/*! For license information please see client.js.LICENSE.txt */
(()=>{"use strict";var t={840:function(t,e,i){var n,s,r;s="undefined"!=typeof window?window:this,r=function(t){function e(e,i,n,s){e.hasOwnProperty(i)||(e[i]=s.apply(null,n),"function"==typeof CustomEvent&&t.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:i,module:e[i]}})))}var i={};return e(i,"Core/Globals.js",[],(function(){var e;return function(e){e.SVG_NS="http://www.w3.org/2000/svg",e.product="Highcharts",e.version="11.1.0",e.win=void 0!==t?t:{},e.doc=e.win.document,e.svg=e.doc&&e.doc.createElementNS&&!!e.doc.createElementNS(e.SVG_NS,"svg").createSVGRect,e.userAgent=e.win.navigator&&e.win.navigator.userAgent||"",e.isChrome=-1!==e.userAgent.indexOf("Chrome"),e.isFirefox=-1!==e.userAgent.indexOf("Firefox"),e.isMS=/(edge|msie|trident)/i.test(e.userAgent)&&!e.win.opera,e.isSafari=!e.isChrome&&-1!==e.userAgent.indexOf("Safari"),e.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(e.userAgent),e.isWebKit=-1!==e.userAgent.indexOf("AppleWebKit"),e.deg2rad=2*Math.PI/360,e.hasBidiBug=e.isFirefox&&4>parseInt(e.userAgent.split("Firefox/")[1],10),e.hasTouch=!!e.win.TouchEvent,e.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],e.noop=function(){},e.supportsPassiveEvents=function(){let t=!1;if(!e.isMS){const i=Object.defineProperty({},"passive",{get:function(){t=!0}});e.win.addEventListener&&e.win.removeEventListener&&(e.win.addEventListener("testPassive",e.noop,i),e.win.removeEventListener("testPassive",e.noop,i))}return t}(),e.charts=[],e.dateFormats={},e.seriesTypes={},e.symbolSizes={},e.chartCount=0}(e||(e={})),e})),e(i,"Core/Utilities.js",[i["Core/Globals.js"]],(function(t){function e(i,n,s,r){const o=n?"Highcharts error":"Highcharts warning";32===i&&(i=`${o}: Deprecated member`);const a=l(i);let h=a?`${o} #${i}: www.highcharts.com/errors/${i}/`:i.toString();if(void 0!==r){let t="";a&&(h+="?"),v(r,(function(e,i){t+=`\n - ${i}: ${e}`,a&&(h+=encodeURI(i)+"="+encodeURI(e))})),h+=t}x(t,"displayError",{chart:s,code:i,message:h,params:r},(function(){if(n)throw Error(h);M.console&&-1===e.messages.indexOf(h)&&console.warn(h)})),e.messages.push(h)}function i(t,e){return parseInt(t,e||10)}function n(t){return"string"==typeof t}function s(t){return"[object Array]"===(t=Object.prototype.toString.call(t))||"[object Array Iterator]"===t}function r(t,e){return!(!t||"object"!=typeof t||e&&s(t))}function o(t){return r(t)&&"number"==typeof t.nodeType}function a(t){const e=t&&t.constructor;return!(!r(t,!0)||o(t)||!e||!e.name||"Object"===e.name)}function l(t){return"number"==typeof t&&!isNaN(t)&&1/0>t&&-1/0<t}function h(t){return null!=t}function c(t,e,i){const s=n(e)&&!h(i);let r;const o=(e,i)=>{h(e)?t.setAttribute(i,e):s?(r=t.getAttribute(i))||"class"!==i||(r=t.getAttribute(i+"Name")):t.removeAttribute(i)};return n(e)?o(i,e):v(e,o),r}function d(t){return s(t)?t:[t]}function u(t,e){let i;for(i in t||(t={}),e)t[i]=e[i];return t}function p(){const t=arguments,e=t.length;for(let i=0;i<e;i++){const e=t[i];if(null!=e)return e}}function f(e,i){t.isMS&&!t.svg&&i&&h(i.opacity)&&(i.filter=`alpha(opacity=${100*i.opacity})`),u(e.style,i)}function m(t){return Math.pow(10,Math.floor(Math.log(t)/Math.LN10))}function g(t,e){return 1e14<t?t:parseFloat(t.toPrecision(e||14))}function v(t,e,i){for(const n in t)Object.hasOwnProperty.call(t,n)&&e.call(i||t[n],t[n],n,t)}function _(t,e,i){function n(e,i){const n=t.removeEventListener;n&&n.call(t,e,i,!1)}function s(i){let s,r;t.nodeName&&(e?(s={},s[e]=!0):s=i,v(s,(function(t,e){if(i[e])for(r=i[e].length;r--;)n(e,i[e][r].fn)})))}var r="function"==typeof t&&t.prototype||t;if(Object.hasOwnProperty.call(r,"hcEvents")){const t=r.hcEvents;e?(r=t[e]||[],i?(t[e]=r.filter((function(t){return i!==t.fn})),n(e,i)):(s(t),t[e]=[])):(s(t),delete r.hcEvents)}}function x(e,i,n,s){if(n=n||{},b.createEvent&&(e.dispatchEvent||e.fireEvent&&e!==t)){var r=b.createEvent("Events");r.initEvent(i,!0,!0),n=u(r,n),e.dispatchEvent?e.dispatchEvent(n):e.fireEvent(i,n)}else if(e.hcEvents){n.target||u(n,{preventDefault:function(){n.defaultPrevented=!0},target:e,type:i}),r=[];let t=e,s=!1;for(;t.hcEvents;)Object.hasOwnProperty.call(t,"hcEvents")&&t.hcEvents[i]&&(r.length&&(s=!0),r.unshift.apply(r,t.hcEvents[i])),t=Object.getPrototypeOf(t);s&&r.sort(((t,e)=>t.order-e.order)),r.forEach((t=>{!1===t.fn.call(e,n)&&n.preventDefault()}))}s&&!n.defaultPrevented&&s.call(e,n)}const{charts:y,doc:b,win:M}=t;(e||(e={})).messages=[],Math.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)};var S=Array.prototype.find?function(t,e){return t.find(e)}:function(t,e){let i;const n=t.length;for(i=0;i<n;i++)if(e(t[i],i))return t[i]};let w;v({map:"map",each:"forEach",grep:"filter",reduce:"reduce",some:"some"},(function(i,n){t[n]=function(t){return e(32,!1,void 0,{[`Highcharts.${n}`]:`use Array.${i}`}),Array.prototype[i].apply(t,[].slice.call(arguments,1))}}));const T=function(){const t=Math.random().toString(36).substring(2,9)+"-";let e=0;return function(){return"highcharts-"+(w?"":t)+e++}}();return M.jQuery&&(M.jQuery.fn.highcharts=function(){const e=[].slice.call(arguments);if(this[0])return e[0]?(new(t[n(e[0])?e.shift():"Chart"])(this[0],e[0],e[1]),this):y[c(this[0],"data-highcharts-chart")]}),S={addEvent:function(e,i,n,s={}){var r="function"==typeof e&&e.prototype||e;Object.hasOwnProperty.call(r,"hcEvents")||(r.hcEvents={}),r=r.hcEvents,t.Point&&e instanceof t.Point&&e.series&&e.series.chart&&(e.series.chart.runTrackerClick=!0);const o=e.addEventListener;return o&&o.call(e,i,n,!!t.supportsPassiveEvents&&{passive:void 0===s.passive?-1!==i.indexOf("touch"):s.passive,capture:!1}),r[i]||(r[i]=[]),r[i].push({fn:n,order:"number"==typeof s.order?s.order:1/0}),r[i].sort(((t,e)=>t.order-e.order)),function(){_(e,i,n)}},arrayMax:function(t){let e=t.length,i=t[0];for(;e--;)t[e]>i&&(i=t[e]);return i},arrayMin:function(t){let e=t.length,i=t[0];for(;e--;)t[e]<i&&(i=t[e]);return i},attr:c,clamp:function(t,e,i){return t>e?t<i?t:i:e},clearTimeout:function(t){h(t)&&clearTimeout(t)},correctFloat:g,createElement:function(t,e,i,n,s){return t=b.createElement(t),e&&u(t,e),s&&f(t,{padding:"0",border:"none",margin:"0"}),i&&f(t,i),n&&n.appendChild(t),t},css:f,defined:h,destroyObjectProperties:function(t,e){v(t,(function(i,n){i&&i!==e&&i.destroy&&i.destroy(),delete t[n]}))},diffObjects:function(t,e,i,n){const o={};return function t(e,o,a,l){const h=i?o:e;v(e,(function(i,c){if(!l&&n&&-1<n.indexOf(c)&&o[c]){i=d(i),a[c]=[];for(let e=0;e<Math.max(i.length,o[c].length);e++)o[c][e]&&(void 0===i[e]?a[c][e]=o[c][e]:(a[c][e]={},t(i[e],o[c][e],a[c][e],l+1)))}else r(i,!0)&&!i.nodeType?(a[c]=s(i)?[]:{},t(i,o[c]||{},a[c],l+1),0!==Object.keys(a[c]).length||"colorAxis"===c&&0===l||delete a[c]):(e[c]!==o[c]||c in e&&!(c in o))&&(a[c]=h[c])}))}(t,e,o,0),o},discardElement:function(t){t&&t.parentElement&&t.parentElement.removeChild(t)},erase:function(t,e){let i=t.length;for(;i--;)if(t[i]===e){t.splice(i,1);break}},error:e,extend:u,extendClass:function(t,e){const i=function(){};return u(i.prototype=new t,e),i},find:S,fireEvent:x,getClosestDistance:function(t,e){const i=!e;let n,s,r,o;return t.forEach((t=>{if(1<t.length)for(o=s=t.length-1;0<o;o--)r=t[o]-t[o-1],0>r&&!i?(null==e||e(),e=void 0):r&&(void 0===n||r<n)&&(n=r)})),n},getMagnitude:m,getNestedProperty:function(t,e){for(t=t.split(".");t.length&&h(e);){const i=t.shift();if(void 0===i||"__proto__"===i)return;if("this"===i){let t;return r(e)&&(t=e["@this"]),null!=t?t:e}if(!h(e=e[i])||"function"==typeof e||"number"==typeof e.nodeType||e===M)return}return e},getStyle:function t(e,n,s){let r;return"width"===n?(n=Math.min(e.offsetWidth,e.scrollWidth),(s=e.getBoundingClientRect&&e.getBoundingClientRect().width)<n&&s>=n-1&&(n=Math.floor(s)),Math.max(0,n-(t(e,"padding-left",!0)||0)-(t(e,"padding-right",!0)||0))):"height"===n?Math.max(0,Math.min(e.offsetHeight,e.scrollHeight)-(t(e,"padding-top",!0)||0)-(t(e,"padding-bottom",!0)||0)):((e=M.getComputedStyle(e,void 0))&&(r=e.getPropertyValue(n),p(s,"opacity"!==n)&&(r=i(r))),r)},inArray:function(t,i,n){return e(32,!1,void 0,{"Highcharts.inArray":"use Array.indexOf"}),i.indexOf(t,n)},insertItem:function(t,e){const i=t.options.index,n=e.length;let s;for(s=t.options.isInternal?n:0;s<n+1;s++)if(!e[s]||l(i)&&i<p(e[s].options.index,e[s]._i)||e[s].options.isInternal){e.splice(s,0,t);break}return s},isArray:s,isClass:a,isDOMElement:o,isFunction:function(t){return"function"==typeof t},isNumber:l,isObject:r,isString:n,keys:function(t){return e(32,!1,void 0,{"Highcharts.keys":"use Object.keys"}),Object.keys(t)},merge:function(){let t,e=arguments,i={};const n=function(t,e){return"object"!=typeof t&&(t={}),v(e,(function(i,s){"__proto__"!==s&&"constructor"!==s&&(!r(i,!0)||a(i)||o(i)?t[s]=e[s]:t[s]=n(t[s]||{},i))})),t};!0===e[0]&&(i=e[1],e=Array.prototype.slice.call(e,2));const s=e.length;for(t=0;t<s;t++)i=n(i,e[t]);return i},normalizeTickInterval:function(t,e,i,n,s){let r=t;const o=t/(i=p(i,m(t)));for(e||(e=s?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],!1===n&&(1===i?e=e.filter((function(t){return 0==t%1})):.1>=i&&(e=[1/i]))),n=0;n<e.length&&(r=e[n],!(s&&r*i>=t||!s&&o<=(e[n]+(e[n+1]||e[n]))/2));n++);return g(r*i,-Math.round(Math.log(.001)/Math.LN10))},objectEach:v,offset:function(t){const e=b.documentElement;return{top:(t=t.parentElement||t.parentNode?t.getBoundingClientRect():{top:0,left:0,width:0,height:0}).top+(M.pageYOffset||e.scrollTop)-(e.clientTop||0),left:t.left+(M.pageXOffset||e.scrollLeft)-(e.clientLeft||0),width:t.width,height:t.height}},pad:function(t,e,i){return Array((e||2)+1-String(t).replace("-","").length).join(i||"0")+t},pick:p,pInt:i,pushUnique:function(t,e){return 0>t.indexOf(e)&&!!t.push(e)},relativeLength:function(t,e,i){return/%$/.test(t)?e*parseFloat(t)/100+(i||0):parseFloat(t)},removeEvent:_,splat:d,stableSort:function(t,e){const i=t.length;let n,s;for(s=0;s<i;s++)t[s].safeI=s;for(t.sort((function(t,i){return n=e(t,i),0===n?t.safeI-i.safeI:n})),s=0;s<i;s++)delete t[s].safeI},syncTimeout:function(t,e,i){return 0<e?setTimeout(t,e,i):(t.call(0,i),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},uniqueKey:T,useSerialIds:function(t){return w=p(t,w)},wrap:function(t,e,i){const n=t[e];t[e]=function(){const t=arguments,e=this;return i.apply(this,[function(){return n.apply(e,arguments.length?arguments:t)}].concat([].slice.call(arguments)))}}},S})),e(i,"Core/Chart/ChartDefaults.js",[],(function(){return{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"}})),e(i,"Core/Color/Color.js",[i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e){const{isNumber:i,merge:n,pInt:s}=e;class r{static parse(t){return t?new r(t):r.None}constructor(e){this.rgba=[NaN,NaN,NaN,NaN],this.input=e;const i=t.Color;if(i&&i!==r)return new i(e);this.init(e)}init(t){let e,i;if("object"==typeof t&&void 0!==t.stops)this.stops=t.stops.map((t=>new r(t[1])));else if("string"==typeof t){if(this.input=t=r.names[t.toLowerCase()]||t,"#"===t.charAt(0)){var n=t.length,s=parseInt(t.substr(1),16);7===n?e=[(16711680&s)>>16,(65280&s)>>8,255&s,1]:4===n&&(e=[(3840&s)>>4|(3840&s)>>8,(240&s)>>4|240&s,(15&s)<<4|15&s,1])}if(!e)for(s=r.parsers.length;s--&&!e;)i=r.parsers[s],(n=i.regex.exec(t))&&(e=i.parse(n))}e&&(this.rgba=e)}get(t){const e=this.input,s=this.rgba;if("object"==typeof e&&void 0!==this.stops){const i=n(e);return i.stops=[].slice.call(i.stops),this.stops.forEach(((e,n)=>{i.stops[n]=[i.stops[n][0],e.get(t)]})),i}return s&&i(s[0])?"rgb"===t||!t&&1===s[3]?"rgb("+s[0]+","+s[1]+","+s[2]+")":"a"===t?`${s[3]}`:"rgba("+s.join(",")+")":e}brighten(t){const e=this.rgba;if(this.stops)this.stops.forEach((function(e){e.brighten(t)}));else if(i(t)&&0!==t)for(let i=0;3>i;i++)e[i]+=s(255*t),0>e[i]&&(e[i]=0),255<e[i]&&(e[i]=255);return this}setOpacity(t){return this.rgba[3]=t,this}tweenTo(t,e){const n=this.rgba,s=t.rgba;return i(n[0])&&i(s[0])?((t=1!==s[3]||1!==n[3])?"rgba(":"rgb(")+Math.round(s[0]+(n[0]-s[0])*(1-e))+","+Math.round(s[1]+(n[1]-s[1])*(1-e))+","+Math.round(s[2]+(n[2]-s[2])*(1-e))+(t?","+(s[3]+(n[3]-s[3])*(1-e)):"")+")":t.input||"none"}}return r.names={white:"#ffffff",black:"#000000"},r.parsers=[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(t){return[s(t[1]),s(t[2]),s(t[3]),parseFloat(t[4],10)]}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(t){return[s(t[1]),s(t[2]),s(t[3]),1]}}],r.None=new r(""),r})),e(i,"Core/Color/Palettes.js",[],(function(){return{colors:"#2caffe #544fc5 #00e272 #fe6a35 #6b8abc #d568fb #2ee0ca #fa4b42 #feb56a #91e8e1".split(" ")}})),e(i,"Core/Time.js",[i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e){const{win:i}=t,{defined:n,error:s,extend:r,isObject:o,merge:a,objectEach:l,pad:h,pick:c,splat:d,timeUnits:u}=e,p=t.isSafari&&i.Intl&&i.Intl.DateTimeFormat.prototype.formatRange,f=t.isSafari&&i.Intl&&!i.Intl.DateTimeFormat.prototype.formatRange;return class{constructor(t){this.options={},this.variableTimezone=this.useUTC=!1,this.Date=i.Date,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.update(t)}get(t,e){if(this.variableTimezone||this.timezoneOffset){const i=e.getTime(),n=i-this.getTimezoneOffset(e);return e.setTime(n),t=e["getUTC"+t](),e.setTime(i),t}return this.useUTC?e["getUTC"+t]():e["get"+t]()}set(t,e,i){if(this.variableTimezone||this.timezoneOffset){if("Milliseconds"===t||"Seconds"===t||"Minutes"===t&&0==this.getTimezoneOffset(e)%36e5)return e["setUTC"+t](i);var n=this.getTimezoneOffset(e);return n=e.getTime()-n,e.setTime(n),e["setUTC"+t](i),t=this.getTimezoneOffset(e),n=e.getTime()+t,e.setTime(n)}return this.useUTC||p&&"FullYear"===t?e["setUTC"+t](i):e["set"+t](i)}update(t={}){const e=c(t.useUTC,!0);this.options=t=a(!0,this.options,t),this.Date=t.Date||i.Date||Date,this.timezoneOffset=(this.useUTC=e)&&t.timezoneOffset||void 0,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.variableTimezone=e&&!(!t.getTimezoneOffset&&!t.timezone)}makeTime(t,e,i,n,s,r){let o,a,l;return this.useUTC?(o=this.Date.UTC.apply(0,arguments),a=this.getTimezoneOffset(o),o+=a,l=this.getTimezoneOffset(o),a!==l?o+=l-a:a-36e5!==this.getTimezoneOffset(o-36e5)||f||(o-=36e5)):o=new this.Date(t,e,c(i,1),c(n,0),c(s,0),c(r,0)).getTime(),o}timezoneOffsetFunction(){const t=this,e=this.options,n=e.getTimezoneOffset,r=e.moment||i.moment;if(!this.useUTC)return function(t){return 6e4*new Date(t.toString()).getTimezoneOffset()};if(e.timezone){if(r)return function(t){return 6e4*-r.tz(t,e.timezone).utcOffset()};s(25)}return this.useUTC&&n?function(t){return 6e4*n(t.valueOf())}:function(){return 6e4*(t.timezoneOffset||0)}}dateFormat(e,i,s){if(!n(i)||isNaN(i))return t.defaultOptions.lang&&t.defaultOptions.lang.invalidDate||"";e=c(e,"%Y-%m-%d %H:%M:%S");const o=this;var a=new this.Date(i);const d=this.get("Hours",a),u=this.get("Day",a),p=this.get("Date",a),f=this.get("Month",a),m=this.get("FullYear",a),g=t.defaultOptions.lang,v=g&&g.weekdays,_=g&&g.shortWeekdays;return a=r({a:_?_[u]:v[u].substr(0,3),A:v[u],d:h(p),e:h(p,2," "),w:u,b:g.shortMonths[f],B:g.months[f],m:h(f+1),o:f+1,y:m.toString().substr(2,2),Y:m,H:h(d),k:d,I:h(d%12||12),l:d%12||12,M:h(this.get("Minutes",a)),p:12>d?"AM":"PM",P:12>d?"am":"pm",S:h(a.getSeconds()),L:h(Math.floor(i%1e3),3)},t.dateFormats),l(a,(function(t,n){for(;-1!==e.indexOf("%"+n);)e=e.replace("%"+n,"function"==typeof t?t.call(o,i):t)})),s?e.substr(0,1).toUpperCase()+e.substr(1):e}resolveDTLFormat(t){return o(t,!0)?t:{main:(t=d(t))[0],from:t[1],to:t[2]}}getTimeTicks(t,e,i,s){const o=this,a=[],l={};var h=new o.Date(e);const d=t.unitRange,p=t.count||1;let f;if(s=c(s,1),n(e)){if(o.set("Milliseconds",h,d>=u.second?0:p*Math.floor(o.get("Milliseconds",h)/p)),d>=u.second&&o.set("Seconds",h,d>=u.minute?0:p*Math.floor(o.get("Seconds",h)/p)),d>=u.minute&&o.set("Minutes",h,d>=u.hour?0:p*Math.floor(o.get("Minutes",h)/p)),d>=u.hour&&o.set("Hours",h,d>=u.day?0:p*Math.floor(o.get("Hours",h)/p)),d>=u.day&&o.set("Date",h,d>=u.month?1:Math.max(1,p*Math.floor(o.get("Date",h)/p))),d>=u.month){o.set("Month",h,d>=u.year?0:p*Math.floor(o.get("Month",h)/p));var m=o.get("FullYear",h)}d>=u.year&&o.set("FullYear",h,m-m%p),d===u.week&&(m=o.get("Day",h),o.set("Date",h,o.get("Date",h)-m+s+(m<s?-7:0))),m=o.get("FullYear",h),s=o.get("Month",h);const t=o.get("Date",h),r=o.get("Hours",h);for(e=h.getTime(),!o.variableTimezone&&o.useUTC||!n(i)||(f=i-e>4*u.month||o.getTimezoneOffset(e)!==o.getTimezoneOffset(i)),e=h.getTime(),h=1;e<i;)a.push(e),e=d===u.year?o.makeTime(m+h*p,0):d===u.month?o.makeTime(m,s+h*p):!f||d!==u.day&&d!==u.week?f&&d===u.hour&&1<p?o.makeTime(m,s,t,r+h*p):e+d*p:o.makeTime(m,s,t+h*p*(d===u.day?1:7)),h++;a.push(e),d<=u.hour&&1e4>a.length&&a.forEach((function(t){0==t%18e5&&"000000000"===o.dateFormat("%H%M%S%L",t)&&(l[t]="day")}))}return a.info=r(t,{higherRanks:l,totalRange:d*p}),a}getDateFormat(t,e,i,n){const s=this.dateFormat("%m-%d %H:%M:%S.%L",e),r={millisecond:15,second:12,minute:9,hour:6,day:3};let o,a="millisecond";for(o in u){if(t===u.week&&+this.dateFormat("%w",e)===i&&"00:00:00.000"===s.substr(6)){o="week";break}if(u[o]>t){o=a;break}if(r[o]&&s.substr(r[o])!=="01-01 00:00:00.000".substr(r[o]))break;"week"!==o&&(a=o)}return this.resolveDTLFormat(n[o]).main}}})),e(i,"Core/Defaults.js",[i["Core/Chart/ChartDefaults.js"],i["Core/Color/Color.js"],i["Core/Globals.js"],i["Core/Color/Palettes.js"],i["Core/Time.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r){const{isTouchDevice:o,svg:a}=i,{merge:l}=r,h={colors:n.colors,symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January February March April May June July August September October November December".split(" "),shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),decimalPoint:".",numericSymbols:"kMGTPE".split(""),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{},time:{Date:void 0,getTimezoneOffset:void 0,timezone:void 0,timezoneOffset:0,useUTC:!0},chart:t,title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",align:"center",margin:15,widthAdjust:-44},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:"",align:"center",widthAdjust:-44},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:a,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %e %b, %H:%M:%S.%L",second:"%A, %e %b, %H:%M:%S",minute:"%A, %e %b, %H:%M",hour:"%A, %e %b, %H:%M",day:"%A, %e %b %Y",week:"Week from %A, %e %b %Y",month:"%B %Y",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,shape:"callout",shared:!1,snap:o?25:10,headerFormat:'<span style="font-size: 0.8em">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,shadow:!0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}};h.chart.styledMode=!1;const c=new s(h.time);return{defaultOptions:h,defaultTime:c,getOptions:function(){return h},setOptions:function(t){return l(!0,h,t),(t.time||t.global)&&(i.time?i.time.update(l(h.global,h.time,t.global,t.time)):i.time=c),h}}})),e(i,"Core/Animation/Fx.js",[i["Core/Color/Color.js"],i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e,i){const{parse:n}=t,{win:s}=e,{isNumber:r,objectEach:o}=i;class a{constructor(t,e,i){this.pos=NaN,this.options=e,this.elem=t,this.prop=i}dSetter(){var t=this.paths;const e=t&&t[0];t=t&&t[1];const i=this.now||0;let n=[];if(1!==i&&e&&t)if(e.length===t.length&&1>i)for(let s=0;s<t.length;s++){const o=e[s],a=t[s],l=[];for(let t=0;t<a.length;t++){const e=o[t],n=a[t];r(e)&&r(n)&&("A"!==a[0]||4!==t&&5!==t)?l[t]=e+i*(n-e):l[t]=n}n.push(l)}else n=t;else n=this.toD||[];this.elem.attr("d",n,void 0,!0)}update(){const t=this.elem,e=this.prop,i=this.now,n=this.options.step;this[e+"Setter"]?this[e+"Setter"]():t.attr?t.element&&t.attr(e,i,null,!0):t.style[e]=i+this.unit,n&&n.call(t,i,this)}run(t,e,i){const n=this,r=n.options,o=function(t){return!o.stopped&&n.step(t)},l=s.requestAnimationFrame||function(t){setTimeout(t,13)},h=function(){for(let t=0;t<a.timers.length;t++)a.timers[t]()||a.timers.splice(t--,1);a.timers.length&&l(h)};t!==e||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=t,this.end=e,this.unit=i,this.now=this.start,this.pos=0,o.elem=this.elem,o.prop=this.prop,o()&&1===a.timers.push(o)&&l(h)):(delete r.curAnim[this.prop],r.complete&&0===Object.keys(r.curAnim).length&&r.complete.call(this.elem))}step(t){const e=+new Date,i=this.options,n=this.elem,s=i.complete,r=i.duration,a=i.curAnim;let l;return n.attr&&!n.element?t=!1:t||e>=r+this.startTime?(this.now=this.end,this.pos=1,this.update(),l=a[this.prop]=!0,o(a,(function(t){!0!==t&&(l=!1)})),l&&s&&s.call(n),t=!1):(this.pos=i.easing((e-this.startTime)/r),this.now=this.start+(this.end-this.start)*this.pos,this.update(),t=!0),t}initPath(t,e,i){function n(t,e){for(;t.length<d;){var i=t[0];const n=e[d-t.length];n&&"M"===i[0]&&(t[0]="C"===n[0]?["C",i[1],i[2],i[1],i[2],i[1],i[2]]:["L",i[1],i[2]]),t.unshift(i),l&&(i=t.pop(),t.push(t[t.length-1],i))}}function s(t,e){for(;t.length<d;)if("C"===(e=t[Math.floor(t.length/h)-1].slice())[0]&&(e[1]=e[5],e[2]=e[6]),l){const i=t[Math.floor(t.length/h)].slice();t.splice(t.length/2,0,e,i)}else t.push(e)}const o=t.startX,a=t.endX;i=i.slice();const l=t.isArea,h=l?2:1;let c,d,u;if(!(e=e&&e.slice()))return[i,i];if(o&&a&&a.length){for(t=0;t<o.length;t++){if(o[t]===a[0]){c=t;break}if(o[0]===a[a.length-o.length+t]){c=t,u=!0;break}if(o[o.length-1]===a[a.length-o.length+t]){c=o.length-t;break}}void 0===c&&(e=[])}return e.length&&r(c)&&(d=i.length+c*h,u?(n(e,i),s(i,e)):(n(i,e),s(e,i))),[e,i]}fillSetter(){a.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,n(this.start).tweenTo(n(this.end),this.pos),void 0,!0)}}return a.timers=[],a})),e(i,"Core/Animation/AnimationUtilities.js",[i["Core/Animation/Fx.js"],i["Core/Utilities.js"]],(function(t,e){function i(t){return l(t)?h({duration:500,defer:0},t):{duration:t?500:0,defer:0}}function n(e,i){let n=t.timers.length;for(;n--;)t.timers[n].elem!==e||i&&i!==t.timers[n].prop||(t.timers[n].stopped=!0)}const{defined:s,getStyle:r,isArray:o,isNumber:a,isObject:l,merge:h,objectEach:c,pick:d}=e;return{animate:function(e,i,s){let d,u,p,f,m="";l(s)||(f=arguments,s={duration:f[2],easing:f[3],complete:f[4]}),a(s.duration)||(s.duration=400),s.easing="function"==typeof s.easing?s.easing:Math[s.easing]||Math.easeInOutSine,s.curAnim=h(i),c(i,(function(a,l){n(e,l),p=new t(e,s,l),u=void 0,"d"===l&&o(i.d)?(p.paths=p.initPath(e,e.pathArray,i.d),p.toD=i.d,d=0,u=1):e.attr?d=e.attr(l):(d=parseFloat(r(e,l))||0,"opacity"!==l&&(m="px")),u||(u=a),"string"==typeof u&&u.match("px")&&(u=u.replace(/px/g,"")),p.run(d,u,m)}))},animObject:i,getDeferredAnimation:function(t,e,n){const r=i(e);let o=0,a=0;return(n?[n]:t.series).forEach((t=>{t=i(t.options.animation),o=e&&s(e.defer)?r.defer:Math.max(o,t.duration+t.defer),a=Math.min(r.duration,t.duration)})),t.renderer.forExport&&(o=0),{defer:Math.max(0,o-a),duration:Math.min(o,a)}},setAnimation:function(t,e){e.renderer.globalAnimation=d(t,e.options.chart.animation,!0)},stop:n}})),e(i,"Core/Renderer/HTML/AST.js",[i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e){const{SVG_NS:i,win:n}=t,{attr:s,createElement:r,css:o,error:a,isFunction:l,isString:h,objectEach:c,splat:d}=e;({trustedTypes:e}=n);const u=e&&l(e.createPolicy)&&e.createPolicy("highcharts",{createHTML:t=>t});e=u?u.createHTML(""):"";try{var p=!!(new DOMParser).parseFromString(e,"text/html")}catch(t){p=!1}const f=p;class m{static filterUserAttributes(t){return c(t,((e,i)=>{let n=!0;-1===m.allowedAttributes.indexOf(i)&&(n=!1),-1!==["background","dynsrc","href","lowsrc","src"].indexOf(i)&&(n=h(e)&&m.allowedReferences.some((t=>0===e.indexOf(t)))),n||(a(33,!1,void 0,{"Invalid attribute in config":`${i}`}),delete t[i]),h(e)&&t[i]&&(t[i]=e.replace(/</g,"&lt;"))})),t}static parseStyle(t){return t.split(";").reduce(((t,e)=>{const i=(e=e.split(":").map((t=>t.trim()))).shift();return i&&e.length&&(t[i.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))]=e.join(":")),t}),{})}static setElementHTML(t,e){t.innerHTML=m.emptyHTML,e&&new m(e).addToDOM(t)}constructor(t){this.nodes="string"==typeof t?this.parseMarkup(t):t}addToDOM(e){return function e(n,r){let l;return d(n).forEach((function(n){var h=n.tagName;const d=n.textContent?t.doc.createTextNode(n.textContent):void 0,u=m.bypassHTMLFiltering;let p;if(h)if("#text"===h)p=d;else if(-1!==m.allowedTags.indexOf(h)||u){h=t.doc.createElementNS("svg"===h?i:r.namespaceURI||i,h);const a=n.attributes||{};c(n,(function(t,e){"tagName"!==e&&"attributes"!==e&&"children"!==e&&"style"!==e&&"textContent"!==e&&(a[e]=t)})),s(h,u?a:m.filterUserAttributes(a)),n.style&&o(h,n.style),d&&h.appendChild(d),e(n.children||[],h),p=h}else a(33,!1,void 0,{"Invalid tagName in config":h});p&&r.appendChild(p),l=p})),l}(this.nodes,e)}parseMarkup(t){const e=[];if(t=t.trim().replace(/ style=(["'])/g," data-style=$1"),f)t=(new DOMParser).parseFromString(u?u.createHTML(t):t,"text/html");else{const e=r("div");e.innerHTML=t,t={body:e}}const i=(t,e)=>{var n=t.nodeName.toLowerCase();const s={tagName:n};if("#text"===n&&(s.textContent=t.textContent||""),n=t.attributes){const t={};[].forEach.call(n,(e=>{"data-style"===e.name?s.style=m.parseStyle(e.value):t[e.name]=e.value})),s.attributes=t}if(t.childNodes.length){const e=[];[].forEach.call(t.childNodes,(t=>{i(t,e)})),e.length&&(s.children=e)}e.push(s)};return[].forEach.call(t.body.childNodes,(t=>i(t,e))),e}}return m.allowedAttributes="alt aria-controls aria-describedby aria-expanded aria-haspopup aria-hidden aria-label aria-labelledby aria-live aria-pressed aria-readonly aria-roledescription aria-selected class clip-path color colspan cx cy d dx dy disabled fill flood-color flood-opacity height href id in markerHeight markerWidth offset opacity orient padding paddingLeft paddingRight patternUnits r refX refY role scope slope src startOffset stdDeviation stroke stroke-linecap stroke-width style tableValues result rowspan summary target tabindex text-align text-anchor textAnchor textLength title type valign width x x1 x2 xlink:href y y1 y2 zIndex".split(" "),m.allowedReferences="https:// http:// mailto: / ../ ./ #".split(" "),m.allowedTags="a abbr b br button caption circle clipPath code dd defs div dl dt em feComponentTransfer feDropShadow feFuncA feFuncB feFuncG feFuncR feGaussianBlur feOffset feMerge feMergeNode filter h1 h2 h3 h4 h5 h6 hr i img li linearGradient marker ol p path pattern pre rect small span stop strong style sub sup svg table text textPath thead title tbody tspan td th tr u ul #text".split(" "),m.emptyHTML=e,m.bypassHTMLFiltering=!1,m})),e(i,"Core/Templating.js",[i["Core/Defaults.js"],i["Core/Utilities.js"]],(function(t,e){function i(t="",e,o){const l=/\{([a-zA-Z0-9:\.,;\-\/<>%_@"'= #\(\)]+)\}/g,h=/\(([a-zA-Z0-9:\.,;\-\/<>%_@"'= ]+)\)/g,c=[],u=/f$/,f=/\.([0-9])/,m=s.lang,g=o&&o.time||r,v=o&&o.numberFormatter||n,_=(t="")=>{let i;return"true"===t||"false"!==t&&((i=Number(t)).toString()===t?i:a(t,e))};let x,y,b,M=0;for(;null!==(x=l.exec(t));){const i=h.exec(x[1]);i&&(x=i,b=!0),y&&y.isBlock||(y={ctx:e,expression:x[1],find:x[0],isBlock:"#"===x[1].charAt(0),start:x.index,startInner:x.index+x[0].length,length:x[0].length});var S=x[1].split(" ")[0].replace("#","");if(p[S]&&(y.isBlock&&S===y.fn&&M++,y.fn||(y.fn=S)),S="else"===x[1],y.isBlock&&y.fn&&(x[1]===`/${y.fn}`||S))if(M)S||M--;else{var w=y.startInner;w=t.substr(w,x.index-w),void 0===y.body?(y.body=w,y.startInner=x.index+x[0].length):y.elseBody=w,y.find+=w+x[0],S||(c.push(y),y=void 0)}else y.isBlock||c.push(y);if(i&&(null==y||!y.isBlock))break}return c.forEach((n=>{const{body:s,elseBody:r,expression:o,fn:a}=n;var l;if(a){var h=[n],c=o.split(" ");for(l=p[a].length;l--;)h.unshift(_(c[l+1]));l=p[a].apply(e,h),n.isBlock&&"boolean"==typeof l&&(l=i(l?s:r,e))}else h=o.split(":"),l=_(h.shift()||""),h.length&&"number"==typeof l&&(h=h.join(":"),u.test(h)?(c=parseInt((h.match(f)||["","-1"])[1],10),null!==l&&(l=v(l,c,m.decimalPoint,-1<h.indexOf(",")?m.thousandsSep:""))):l=g.dateFormat(h,l));t=t.replace(n.find,d(l,""))})),b?i(t,e,o):t}function n(t,e,i,n){t=+t||0,e=+e;const r=s.lang;var o=(t.toString().split(".")[1]||"").split("e")[0].length;const a=t.toString().split("e"),l=e;if(-1===e)e=Math.min(o,20);else if(h(e)){if(e&&a[1]&&0>a[1]){var c=e+ +a[1];0<=c?(a[0]=(+a[0]).toExponential(c).split("e")[0],e=c):(a[0]=a[0].split(".")[0]||0,t=20>e?(a[0]*Math.pow(10,a[1])).toFixed(e):0,a[1]=0)}}else e=2;c=(Math.abs(a[1]?a[0]:t)+Math.pow(10,-Math.max(e,o)-1)).toFixed(e);const p=3<(o=String(u(c))).length?o.length%3:0;return i=d(i,r.decimalPoint),n=d(n,r.thousandsSep),t=(0>t?"-":"")+(p?o.substr(0,p)+n:""),t=0>+a[1]&&!l?"0":t+o.substr(p).replace(/(\d{3})(?=\d)/g,"$1"+n),e&&(t+=i+c.slice(-e)),a[1]&&0!=+t&&(t+="e"+a[1]),t}const{defaultOptions:s,defaultTime:r}=t,{extend:o,getNestedProperty:a,isArray:l,isNumber:h,isObject:c,pick:d,pInt:u}=e,p={add:(t,e)=>t+e,divide:(t,e)=>0!==e?t/e:"",eq:(t,e)=>t==e,each:function(t){const e=arguments[arguments.length-1];return!!l(t)&&t.map(((n,s)=>i(e.body,o(c(n)?n:{"@this":n},{"@index":s,"@first":0===s,"@last":s===t.length-1})))).join("")},ge:(t,e)=>t>=e,gt:(t,e)=>t>e,if:t=>!!t,le:(t,e)=>t<=e,lt:(t,e)=>t<e,multiply:(t,e)=>t*e,ne:(t,e)=>t!=e,subtract:(t,e)=>t-e,unless:t=>!t};return{dateFormat:function(t,e,i){return r.dateFormat(t,e,i)},format:i,helpers:p,numberFormat:n}})),e(i,"Core/Renderer/RendererUtilities.js",[i["Core/Utilities.js"]],(function(t){const{clamp:e,pick:i,stableSort:n}=t;var s;return function(t){t.distribute=function t(s,r,o){const a=s;var l=a.reducedLen||r,h=(t,e)=>(e.rank||0)-(t.rank||0);const c=(t,e)=>t.target-e.target;let d,u=!0,p=[],f=0;for(d=s.length;d--;)f+=s[d].size;if(f>l){for(n(s,h),f=d=0;f<=l;)f+=s[d].size,d++;p=s.splice(d-1,s.length)}for(n(s,c),s=s.map((t=>({size:t.size,targets:[t.target],align:i(t.align,.5)})));u;){for(d=s.length;d--;)l=s[d],h=(Math.min.apply(0,l.targets)+Math.max.apply(0,l.targets))/2,l.pos=e(h-l.size*l.align,0,r-l.size);for(d=s.length,u=!1;d--;)0<d&&s[d-1].pos+s[d-1].size>s[d].pos&&(s[d-1].size+=s[d].size,s[d-1].targets=s[d-1].targets.concat(s[d].targets),s[d-1].align=.5,s[d-1].pos+s[d-1].size>r&&(s[d-1].pos=r-s[d-1].size),s.splice(d,1),u=!0)}return a.push.apply(a,p),d=0,s.some((e=>{let i=0;return(e.targets||[]).some((()=>(a[d].pos=e.pos+i,void 0!==o&&Math.abs(a[d].pos-a[d].target)>o?(a.slice(0,d+1).forEach((t=>delete t.pos)),a.reducedLen=(a.reducedLen||r)-.1*r,a.reducedLen>.1*r&&t(a,r,o),!0):(i+=a[d].size,d++,!1))))})),n(a,c),a}}(s||(s={})),s})),e(i,"Core/Renderer/SVG/SVGElement.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Color/Color.js"],i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e,i,n){const{animate:s,animObject:r,stop:o}=t,{deg2rad:a,doc:l,svg:h,SVG_NS:c,win:d}=i,{addEvent:u,attr:p,createElement:f,css:m,defined:g,erase:v,extend:_,fireEvent:x,isArray:y,isFunction:b,isObject:M,isString:S,merge:w,objectEach:T,pick:E,pInt:A,syncTimeout:C,uniqueKey:P}=n;class L{constructor(){this.element=void 0,this.onEvents={},this.opacity=1,this.renderer=void 0,this.SVG_NS=c}_defaultGetter(t){return t=E(this[t+"Value"],this[t],this.element?this.element.getAttribute(t):null,0),/^[\-0-9\.]+$/.test(t)&&(t=parseFloat(t)),t}_defaultSetter(t,e,i){i.setAttribute(e,t)}add(t){const e=this.renderer,i=this.element;let n;return t&&(this.parentGroup=t),void 0!==this.textStr&&"text"===this.element.nodeName&&e.buildText(this),this.added=!0,(!t||t.handleZ||this.zIndex)&&(n=this.zIndexSetter()),n||(t?t.element:e.box).appendChild(i),this.onAdd&&this.onAdd(),this}addClass(t,e){const i=e?"":this.attr("class")||"";return t=(t||"").split(/ /g).reduce((function(t,e){return-1===i.indexOf(e)&&t.push(e),t}),i?[i]:[]).join(" "),t!==i&&this.attr("class",t),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(t,e,i){const n={};var s,r=this.renderer,o=r.alignedObjects;let a,l;t?(this.alignOptions=t,this.alignByTranslate=e,(!i||S(i))&&(this.alignTo=s=i||"renderer",v(o,this),o.push(this),i=void 0)):(t=this.alignOptions,e=this.alignByTranslate,s=this.alignTo),i=E(i,r[s],"scrollablePlotBox"===s?r.plotBox:void 0,r),s=t.align;const h=t.verticalAlign;return r=(i.x||0)+(t.x||0),o=(i.y||0)+(t.y||0),"right"===s?a=1:"center"===s&&(a=2),a&&(r+=(i.width-(t.width||0))/a),n[e?"translateX":"x"]=Math.round(r),"bottom"===h?l=1:"middle"===h&&(l=2),l&&(o+=(i.height-(t.height||0))/l),n[e?"translateY":"y"]=Math.round(o),this[this.placed?"animate":"attr"](n),this.placed=!0,this.alignAttr=n,this}alignSetter(t){const e={left:"start",center:"middle",right:"end"};e[t]&&(this.alignValue=t,this.element.setAttribute("text-anchor",e[t]))}animate(t,e,i){const n=r(E(e,this.renderer.globalAnimation,!0));return e=n.defer,l.hidden&&(n.duration=0),0!==n.duration?(i&&(n.complete=i),C((()=>{this.element&&s(this,t,n)}),e)):(this.attr(t,void 0,i||n.complete),T(t,(function(t,e){n.step&&n.step.call(this,t,{prop:e,pos:1,elem:this})}),this)),this}applyTextOutline(t){const e=this.element;-1!==t.indexOf("contrast")&&(t=t.replace(/contrast/g,this.renderer.getContrast(e.style.fill)));var n=t.split(" ");if(t=n[n.length-1],(n=n[0])&&"none"!==n&&i.svg){this.fakeTS=!0,n=n.replace(/(^[\d\.]+)(.*?)$/g,(function(t,e,i){return 2*Number(e)+i})),this.removeTextOutline();const i=l.createElementNS(c,"tspan");p(i,{class:"highcharts-text-outline",fill:t,stroke:t,"stroke-width":n,"stroke-linejoin":"round"}),t=e.querySelector("textPath")||e,[].forEach.call(t.childNodes,(t=>{const e=t.cloneNode(!0);e.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach((t=>e.removeAttribute(t))),i.appendChild(e)}));let s=0;[].forEach.call(t.querySelectorAll("text tspan"),(t=>{s+=Number(t.getAttribute("dy"))})),(n=l.createElementNS(c,"tspan")).textContent="​",p(n,{x:Number(e.getAttribute("x")),dy:-s}),i.appendChild(n),t.insertBefore(i,t.firstChild)}}attr(t,e,i,n){const s=this.element,r=L.symbolCustomAttribs;let a,l,h,c,d=this;return"string"==typeof t&&void 0!==e&&(a=t,(t={})[a]=e),"string"==typeof t?d=(this[t+"Getter"]||this._defaultGetter).call(this,t,s):(T(t,(function(e,i){h=!1,n||o(this,i),this.symbolName&&-1!==r.indexOf(i)&&(l||(this.symbolAttr(t),l=!0),h=!0),!this.rotation||"x"!==i&&"y"!==i||(this.doTransform=!0),h||(c=this[i+"Setter"]||this._defaultSetter,c.call(this,e,i,s))}),this),this.afterSetters()),i&&i.call(this),d}clip(t){return this.attr("clip-path",t?"url("+this.renderer.url+"#"+t.id+")":"none")}crisp(t,e){e=e||t.strokeWidth||0;const i=Math.round(e)%2/2;return t.x=Math.floor(t.x||this.x||0)+i,t.y=Math.floor(t.y||this.y||0)+i,t.width=Math.floor((t.width||this.width||0)-2*i),t.height=Math.floor((t.height||this.height||0)-2*i),g(t.strokeWidth)&&(t.strokeWidth=e),t}complexColor(t,i,n){const s=this.renderer;let r,o,a,l,h,c,d,u,p,f,m,v=[];x(this.renderer,"complexColor",{args:arguments},(function(){if(t.radialGradient?o="radialGradient":t.linearGradient&&(o="linearGradient"),o){if(a=t[o],h=s.gradients,c=t.stops,p=n.radialReference,y(a)&&(t[o]=a={x1:a[0],y1:a[1],x2:a[2],y2:a[3],gradientUnits:"userSpaceOnUse"}),"radialGradient"===o&&p&&!g(a.gradientUnits)&&(l=a,a=w(a,s.getRadialAttr(p,l),{gradientUnits:"userSpaceOnUse"})),T(a,(function(t,e){"id"!==e&&v.push(e,t)})),T(c,(function(t){v.push(t)})),v=v.join(","),h[v])f=h[v].attr("id");else{a.id=f=P();const t=h[v]=s.createElement(o).attr(a).add(s.defs);t.radAttr=l,t.stops=[],c.forEach((function(i){0===i[1].indexOf("rgba")?(r=e.parse(i[1]),d=r.get("rgb"),u=r.get("a")):(d=i[1],u=1),i=s.createElement("stop").attr({offset:i[0],"stop-color":d,"stop-opacity":u}).add(t),t.stops.push(i)}))}m="url("+s.url+"#"+f+")",n.setAttribute(i,m),n.gradient=v,t.toString=function(){return m}}}))}css(t){const e=this.styles,i={},n=this.element;let s,r=!e;if(e&&T(t,(function(t,n){e&&e[n]!==t&&(i[n]=t,r=!0)})),r){e&&(t=_(e,i)),null===t.width||"auto"===t.width?delete this.textWidth:"text"===n.nodeName.toLowerCase()&&t.width&&(s=this.textWidth=A(t.width)),this.styles=t,s&&!h&&this.renderer.forExport&&delete t.width;const r=w(t);n.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","width"].forEach((t=>r&&delete r[t])),r.color&&(r.fill=r.color)),m(n,r)}return this.added&&("text"===this.element.nodeName&&this.renderer.buildText(this),t.textOutline&&this.applyTextOutline(t.textOutline)),this}dashstyleSetter(t){let e=this["stroke-width"];if("inherit"===e&&(e=1),t=t&&t.toLowerCase()){const i=t.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(t=i.length;t--;)i[t]=""+A(i[t])*E(e,NaN);t=i.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",t)}}destroy(){const t=this;var e=t.element||{};const i=t.renderer;var n=e.ownerSVGElement;let s="SPAN"===e.nodeName&&t.parentGroup||void 0;if(e.onclick=e.onmouseout=e.onmouseover=e.onmousemove=e.point=null,o(t),t.clipPath&&n){const e=t.clipPath;[].forEach.call(n.querySelectorAll("[clip-path],[CLIP-PATH]"),(function(t){-1<t.getAttribute("clip-path").indexOf(e.element.id)&&t.removeAttribute("clip-path")})),t.clipPath=e.destroy()}if(t.stops){for(n=0;n<t.stops.length;n++)t.stops[n].destroy();t.stops.length=0,t.stops=void 0}for(t.safeRemoveChild(e);s&&s.div&&0===s.div.childNodes.length;)e=s.parentGroup,t.safeRemoveChild(s.div),delete s.div,s=e;t.alignTo&&v(i.alignedObjects,t),T(t,(function(e,i){t[i]&&t[i].parentGroup===t&&t[i].destroy&&t[i].destroy(),delete t[i]}))}dSetter(t,e,i){y(t)&&("string"==typeof t[0]&&(t=this.renderer.pathToSegments(t)),this.pathArray=t,t=t.reduce(((t,e,i)=>e&&e.join?(i?t+" ":"")+e.join(" "):(e||"").toString()),"")),/(NaN| {2}|^$)/.test(t)&&(t="M 0 0"),this[e]!==t&&(i.setAttribute(e,t),this[e]=t)}fadeOut(t){const e=this;e.animate({opacity:0},{duration:E(t,150),complete:function(){e.hide()}})}fillSetter(t,e,i){"string"==typeof t?i.setAttribute(e,t):t&&this.complexColor(t,e,i)}getBBox(t,e){const{alignValue:i,element:n,renderer:s,styles:r,textStr:o}=this,{cache:l,cacheKeys:h}=s;var c=n.namespaceURI===this.SVG_NS;e=E(e,this.rotation,0);var d=s.styledMode?n&&L.prototype.getStyle.call(n,"font-size"):r&&r.fontSize;let u,p;if(g(o)&&(p=o.toString(),-1===p.indexOf("<")&&(p=p.replace(/[0-9]/g,"0")),p+=["",s.rootFontSize,d,e,this.textWidth,i,r&&r.textOverflow,r&&r.fontWeight].join()),p&&!t&&(u=l[p]),!u){if(c||s.forExport){try{var f=this.fakeTS&&function(t){const e=n.querySelector(".highcharts-text-outline");e&&m(e,{display:t})};b(f)&&f("none"),u=n.getBBox?_({},n.getBBox()):{width:n.offsetWidth,height:n.offsetHeight,x:0,y:0},b(f)&&f("")}catch(t){}(!u||0>u.width)&&(u={x:0,y:0,width:0,height:0})}else u=this.htmlGetBBox();if(f=u.width,t=u.height,c&&(u.height=t={"11px,17":14,"13px,20":16}[`${d||""},${Math.round(t)}`]||t),e){c=Number(n.getAttribute("y")||0)-u.y,d={right:1,center:.5}[i||0]||0;var v=e*a,x=(e-90)*a,y=f*Math.cos(v);e=f*Math.sin(v);var M=Math.cos(x);v=Math.sin(x),y=(M=(x=(f=u.x+d*(f-y)+c*M)+y)-t*M)-y,e=(t=(d=(c=u.y+c-d*e+c*v)+e)-t*v)-e,u.x=Math.min(f,x,M,y),u.y=Math.min(c,d,t,e),u.width=Math.max(f,x,M,y)-u.x,u.height=Math.max(c,d,t,e)-u.y}}if(p&&(""===o||0<u.height)){for(;250<h.length;)delete l[h.shift()];l[p]||h.push(p),l[p]=u}return u}getStyle(t){return d.getComputedStyle(this.element||this,"").getPropertyValue(t)}hasClass(t){return-1!==(""+this.attr("class")).split(" ").indexOf(t)}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}init(t,e){this.element="span"===e?f(e):l.createElementNS(this.SVG_NS,e),this.renderer=t,x(this,"afterInit")}on(t,e){const{onEvents:i}=this;return i[t]&&i[t](),i[t]=u(this.element,t,e),this}opacitySetter(t,e,i){this.opacity=t=Number(Number(t).toFixed(3)),i.setAttribute(e,t)}removeClass(t){return this.attr("class",(""+this.attr("class")).replace(S(t)?new RegExp(`(^| )${t}( |$)`):t," ").replace(/ +/g," ").trim())}removeTextOutline(){const t=this.element.querySelector("tspan.highcharts-text-outline");t&&this.safeRemoveChild(t)}safeRemoveChild(t){const e=t.parentNode;e&&e.removeChild(t)}setRadialReference(t){const e=this.element.gradient&&this.renderer.gradients[this.element.gradient];return this.element.radialReference=t,e&&e.radAttr&&e.animate(this.renderer.getRadialAttr(t,e.radAttr)),this}setTextPath(t,e){e=w(!0,{enabled:!0,attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},e);const i=this.renderer.url,n=this.text||this,s=n.textPath,{attributes:r,enabled:o}=e;return t=t||s&&s.path,s&&s.undo(),t&&o?(e=u(n,"afterModifyTree",(e=>{if(t&&o){let o=t.attr("id");o||t.attr("id",o=P());var s={x:0,y:0};g(r.dx)&&(s.dx=r.dx,delete r.dx),g(r.dy)&&(s.dy=r.dy,delete r.dy),n.attr(s),this.attr({transform:""}),this.box&&(this.box=this.box.destroy()),s=e.nodes.slice(0),e.nodes.length=0,e.nodes[0]={tagName:"textPath",attributes:_(r,{"text-anchor":r.textAnchor,href:`${i}#${o}`}),children:s}}})),n.textPath={path:t,undo:e}):(n.attr({dx:0,dy:0}),delete n.textPath),this.added&&(n.textCache="",this.renderer.buildText(n)),this}shadow(t){var e;const{renderer:i}=this,n=w(90===(null===(e=this.parentGroup)||void 0===e?void 0:e.rotation)?{offsetX:-1,offsetY:-1}:{},M(t)?t:{});return e=i.shadowDefinition(n),this.attr({filter:t?`url(${i.url}#${e})`:"none"})}show(t=!0){return this.attr({visibility:t?"inherit":"visible"})}"stroke-widthSetter"(t,e,i){this[e]=t,i.setAttribute(e,t)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;const t=this.getStyle("stroke-width");let e,i=0;return t.indexOf("px")===t.length-2?i=A(t):""!==t&&(e=l.createElementNS(c,"rect"),p(e,{width:t,"stroke-width":0}),this.element.parentNode.appendChild(e),i=e.getBBox().width,e.parentNode.removeChild(e)),i}symbolAttr(t){const e=this;L.symbolCustomAttribs.forEach((function(i){e[i]=E(t[i],e[i])})),e.attr({d:e.renderer.symbols[e.symbolName](e.x,e.y,e.width,e.height,e)})}textSetter(t){t!==this.textStr&&(delete this.textPxLength,this.textStr=t,this.added&&this.renderer.buildText(this))}titleSetter(t){const e=this.element,i=e.getElementsByTagName("title")[0]||l.createElementNS(this.SVG_NS,"title");e.insertBefore?e.insertBefore(i,e.firstChild):e.appendChild(i),i.textContent=String(E(t,"")).replace(/<[^>]*>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){const t=this.element;return t.parentNode.appendChild(t),this}translate(t,e){return this.attr({translateX:t,translateY:e})}updateTransform(){const{element:t,matrix:e,rotation:i=0,scaleX:n,scaleY:s,translateX:r=0,translateY:o=0}=this,a=["translate("+r+","+o+")"];g(e)&&a.push("matrix("+e.join(",")+")"),i&&a.push("rotate("+i+" "+E(this.rotationOriginX,t.getAttribute("x"),0)+" "+E(this.rotationOriginY,t.getAttribute("y")||0)+")"),(g(n)||g(s))&&a.push("scale("+E(n,1)+" "+E(s,1)+")"),a.length&&!(this.text||this).textPath&&t.setAttribute("transform",a.join(" "))}visibilitySetter(t,e,i){"inherit"===t?i.removeAttribute(e):this[e]!==t&&i.setAttribute(e,t),this[e]=t}xGetter(t){return"circle"===this.element.nodeName&&("x"===t?t="cx":"y"===t&&(t="cy")),this._defaultGetter(t)}zIndexSetter(t,e){var i=this.renderer,n=this.parentGroup;const s=(n||i).element||i.box,r=this.element;i=s===i.box;let o,a=!1;var l=this.added;let h;if(g(t)?(r.setAttribute("data-z-index",t),t=+t,this[e]===t&&(l=!1)):g(this[e])&&r.removeAttribute("data-z-index"),this[e]=t,l){for((t=this.zIndex)&&n&&(n.handleZ=!0),h=(e=s.childNodes).length-1;0<=h&&!a;h--)l=(n=e[h]).getAttribute("data-z-index"),o=!g(l),n!==r&&(0>t&&o&&!i&&!h?(s.insertBefore(r,e[h]),a=!0):(A(l)<=t||o&&(!g(t)||0<=t))&&(s.insertBefore(r,e[h+1]),a=!0));a||(s.insertBefore(r,e[i?3:0]),a=!0)}return a}}return L.symbolCustomAttribs="anchorX anchorY clockwise end height innerR r start width x y".split(" "),L.prototype.strokeSetter=L.prototype.fillSetter,L.prototype.yGetter=L.prototype.xGetter,L.prototype.matrixSetter=L.prototype.rotationOriginXSetter=L.prototype.rotationOriginYSetter=L.prototype.rotationSetter=L.prototype.scaleXSetter=L.prototype.scaleYSetter=L.prototype.translateXSetter=L.prototype.translateYSetter=L.prototype.verticalAlignSetter=function(t,e){this[e]=t,this.doTransform=!0},L})),e(i,"Core/Renderer/RendererRegistry.js",[i["Core/Globals.js"]],(function(t){var e;return function(e){let i;e.rendererTypes={},e.getRendererType=function(t=i){return e.rendererTypes[t]||e.rendererTypes[i]},e.registerRendererType=function(n,s,r){e.rendererTypes[n]=s,i&&!r||(i=n,t.Renderer=s)}}(e||(e={})),e})),e(i,"Core/Renderer/SVG/SVGLabel.js",[i["Core/Renderer/SVG/SVGElement.js"],i["Core/Utilities.js"]],(function(t,e){const{defined:i,extend:n,isNumber:s,merge:r,pick:o,removeEvent:a}=e;class l extends t{constructor(t,e,i,n,s,r,o,a,h,c){let d;super(),this.paddingRightSetter=this.paddingLeftSetter=this.paddingSetter,this.init(t,"g"),this.textStr=e,this.x=i,this.y=n,this.anchorX=r,this.anchorY=o,this.baseline=h,this.className=c,this.addClass("button"===c?"highcharts-no-tooltip":"highcharts-label"),c&&this.addClass("highcharts-"+c),this.text=t.text(void 0,0,0,a).attr({zIndex:1}),"string"==typeof s&&((d=/^url\((.*?)\)$/.test(s))||this.renderer.symbols[s])&&(this.symbolKey=s),this.bBox=l.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=t.styledMode||d,this.deferredAttr={},this.alignFactor=0}alignSetter(t){(t={left:0,center:.5,right:1}[t])!==this.alignFactor&&(this.alignFactor=t,this.bBox&&s(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(t,e){this.anchorX=t,this.boxAttr(e,Math.round(t)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(t,e){this.anchorY=t,this.boxAttr(e,t-this.ySetting)}boxAttr(t,e){this.box?this.box.attr(t,e):this.deferredAttr[t]=e}css(e){if(e){const t={};e=r(e),l.textProps.forEach((i=>{void 0!==e[i]&&(t[i]=e[i],delete e[i])})),this.text.css(t),"fontSize"in t||"fontWeight"in t?this.updateTextPadding():("width"in t||"textOverflow"in t)&&this.updateBoxSize()}return t.prototype.css.call(this,e)}destroy(){a(this.element,"mouseenter"),a(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),t.prototype.destroy.call(this)}fillSetter(t,e){t&&(this.needsBox=!0),this.fill=t,this.boxAttr(e,t)}getBBox(){this.textStr&&0===this.bBox.width&&0===this.bBox.height&&this.updateBoxSize();const t=this.padding,e=o(this.paddingLeft,t);return{width:this.width,height:this.height,x:this.bBox.x-e,y:this.bBox.y-t}}getCrispAdjust(){return this.renderer.styledMode&&this.box?this.box.strokeWidth()%2/2:(this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(t){this.heightSetting=t}onAdd(){this.text.add(this),this.attr({text:o(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&i(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(t,e){s(t)?t!==this[e]&&(this[e]=t,this.updateTextPadding()):this[e]=void 0}rSetter(t,e){this.boxAttr(e,t)}strokeSetter(t,e){this.stroke=t,this.boxAttr(e,t)}"stroke-widthSetter"(t,e){t&&(this.needsBox=!0),this["stroke-width"]=t,this.boxAttr(e,t)}"text-alignSetter"(t){this.textAlign=t}textSetter(t){void 0!==t&&this.text.attr({text:t}),this.updateTextPadding()}updateBoxSize(){var t=this.text;const e={},r=this.padding,o=this.bBox=s(this.widthSetting)&&s(this.heightSetting)&&!this.textAlign||!i(t.textStr)?l.emptyBBox:t.getBBox();this.width=this.getPaddedWidth(),this.height=(this.heightSetting||o.height||0)+2*r;const a=this.renderer.fontMetrics(t);this.baselineOffset=r+Math.min((this.text.firstLineMetrics||a).b,o.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-a.h)/2),this.needsBox&&!t.textPath&&(this.box||((t=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect()).addClass(("button"===this.className?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),t.add(this)),t=this.getCrispAdjust(),e.x=t,e.y=(this.baseline?-this.baselineOffset:0)+t,e.width=Math.round(this.width),e.height=Math.round(this.height),this.box.attr(n(e,this.deferredAttr)),this.deferredAttr={})}updateTextPadding(){const t=this.text;if(!t.textPath){this.updateBoxSize();const e=this.baseline?0:this.baselineOffset;let n=o(this.paddingLeft,this.padding);i(this.widthSetting)&&this.bBox&&("center"===this.textAlign||"right"===this.textAlign)&&(n+={center:.5,right:1}[this.textAlign]*(this.widthSetting-this.bBox.width)),n===t.x&&e===t.y||(t.attr("x",n),t.hasBoxWidthChanged&&(this.bBox=t.getBBox(!0)),void 0!==e&&t.attr("y",e)),t.x=n,t.y=e}}widthSetter(t){this.widthSetting=s(t)?t:void 0}getPaddedWidth(){var t=this.padding;const e=o(this.paddingLeft,t);return t=o(this.paddingRight,t),(this.widthSetting||this.bBox.width||0)+e+t}xSetter(t){this.x=t,this.alignFactor&&(t-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(t),this.attr("translateX",this.xSetting)}ySetter(t){this.ySetting=this.y=Math.round(t),this.attr("translateY",this.ySetting)}}return l.emptyBBox={width:0,height:0,x:0,y:0},l.textProps="color direction fontFamily fontSize fontStyle fontWeight lineHeight textAlign textDecoration textOutline textOverflow whiteSpace width".split(" "),l})),e(i,"Core/Renderer/SVG/Symbols.js",[i["Core/Utilities.js"]],(function(t){function e(t,e,i,n,r){const a=[];if(r){const l=r.start||0,h=o(r.r,i);i=o(r.r,n||i),n=(r.end||0)-.001;const c=r.innerR,d=o(r.open,.001>Math.abs((r.end||0)-l-2*Math.PI)),u=Math.cos(l),p=Math.sin(l),f=Math.cos(n),m=Math.sin(n),g=o(r.longArc,.001>n-l-Math.PI?0:1);let v=["A",h,i,0,g,o(r.clockwise,1),t+h*f,e+i*m];v.params={start:l,end:n,cx:t,cy:e},a.push(["M",t+h*u,e+i*p],v),s(c)&&(v=["A",c,c,0,g,s(r.clockwise)?1-r.clockwise:0,t+c*u,e+c*p],v.params={start:n,end:l,cx:t,cy:e},a.push(d?["M",t+c*f,e+c*m]:["L",t+c*f,e+c*m],v)),d||a.push(["Z"])}return a}function i(t,e,i,s,r){return r&&r.r?n(t,e,i,s,r):[["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["Z"]]}function n(t,e,i,n,s){return[["M",t+(s=(null==s?void 0:s.r)||0),e],["L",t+i-s,e],["A",s,s,0,0,1,t+i,e+s],["L",t+i,e+n-s],["A",s,s,0,0,1,t+i-s,e+n],["L",t+s,e+n],["A",s,s,0,0,1,t,e+n-s],["L",t,e+s],["A",s,s,0,0,1,t+s,e],["Z"]]}const{defined:s,isNumber:r,pick:o}=t;return{arc:e,callout:function(t,e,i,s,o){const a=Math.min(o&&o.r||0,i,s),l=a+6,h=o&&o.anchorX;o=o&&o.anchorY||0;const c=n(t,e,i,s,{r:a});return r(h)?(t+h>=i?o>e+l&&o<e+s-l?c.splice(3,1,["L",t+i,o-6],["L",t+i+6,o],["L",t+i,o+6],["L",t+i,e+s-a]):c.splice(3,1,["L",t+i,s/2],["L",h,o],["L",t+i,s/2],["L",t+i,e+s-a]):0>=t+h?o>e+l&&o<e+s-l?c.splice(7,1,["L",t,o+6],["L",t-6,o],["L",t,o-6],["L",t,e+a]):c.splice(7,1,["L",t,s/2],["L",h,o],["L",t,s/2],["L",t,e+a]):o&&o>s&&h>t+l&&h<t+i-l?c.splice(5,1,["L",h+6,e+s],["L",h,e+s+6],["L",h-6,e+s],["L",t+a,e+s]):o&&0>o&&h>t+l&&h<t+i-l&&c.splice(1,1,["L",h-6,e],["L",h,e-6],["L",h+6,e],["L",i-a,e]),c):c},circle:function(t,i,n,s){return e(t+n/2,i+s/2,n/2,s/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(t,e,i,n){return[["M",t+i/2,e],["L",t+i,e+n/2],["L",t+i/2,e+n],["L",t,e+n/2],["Z"]]},rect:i,roundedRect:n,square:i,triangle:function(t,e,i,n){return[["M",t+i/2,e],["L",t+i,e+n],["L",t,e+n],["Z"]]},"triangle-down":function(t,e,i,n){return[["M",t,e],["L",t+i,e],["L",t+i/2,e+n],["Z"]]}}})),e(i,"Core/Renderer/SVG/TextBuilder.js",[i["Core/Renderer/HTML/AST.js"],i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e,i){const{doc:n,SVG_NS:s,win:r}=e,{attr:o,extend:a,fireEvent:l,isString:h,objectEach:c,pick:d}=i;return class{constructor(t){const e=t.styles;this.renderer=t.renderer,this.svgElement=t,this.width=t.textWidth,this.textLineHeight=e&&e.lineHeight,this.textOutline=e&&e.textOutline,this.ellipsis=!(!e||"ellipsis"!==e.textOverflow),this.noWrap=!(!e||"nowrap"!==e.whiteSpace)}buildSVG(){const e=this.svgElement,i=e.element;var s=e.renderer,r=d(e.textStr,"").toString();const o=-1!==r.indexOf("<"),a=i.childNodes;s=!e.added&&s.box;const l=/<br.*?>/g;var c=[r,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,e.getStyle("font-size"),this.width].join();if(c!==e.textCache){for(e.textCache=c,delete e.actualWidth,c=a.length;c--;)i.removeChild(a[c]);o||this.ellipsis||this.width||e.textPath||-1!==r.indexOf(" ")&&(!this.noWrap||l.test(r))?""!==r&&(s&&s.appendChild(i),r=new t(r),this.modifyTree(r.nodes),r.addToDOM(i),this.modifyDOM(),this.ellipsis&&-1!==(i.textContent||"").indexOf("…")&&e.attr("title",this.unescapeEntities(e.textStr||"",["&lt;","&gt;"])),s&&s.removeChild(i)):i.appendChild(n.createTextNode(this.unescapeEntities(r))),h(this.textOutline)&&e.applyTextOutline&&e.applyTextOutline(this.textOutline)}}modifyDOM(){const t=this.svgElement,e=o(t.element,"x");let i;for(t.firstLineMetrics=void 0;(i=t.element.firstChild)&&/^[\s\u200B]*$/.test(i.textContent||" ");)t.element.removeChild(i);[].forEach.call(t.element.querySelectorAll("tspan.highcharts-br"),((i,n)=>{i.nextSibling&&i.previousSibling&&(0===n&&1===i.previousSibling.nodeType&&(t.firstLineMetrics=t.renderer.fontMetrics(i.previousSibling)),o(i,{dy:this.getLineHeight(i.nextSibling),x:e}))}));const a=this.width||0;if(a){var l=(i,r)=>{var l=i.textContent||"";const h=l.replace(/([^\^])-/g,"$1- ").split(" ");var c=!this.noWrap&&(1<h.length||1<t.element.childNodes.length);const d=this.getLineHeight(r);let u=0,p=t.actualWidth;if(this.ellipsis)l&&this.truncate(i,l,void 0,0,Math.max(0,a-.8*d),((t,e)=>t.substring(0,e)+"…"));else if(c){for(l=[],c=[];r.firstChild&&r.firstChild!==i;)c.push(r.firstChild),r.removeChild(r.firstChild);for(;h.length;)h.length&&!this.noWrap&&0<u&&(l.push(i.textContent||""),i.textContent=h.join(" ").replace(/- /g,"-")),this.truncate(i,void 0,h,0===u&&p||0,a,((t,e)=>h.slice(0,e).join(" ").replace(/- /g,"-"))),p=t.actualWidth,u++;c.forEach((t=>{r.insertBefore(t,i)})),l.forEach((t=>{r.insertBefore(n.createTextNode(t),i),(t=n.createElementNS(s,"tspan")).textContent="​",o(t,{dy:d,x:e}),r.insertBefore(t,i)}))}},h=e=>{[].slice.call(e.childNodes).forEach((i=>{i.nodeType===r.Node.TEXT_NODE?l(i,e):(-1!==i.className.baseVal.indexOf("highcharts-br")&&(t.actualWidth=0),h(i))}))};h(t.element)}}getLineHeight(t){return t=t.nodeType===r.Node.TEXT_NODE?t.parentElement:t,this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(t||this.svgElement.element).h}modifyTree(t){const e=(i,n)=>{const{attributes:s={},children:r,style:o={},tagName:l}=i,h=this.renderer.styledMode;"b"===l||"strong"===l?h?s.class="highcharts-strong":o.fontWeight="bold":"i"!==l&&"em"!==l||(h?s.class="highcharts-emphasized":o.fontStyle="italic"),o&&o.color&&(o.fill=o.color),"br"===l?(s.class="highcharts-br",i.textContent="​",(n=t[n+1])&&n.textContent&&(n.textContent=n.textContent.replace(/^ +/gm,""))):"a"===l&&r&&r.some((t=>"#text"===t.tagName))&&(i.children=[{children:r,tagName:"tspan"}]),"#text"!==l&&"a"!==l&&(i.tagName="tspan"),a(i,{attributes:s,style:o}),r&&r.filter((t=>"#text"!==t.tagName)).forEach(e)};t.forEach(e),l(this.svgElement,"afterModifyTree",{nodes:t})}truncate(t,e,i,n,s,r){const o=this.svgElement,{rotation:a}=o,l=[];let h,c,d=i?1:0,u=(e||i||"").length,p=u;const f=function(e,s){if(e=s||e,(s=t.parentNode)&&void 0===l[e]&&s.getSubStringLength)try{l[e]=n+s.getSubStringLength(0,i?e+1:e)}catch(t){}return l[e]};if(o.rotation=0,c=f(t.textContent.length),n+c>s){for(;d<=u;)p=Math.ceil((d+u)/2),i&&(h=r(i,p)),c=f(p,h&&h.length-1),d===u?d=u+1:c>s?u=p-1:d=p;0===u?t.textContent="":e&&u===e.length-1||(t.textContent=h||r(e||i,p))}i&&i.splice(0,p),o.actualWidth=c,o.rotation=a}unescapeEntities(t,e){return c(this.renderer.escapes,(function(i,n){e&&-1!==e.indexOf(i)||(t=t.toString().replace(new RegExp(i,"g"),n))})),t}}})),e(i,"Core/Renderer/SVG/SVGRenderer.js",[i["Core/Renderer/HTML/AST.js"],i["Core/Color/Color.js"],i["Core/Globals.js"],i["Core/Renderer/RendererRegistry.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Renderer/SVG/SVGLabel.js"],i["Core/Renderer/SVG/Symbols.js"],i["Core/Renderer/SVG/TextBuilder.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r,o,a,l){const{charts:h,deg2rad:c,doc:d,isFirefox:u,isMS:p,isWebKit:f,noop:m,SVG_NS:g,symbolSizes:v,win:_}=i,{addEvent:x,attr:y,createElement:b,css:M,defined:S,destroyObjectProperties:w,extend:T,isArray:E,isNumber:A,isObject:C,isString:P,merge:L,pick:R,pInt:D,uniqueKey:I}=l;let k;class O{constructor(t,e,i,n,s,r,o){this.width=this.url=this.style=this.imgCount=this.height=this.gradients=this.globalAnimation=this.defs=this.chartIndex=this.cacheKeys=this.cache=this.boxWrapper=this.box=this.alignedObjects=void 0,this.init(t,e,i,n,s,r,o)}init(t,e,i,n,s,r,o){const a=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),l=a.element;let h;o||a.css(this.getStyle(n)),t.appendChild(l),y(t,"dir","ltr"),-1===t.innerHTML.indexOf("xmlns")&&y(l,"xmlns",this.SVG_NS),this.box=l,this.boxWrapper=a,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(d.createTextNode("Created with Highcharts 11.1.0")),this.defs=this.createElement("defs").add(),this.allowHTML=r,this.forExport=s,this.styledMode=o,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=a.getStyle("font-size"),this.setSize(e,i,!1),u&&t.getBoundingClientRect&&((e=function(){M(t,{left:0,top:0}),h=t.getBoundingClientRect(),M(t,{left:Math.ceil(h.left)-h.left+"px",top:Math.ceil(h.top)-h.top+"px"})})(),this.unSubPixelFix=x(_,"resize",e))}definition(e){return new t([e]).addToDOM(this.defs.element)}getReferenceURL(){if((u||f)&&d.getElementsByTagName("base").length){if(!S(k)){var e=I();e=new t([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:e},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${e})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(d.body),M(e,{position:"fixed",top:0,left:0,zIndex:9e5});const i=d.elementFromPoint(6,6);k="hitme"===(i&&i.id),d.body.removeChild(e)}if(k)return _.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20")}return""}getStyle(t){return this.style=T({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"1rem"},t)}setStyle(t){this.boxWrapper.css(this.getStyle(t))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){const t=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),w(this.gradients||{}),this.gradients=null,this.defs=t.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null}createElement(t){const e=new this.Element;return e.init(this,t),e}getRadialAttr(t,e){return{cx:t[0]-t[2]/2+(e.cx||0)*t[2],cy:t[1]-t[2]/2+(e.cy||0)*t[2],r:(e.r||0)*t[2]}}shadowDefinition(t){const e=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(t).map((e=>t[e]))].join("-").replace(/[^a-z0-9\-]/g,""),i=L({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},t);return this.defs.element.querySelector(`#${e}`)||this.definition({tagName:"filter",attributes:{id:e},children:[{tagName:"feDropShadow",attributes:{dx:i.offsetX,dy:i.offsetY,"flood-color":i.color,"flood-opacity":Math.min(5*i.opacity,1),stdDeviation:i.width/2}}]}),e}buildText(t){new a(t).buildSVG()}getContrast(t){return 1.05/(.05+(t=.2126*(t=e.parse(t).rgba.map((t=>.03928>=(t/=255)?t/12.92:Math.pow((t+.055)/1.055,2.4))))[0]+.7152*t[1]+.0722*t[2]))>(t+.05)/.05?"#FFFFFF":"#000000"}button(e,i,n,s,r={},o,a,l,h,c){const d=this.label(e,i,n,h,void 0,void 0,c,void 0,"button"),u=this.styledMode;e=r.states||{};let f=0;delete(r=L(r)).states;const m=L({color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},r.style);delete r.style;let g,v,_,y=t.filterUserAttributes(r);return d.attr(L({padding:8,r:2},y)),u||(y=L({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1},y),o=L(y,{fill:"#e6e6e6"},t.filterUserAttributes(o||e.hover||{})),g=o.style,delete o.style,a=L(y,{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},t.filterUserAttributes(a||e.select||{})),v=a.style,delete a.style,l=L(y,{style:{color:"#cccccc"}},t.filterUserAttributes(l||e.disabled||{})),_=l.style,delete l.style),x(d.element,p?"mouseover":"mouseenter",(function(){3!==f&&d.setState(1)})),x(d.element,p?"mouseout":"mouseleave",(function(){3!==f&&d.setState(f)})),d.setState=function(t){1!==t&&(d.state=f=t),d.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),u||(d.attr([y,o,a,l][t||0]),C(t=[m,g,v,_][t||0])&&d.css(t))},u||(d.attr(y).css(T({cursor:"default"},m)),c&&d.text.css({pointerEvents:"none"})),d.on("touchstart",(t=>t.stopPropagation())).on("click",(function(t){3!==f&&s.call(d,t)}))}crispLine(t,e,i="round"){const n=t[0],s=t[1];return S(n[1])&&n[1]===s[1]&&(n[1]=s[1]=Math[i](n[1])-e%2/2),S(n[2])&&n[2]===s[2]&&(n[2]=s[2]=Math[i](n[2])+e%2/2),t}path(t){const e=this.styledMode?{}:{fill:"none"};return E(t)?e.d=t:C(t)&&T(e,t),this.createElement("path").attr(e)}circle(t,e,i){return t=C(t)?t:void 0===t?{}:{x:t,y:e,r:i},(e=this.createElement("circle")).xSetter=e.ySetter=function(t,e,i){i.setAttribute("c"+e,t)},e.attr(t)}arc(t,e,i,n,s,r){return C(t)?(e=(n=t).y,i=n.r,t=n.x):n={innerR:n,start:s,end:r},(t=this.symbol("arc",t,e,i,i,n)).r=i,t}rect(t,e,i,n,s,r){t=C(t)?t:void 0===t?{}:{x:t,y:e,r:s,width:Math.max(i||0,0),height:Math.max(n||0,0)};const o=this.createElement("rect");return this.styledMode||(void 0!==r&&(t["stroke-width"]=r,T(t,o.crisp(t))),t.fill="none"),o.rSetter=function(t,e,i){o.r=t,y(i,{rx:t,ry:t})},o.rGetter=function(){return o.r||0},o.attr(t)}roundedRect(t){return this.symbol("roundedRect").attr(t)}setSize(t,e,i){this.width=t,this.height=e,this.boxWrapper.animate({width:t,height:e},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:R(i,!0)?void 0:0}),this.alignElements()}g(t){const e=this.createElement("g");return t?e.attr({class:"highcharts-"+t}):e}image(t,e,i,n,s,r){const o={preserveAspectRatio:"none"};A(e)&&(o.x=e),A(i)&&(o.y=i),A(n)&&(o.width=n),A(s)&&(o.height=s);const a=this.createElement("image").attr(o);return e=function(e){a.attr({href:t}),r.call(a,e)},r?(a.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}),i=new _.Image,x(i,"load",e),i.src=t,i.complete&&e({})):a.attr({href:t}),a}symbol(t,e,i,n,s,r){const o=this,a=/^url\((.*?)\)$/,l=a.test(t),c=!l&&(this.symbols[t]?t:"circle"),u=c&&this.symbols[c];let p,f,m,g;if(u)"number"==typeof e&&(f=u.call(this.symbols,Math.round(e||0),Math.round(i||0),n||0,s||0,r)),p=this.path(f),o.styledMode||p.attr("fill","none"),T(p,{symbolName:c||void 0,x:e,y:i,width:n,height:s}),r&&T(p,r);else if(l){m=t.match(a)[1];const n=p=this.image(m);n.imgwidth=R(r&&r.width,v[m]&&v[m].width),n.imgheight=R(r&&r.height,v[m]&&v[m].height),g=t=>t.attr({width:t.width,height:t.height}),["width","height"].forEach((function(t){n[t+"Setter"]=function(t,e){this[e]=t;const{alignByTranslate:i,element:n,width:s,height:o,imgwidth:a,imgheight:l}=this;if(t=this["img"+e],S(t)){let h=1;r&&"within"===r.backgroundSize&&s&&o?(h=Math.min(s/a,o/l),y(n,{width:Math.round(a*h),height:Math.round(l*h)})):n&&n.setAttribute(e,t),i||this.translate(((s||0)-a*h)/2,((o||0)-l*h)/2)}}})),S(e)&&n.attr({x:e,y:i}),n.isImg=!0,S(n.imgwidth)&&S(n.imgheight)?g(n):(n.attr({width:0,height:0}),b("img",{onload:function(){const t=h[o.chartIndex];0===this.width&&(M(this,{position:"absolute",top:"-999em"}),d.body.appendChild(this)),v[m]={width:this.width,height:this.height},n.imgwidth=this.width,n.imgheight=this.height,n.element&&g(n),this.parentNode&&this.parentNode.removeChild(this),o.imgCount--,o.imgCount||!t||t.hasLoaded||t.onload()},src:m}),this.imgCount++)}return p}clipRect(t,e,i,n){const s=I()+"-",r=this.createElement("clipPath").attr({id:s}).add(this.defs);return(t=this.rect(t,e,i,n,0).add(r)).id=s,t.clipPath=r,t.count=0,t}text(t,e,i,n){const s={};return!n||!this.allowHTML&&this.forExport?(s.x=Math.round(e||0),i&&(s.y=Math.round(i)),S(t)&&(s.text=t),t=this.createElement("text").attr(s),(!n||this.forExport&&!this.allowHTML)&&(t.xSetter=function(t,e,i){const n=i.getElementsByTagName("tspan"),s=i.getAttribute(e);for(let i,r=0;r<n.length;r++)i=n[r],i.getAttribute(e)===s&&i.setAttribute(e,t);i.setAttribute(e,t)}),t):this.html(t,e,i)}fontMetrics(t){const e=24>(t=D(s.prototype.getStyle.call(t,"font-size")||0))?t+3:Math.round(1.2*t);return{h:e,b:Math.round(.8*e),f:t}}rotCorr(t,e,i){let n=t;return e&&i&&(n=Math.max(n*Math.cos(e*c),4)),{x:-t/3*Math.sin(e*c),y:n}}pathToSegments(t){const e=[],i=[],n={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let s=0;s<t.length;s++)P(i[0])&&A(t[s])&&i.length===n[i[0].toUpperCase()]&&t.splice(s,0,i[0].replace("M","L").replace("m","l")),"string"==typeof t[s]&&(i.length&&e.push(i.slice(0)),i.length=0),i.push(t[s]);return e.push(i.slice(0)),e}label(t,e,i,n,s,o,a,l,h){return new r(this,t,e,i,n,s,o,a,l,h)}alignElements(){this.alignedObjects.forEach((t=>t.align()))}}return T(O.prototype,{Element:s,SVG_NS:g,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:o,draw:m}),n.registerRendererType("svg",O,!0),O})),e(i,"Core/Renderer/HTML/HTMLElement.js",[i["Core/Globals.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Utilities.js"]],(function(t,e,i){const{isFirefox:n,isMS:s,isWebKit:r,win:o}=t,{css:a,defined:l,extend:h,pick:c,pInt:d}=i,u=[];class p extends e{static compose(t){if(i.pushUnique(u,t)){const e=p.prototype,i=t.prototype;i.getSpanCorrection=e.getSpanCorrection,i.htmlCss=e.htmlCss,i.htmlGetBBox=e.htmlGetBBox,i.htmlUpdateTransform=e.htmlUpdateTransform,i.setSpanRotation=e.setSpanRotation}return t}getSpanCorrection(t,e,i){this.xCorr=-t*i,this.yCorr=-e}htmlCss(t){const e="SPAN"===this.element.tagName&&t&&"width"in t,i=c(e&&t.width,void 0);let n;return e&&(delete t.width,this.textWidth=i,n=!0),t&&"ellipsis"===t.textOverflow&&(t.whiteSpace="nowrap",t.overflow="hidden"),this.styles=h(this.styles,t),a(this.element,t),n&&this.htmlUpdateTransform(),this}htmlGetBBox(){const t=this.element;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}htmlUpdateTransform(){if(this.added){var t=this.renderer,e=this.element,i=this.x||0,n=this.y||0,s=this.textAlign||"left",r={left:0,center:.5,right:1}[s],o=this.styles,h=o&&o.whiteSpace;if(a(e,{marginLeft:this.translateX||0,marginTop:this.translateY||0}),"SPAN"===e.tagName){o=this.rotation;const u=this.textWidth&&d(this.textWidth),p=[o,s,e.innerHTML,this.textWidth,this.textAlign].join();let f=!1;if(u!==this.oldTextWidth){if(this.textPxLength)var c=this.textPxLength;else a(e,{width:"",whiteSpace:h||"nowrap"}),c=e.offsetWidth;(u>this.oldTextWidth||c>u)&&(/[ \-]/.test(e.textContent||e.innerText)||"ellipsis"===e.style.textOverflow)&&(a(e,{width:c>u||o?u+"px":"auto",display:"block",whiteSpace:h||"normal"}),this.oldTextWidth=u,f=!0)}this.hasBoxWidthChanged=f,p!==this.cTT&&(t=t.fontMetrics(e).b,!l(o)||o===(this.oldRotation||0)&&s===this.oldAlign||this.setSpanRotation(o,r,t),this.getSpanCorrection(!l(o)&&this.textPxLength||e.offsetWidth,t,r,o,s)),a(e,{left:i+(this.xCorr||0)+"px",top:n+(this.yCorr||0)+"px"}),this.cTT=p,this.oldRotation=o,this.oldAlign=s}}else this.alignOnAdd=!0}setSpanRotation(t,e,i){const l={},h=s&&!/Edge/.test(o.navigator.userAgent)?"-ms-transform":r?"-webkit-transform":n?"MozTransform":o.opera?"-o-transform":void 0;h&&(l[h]=l.transform="rotate("+t+"deg)",l[h+(n?"Origin":"-origin")]=l.transformOrigin=100*e+"% "+i+"px",a(this.element,l))}}return p})),e(i,"Core/Renderer/HTML/HTMLRenderer.js",[i["Core/Renderer/HTML/AST.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Renderer/SVG/SVGRenderer.js"],i["Core/Utilities.js"]],(function(t,e,i,n){const{attr:s,createElement:r,extend:o,pick:a}=n,l=[];class h extends i{static compose(t){return n.pushUnique(l,t)&&(t.prototype.html=h.prototype.html),t}html(i,n,l){const h=this.createElement("span"),c=h.element,d=h.renderer,u=function(t,i){["opacity","visibility"].forEach((function(n){t[n+"Setter"]=function(s,r,o){const a=t.div?t.div.style:i;e.prototype[n+"Setter"].call(this,s,r,o),a&&(a[r]=s)}})),t.addedSetters=!0};return h.textSetter=function(e){e!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,t.setElementHTML(this.element,a(e,"")),this.textStr=e,h.doTransform=!0)},u(h,h.element.style),h.xSetter=h.ySetter=h.alignSetter=h.rotationSetter=function(t,e){"align"===e?h.alignValue=h.textAlign=t:h[e]=t,h.doTransform=!0},h.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),this.doTransform=!1)},h.attr({text:i,x:Math.round(n),y:Math.round(l)}).css({position:"absolute"}),d.styledMode||h.css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize}),c.style.whiteSpace="nowrap",h.css=h.htmlCss,h.add=function(t){const e=d.box.parentNode,i=[];let n;if(this.parentGroup=t){if(n=t.div,!n){for(;t;)i.push(t),t=t.parentGroup;i.reverse().forEach((function(t){function a(e,i){t[i]=e,"translateX"===i?d.left=e+"px":d.top=e+"px",t.doTransform=!0}const l=s(t.element,"class"),c=t.styles||{};n=t.div=t.div||r("div",l?{className:l}:void 0,{position:"absolute",left:(t.translateX||0)+"px",top:(t.translateY||0)+"px",display:t.display,opacity:t.opacity,visibility:t.visibility},n||e);const d=n.style;o(t,{classSetter:function(t){return function(e){this.element.setAttribute("class",e),t.className=e}}(n),css:function(e){return h.css.call(t,e),["cursor","pointerEvents"].forEach((t=>{e[t]&&(d[t]=e[t])})),t},on:function(){return i[0].div&&h.on.apply({element:i[0].div,onEvents:t.onEvents},arguments),t},translateXSetter:a,translateYSetter:a}),t.addedSetters||u(t),t.css(c)}))}}else n=e;return n.appendChild(c),h.added=!0,h.alignOnAdd&&h.htmlUpdateTransform(),h},h}}return h})),e(i,"Core/Axis/AxisDefaults.js",[],(function(){var t;return function(t){t.defaultXAxisOptions={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%H:%M:%S.%L",range:!1},second:{main:"%H:%M:%S",range:!1},minute:{main:"%H:%M",range:!1},hour:{main:"%H:%M",range:!1},day:{main:"%e %b"},week:{main:"%e %b"},month:{main:"%b '%y"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotation:void 0,autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",padding:5,reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,opposite:!1,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",rotation:0,useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},type:"linear",uniqueNames:!0,visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},t.defaultYAxisOptions={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{rotation:270,text:"Values"},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){const{numberFormatter:t}=this.axis.chart;return t(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0},t.defaultLeftAxisOptions={title:{rotation:270}},t.defaultRightAxisOptions={title:{rotation:90}},t.defaultBottomAxisOptions={labels:{autoRotation:[-45]},margin:15,title:{rotation:0}},t.defaultTopAxisOptions={labels:{autoRotation:[-45]},margin:15,title:{rotation:0}}}(t||(t={})),t})),e(i,"Core/Foundation.js",[i["Core/Utilities.js"]],(function(t){const{addEvent:e,isFunction:i,objectEach:n,removeEvent:s}=t;var r;return function(t){t.registerEventOptions=function(t,r){t.eventOptions=t.eventOptions||{},n(r.events,(function(n,r){t.eventOptions[r]!==n&&(t.eventOptions[r]&&(s(t,r,t.eventOptions[r]),delete t.eventOptions[r]),i(n)&&(t.eventOptions[r]=n,e(t,r,n,{order:0})))}))}}(r||(r={})),r})),e(i,"Core/Axis/Tick.js",[i["Core/Templating.js"],i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e,i){const{deg2rad:n}=e,{clamp:s,correctFloat:r,defined:o,destroyObjectProperties:a,extend:l,fireEvent:h,isNumber:c,merge:d,objectEach:u,pick:p}=i;return class{constructor(t,e,i,n,s){this.isNewLabel=this.isNew=!0,this.axis=t,this.pos=e,this.type=i||"",this.parameters=s||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,h(this,"init"),i||n||this.addLabel()}addLabel(){const e=this,i=e.axis;var n=i.options;const s=i.chart;var a=i.categories;const d=i.logarithmic,u=i.names,f=e.pos,m=p(e.options&&e.options.labels,n.labels);var g=i.tickPositions;const v=f===g[0],_=f===g[g.length-1],x=(!m.step||1===m.step)&&1===i.tickInterval;g=g.info;let y,b,M,S=e.label;a=this.parameters.category||(a?p(a[f],u[f],f):f),d&&c(a)&&(a=r(d.lin2log(a))),i.dateTime&&(g?(b=s.time.resolveDTLFormat(n.dateTimeLabelFormats[!n.grid&&g.higherRanks[f]||g.unitName]),y=b.main):c(a)&&(y=i.dateTime.getXDateFormat(a,n.dateTimeLabelFormats||{}))),e.isFirst=v,e.isLast=_;const w={axis:i,chart:s,dateTimeLabelFormat:y,isFirst:v,isLast:_,pos:f,tick:e,tickPositionInfo:g,value:a};h(this,"labelFormat",w);const T=e=>m.formatter?m.formatter.call(e,e):m.format?(e.text=i.defaultLabelFormatter.call(e,e),t.format(m.format,e,s)):i.defaultLabelFormatter.call(e,e);n=T.call(w,w);const E=b&&b.list;e.shortenLabel=E?function(){for(M=0;M<E.length;M++)if(l(w,{dateTimeLabelFormat:E[M]}),S.attr({text:T.call(w,w)}),S.getBBox().width<i.getSlotWidth(e)-2*m.padding)return;S.attr({text:""})}:void 0,x&&i._addedPlotLB&&e.moveLabel(n,m),o(S)||e.movedLabel?S&&S.textStr!==n&&!x&&(!S.textWidth||m.style.width||S.styles.width||S.css({width:null}),S.attr({text:n}),S.textPxLength=S.getBBox().width):(e.label=S=e.createLabel({x:0,y:0},n,m),e.rotation=0)}createLabel(t,e,i){const n=this.axis,s=n.chart;return(t=o(e)&&i.enabled?s.renderer.text(e,t.x,t.y,i.useHTML).add(n.labelGroup):null)&&(s.styledMode||t.css(d(i.style)),t.textPxLength=t.getBBox().width),t}destroy(){a(this,this.axis)}getPosition(t,e,i,n){const o=this.axis,a=o.chart,l=n&&a.oldChartHeight||a.chartHeight;return(t={x:t?r(o.translate(e+i,void 0,void 0,n)+o.transB):o.left+o.offset+(o.opposite?(n&&a.oldChartWidth||a.chartWidth)-o.right-o.left:0),y:t?l-o.bottom+o.offset-(o.opposite?o.height:0):r(l-o.translate(e+i,void 0,void 0,n)-o.transB)}).y=s(t.y,-1e5,1e5),h(this,"afterGetPosition",{pos:t}),t}getLabelPosition(t,e,i,s,r,a,l,c){const d=this.axis,u=d.transA,f=d.isLinked&&d.linkedParent?d.linkedParent.reversed:d.reversed,m=d.staggerLines,g=d.tickRotCorr||{x:0,y:0},v=s||d.reserveSpaceDefault?0:-d.labelOffset*("center"===d.labelAlign?.5:1),_=r.distance,x={};return i=0===d.side?i.rotation?-_:-i.getBBox().height:2===d.side?g.y+_:Math.cos(i.rotation*n)*(g.y-i.getBBox(!1,0).height/2),o(r.y)&&(i=0===d.side&&d.horiz?r.y+i:r.y),t=t+p(r.x,[0,1,0,-1][d.side]*_)+v+g.x-(a&&s?a*u*(f?-1:1):0),e=e+i-(a&&!s?a*u*(f?1:-1):0),m&&(s=l/(c||1)%m,d.opposite&&(s=m-s-1),e+=d.labelOffset/m*s),x.x=t,x.y=Math.round(e),h(this,"afterGetLabelPosition",{pos:x,tickmarkOffset:a,index:l}),x}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(t,e,i,n,s,r){return r.crispLine([["M",t,e],["L",t+(s?0:-i),e+(s?i:0)]],n)}handleOverflow(t){const e=this.axis,i=e.options.labels,s=t.x;var r=e.chart.chartWidth,o=e.chart.spacing;const a=p(e.labelLeft,Math.min(e.pos,o[3]));o=p(e.labelRight,Math.max(e.isRadial?0:e.pos+e.len,r-o[1]));const l=this.label,h=this.rotation,c={left:0,center:.5,right:1}[e.labelAlign||l.attr("align")],d=l.getBBox().width,u=e.getSlotWidth(this),f={};let m,g=u,v=1;h||"justify"!==i.overflow?0>h&&s-c*d<a?m=Math.round(s/Math.cos(h*n)-a):0<h&&s+c*d>o&&(m=Math.round((r-s)/Math.cos(h*n))):(r=s+(1-c)*d,s-c*d<a?g=t.x+g*(1-c)-a:r>o&&(g=o-t.x+g*c,v=-1),g=Math.min(u,g),g<u&&"center"===e.labelAlign&&(t.x+=v*(u-g-c*(u-Math.min(d,g)))),(d>g||e.autoRotation&&(l.styles||{}).width)&&(m=g)),m&&(this.shortenLabel?this.shortenLabel():(f.width=Math.floor(m)+"px",(i.style||{}).textOverflow||(f.textOverflow="ellipsis"),l.css(f)))}moveLabel(t,e){const i=this;var n=i.label;const s=i.axis;let r=!1;n&&n.textStr===t?(i.movedLabel=n,r=!0,delete i.label):u(s.ticks,(function(e){r||e.isNew||e===i||!e.label||e.label.textStr!==t||(i.movedLabel=e.label,r=!0,e.labelPos=i.movedLabel.xy,delete e.label)})),r||!i.labelPos&&!n||(n=i.labelPos||n.xy,i.movedLabel=i.createLabel(n,t,e),i.movedLabel&&i.movedLabel.attr({opacity:0}))}render(t,e,i){var n=this.axis,s=n.horiz,r=this.pos,o=p(this.tickmarkOffset,n.tickmarkOffset);o=(r=this.getPosition(s,r,o,e)).x;const a=r.y;n=s&&o===n.pos+n.len||!s&&a===n.pos?-1:1,s=p(i,this.label&&this.label.newOpacity,1),i=p(i,1),this.isActive=!0,this.renderGridLine(e,i,n),this.renderMark(r,i,n),this.renderLabel(r,e,s,t),this.isNew=!1,h(this,"afterRender")}renderGridLine(t,e,i){const n=this.axis,s=n.options,r={},o=this.pos,a=this.type,l=p(this.tickmarkOffset,n.tickmarkOffset),h=n.chart.renderer;let c=this.gridLine,d=s.gridLineWidth,u=s.gridLineColor,f=s.gridLineDashStyle;"minor"===this.type&&(d=s.minorGridLineWidth,u=s.minorGridLineColor,f=s.minorGridLineDashStyle),c||(n.chart.styledMode||(r.stroke=u,r["stroke-width"]=d||0,r.dashstyle=f),a||(r.zIndex=1),t&&(e=0),this.gridLine=c=h.path().attr(r).addClass("highcharts-"+(a?a+"-":"")+"grid-line").add(n.gridGroup)),c&&(i=n.getPlotLinePath({value:o+l,lineWidth:c.strokeWidth()*i,force:"pass",old:t,acrossPanes:!1}))&&c[t||this.isNew?"attr":"animate"]({d:i,opacity:e})}renderMark(t,e,i){const n=this.axis;var s=n.options;const r=n.chart.renderer,o=this.type,a=n.tickSize(o?o+"Tick":"tick"),l=t.x;t=t.y;const h=p(s["minor"!==o?"tickWidth":"minorTickWidth"],!o&&n.isXAxis?1:0);s=s["minor"!==o?"tickColor":"minorTickColor"];let c=this.mark;const d=!c;a&&(n.opposite&&(a[0]=-a[0]),c||(this.mark=c=r.path().addClass("highcharts-"+(o?o+"-":"")+"tick").add(n.axisGroup),n.chart.styledMode||c.attr({stroke:s,"stroke-width":h})),c[d?"attr":"animate"]({d:this.getMarkPath(l,t,a[0],c.strokeWidth()*i,n.horiz,r),opacity:e}))}renderLabel(t,e,i,n){var s=this.axis;const r=s.horiz,o=s.options,a=this.label,l=o.labels,h=l.step;s=p(this.tickmarkOffset,s.tickmarkOffset);const d=t.x;t=t.y;let u=!0;a&&c(d)&&(a.xy=t=this.getLabelPosition(d,t,a,r,l,s,n,h),this.isFirst&&!this.isLast&&!o.showFirstLabel||this.isLast&&!this.isFirst&&!o.showLastLabel?u=!1:!r||l.step||l.rotation||e||0===i||this.handleOverflow(t),h&&n%h&&(u=!1),u&&c(t.y)?(t.opacity=i,a[this.isNewLabel?"attr":"animate"](t).show(!0),this.isNewLabel=!1):(a.hide(),this.isNewLabel=!0))}replaceMovedLabel(){const t=this.label,e=this.axis;t&&!this.isNew&&(t.animate({opacity:0},void 0,t.destroy),delete this.label),e.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}}})),e(i,"Core/Axis/Axis.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Axis/AxisDefaults.js"],i["Core/Color/Color.js"],i["Core/Defaults.js"],i["Core/Foundation.js"],i["Core/Globals.js"],i["Core/Axis/Tick.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r,o,a){const{animObject:l}=t,{defaultOptions:h}=n,{registerEventOptions:c}=s,{deg2rad:d}=r,{arrayMax:u,arrayMin:p,clamp:f,correctFloat:m,defined:g,destroyObjectProperties:v,erase:_,error:x,extend:y,fireEvent:b,getClosestDistance:M,insertItem:S,isArray:w,isNumber:T,isString:E,merge:A,normalizeTickInterval:C,objectEach:P,pick:L,relativeLength:R,removeEvent:D,splat:I,syncTimeout:k}=a,O=(t,e)=>C(e,void 0,void 0,L(t.options.allowDecimals,.5>e||void 0!==t.tickAmount),!!t.tickAmount);class N{constructor(t,e,i){this.zoomEnabled=this.width=this.visible=this.userOptions=this.translationSlope=this.transB=this.transA=this.top=this.ticks=this.tickRotCorr=this.tickPositions=this.tickmarkOffset=this.tickInterval=this.tickAmount=this.side=this.series=this.right=this.positiveValuesOnly=this.pos=this.pointRangePadding=this.pointRange=this.plotLinesAndBandsGroups=this.plotLinesAndBands=this.paddedTicks=this.overlap=this.options=this.offset=this.names=this.minPixelPadding=this.minorTicks=this.minorTickInterval=this.min=this.maxLabelLength=this.max=this.len=this.left=this.labelFormatter=this.labelEdge=this.isLinked=this.index=this.height=this.hasVisibleSeries=this.hasNames=this.eventOptions=this.coll=this.closestPointRange=this.chart=this.bottom=this.alternateBands=void 0,this.init(t,e,i)}init(t,e,i=this.coll){const n="xAxis"===i;this.chart=t,this.horiz=this.isZAxis||(t.inverted?!n:n),this.isXAxis=n,this.coll=i,b(this,"init",{userOptions:e}),this.opposite=L(e.opposite,this.opposite),this.side=L(e.side,this.side,this.horiz?this.opposite?0:2:this.opposite?1:3),this.setOptions(e);const s=(i=this.options).labels,r=i.type;this.userOptions=e,this.minPixelPadding=0,this.reversed=L(i.reversed,this.reversed),this.visible=i.visible,this.zoomEnabled=i.zoomEnabled,this.hasNames="category"===r||!0===i.categories,this.categories=i.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=g(i.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len=0,this.minRange=this.userMinRange=i.minRange||i.maxZoom,this.range=i.range,this.offset=i.offset||0,this.min=this.max=null,e=L(i.crosshair,I(t.options.tooltip.crosshairs)[n?0:1]),this.crosshair=!0===e?{}:e,-1===t.axes.indexOf(this)&&(n?t.axes.splice(t.xAxis.length,0,this):t.axes.push(this),S(this,t[this.coll])),t.orderItems(this.coll),this.series=this.series||[],t.inverted&&!this.isZAxis&&n&&void 0===this.reversed&&(this.reversed=!0),this.labelRotation=T(s.rotation)?s.rotation:void 0,c(this,i),b(this,"afterInit")}setOptions(t){this.options=A(e.defaultXAxisOptions,"yAxis"===this.coll&&e.defaultYAxisOptions,[e.defaultTopAxisOptions,e.defaultRightAxisOptions,e.defaultBottomAxisOptions,e.defaultLeftAxisOptions][this.side],A(h[this.coll],t)),b(this,"afterSetOptions",{userOptions:t})}defaultLabelFormatter(t){var e=this.axis;({numberFormatter:t}=this.chart);const i=T(this.value)?this.value:NaN,n=e.chart.time,s=this.dateTimeLabelFormat;var r=h.lang;const o=r.numericSymbols;r=r.numericSymbolMagnitude||1e3;const a=e.logarithmic?Math.abs(i):e.tickInterval;let l,c=o&&o.length;if(e.categories)l=`${this.value}`;else if(s)l=n.dateFormat(s,i);else if(c&&1e3<=a)for(;c--&&void 0===l;)a>=(e=Math.pow(r,c+1))&&0==10*i%e&&null!==o[c]&&0!==i&&(l=t(i/e,-1)+o[c]);return void 0===l&&(l=1e4<=Math.abs(i)?t(i,-1):t(i,-1,void 0,"")),l}getSeriesExtremes(){const t=this,e=t.chart;let i;b(this,"getSeriesExtremes",null,(function(){t.hasVisibleSeries=!1,t.dataMin=t.dataMax=t.threshold=null,t.softThreshold=!t.isXAxis,t.series.forEach((function(n){if(n.visible||!e.options.chart.ignoreHiddenSeries){var s=n.options;let e,r,o=s.threshold;t.hasVisibleSeries=!0,t.positiveValuesOnly&&0>=o&&(o=null),t.isXAxis?(s=n.xData)&&s.length&&(s=t.logarithmic?s.filter((t=>0<t)):s,i=n.getXExtremes(s),e=i.min,r=i.max,T(e)||e instanceof Date||(s=s.filter(T),i=n.getXExtremes(s),e=i.min,r=i.max),s.length&&(t.dataMin=Math.min(L(t.dataMin,e),e),t.dataMax=Math.max(L(t.dataMax,r),r))):(n=n.applyExtremes(),T(n.dataMin)&&(e=n.dataMin,t.dataMin=Math.min(L(t.dataMin,e),e)),T(n.dataMax)&&(r=n.dataMax,t.dataMax=Math.max(L(t.dataMax,r),r)),g(o)&&(t.threshold=o),(!s.softThreshold||t.positiveValuesOnly)&&(t.softThreshold=!1))}}))})),b(this,"afterGetSeriesExtremes")}translate(t,e,i,n,s,r){const o=this.linkedParent||this,a=n&&o.old?o.old.min:o.min;if(!T(a))return NaN;const l=o.minPixelPadding;s=(o.isOrdinal||o.brokenAxis&&o.brokenAxis.hasBreaks||o.logarithmic&&s)&&o.lin2val;let h=1,c=0;return(n=n&&o.old?o.old.transA:o.transA)||(n=o.transA),i&&(h*=-1,c=o.len),o.reversed&&(h*=-1,c-=h*(o.sector||o.len)),e?(r=(t*h+c-l)/n+a,s&&(r=o.lin2val(r))):(s&&(t=o.val2lin(t)),t=h*(t-a)*n,r=(o.isRadial?t:m(t))+c+h*l+(T(r)?n*r:0)),r}toPixels(t,e){return this.translate(t,!1,!this.horiz,void 0,!0)+(e?0:this.pos)}toValue(t,e){return this.translate(t-(e?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(t){function e(t,e,i){return"pass"!==x&&(t<e||t>i)&&(x?t=f(t,e,i):v=!0),t}const i=this,n=i.chart,s=i.left,r=i.top,o=t.old,a=t.value,l=t.lineWidth,h=o&&n.oldChartHeight||n.chartHeight,c=o&&n.oldChartWidth||n.chartWidth,d=i.transB;let u,p,m,g,v,_=t.translatedValue,x=t.force;return t={value:a,lineWidth:l,old:o,force:x,acrossPanes:t.acrossPanes,translatedValue:_},b(this,"getPlotLinePath",t,(function(t){_=L(_,i.translate(a,void 0,void 0,o)),_=f(_,-1e5,1e5),u=m=Math.round(_+d),p=g=Math.round(h-_-d),T(_)?i.horiz?(p=r,g=h-i.bottom,u=m=e(u,s,s+i.width)):(u=s,m=c-i.right,p=g=e(p,r,r+i.height)):(v=!0,x=!1),t.path=v&&!x?null:n.renderer.crispLine([["M",u,p],["L",m,g]],l||1)})),t.path}getLinearTickPositions(t,e,i){const n=m(Math.floor(e/t)*t);i=m(Math.ceil(i/t)*t);const s=[];let r,o;if(m(n+t)===n&&(o=20),this.single)return[e];for(e=n;e<=i&&(s.push(e),(e=m(e+t,o))!==r);)r=e;return s}getMinorTickInterval(){const t=this.options;return!0===t.minorTicks?L(t.minorTickInterval,"auto"):!1===t.minorTicks?null:t.minorTickInterval}getMinorTickPositions(){var t=this.options;const e=this.tickPositions,i=this.minorTickInterval;var n=this.pointRangePadding||0;const s=this.min-n,r=(n=this.max+n)-s;let o=[];if(r&&r/i<this.len/3){const r=this.logarithmic;if(r)this.paddedTicks.forEach((function(t,e,n){e&&o.push.apply(o,r.getLogTickPositions(i,n[e-1],n[e],!0))}));else if(this.dateTime&&"auto"===this.getMinorTickInterval())o=o.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(i),s,n,t.startOfWeek));else for(t=s+(e[0]-s)%i;t<=n&&t!==o[0];t+=i)o.push(t)}return 0!==o.length&&this.trimTicks(o),o}adjustForMinRange(){const t=this.options,e=this.logarithmic;let i=this.min;var n=this.max;let s,r;if(this.isXAxis&&void 0===this.minRange&&!e)if(g(t.min)||g(t.max)||g(t.floor)||g(t.ceiling))this.minRange=null;else{var o=M(this.series.map((t=>{var e;return(t.xIncrement?null===(e=t.xData)||void 0===e?void 0:e.slice(0,2):t.xData)||[]})))||0;this.minRange=Math.min(5*o,this.dataMax-this.dataMin)}n-i<this.minRange&&(o=this.dataMax-this.dataMin>=this.minRange,r=this.minRange,s=[i-(n=(r-n+i)/2),L(t.min,i-n)],o&&(s[2]=e?e.log2lin(this.dataMin):this.dataMin),i=u(s),n=[i+r,L(t.max,i+r)],o&&(n[2]=e?e.log2lin(this.dataMax):this.dataMax),(n=p(n))-i<r&&(s[0]=n-r,s[1]=L(t.min,n-r),i=u(s))),this.min=i,this.max=n}getClosest(){let t,e;if(this.categories)e=1;else{const i=[];this.series.forEach((function(t){var n;const s=t.closestPointRange,r=t.visible||!t.chart.options.chart.ignoreHiddenSeries;1===(null===(n=t.xData)||void 0===n?void 0:n.length)?i.push(t.xData[0]):!t.noSharedTooltip&&g(s)&&r&&(e=g(e)?Math.min(e,s):s)})),i.length&&(i.sort(((t,e)=>t-e)),t=M([i]))}return t&&e?Math.min(t,e):t||e}nameToX(t){const e=w(this.options.categories),i=e?this.categories:this.names;let n,s=t.options.x;return t.series.requireSorting=!1,g(s)||(s=this.options.uniqueNames&&i?e?i.indexOf(t.name):L(i.keys[t.name],-1):t.series.autoIncrement()),-1===s?!e&&i&&(n=i.length):n=s,void 0!==n?(this.names[n]=t.name,this.names.keys[t.name]=n):t.x&&(n=t.x),n}updateNames(){const t=this,e=this.names;0<e.length&&(Object.keys(e.keys).forEach((function(t){delete e.keys[t]})),e.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach((function(e){e.xIncrement=null,e.points&&!e.isDirtyData||(t.max=Math.max(t.max,e.xData.length-1),e.processData(),e.generatePoints()),e.data.forEach((function(i,n){let s;i&&i.options&&void 0!==i.name&&(s=t.nameToX(i),void 0!==s&&s!==i.x&&(i.x=s,e.xData[n]=s))}))})))}setAxisTranslation(){const t=this,e=t.max-t.min;var i=t.linkedParent;const n=!!t.categories,s=t.isXAxis;let r,o=t.axisPointRange||0,a=0,l=0,h=t.transA;(s||n||o)&&(r=t.getClosest(),i?(a=i.minPointOffset,l=i.pointRangePadding):t.series.forEach((function(e){const i=n?1:s?L(e.options.pointRange,r,0):t.axisPointRange||0,h=e.options.pointPlacement;o=Math.max(o,i),t.single&&!n||(e=e.is("xrange")?!s:s,a=Math.max(a,e&&E(h)?0:i/2),l=Math.max(l,e&&"on"===h?0:i))})),i=t.ordinal&&t.ordinal.slope&&r?t.ordinal.slope/r:1,t.minPointOffset=a*=i,t.pointRangePadding=l*=i,t.pointRange=Math.min(o,t.single&&n?1:e),s&&r&&(t.closestPointRange=r)),t.translationSlope=t.transA=h=t.staticScale||t.len/(e+l||1),t.transB=t.horiz?t.left:t.bottom,t.minPixelPadding=h*a,b(this,"afterSetAxisTranslation")}minFromRange(){return this.max-this.range}setTickInterval(t){var e=this.chart;const i=this.logarithmic,n=this.options,s=this.isXAxis,r=this.isLinked,o=n.tickPixelInterval,a=this.categories,l=this.softThreshold;let h,c,d,u=n.maxPadding,p=n.minPadding,f=T(n.tickInterval)&&0<=n.tickInterval?n.tickInterval:void 0,v=T(this.threshold)?this.threshold:null;if(this.dateTime||a||r||this.getTickAmount(),c=L(this.userMin,n.min),d=L(this.userMax,n.max),r){this.linkedParent=e[this.coll][n.linkedTo];var _=this.linkedParent.getExtremes();this.min=L(_.min,_.dataMin),this.max=L(_.max,_.dataMax),n.type!==this.linkedParent.options.type&&x(11,1,e)}else l&&g(v)&&(this.dataMin>=v?(_=v,p=0):this.dataMax<=v&&(h=v,u=0)),this.min=L(c,_,this.dataMin),this.max=L(d,h,this.dataMax);if(i&&(this.positiveValuesOnly&&!t&&0>=Math.min(this.min,L(this.dataMin,this.min))&&x(10,1,e),this.min=m(i.log2lin(this.min),16),this.max=m(i.log2lin(this.max),16)),this.range&&g(this.max)&&(this.userMin=this.min=c=Math.max(this.dataMin,this.minFromRange()),this.userMax=d=this.max,this.range=null),b(this,"foundExtremes"),this.beforePadding&&this.beforePadding(),this.adjustForMinRange(),!T(this.userMin)&&T(n.softMin)&&n.softMin<this.min&&(this.min=c=n.softMin),!T(this.userMax)&&T(n.softMax)&&n.softMax>this.max&&(this.max=d=n.softMax),!(a||this.axisPointRange||this.stacking&&this.stacking.usePercentage||r)&&g(this.min)&&g(this.max)&&(e=this.max-this.min)&&(!g(c)&&p&&(this.min-=e*p),!g(d)&&u&&(this.max+=e*u)),!T(this.userMin)&&T(n.floor)&&(this.min=Math.max(this.min,n.floor)),!T(this.userMax)&&T(n.ceiling)&&(this.max=Math.min(this.max,n.ceiling)),l&&g(this.dataMin)&&(v=v||0,!g(c)&&this.min<v&&this.dataMin>=v?this.min=this.options.minRange?Math.min(v,this.max-this.minRange):v:!g(d)&&this.max>v&&this.dataMax<=v&&(this.max=this.options.minRange?Math.max(v,this.min+this.minRange):v)),T(this.min)&&T(this.max)&&!this.chart.polar&&this.min>this.max&&(g(this.options.min)?this.max=this.min:g(this.options.max)&&(this.min=this.max)),this.tickInterval=this.min===this.max||void 0===this.min||void 0===this.max?1:r&&this.linkedParent&&!f&&o===this.linkedParent.options.tickPixelInterval?f=this.linkedParent.tickInterval:L(f,this.tickAmount?(this.max-this.min)/Math.max(this.tickAmount-1,1):void 0,a?1:(this.max-this.min)*o/Math.max(this.len,o)),s&&!t){const t=this.min!==(this.old&&this.old.min)||this.max!==(this.old&&this.old.max);this.series.forEach((function(e){e.forceCrop=e.forceCropping&&e.forceCropping(),e.processData(t)})),b(this,"postProcessData",{hasExtremesChanged:t})}this.setAxisTranslation(),b(this,"initialAxisTranslation"),this.pointRange&&!f&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval)),t=L(n.minTickInterval,this.dateTime&&!this.series.some((t=>t.noSharedTooltip))?this.closestPointRange:0),!f&&this.tickInterval<t&&(this.tickInterval=t),this.dateTime||this.logarithmic||f||(this.tickInterval=O(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var t=this.options;const e=t.tickPositions,i=t.tickPositioner;var n=this.getMinorTickInterval(),s=this.hasVerticalPanning(),r="colorAxis"===this.coll;const o=(r||!s)&&t.startOnTick;let a;if(s=(r||!s)&&t.endOnTick,r=[],this.tickmarkOffset=this.categories&&"between"===t.tickmarkPlacement&&1===this.tickInterval?.5:0,this.minorTickInterval="auto"===n&&this.tickInterval?this.tickInterval/t.minorTicksPerMajor:n,this.single=this.min===this.max&&g(this.min)&&!this.tickAmount&&(parseInt(this.min,10)===this.min||!1!==t.allowDecimals),e)r=e.slice();else if(T(this.min)&&T(this.max)){if(this.ordinal&&this.ordinal.positions||!((this.max-this.min)/this.tickInterval>Math.max(2*this.len,200)))if(this.dateTime)r=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,t.units),this.min,this.max,t.startOfWeek,this.ordinal&&this.ordinal.positions,this.closestPointRange,!0);else if(this.logarithmic)r=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else for(n=t=this.tickInterval;n<=2*t&&(r=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&r.length>this.tickAmount);)this.tickInterval=O(this,n*=1.1);else r=[this.min,this.max],x(19,!1,this.chart);r.length>this.len&&(r=[r[0],r[r.length-1]])[0]===r[1]&&(r.length=1),i&&(this.tickPositions=r,(a=i.apply(this,[this.min,this.max]))&&(r=a))}this.tickPositions=r,this.paddedTicks=r.slice(0),this.trimTicks(r,o,s),!this.isLinked&&T(this.min)&&T(this.max)&&(this.single&&2>r.length&&!this.categories&&!this.series.some((t=>t.is("heatmap")&&"between"===t.options.pointPlacement))&&(this.min-=.5,this.max+=.5),e||a||this.adjustTickAmount()),b(this,"afterSetTickPositions")}trimTicks(t,e,i){const n=t[0],s=t[t.length-1],r=!this.isOrdinal&&this.minPointOffset||0;if(b(this,"trimTicks"),!this.isLinked){if(e&&-1/0!==n)this.min=n;else for(;this.min-r>t[0];)t.shift();if(i)this.max=s;else for(;this.max+r<t[t.length-1];)t.pop();0===t.length&&g(n)&&!this.options.tickPositions&&t.push((s+n)/2)}}alignToOthers(){const t=this,e=[this],i=t.options,n="yAxis"===this.coll&&this.chart.options.chart.alignThresholds,s=[];let r;if(t.thresholdAlignment=void 0,(!1!==this.chart.options.chart.alignTicks&&i.alignTicks||n)&&!1!==i.startOnTick&&!1!==i.endOnTick&&!t.logarithmic){const i=t=>{const{horiz:e,options:i}=t;return[e?i.left:i.top,i.width,i.height,i.pane].join()},n=i(this);this.chart[this.coll].forEach((function(s){const{series:o}=s;o.length&&o.some((t=>t.visible))&&s!==t&&i(s)===n&&(r=!0,e.push(s))}))}if(r&&n){e.forEach((e=>{e=e.getThresholdAlignment(t),T(e)&&s.push(e)}));const i=1<s.length?s.reduce(((t,e)=>t+e),0)/s.length:void 0;e.forEach((t=>{t.thresholdAlignment=i}))}return r}getThresholdAlignment(t){if((!T(this.dataMin)||this!==t&&this.series.some((t=>t.isDirty||t.isDirtyData)))&&this.getSeriesExtremes(),T(this.threshold))return t=f((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1),this.options.reversed&&(t=1-t),t}getTickAmount(){const t=this.options,e=t.tickPixelInterval;let i=t.tickAmount;!g(t.tickInterval)&&!i&&this.len<e&&!this.isRadial&&!this.logarithmic&&t.startOnTick&&t.endOnTick&&(i=2),!i&&this.alignToOthers()&&(i=Math.ceil(this.len/e)+1),4>i&&(this.finalTickAmt=i,i=5),this.tickAmount=i}adjustTickAmount(){const t=this,{finalTickAmt:e,max:i,min:n,options:s,tickPositions:r,tickAmount:o,thresholdAlignment:a}=t,l=r&&r.length;var h=L(t.threshold,t.softThreshold?0:null),c=t.tickInterval;let d;if(T(a)&&(d=.5>a?Math.ceil(a*(o-1)):Math.floor(a*(o-1)),s.reversed&&(d=o-1-d)),t.hasData()&&T(n)&&T(i)){const a=()=>{t.transA*=(l-1)/(o-1),t.min=s.startOnTick?r[0]:Math.min(n,r[0]),t.max=s.endOnTick?r[r.length-1]:Math.max(i,r[r.length-1])};if(T(d)&&T(t.threshold)){for(;r[d]!==h||r.length!==o||r[0]>n||r[r.length-1]<i;){for(r.length=0,r.push(t.threshold);r.length<o;)void 0===r[d]||r[d]>t.threshold?r.unshift(m(r[0]-c)):r.push(m(r[r.length-1]+c));if(c>8*t.tickInterval)break;c*=2}a()}else if(l<o){for(;r.length<o;)r.length%2||n===h?r.push(m(r[r.length-1]+c)):r.unshift(m(r[0]-c));a()}if(g(e)){for(c=h=r.length;c--;)(3===e&&1==c%2||2>=e&&0<c&&c<h-1)&&r.splice(c,1);t.finalTickAmt=void 0}}}setScale(){let t=!1,e=!1;this.series.forEach((function(i){t=t||i.isDirtyData||i.isDirty,e=e||i.xAxis&&i.xAxis.isDirty||!1})),this.setAxisSize();const i=this.len!==(this.old&&this.old.len);i||t||e||this.isLinked||this.forceRedraw||this.userMin!==(this.old&&this.old.userMin)||this.userMax!==(this.old&&this.old.userMax)||this.alignToOthers()?(this.stacking&&(this.stacking.resetStacks(),this.stacking.buildStacks()),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),this.isDirty||(this.isDirty=i||this.min!==(this.old&&this.old.min)||this.max!==(this.old&&this.old.max))):this.stacking&&this.stacking.cleanStacks(),t&&this.panningState&&(this.panningState.isDirty=!0),b(this,"afterSetScale")}setExtremes(t,e,i,n,s){const r=this,o=r.chart;i=L(i,!0),r.series.forEach((function(t){delete t.kdTree})),s=y(s,{min:t,max:e}),b(r,"setExtremes",s,(function(){r.userMin=t,r.userMax=e,r.eventArgs=s,i&&o.redraw(n)}))}zoom(t,e){const i=this,n=this.dataMin,s=this.dataMax,r=this.options,o=Math.min(n,L(r.min,n)),a=Math.max(s,L(r.max,s));return b(this,"zoom",t={newMin:t,newMax:e},(function(t){let e=t.newMin,r=t.newMax;e===i.min&&r===i.max||(i.allowZoomOutside||(g(n)&&(e<o&&(e=o),e>a&&(e=a)),g(s)&&(r<o&&(r=o),r>a&&(r=a))),i.displayBtn=void 0!==e||void 0!==r,i.setExtremes(e,r,!1,void 0,{trigger:"zoom"})),t.zoomed=!0})),t.zoomed}setAxisSize(){const t=this.chart;var e=this.options;const i=e.offsets||[0,0,0,0],n=this.horiz,s=this.width=Math.round(R(L(e.width,t.plotWidth-i[3]+i[1]),t.plotWidth)),r=this.height=Math.round(R(L(e.height,t.plotHeight-i[0]+i[2]),t.plotHeight)),o=this.top=Math.round(R(L(e.top,t.plotTop+i[0]),t.plotHeight,t.plotTop));e=this.left=Math.round(R(L(e.left,t.plotLeft+i[3]),t.plotWidth,t.plotLeft)),this.bottom=t.chartHeight-r-o,this.right=t.chartWidth-s-e,this.len=Math.max(n?s:r,0),this.pos=n?e:o}getExtremes(){const t=this.logarithmic;return{min:t?m(t.lin2log(this.min)):this.min,max:t?m(t.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(t){var e=this.logarithmic;const i=e?e.lin2log(this.min):this.min;return e=e?e.lin2log(this.max):this.max,null===t||-1/0===t?t=i:1/0===t?t=e:i>t?t=i:e<t&&(t=e),this.translate(t,0,1,0,1)}autoLabelAlign(t){const e=(L(t,0)-90*this.side+720)%360;return b(this,"autoLabelAlign",t={align:"center"},(function(t){15<e&&165>e?t.align="right":195<e&&345>e&&(t.align="left")})),t.align}tickSize(t){const e=this.options,i=L(e["tick"===t?"tickWidth":"minorTickWidth"],"tick"===t&&this.isXAxis&&!this.categories?1:0);let n,s=e["tick"===t?"tickLength":"minorTickLength"];return i&&s&&("inside"===e[t+"Position"]&&(s=-s),n=[s,i]),b(this,"afterTickSize",t={tickSize:n}),t.tickSize}labelMetrics(){const t=this.chart.renderer;var e=this.ticks;return e=e[Object.keys(e)[0]]||{},this.chart.renderer.fontMetrics(e.label||e.movedLabel||t.box)}unsquish(){const t=this.options.labels;var e=this.horiz;const i=this.tickInterval,n=this.len/(((this.categories?1:0)+this.max-this.min)/i),s=t.rotation,r=.75*this.labelMetrics().h,o=Math.max(this.max-this.min,0),a=function(t){let e=t/(n||1);return e=1<e?Math.ceil(e):1,e*i>o&&1/0!==t&&1/0!==n&&o&&(e=Math.ceil(o/i)),m(e*i)};let l,h,c=i,u=Number.MAX_VALUE;if(e){if(t.staggerLines||(T(s)?h=[s]:n<t.autoRotationLimit&&(h=t.autoRotation)),h){let t;for(const i of h)(i===s||i&&-90<=i&&90>=i)&&(t=(e=a(Math.abs(r/Math.sin(d*i))))+Math.abs(i/360),t<u&&(u=t,l=i,c=e))}}else c=a(r);return this.autoRotation=h,this.labelRotation=L(l,T(s)?s:0),t.step?i:c}getSlotWidth(t){const e=this.chart,i=this.horiz,n=this.options.labels,s=Math.max(this.tickPositions.length-(this.categories?0:1),1),r=e.margin[3];if(t&&T(t.slotWidth))return t.slotWidth;if(i&&2>n.step)return n.rotation?0:(this.staggerLines||1)*this.len/s;if(!i){if(void 0!==(t=n.style.width))return parseInt(String(t),10);if(r)return r-e.spacing[3]}return.33*e.chartWidth}renderUnsquish(){const t=this.chart,e=t.renderer,i=this.tickPositions,n=this.ticks,s=this.options.labels,r=s.style,o=this.horiz,a=this.getSlotWidth();var l=Math.max(1,Math.round(a-2*s.padding));const h={},c=this.labelMetrics(),d=r.textOverflow;let u,p,f=0;if(E(s.rotation)||(h.rotation=s.rotation||0),i.forEach((function(t){(t=n[t]).movedLabel&&t.replaceMovedLabel(),t&&t.label&&t.label.textPxLength>f&&(f=t.label.textPxLength)})),this.maxLabelLength=f,this.autoRotation)f>l&&f>c.h?h.rotation=this.labelRotation:this.labelRotation=0;else if(a&&(u=l,!d))for(p="clip",l=i.length;!o&&l--;){var m=i[l];(m=n[m].label)&&(m.styles&&"ellipsis"===m.styles.textOverflow?m.css({textOverflow:"clip"}):m.textPxLength>a&&m.css({width:a+"px"}),m.getBBox().height>this.len/i.length-(c.h-c.f)&&(m.specificTextOverflow="ellipsis"))}h.rotation&&(u=f>.5*t.chartHeight?.33*t.chartHeight:f,d||(p="ellipsis")),(this.labelAlign=s.align||this.autoLabelAlign(this.labelRotation))&&(h.align=this.labelAlign),i.forEach((function(t){const e=(t=n[t])&&t.label,i=r.width,s={};e&&(e.attr(h),t.shortenLabel?t.shortenLabel():u&&!i&&"nowrap"!==r.whiteSpace&&(u<e.textPxLength||"SPAN"===e.element.tagName)?(s.width=u+"px",d||(s.textOverflow=e.specificTextOverflow||p),e.css(s)):e.styles&&e.styles.width&&!s.width&&!i&&e.css({width:null}),delete e.specificTextOverflow,t.rotation=h.rotation)}),this),this.tickRotCorr=e.rotCorr(c.b,this.labelRotation||0,0!==this.side)}hasData(){return this.series.some((function(t){return t.hasData()}))||this.options.showEmpty&&g(this.min)&&g(this.max)}addTitle(t){const e=this.chart.renderer,i=this.horiz,n=this.opposite,s=this.options.title,r=this.chart.styledMode;let o;this.axisTitle||((o=s.textAlign)||(o=(i?{low:"left",middle:"center",high:"right"}:{low:n?"right":"left",middle:"center",high:n?"left":"right"})[s.align]),this.axisTitle=e.text(s.text||"",0,0,s.useHTML).attr({zIndex:7,rotation:s.rotation,align:o}).addClass("highcharts-axis-title"),r||this.axisTitle.css(A(s.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),r||s.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[t?"show":"hide"](t)}generateTick(t){const e=this.ticks;e[t]?e[t].addLabel():e[t]=new o(this,t)}getOffset(){const t=this,{chart:e,horiz:i,options:n,side:s,ticks:r,tickPositions:o,coll:a,axisParent:l}=t,h=e.renderer,c=e.inverted&&!t.isZAxis?[1,0,3,2][s]:s;var d=t.hasData();const u=n.title;var p=n.labels;const f=T(n.crossing);var m=e.axisOffset;const v=e.clipOffset,_=[-1,1,1,-1][s],x=n.className;let y,M,S=0;var w=0;let E=0;if(t.showAxis=y=d||n.showEmpty,t.staggerLines=t.horiz&&p.staggerLines||void 0,!t.axisGroup){const e=(t,e,i)=>h.g(t).attr({zIndex:i}).addClass(`highcharts-${a.toLowerCase()}${e} `+(this.isRadial?`highcharts-radial-axis${e} `:"")+(x||"")).add(l);t.gridGroup=e("grid","-grid",n.gridZIndex),t.axisGroup=e("axis","",n.zIndex),t.labelGroup=e("axis-labels","-labels",p.zIndex)}d||t.isLinked?(o.forEach((function(e){t.generateTick(e)})),t.renderUnsquish(),t.reserveSpaceDefault=0===s||2===s||{1:"left",3:"right"}[s]===t.labelAlign,L(p.reserveSpace,!f&&null,"center"===t.labelAlign||null,t.reserveSpaceDefault)&&o.forEach((function(t){E=Math.max(r[t].getLabelSize(),E)})),t.staggerLines&&(E*=t.staggerLines),t.labelOffset=E*(t.opposite?-1:1)):P(r,(function(t,e){t.destroy(),delete r[e]})),u&&u.text&&!1!==u.enabled&&(t.addTitle(y),y&&!f&&!1!==u.reserveSpace&&(t.titleOffset=S=t.axisTitle.getBBox()[i?"height":"width"],M=u.offset,w=g(M)?0:L(u.margin,i?5:10))),t.renderLine(),t.offset=_*L(n.offset,m[s]?m[s]+(n.margin||0):0),t.tickRotCorr=t.tickRotCorr||{x:0,y:0},d=0===s?-t.labelMetrics().h:2===s?t.tickRotCorr.y:0,w=Math.abs(E)+w,E&&(w=w-d+_*(i?L(p.y,t.tickRotCorr.y+_*p.distance):L(p.x,_*p.distance))),t.axisTitleMargin=L(M,w),t.getMaxLabelDimensions&&(t.maxLabelDimensions=t.getMaxLabelDimensions(r,o)),"colorAxis"!==a&&(p=this.tickSize("tick"),m[s]=Math.max(m[s],(t.axisTitleMargin||0)+S+_*t.offset,w,o&&o.length&&p?p[0]+_*t.offset:0),m=!t.axisLine||n.offset?0:2*Math.floor(t.axisLine.strokeWidth()/2),v[c]=Math.max(v[c],m)),b(this,"afterGetOffset")}getLinePath(t){const e=this.chart,i=this.opposite;var n=this.offset;const s=this.horiz,r=this.left+(i?this.width:0)+n;return n=e.chartHeight-this.bottom-(i?this.height:0)+n,i&&(t*=-1),e.renderer.crispLine([["M",s?this.left:r,s?n:this.top],["L",s?e.chartWidth-this.right:r,s?n:e.chartHeight-this.bottom]],t)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(t){var e=this.horiz,i=this.left;const n=this.top;var s=this.len;const r=this.options.title,o=e?i:n,a=this.opposite,l=this.offset,h=r.x,c=r.y,d=this.chart.renderer.fontMetrics(t);return t=t?Math.max(t.getBBox(!1,0).height-d.h-1,0):0,s={low:o+(e?0:s),middle:o+s/2,high:o+(e?s:0)}[r.align],i=(e?n+this.height:i)+(e?1:-1)*(a?-1:1)*(this.axisTitleMargin||0)+[-t,t,d.f,-t][this.side],e={x:e?s+h:i+(a?this.width:0)+l+h,y:e?i+c-(a?this.height:0)+l:s+c},b(this,"afterGetTitlePosition",{titlePosition:e}),e}renderMinorTick(t,e){const i=this.minorTicks;i[t]||(i[t]=new o(this,t,"minor")),e&&i[t].isNew&&i[t].render(null,!0),i[t].render(null,!1,1)}renderTick(t,e,i){const n=this.ticks;(!this.isLinked||t>=this.min&&t<=this.max||this.grid&&this.grid.isColumn)&&(n[t]||(n[t]=new o(this,t)),i&&n[t].isNew&&n[t].render(e,!0,-1),n[t].render(e))}render(){const t=this,e=t.chart,i=t.logarithmic,n=t.options,s=t.isLinked,a=t.tickPositions,h=t.axisTitle,c=t.ticks,d=t.minorTicks,u=t.alternateBands,p=n.stackLabels,f=n.alternateGridColor;var m=n.crossing;const g=t.tickmarkOffset,v=t.axisLine,_=t.showAxis,x=l(e.renderer.globalAnimation);let y,M;if(t.labelEdge.length=0,t.overlap=!1,[c,d,u].forEach((function(t){P(t,(function(t){t.isActive=!1}))})),T(m)){const i=this.isXAxis?e.yAxis[0]:e.xAxis[0],n=[1,-1,-1,1][this.side];i&&(m=i.toPixels(m,!0),t.horiz&&(m=i.len-m),t.offset=n*m)}if(t.hasData()||s){const s=t.chart.hasRendered&&t.old&&T(t.old.min);t.minorTickInterval&&!t.categories&&t.getMinorTickPositions().forEach((function(e){t.renderMinorTick(e,s)})),a.length&&(a.forEach((function(e,i){t.renderTick(e,i,s)})),g&&(0===t.min||t.single)&&(c[-1]||(c[-1]=new o(t,-1,null,!0)),c[-1].render(-1))),f&&a.forEach((function(n,s){M=void 0!==a[s+1]?a[s+1]+g:t.max-g,0==s%2&&n<t.max&&M<=t.max+(e.polar?-g:g)&&(u[n]||(u[n]=new r.PlotLineOrBand(t)),y=n+g,u[n].options={from:i?i.lin2log(y):y,to:i?i.lin2log(M):M,color:f,className:"highcharts-alternate-grid"},u[n].render(),u[n].isActive=!0)})),t._addedPlotLB||(t._addedPlotLB=!0,(n.plotLines||[]).concat(n.plotBands||[]).forEach((function(e){t.addPlotBandOrLine(e)})))}[c,d,u].forEach((function(t){const i=[],n=x.duration;P(t,(function(t,e){t.isActive||(t.render(e,!1,0),t.isActive=!1,i.push(e))})),k((function(){let e=i.length;for(;e--;)t[i[e]]&&!t[i[e]].isActive&&(t[i[e]].destroy(),delete t[i[e]])}),t!==u&&e.hasRendered&&n?n:0)})),v&&(v[v.isPlaced?"animate":"attr"]({d:this.getLinePath(v.strokeWidth())}),v.isPlaced=!0,v[_?"show":"hide"](_)),h&&_&&(h[h.isNew?"attr":"animate"](t.getTitlePosition(h)),h.isNew=!1),p&&p.enabled&&t.stacking&&t.stacking.renderStackTotals(),t.old={len:t.len,max:t.max,min:t.min,transA:t.transA,userMax:t.userMax,userMin:t.userMin},t.isDirty=!1,b(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach((function(t){t.render()}))),this.series.forEach((function(t){t.isDirty=!0}))}getKeepProps(){return this.keepProps||N.keepProps}destroy(t){const e=this,i=e.plotLinesAndBands,n=this.eventOptions;if(b(this,"destroy",{keepEvents:t}),t||D(e),[e.ticks,e.minorTicks,e.alternateBands].forEach((function(t){v(t)})),i)for(t=i.length;t--;)i[t].destroy();"axisLine axisTitle axisGroup gridGroup labelGroup cross scrollbar".split(" ").forEach((function(t){e[t]&&(e[t]=e[t].destroy())}));for(const t in e.plotLinesAndBandsGroups)e.plotLinesAndBandsGroups[t]=e.plotLinesAndBandsGroups[t].destroy();P(e,(function(t,i){-1===e.getKeepProps().indexOf(i)&&delete e[i]})),this.eventOptions=n}drawCrosshair(t,e){const n=this.crosshair;var s=L(n&&n.snap,!0);const r=this.chart;let o,a=this.cross;if(b(this,"drawCrosshair",{e:t,point:e}),t||(t=this.cross&&this.cross.e),n&&!1!==(g(e)||!s)){if(s?g(e)&&(o=L("colorAxis"!==this.coll?e.crosshairPos:null,this.isXAxis?e.plotX:this.len-e.plotY)):o=t&&(this.horiz?t.chartX-this.pos:this.len-t.chartY+this.pos),g(o)){var l={value:e&&(this.isXAxis?e.x:L(e.stackY,e.y)),translatedValue:o};r.polar&&y(l,{isCrosshair:!0,chartX:t&&t.chartX,chartY:t&&t.chartY,point:e}),l=this.getPlotLinePath(l)||null}if(!g(l))return void this.hideCrosshair();s=this.categories&&!this.isRadial,a||(this.cross=a=r.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(s?"category ":"thin ")+(n.className||"")).attr({zIndex:L(n.zIndex,2)}).add(),r.styledMode||(a.attr({stroke:n.color||(s?i.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":L(n.width,1)}).css({"pointer-events":"none"}),n.dashStyle&&a.attr({dashstyle:n.dashStyle}))),a.show().attr({d:l}),s&&!n.width&&a.attr({"stroke-width":this.transA}),this.cross.e=t}else this.hideCrosshair();b(this,"afterDrawCrosshair",{e:t,point:e})}hideCrosshair(){this.cross&&this.cross.hide(),b(this,"afterHideCrosshair")}hasVerticalPanning(){const t=this.chart.options.chart.panning;return!!(t&&t.enabled&&/y/.test(t.type))}update(t,e){const i=this.chart;t=A(this.userOptions,t),this.destroy(!0),this.init(i,t),i.isDirtyBox=!0,L(e,!0)&&i.redraw()}remove(t){const e=this.chart,i=this.coll,n=this.series;let s=n.length;for(;s--;)n[s]&&n[s].remove(!1);_(e.axes,this),_(e[i]||[],this),e.orderItems(i),this.destroy(),e.isDirtyBox=!0,L(t,!0)&&e.redraw()}setTitle(t,e){this.update({title:t},e)}setCategories(t,e){this.update({categories:t},e)}}return N.defaultOptions=e.defaultXAxisOptions,N.keepProps="coll extKey hcEvents names series userMax userMin".split(" "),N})),e(i,"Core/Axis/DateTimeAxis.js",[i["Core/Utilities.js"]],(function(t){const{addEvent:e,getMagnitude:i,normalizeTickInterval:n,timeUnits:s}=t;var r;return function(r){function o(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function a(t){"datetime"!==t.userOptions.type?this.dateTime=void 0:this.dateTime||(this.dateTime=new h(this))}const l=[];r.compose=function(i){return t.pushUnique(l,i)&&(i.keepProps.push("dateTime"),i.prototype.getTimeTicks=o,e(i,"init",a)),i};class h{constructor(t){this.axis=t}normalizeTimeTickInterval(t,e){const r=e||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]];e=r[r.length-1];let o,a=s[e[0]],l=e[1];for(o=0;o<r.length&&(e=r[o],a=s[e[0]],l=e[1],!(r[o+1]&&t<=(a*l[l.length-1]+s[r[o+1][0]])/2));o++);return a===s.year&&t<5*a&&(l=[1,2,5]),{unitRange:a,count:t=n(t/a,l,"year"===e[0]?Math.max(i(t/a),1):1),unitName:e[0]}}getXDateFormat(t,e){const{axis:i}=this,n=i.chart.time;return i.closestPointRange?n.getDateFormat(i.closestPointRange,t,i.options.startOfWeek,e)||n.resolveDTLFormat(e.year).main:n.resolveDTLFormat(e.day).main}}r.Additions=h}(r||(r={})),r})),e(i,"Core/Axis/LogarithmicAxis.js",[i["Core/Utilities.js"]],(function(t){const{addEvent:e,normalizeTickInterval:i,pick:n}=t;var s;return function(s){function r(t){let e=this.logarithmic;"logarithmic"!==t.userOptions.type?this.logarithmic=void 0:e||(this.logarithmic=new l(this))}function o(){const t=this.logarithmic;t&&(this.lin2val=function(e){return t.lin2log(e)},this.val2lin=function(e){return t.log2lin(e)})}const a=[];s.compose=function(i){return t.pushUnique(a,i)&&(i.keepProps.push("logarithmic"),e(i,"init",r),e(i,"afterInit",o)),i};class l{constructor(t){this.axis=t}getLogTickPositions(t,e,s,r){const o=this.axis;var a=o.len,l=o.options;let h=[];if(r||(this.minorAutoInterval=void 0),.5<=t)t=Math.round(t),h=o.getLinearTickPositions(t,e,s);else if(.08<=t){let i,n,o,c,d;for(l=Math.floor(e),a=.3<t?[1,2,4]:.15<t?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];l<s+1&&!d;l++)for(n=a.length,i=0;i<n&&!d;i++)o=this.log2lin(this.lin2log(l)*a[i]),o>e&&(!r||c<=s)&&void 0!==c&&h.push(c),c>s&&(d=!0),c=o}else e=this.lin2log(e),s=this.lin2log(s),t=r?o.getMinorTickInterval():l.tickInterval,t=n("auto"===t?null:t,this.minorAutoInterval,l.tickPixelInterval/(r?5:1)*(s-e)/((r?a/o.tickPositions.length:a)||1)),t=i(t),h=o.getLinearTickPositions(t,e,s).map(this.log2lin),r||(this.minorAutoInterval=t/5);return r||(o.tickInterval=t),h}lin2log(t){return Math.pow(10,t)}log2lin(t){return Math.log(t)/Math.LN10}}s.Additions=l}(s||(s={})),s})),e(i,"Core/Axis/PlotLineOrBand/PlotLineOrBandAxis.js",[i["Core/Utilities.js"]],(function(t){const{erase:e,extend:i,isNumber:n}=t;var s;return function(s){function r(t){return this.addPlotBandOrLine(t,"plotBands")}function o(t,e){const i=this.userOptions;let n=new p(this,t);if(this.visible&&(n=n.render()),n){if(this._addedPlotLB||(this._addedPlotLB=!0,(i.plotLines||[]).concat(i.plotBands||[]).forEach((t=>{this.addPlotBandOrLine(t)}))),e){const n=i[e]||[];n.push(t),i[e]=n}this.plotLinesAndBands.push(n)}return n}function a(t){return this.addPlotBandOrLine(t,"plotLines")}function l(t,e,i=this.options){const s=this.getPlotLinePath({value:e,force:!0,acrossPanes:i.acrossPanes}),r=[],o=this.horiz;let a;if(e=!n(this.min)||!n(this.max)||t<this.min&&e<this.min||t>this.max&&e>this.max,t=this.getPlotLinePath({value:t,force:!0,acrossPanes:i.acrossPanes}),i=1,t&&s)for(e&&(a=t.toString()===s.toString(),i=0),e=0;e<t.length;e+=2){const n=t[e],l=t[e+1],h=s[e],c=s[e+1];"M"!==n[0]&&"L"!==n[0]||"M"!==l[0]&&"L"!==l[0]||"M"!==h[0]&&"L"!==h[0]||"M"!==c[0]&&"L"!==c[0]||(o&&h[1]===n[1]?(h[1]+=i,c[1]+=i):o||h[2]!==n[2]||(h[2]+=i,c[2]+=i),r.push(["M",n[1],n[2]],["L",l[1],l[2]],["L",c[1],c[2]],["L",h[1],h[2]],["Z"])),r.isFlat=a}return r}function h(t){this.removePlotBandOrLine(t)}function c(t){const i=this.plotLinesAndBands,n=this.options,s=this.userOptions;if(i){let r=i.length;for(;r--;)i[r].id===t&&i[r].destroy();[n.plotLines||[],s.plotLines||[],n.plotBands||[],s.plotBands||[]].forEach((function(i){for(r=i.length;r--;)(i[r]||{}).id===t&&e(i,i[r])}))}}function d(t){this.removePlotBandOrLine(t)}const u=[];let p;s.compose=function(e,n){return p||(p=e),t.pushUnique(u,n)&&i(n.prototype,{addPlotBand:r,addPlotLine:a,addPlotBandOrLine:o,getPlotBandPath:l,removePlotBand:h,removePlotLine:d,removePlotBandOrLine:c}),n}}(s||(s={})),s})),e(i,"Core/Axis/PlotLineOrBand/PlotLineOrBand.js",[i["Core/Axis/PlotLineOrBand/PlotLineOrBandAxis.js"],i["Core/Utilities.js"]],(function(t,e){const{arrayMax:i,arrayMin:n,defined:s,destroyObjectProperties:r,erase:o,fireEvent:a,merge:l,objectEach:h,pick:c}=e;class d{static compose(e){return t.compose(d,e)}constructor(t,e){this.axis=t,e&&(this.options=e,this.id=e.id)}render(){a(this,"render");const t=this,e=t.axis,i=e.horiz;var n=e.logarithmic;const r=t.options,o=r.color,d=c(r.zIndex,0),u=r.events,p={},f=e.chart.renderer;let m=r.label,g=t.label,v=r.to,_=r.from,x=r.value,y=t.svgElem;var b=[];const M=s(_)&&s(v);b=s(x);const S=!y,w={class:"highcharts-plot-"+(M?"band ":"line ")+(r.className||"")};let T=M?"bands":"lines";if(n&&(_=n.log2lin(_),v=n.log2lin(v),x=n.log2lin(x)),e.chart.styledMode||(b?(w.stroke=o||"#999999",w["stroke-width"]=c(r.width,1),r.dashStyle&&(w.dashstyle=r.dashStyle)):M&&(w.fill=o||"#e6e9ff",r.borderWidth&&(w.stroke=r.borderColor,w["stroke-width"]=r.borderWidth))),p.zIndex=d,T+="-"+d,(n=e.plotLinesAndBandsGroups[T])||(e.plotLinesAndBandsGroups[T]=n=f.g("plot-"+T).attr(p).add()),S&&(t.svgElem=y=f.path().attr(w).add(n)),b)b=e.getPlotLinePath({value:x,lineWidth:y.strokeWidth(),acrossPanes:r.acrossPanes});else{if(!M)return;b=e.getPlotBandPath(_,v,r)}return!t.eventsAdded&&u&&(h(u,(function(e,i){y.on(i,(function(e){u[i].apply(t,[e])}))})),t.eventsAdded=!0),(S||!y.d)&&b&&b.length?y.attr({d:b}):y&&(b?(y.show(),y.animate({d:b})):y.d&&(y.hide(),g&&(t.label=g=g.destroy()))),m&&(s(m.text)||s(m.formatter))&&b&&b.length&&0<e.width&&0<e.height&&!b.isFlat?(m=l({align:i&&M&&"center",x:i?!M&&4:10,verticalAlign:!i&&M&&"middle",y:i?M?16:10:M?6:-4,rotation:i&&!M&&90},m),this.renderLabel(m,b,M,d)):g&&g.hide(),t}renderLabel(t,e,s,r){const o=this.axis;var a=o.chart.renderer;let h=this.label;h||(this.label=h=a.text(this.getLabelText(t),0,0,t.useHTML).attr({align:t.textAlign||t.align,rotation:t.rotation,class:"highcharts-plot-"+(s?"band":"line")+"-label "+(t.className||""),zIndex:r}).add(),o.chart.styledMode||h.css(l({fontSize:"0.8em",textOverflow:"ellipsis"},t.style))),r=e.xBounds||[e[0][1],e[1][1],s?e[2][1]:e[0][1]],e=e.yBounds||[e[0][2],e[1][2],s?e[2][2]:e[0][2]],s=n(r),a=n(e),h.align(t,!1,{x:s,y:a,width:i(r)-s,height:i(e)-a}),h.alignValue&&"left"!==h.alignValue||(t=t.clip?o.width:o.chart.chartWidth,h.css({width:(90===h.rotation?o.height-(h.alignAttr.y-o.top):t-(h.alignAttr.x-o.left))+"px"})),h.show(!0)}getLabelText(t){return s(t.formatter)?t.formatter.call(this):t.text}destroy(){o(this.axis.plotLinesAndBands,this),delete this.axis,r(this)}}return d})),e(i,"Core/Tooltip.js",[i["Core/Templating.js"],i["Core/Globals.js"],i["Core/Renderer/RendererUtilities.js"],i["Core/Renderer/RendererRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s){const{format:r}=t,{doc:o,isSafari:a}=e,{distribute:l}=i,{addEvent:h,clamp:c,css:d,discardElement:u,extend:p,fireEvent:f,isArray:m,isNumber:g,isString:v,merge:_,pick:x,splat:y,syncTimeout:b}=s;class M{constructor(t,e){this.allowShared=!0,this.container=void 0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.now={},this.options={},this.outside=!1,this.chart=t,this.init(t,e)}bodyFormatter(t){return t.map((function(t){const e=t.series.tooltipOptions;return(e[(t.point.formatPrefix||"point")+"Formatter"]||t.point.tooltipFormatter).call(t.point,e[(t.point.formatPrefix||"point")+"Format"]||"")}))}cleanSplit(t){this.chart.series.forEach((function(e){const i=e&&e.tt;i&&(!i.isActive||t?e.tt=i.destroy():i.isActive=!1)}))}defaultFormatter(t){const e=this.points||y(this);let i;return i=[t.tooltipFooterHeaderFormatter(e[0])],i=i.concat(t.bodyFormatter(e)),i.push(t.tooltipFooterHeaderFormatter(e[0],!0)),i}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),u(this.container)),s.clearTimeout(this.hideTimer),s.clearTimeout(this.tooltipTimeout)}getAnchor(t,e){var i=this.chart;const n=i.pointer,s=i.inverted,r=i.plotTop;if(i=i.plotLeft,(t=y(t))[0].series&&t[0].series.yAxis&&!t[0].series.yAxis.options.reversedStacks&&(t=t.slice().reverse()),this.followPointer&&e)void 0===e.chartX&&(e=n.normalize(e)),t=[e.chartX-i,e.chartY-r];else if(t[0].tooltipPos)t=t[0].tooltipPos;else{let n=0,o=0;t.forEach((function(t){(t=t.pos(!0))&&(n+=t[0],o+=t[1])})),n/=t.length,o/=t.length,this.shared&&1<t.length&&e&&(s?n=e.chartX:o=e.chartY),t=[n-i,o-r]}return t.map(Math.round)}getClassName(t,e,i){const n=t.series,s=n.options;return[this.options.className,"highcharts-label",i&&"highcharts-tooltip-header",e?"highcharts-tooltip-box":"highcharts-tooltip",!i&&"highcharts-color-"+x(t.colorIndex,n.colorIndex),s&&s.className].filter(v).join(" ")}getLabel(){const t=this,i=this.chart.styledMode,s=this.options,r=this.split&&this.allowShared,o=s.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none");let a,l=this.chart.renderer;if(this.label){var h=!this.label.hasClass("highcharts-label");(!r&&h||r&&!h)&&this.destroy()}if(!this.label){if(this.outside){h=this.chart.options.chart.style;const t=n.getRendererType();this.container=a=e.doc.createElement("div"),a.className="highcharts-tooltip-container",d(a,{position:"absolute",top:"1px",pointerEvents:o,zIndex:Math.max(this.options.style.zIndex||0,(h&&h.zIndex||0)+3)}),e.doc.body.appendChild(a),this.renderer=l=new t(a,0,0,h,void 0,void 0,l.styledMode)}if(r?this.label=l.g("tooltip"):(this.label=l.label("",0,0,s.shape,void 0,void 0,s.useHTML,void 0,"tooltip").attr({padding:s.padding,r:s.borderRadius}),i||this.label.attr({fill:s.backgroundColor,"stroke-width":s.borderWidth||0}).css(s.style).css({pointerEvents:o})),t.outside){const e=this.label,{xSetter:i,ySetter:n}=e;e.xSetter=function(n){i.call(e,t.distance),a.style.left=n+"px"},e.ySetter=function(i){n.call(e,t.distance),a.style.top=i+"px"}}this.label.attr({zIndex:8}).shadow(s.shadow).add()}return this.label}getPlayingField(){const{body:t,documentElement:e}=o,{chart:i,distance:n,outside:s}=this;return{width:s?Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,e.clientWidth)-2*n:i.chartWidth,height:s?Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,e.clientHeight):i.chartHeight}}getPosition(t,e,i){const n=this.chart,s=this.distance,r={},o=n.inverted&&i.h||0,a=this.outside;var l=this.getPlayingField();const h=l.width,c=l.height,d=n.pointer.getChartPosition();l=r=>{const o="x"===r;return[r,o?h:c,o?t:e].concat(a?[o?t*d.scaleX:e*d.scaleY,o?d.left-s+(i.plotX+n.plotLeft)*d.scaleX:d.top-s+(i.plotY+n.plotTop)*d.scaleY,0,o?h:c]:[o?t:e,o?i.plotX+n.plotLeft:i.plotY+n.plotTop,o?n.plotLeft:n.plotTop,o?n.plotLeft+n.plotWidth:n.plotTop+n.plotHeight])};let u,p=l("y"),f=l("x");l=!!i.negative,!n.polar&&n.hoverSeries&&n.hoverSeries.yAxis&&n.hoverSeries.yAxis.reversed&&(l=!l);const m=!this.followPointer&&x(i.ttBelow,!n.inverted===l),g=function(t,e,i,n,l,h,c){const u=a?"y"===t?s*d.scaleY:s*d.scaleX:s,p=(i-n)/2,f=n<l-s,g=l+s+n<e,v=l-u-i+p;if(l=l+u-p,m&&g)r[t]=l;else if(!m&&f)r[t]=v;else if(f)r[t]=Math.min(c-n,0>v-o?v:v-o);else{if(!g)return!1;r[t]=Math.max(h,l+o+i>e?l:l+o)}},v=function(t,e,i,n,o){let a;return o<s||o>e-s?a=!1:r[t]=o<i/2?1:o>e-n/2?e-n-2:o-i/2,a},_=function(t){const e=p;p=f,f=e,u=t},y=function(){!1!==g.apply(0,p)?!1!==v.apply(0,f)||u||(_(!0),y()):u?r.x=r.y=0:(_(!0),y())};return(n.inverted||1<this.len)&&_(),y(),r}hide(t){const e=this;s.clearTimeout(this.hideTimer),t=x(t,this.options.hideDelay),this.isHidden||(this.hideTimer=b((function(){e.getLabel().fadeOut(t?void 0:t),e.isHidden=!0}),t))}init(t,e){this.chart=t,this.options=e,this.crosshairs=[],this.now={x:0,y:0},this.isHidden=!0,this.split=e.split&&!t.inverted&&!t.polar,this.shared=e.shared||this.split,this.outside=x(e.outside,!(!t.scrollablePixelsX&&!t.scrollablePixelsY))}shouldStickOnContact(t){return!(this.followPointer||!this.options.stickOnContact||t&&!this.chart.pointer.inClass(t.target,"highcharts-tooltip"))}move(t,e,i,n){const r=this,o=r.now,a=!1!==r.options.animation&&!r.isHidden&&(1<Math.abs(t-o.x)||1<Math.abs(e-o.y)),l=r.followPointer||1<r.len;p(o,{x:a?(2*o.x+t)/3:t,y:a?(o.y+e)/2:e,anchorX:l?void 0:a?(2*o.anchorX+i)/3:i,anchorY:l?void 0:a?(o.anchorY+n)/2:n}),r.getLabel().attr(o),r.drawTracker(),a&&(s.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout((function(){r&&r.move(t,e,i,n)}),32))}refresh(t,e){const i=this.chart,n=this.options,o=i.pointer,a=y(t),l=a[0],h=[];var c=n.format,d=n.formatter||this.defaultFormatter;const u=this.shared,p=i.styledMode;let g={};if(n.enabled&&l.series){s.clearTimeout(this.hideTimer),this.allowShared=!(!m(t)&&t.series&&t.series.noSharedTooltip),this.followPointer=!this.split&&l.series.tooltipOptions.followPointer;var _=(t=this.getAnchor(t,e))[0],b=t[1];if(u&&this.allowShared?(o.applyInactiveState(a),a.forEach((function(t){t.setState("hover"),h.push(t.getLabelConfig())})),g=l.getLabelConfig(),g.points=h):g=l.getLabelConfig(),this.len=h.length,c=v(c)?r(c,g,i):d.call(g,this),d=l.series,this.distance=x(d.tooltipOptions.distance,16),!1===c)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(c,a);else{let s=_,r=b;if(e&&o.isDirectTouch&&(s=e.chartX-i.plotLeft,r=e.chartY-i.plotTop),!i.polar&&!1!==d.options.clip&&!a.some((t=>o.isDirectTouch||t.series.shouldShowTooltip(s,r))))return void this.hide();e=this.getLabel(),n.style.width&&!p||e.css({width:(this.outside?this.getPlayingField():i.spacingBox).width+"px"}),e.attr({text:c&&c.join?c.join(""):c}),e.addClass(this.getClassName(l),!0),p||e.attr({stroke:n.borderColor||l.color||d.color||"#666666"}),this.updatePosition({plotX:_,plotY:b,negative:l.negative,ttBelow:l.ttBelow,h:t[2]||0})}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}f(this,"refresh")}}renderSplit(t,e){function i(t,e,i,s,r=!0){return i?(e=P?0:k,t=c(t-s/2,E.left,E.right-s-(n.outside?L:0))):(e-=D,t=c(t=r?t-s-S:t+S,r?t:E.left,E.right)),{x:t,y:e}}const n=this,{chart:s,chart:{chartWidth:r,chartHeight:h,plotHeight:d,plotLeft:u,plotTop:f,pointer:m,scrollablePixelsY:g=0,scrollablePixelsX:_,scrollingContainer:{scrollLeft:y,scrollTop:b}={scrollLeft:0,scrollTop:0},styledMode:M},distance:S,options:w,options:{positioner:T}}=n,E=n.outside&&"number"!=typeof _?o.documentElement.getBoundingClientRect():{left:y,right:y+r,top:b,bottom:b+h},A=n.getLabel(),C=this.renderer||s.renderer,P=!(!s.xAxis[0]||!s.xAxis[0].opposite),{left:L,top:R}=m.getChartPosition();let D=f+b,I=0,k=d-g;v(t)&&(t=[!1,t]),t=t.slice(0,e.length+1).reduce((function(t,s,r){if(!1!==s&&""!==s){const m=(r=e[r-1]||{isHeader:!0,plotX:e[0].plotX,plotY:d,series:{}}).isHeader;var o,a=m?n:r.series;{var l=r;s=s.toString();var h=a.tt;const{isHeader:t,series:e}=l;h||(h={padding:w.padding,r:w.borderRadius},M||(h.fill=w.backgroundColor,h["stroke-width"]=null!==(o=w.borderWidth)&&void 0!==o?o:1),h=C.label("",0,0,w[t?"headerShape":"shape"],void 0,void 0,w.useHTML).addClass(n.getClassName(l,!0,t)).attr(h).add(A)),h.isActive=!0,h.attr({text:s}),M||h.css(w.style).attr({stroke:w.borderColor||l.color||e.color||"#333333"}),o=h}o=a.tt=o,a=(l=o.getBBox()).width+o.strokeWidth(),m&&(I=l.height,k+=I,P&&(D-=I));{const{isHeader:t,plotX:e=0,plotY:i=0,series:n}=r;if(t){s=u+e;var p=f+d/2}else{const{xAxis:t,yAxis:r}=n;s=t.pos+c(e,-S,t.len+S),n.shouldShowTooltip(0,r.pos-f+i,{ignoreX:!0})&&(p=r.pos+i)}p={anchorX:s=c(s,E.left-S,E.right+S),anchorY:p}}const{anchorX:g,anchorY:v}=p;"number"==typeof v?(p=l.height+1,l=T?T.call(n,a,p,r):i(g,v,m,a),t.push({align:T?0:void 0,anchorX:g,anchorY:v,boxWidth:a,point:r,rank:x(l.rank,m?1:0),size:p,target:l.y,tt:o,x:l.x})):o.isActive=!1}return t}),[]),!T&&t.some((t=>{var{outside:e}=n;return(e=(e?L:0)+t.anchorX)<E.left&&e+t.boxWidth<E.right||e<L-E.left+t.boxWidth&&E.right-e>e}))&&(t=t.map((t=>{const{x:e,y:n}=i(t.anchorX,t.anchorY,t.point.isHeader,t.boxWidth,!1);return p(t,{target:n,x:e})}))),n.cleanSplit(),l(t,k);var O=L,N=L;t.forEach((function(t){const{x:e,boxWidth:i,isHeader:s}=t;s||(n.outside&&L+e<O&&(O=L+e),!s&&n.outside&&O+i>N&&(N=L+e))})),t.forEach((function(t){const{x:e,anchorX:i,anchorY:s,pos:r,point:{isHeader:o}}=t,a={visibility:void 0===r?"hidden":"inherit",x:e,y:(r||0)+D,anchorX:i,anchorY:s};if(n.outside&&e<i){const t=L-O;0<t&&(o||(a.x=e+t,a.anchorX=i+t),o&&(a.x=(N-O)/2,a.anchorX=i+t))}t.tt.attr(a)}));const{container:U,outside:B,renderer:F}=n;if(B&&U&&F){const{width:t,height:e,x:i,y:n}=A.getBBox();F.setSize(t+i,e+n,!1),U.style.left=O+"px",U.style.top=R+"px"}a&&A.attr({opacity:1===A.opacity?.999:1})}drawTracker(){if(this.shouldStickOnContact()){var t=this.chart,e=this.label,i=this.shared?t.hoverPoints:t.hoverPoint;if(e&&i){var n={x:0,y:0,width:0,height:0};i=this.getAnchor(i);var s=e.getBBox();i[0]+=t.plotLeft-e.translateX,i[1]+=t.plotTop-e.translateY,n.x=Math.min(0,i[0]),n.y=Math.min(0,i[1]),n.width=0>i[0]?Math.max(Math.abs(i[0]),s.width-i[0]):Math.max(Math.abs(i[0]),s.width),n.height=0>i[1]?Math.max(Math.abs(i[1]),s.height-Math.abs(i[1])):Math.max(Math.abs(i[1]),s.height),this.tracker?this.tracker.attr(n):(this.tracker=e.renderer.rect(n).addClass("highcharts-tracker").add(e),t.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}}else this.tracker&&(this.tracker=this.tracker.destroy())}styledModeFormat(t){return t.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}tooltipFooterHeaderFormatter(t,e){const i=t.series,n=i.tooltipOptions;var s=i.xAxis;const o=s&&s.dateTime;s={isFooter:e,labelConfig:t};let a=n.xDateFormat,l=n[e?"footerFormat":"headerFormat"];return f(this,"headerFormatter",s,(function(e){o&&!a&&g(t.key)&&(a=o.getXDateFormat(t.key,n.dateTimeLabelFormats)),o&&a&&(t.point&&t.point.tooltipDateKeys||["key"]).forEach((function(t){l=l.replace("{point."+t+"}","{point."+t+":"+a+"}")})),i.chart.styledMode&&(l=this.styledModeFormat(l)),e.text=r(l,{point:t,series:i},this.chart)})),s.text}update(t){this.destroy(),this.init(this.chart,_(!0,this.options,t))}updatePosition(t){const{chart:e,distance:i,options:n}=this;var s=e.pointer;const r=this.getLabel(),{left:o,top:a,scaleX:l,scaleY:h}=s.getChartPosition();s=(n.positioner||this.getPosition).call(this,r.width,r.height,t);let c,u=(t.plotX||0)+e.plotLeft;t=(t.plotY||0)+e.plotTop,this.outside&&(n.positioner&&(s.x+=o-i,s.y+=a-i),c=(n.borderWidth||0)+2*i,this.renderer.setSize(r.width+c,r.height+c,!1),1===l&&1===h||(d(this.container,{transform:`scale(${l}, ${h})`}),u*=l,t*=h),u+=o-s.x,t+=a-s.y),this.move(Math.round(s.x),Math.round(s.y||0),u,t)}}return function(t){const e=[];t.compose=function(i){s.pushUnique(e,i)&&h(i,"afterInit",(function(){const e=this.chart;e.options.tooltip&&(e.tooltip=new t(e,e.options.tooltip))}))}}(M||(M={})),M})),e(i,"Core/Series/Point.js",[i["Core/Renderer/HTML/AST.js"],i["Core/Animation/AnimationUtilities.js"],i["Core/Defaults.js"],i["Core/Templating.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s){const{animObject:r}=e,{defaultOptions:o}=i,{format:a}=n,{addEvent:l,defined:h,erase:c,extend:d,fireEvent:u,getNestedProperty:p,isArray:f,isFunction:m,isNumber:g,isObject:v,merge:_,objectEach:x,pick:y,syncTimeout:b,removeEvent:M,uniqueKey:S}=s;class w{constructor(){this.category=void 0,this.destroyed=!1,this.formatPrefix="point",this.id=void 0,this.isNull=!1,this.percentage=this.options=this.name=void 0,this.selected=!1,this.total=this.shapeArgs=this.series=void 0,this.visible=!0,this.x=void 0}animateBeforeDestroy(){const t=this,e={x:t.startXPos,opacity:0},i=t.getGraphicalProps();i.singular.forEach((function(i){t[i]=t[i].animate("dataLabel"===i?{x:t[i].startXPos,y:t[i].startYPos,opacity:0}:e)})),i.plural.forEach((function(e){t[e].forEach((function(e){e.element&&e.animate(d({x:t.startXPos},e.startYPos?{x:e.startXPos,y:e.startYPos}:{}))}))}))}applyOptions(t,e){const i=this.series,n=i.options.pointValKey||i.pointValKey;return t=w.prototype.optionsToObject.call(this,t),d(this,t),this.options=this.options?d(this.options,t):t,t.group&&delete this.group,t.dataLabels&&delete this.dataLabels,n&&(this.y=w.prototype.getNestedProperty.call(this,n)),this.formatPrefix=(this.isNull=this.isValid&&!this.isValid())?"null":"point",this.selected&&(this.state="select"),"name"in this&&void 0===e&&i.xAxis&&i.xAxis.hasNames&&(this.x=i.xAxis.nameToX(this)),void 0===this.x&&i?this.x=void 0===e?i.autoIncrement():e:g(t.x)&&i.options.relativeXValue&&(this.x=i.autoIncrement(t.x)),this}destroy(){if(!this.destroyed){const e=this;var t=e.series;const i=t.chart;t=t.options.dataSorting;const n=i.hoverPoints,s=r(e.series.chart.renderer.globalAnimation),o=()=>{(e.graphic||e.graphics||e.dataLabel||e.dataLabels)&&(M(e),e.destroyElements());for(const t in e)delete e[t]};e.legendItem&&i.legend.destroyItem(e),n&&(e.setState(),c(n,e),n.length||(i.hoverPoints=null)),e===i.hoverPoint&&e.onMouseOut(),t&&t.enabled?(this.animateBeforeDestroy(),b(o,s.duration)):o(),i.pointCount--}this.destroyed=!0}destroyElements(t){const e=this;(t=e.getGraphicalProps(t)).singular.forEach((function(t){e[t]=e[t].destroy()})),t.plural.forEach((function(t){e[t].forEach((function(t){t&&t.element&&t.destroy()})),delete e[t]}))}firePointEvent(t,e,i){const n=this,s=this.series.options;(s.point.events[t]||n.options&&n.options.events&&n.options.events[t])&&n.importEvents(),"click"===t&&s.allowPointSelect&&(i=function(t){n.select&&n.select(null,t.ctrlKey||t.metaKey||t.shiftKey)}),u(n,t,e,i)}getClassName(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(void 0!==this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(t){const e=this,i=[],n={singular:[],plural:[]};let s,r;for((t=t||{graphic:1,dataLabel:1}).graphic&&i.push("graphic"),t.dataLabel&&i.push("dataLabel","dataLabelPath","dataLabelUpper","connector"),r=i.length;r--;)s=i[r],e[s]&&n.singular.push(s);return["graphic","dataLabel","connector"].forEach((function(i){const s=i+"s";t[i]&&e[s]&&n.plural.push(s)})),n}getLabelConfig(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}}getNestedProperty(t){if(t)return 0===t.indexOf("custom.")?p(t,this.options):this[t]}getZone(){var t=this.series;const e=t.zones;t=t.zoneAxis||"y";let i,n=0;for(i=e[n];this[t]>=i.value;)i=e[++n];return this.nonZonedColor||(this.nonZonedColor=this.color),this.color=i&&i.color&&!this.options.color?i.color:this.nonZonedColor,i}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}init(t,e,i){return this.series=t,this.applyOptions(e,i),this.id=h(this.id)?this.id:S(),this.resolveColor(),t.chart.pointCount++,u(this,"afterInit"),this}isValid(){return null!==this.x&&g(this.y)}optionsToObject(t){var e=this.series;const i=e.options.keys,n=i||e.pointArrayMap||["y"],s=n.length;let r={},o=0,a=0;if(g(t)||null===t)r[n[0]]=t;else if(f(t))for(!i&&t.length>s&&("string"==(e=typeof t[0])?r.name=t[0]:"number"===e&&(r.x=t[0]),o++);a<s;)i&&void 0===t[o]||(0<n[a].indexOf(".")?w.prototype.setNestedProperty(r,t[o],n[a]):r[n[a]]=t[o]),o++,a++;else"object"==typeof t&&(r=t,t.dataLabels&&(e._hasPointLabels=!0),t.marker&&(e._hasPointMarkers=!0));return r}pos(t,e=this.plotY){if(!this.destroyed){const{plotX:i,series:n}=this,{chart:s,xAxis:r,yAxis:o}=n;let a=0,l=0;if(g(i)&&g(e))return t&&(a=r?r.pos:s.plotLeft,l=o?o.pos:s.plotTop),s.inverted&&r&&o?[o.len-e+l,r.len-i+a]:[i+a,e+l]}}resolveColor(){const t=this.series;var e=t.chart.styledMode;let i;var n=t.chart.options.chart.colorCount;delete this.nonZonedColor,t.options.colorByPoint?(e||(i=(n=t.options.colors||t.chart.options.colors)[t.colorCounter],n=n.length),e=t.colorCounter,t.colorCounter++,t.colorCounter===n&&(t.colorCounter=0)):(e||(i=t.color),e=t.colorIndex),this.colorIndex=y(this.options.colorIndex,e),this.color=y(this.options.color,i)}setNestedProperty(t,e,i){return i.split(".").reduce((function(t,i,n,s){return t[i]=s.length-1===n?e:v(t[i],!0)?t[i]:{},t[i]}),t),t}shouldDraw(){return!this.isNull}tooltipFormatter(t){const e=this.series,i=e.tooltipOptions,n=y(i.valueDecimals,""),s=i.valuePrefix||"",r=i.valueSuffix||"";return e.chart.styledMode&&(t=e.chart.tooltip.styledModeFormat(t)),(e.pointArrayMap||["y"]).forEach((function(e){e="{point."+e,(s||r)&&(t=t.replace(RegExp(e+"}","g"),s+e+"}"+r)),t=t.replace(RegExp(e+"}","g"),e+":,."+n+"f}")})),a(t,{point:this,series:this.series},e.chart)}update(t,e,i,n){function s(){r.applyOptions(t);var n=a&&r.hasMockGraphic;n=null===r.y?!n:n,a&&n&&(r.graphic=a.destroy(),delete r.hasMockGraphic),v(t,!0)&&(a&&a.element&&t&&t.marker&&void 0!==t.marker.symbol&&(r.graphic=a.destroy()),t&&t.dataLabels&&r.dataLabel&&(r.dataLabel=r.dataLabel.destroy()),r.connector&&(r.connector=r.connector.destroy())),c=r.index,o.updateParallelArrays(r,c),h.data[c]=v(h.data[c],!0)||v(t,!0)?r.options:y(t,h.data[c]),o.isDirty=o.isDirtyData=!0,!o.fixedBox&&o.hasCartesianSeries&&(l.isDirtyBox=!0),"point"===h.legendType&&(l.isDirtyLegend=!0),e&&l.redraw(i)}const r=this,o=r.series,a=r.graphic,l=o.chart,h=o.options;let c;e=y(e,!0),!1===n?s():r.firePointEvent("update",{options:t},s)}remove(t,e){this.series.removePoint(this.series.data.indexOf(this),t,e)}select(t,e){const i=this,n=i.series,s=n.chart;this.selectedStaging=t=y(t,!i.selected),i.firePointEvent(t?"select":"unselect",{accumulate:e},(function(){i.selected=i.options.selected=t,n.options.data[n.data.indexOf(i)]=i.options,i.setState(t&&"select"),e||s.getSelectedPoints().forEach((function(t){const e=t.series;t.selected&&t!==i&&(t.selected=t.options.selected=!1,e.options.data[e.data.indexOf(t)]=t.options,t.setState(s.hoverPoints&&e.options.inactiveOtherPoints?"inactive":""),t.firePointEvent("unselect"))}))})),delete this.selectedStaging}onMouseOver(t){const e=this.series.chart,i=e.pointer;t=t?i.normalize(t):i.getChartCoordinatesFromPoint(this,e.inverted),i.runPointActions(t,this)}onMouseOut(){const t=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(t.hoverPoints||[]).forEach((function(t){t.setState()})),t.hoverPoints=t.hoverPoint=null}importEvents(){if(!this.hasImportedEvents){const t=this,e=_(t.series.options.point,t.options).events;t.events=e,x(e,(function(e,i){m(e)&&l(t,i,e)})),this.hasImportedEvents=!0}}setState(e,i){const n=this.series;var s=this.state,r=n.options.states[e||"normal"]||{},a=o.plotOptions[n.type].marker&&n.options.marker;const l=a&&!1===a.enabled,h=a&&a.states&&a.states[e||"normal"]||{},c=!1===h.enabled,p=this.marker||{},f=n.chart,m=a&&n.markerAttribs;let v=n.halo;var _;let x;var b=n.stateMarkerGraphic;if(!((e=e||"")===this.state&&!i||this.selected&&"select"!==e||!1===r.enabled||e&&(c||l&&!1===h.enabled)||e&&p.states&&p.states[e]&&!1===p.states[e].enabled)){if(this.state=e,m&&(_=n.markerAttribs(this,e)),this.graphic&&!this.hasMockGraphic){if(s&&this.graphic.removeClass("highcharts-point-"+s),e&&this.graphic.addClass("highcharts-point-"+e),!f.styledMode){s=n.pointAttribs(this,e),x=y(f.options.chart.animation,r.animation);const t=s.opacity;n.options.inactiveOtherPoints&&g(t)&&((this.dataLabels||[]).forEach((function(e){e&&!e.hasClass("highcharts-data-label-hidden")&&e.animate({opacity:t},x)})),this.connector&&this.connector.animate({opacity:t},x)),this.graphic.animate(s,x)}_&&this.graphic.animate(_,y(f.options.chart.animation,h.animation,a.animation)),b&&b.hide()}else e&&h&&(a=p.symbol||n.symbol,b&&b.currentSymbol!==a&&(b=b.destroy()),_&&(b?b[i?"animate":"attr"]({x:_.x,y:_.y}):a&&(n.stateMarkerGraphic=b=f.renderer.symbol(a,_.x,_.y,_.width,_.height).add(n.markerGroup),b.currentSymbol=a)),!f.styledMode&&b&&"inactive"!==this.state&&b.attr(n.pointAttribs(this,e))),b&&(b[e&&this.isInside?"show":"hide"](),b.element.point=this,b.addClass(this.getClassName(),!0));r=r.halo,_=(b=this.graphic||b)&&b.visibility||"inherit",r&&r.size&&b&&"hidden"!==_&&!this.isCluster?(v||(n.halo=v=f.renderer.path().add(b.parentGroup)),v.show()[i?"animate":"attr"]({d:this.haloPath(r.size)}),v.attr({class:"highcharts-halo highcharts-color-"+y(this.colorIndex,n.colorIndex)+(this.className?" "+this.className:""),visibility:_,zIndex:-1}),v.point=this,f.styledMode||v.attr(d({fill:this.color||n.color,"fill-opacity":r.opacity},t.filterUserAttributes(r.attributes||{})))):v&&v.point&&v.point.haloPath&&v.animate({d:v.point.haloPath(0)},null,v.hide),u(this,"afterSetState",{state:e})}}haloPath(t){const e=this.pos();return e?this.series.chart.renderer.symbols.circle(Math.floor(e[0])-t,e[1]-t,2*t,2*t):[]}}return w})),e(i,"Core/Pointer.js",[i["Core/Color/Color.js"],i["Core/Globals.js"],i["Core/Utilities.js"]],(function(t,e,i){const{parse:n}=t,{charts:s,noop:r}=e,{addEvent:o,attr:a,css:l,defined:h,extend:c,find:d,fireEvent:u,isNumber:p,isObject:f,objectEach:m,offset:g,pick:v,splat:_}=i;class x{constructor(t,e){this.lastValidTouch={},this.pinchDown=[],this.runChartClick=!1,this.eventsToUnbind=[],this.chart=t,this.hasDragged=!1,this.options=e,this.init(t,e)}applyInactiveState(t){let e,i=[];(t||[]).forEach((function(t){e=t.series,i.push(e),e.linkedParent&&i.push(e.linkedParent),e.linkedSeries&&(i=i.concat(e.linkedSeries)),e.navigatorSeries&&i.push(e.navigatorSeries)})),this.chart.series.forEach((function(t){-1===i.indexOf(t)?t.setState("inactive",!0):t.options.inactiveOtherPoints&&t.setAllPointsToState("inactive")}))}destroy(){const t=this;this.eventsToUnbind.forEach((t=>t())),this.eventsToUnbind=[],e.chartCount||(x.unbindDocumentMouseUp&&(x.unbindDocumentMouseUp=x.unbindDocumentMouseUp()),x.unbindDocumentTouchEnd&&(x.unbindDocumentTouchEnd=x.unbindDocumentTouchEnd())),clearInterval(t.tooltipTimeout),m(t,(function(e,i){t[i]=void 0}))}getSelectionMarkerAttrs(t,e){const i={args:{chartX:t,chartY:e},attrs:{},shapeType:"rect"};return u(this,"getSelectionMarkerAttrs",i,(i=>{const{chart:n,mouseDownX:s=0,mouseDownY:r=0,zoomHor:o,zoomVert:a}=this;let l;(i=i.attrs).x=n.plotLeft,i.y=n.plotTop,i.width=o?1:n.plotWidth,i.height=a?1:n.plotHeight,o&&(l=t-s,i.width=Math.abs(l),i.x=(0<l?0:l)+s),a&&(l=e-r,i.height=Math.abs(l),i.y=(0<l?0:l)+r)})),i}drag(t){const e=this.chart,i=e.options.chart;var s=e.plotLeft;const r=e.plotTop,o=e.plotWidth,a=e.plotHeight,l=this.mouseDownX||0,h=this.mouseDownY||0,c=f(i.panning)?i.panning&&i.panning.enabled:i.panning,d=i.panKey&&t[i.panKey+"Key"];let u=t.chartX,p=t.chartY,m=this.selectionMarker;if((!m||!m.touch)&&(u<s?u=s:u>s+o&&(u=s+o),p<r?p=r:p>r+a&&(p=r+a),this.hasDragged=Math.sqrt(Math.pow(l-u,2)+Math.pow(h-p,2)),10<this.hasDragged)){s=e.isInsidePlot(l-s,h-r,{visiblePlotOnly:!0});const{shapeType:o,attrs:a}=this.getSelectionMarkerAttrs(u,p);!e.hasCartesianSeries&&!e.mapView||!this.zoomX&&!this.zoomY||!s||d||m||(this.selectionMarker=m=e.renderer[o](),m.attr({class:"highcharts-selection-marker",zIndex:7}).add(),e.styledMode||m.attr({fill:i.selectionMarkerFill||n("#334eff").setOpacity(.25).get()})),m&&m.attr(a),s&&!m&&c&&e.pan(t,i.panning)}}dragStart(t){const e=this.chart;e.mouseIsDown=t.type,e.cancelClick=!1,e.mouseDownX=this.mouseDownX=t.chartX,e.mouseDownY=this.mouseDownY=t.chartY}getSelectionBox(t){const e={args:{marker:t},result:{}};return u(this,"getSelectionBox",e,(e=>{e.result={x:t.attr?+t.attr("x"):t.x,y:t.attr?+t.attr("y"):t.y,width:t.attr?t.attr("width"):t.width,height:t.attr?t.attr("height"):t.height}})),e.result}drop(t){const e=this,i=this.chart,n=this.hasPinched;if(this.selectionMarker){const{x:s,y:r,width:o,height:a}=this.getSelectionBox(this.selectionMarker),l={originalEvent:t,xAxis:[],yAxis:[],x:s,y:r,width:o,height:a};let d=!!i.mapView;(this.hasDragged||n)&&(i.axes.forEach((function(i){if(i.zoomEnabled&&h(i.min)&&(n||e[{xAxis:"zoomX",yAxis:"zoomY"}[i.coll]])&&p(s)&&p(r)&&p(o)&&p(a)){var c=i.horiz;const e="touchend"===t.type?i.minPixelPadding:0,n=i.toValue((c?s:r)+e);c=i.toValue((c?s+o:r+a)-e),l[i.coll].push({axis:i,min:Math.min(n,c),max:Math.max(n,c)}),d=!0}})),d&&u(i,"selection",l,(function(t){i.zoom(c(t,n?{animation:!1}:null))}))),p(i.index)&&(this.selectionMarker=this.selectionMarker.destroy()),n&&this.scaleGroups()}i&&p(i.index)&&(l(i.container,{cursor:i._cursor}),i.cancelClick=10<this.hasDragged,i.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])}findNearestKDPoint(t,e,i){let n;return t.forEach((function(t){var s=!(t.noSharedTooltip&&e)&&0>t.options.findNearestPointBy.indexOf("y");if(t=t.searchPoint(i,s),(s=f(t,!0)&&t.series)&&!(s=!f(n,!0))){{s=n.distX-t.distX;const i=n.dist-t.dist,r=(t.series.group&&t.series.group.zIndex)-(n.series.group&&n.series.group.zIndex);s=0!==s&&e?s:0!==i?i:0!==r?r:n.series.index>t.series.index?-1:1}s=0<s}s&&(n=t)})),n}getChartCoordinatesFromPoint(t,e){var i=t.series;const n=i.xAxis;i=i.yAxis;const s=t.shapeArgs;if(n&&i){let r=v(t.clientX,t.plotX),o=t.plotY||0;return t.isNode&&s&&p(s.x)&&p(s.y)&&(r=s.x,o=s.y),e?{chartX:i.len+i.pos-o,chartY:n.len+n.pos-r}:{chartX:r+n.pos,chartY:o+i.pos}}if(s&&s.x&&s.y)return{chartX:s.x,chartY:s.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;var{container:t}=this.chart;const e=g(t);this.chartPosition={left:e.left,top:e.top,scaleX:1,scaleY:1};const i=t.offsetWidth;return t=t.offsetHeight,2<i&&2<t&&(this.chartPosition.scaleX=e.width/i,this.chartPosition.scaleY=e.height/t),this.chartPosition}getCoordinates(t){const e={xAxis:[],yAxis:[]};return this.chart.axes.forEach((function(i){e[i.isXAxis?"xAxis":"yAxis"].push({axis:i,value:i.toValue(t[i.horiz?"chartX":"chartY"])})})),e}getHoverData(t,e,i,n,s,r){const o=[];n=!(!n||!t);const a=function(t){return t.visible&&!(!s&&t.directTouch)&&v(t.options.enableMouseTracking,!0)};let l,h={chartX:r?r.chartX:void 0,chartY:r?r.chartY:void 0,shared:s};u(this,"beforeGetHoverData",h),l=e&&!e.stickyTracking?[e]:i.filter((t=>t.stickyTracking&&(h.filter||a)(t)));const c=n||!r?t:this.findNearestKDPoint(l,s,r);return e=c&&c.series,c&&(s&&!e.noSharedTooltip?(l=i.filter((function(t){return h.filter?h.filter(t):a(t)&&!t.noSharedTooltip})),l.forEach((function(t){let e=d(t.points,(function(t){return t.x===c.x&&!t.isNull}));f(e)&&(t.boosted&&t.boost&&(e=t.boost.getPoint(e)),o.push(e))}))):o.push(c)),h={hoverPoint:c},u(this,"afterGetHoverData",h),{hoverPoint:h.hoverPoint,hoverSeries:e,hoverPoints:o}}getPointFromEvent(t){let e;for(t=t.target;t&&!e;)e=t.point,t=t.parentNode;return e}onTrackerMouseOut(t){t=t.relatedTarget;const e=this.chart.hoverSeries;this.isDirectTouch=!1,!e||!t||e.stickyTracking||this.inClass(t,"highcharts-tooltip")||this.inClass(t,"highcharts-series-"+e.index)&&this.inClass(t,"highcharts-tracker")||e.onMouseOut()}inClass(t,e){let i;for(;t;){if(i=a(t,"class")){if(-1!==i.indexOf(e))return!0;if(-1!==i.indexOf("highcharts-container"))return!1}t=t.parentElement}}init(t,e){this.options=e,this.chart=t,this.runChartClick=!(!e.chart.events||!e.chart.events.click),this.pinchDown=[],this.lastValidTouch={},this.setDOMEvents(),u(this,"afterInit")}normalize(t,e){var i=t.touches,n=i?i.length?i.item(0):v(i.changedTouches,t.changedTouches)[0]:t;return e||(e=this.getChartPosition()),i=n.pageX-e.left,n=n.pageY-e.top,i/=e.scaleX,n/=e.scaleY,c(t,{chartX:Math.round(i),chartY:Math.round(n)})}onContainerClick(t){const e=this.chart,i=e.hoverPoint;t=this.normalize(t);const n=e.plotLeft,s=e.plotTop;e.cancelClick||(i&&this.inClass(t.target,"highcharts-tracker")?(u(i.series,"click",c(t,{point:i})),e.hoverPoint&&i.firePointEvent("click",t)):(c(t,this.getCoordinates(t)),e.isInsidePlot(t.chartX-n,t.chartY-s,{visiblePlotOnly:!0})&&u(e,"click",t)))}onContainerMouseDown(t){const i=1==(1&(t.buttons||t.button));t=this.normalize(t),e.isFirefox&&0!==t.button&&this.onContainerMouseMove(t),(void 0===t.button||i)&&(this.zoomOption(t),i&&t.preventDefault&&t.preventDefault(),this.dragStart(t))}onContainerMouseLeave(t){const e=s[v(x.hoverChartIndex,-1)];t=this.normalize(t),e&&t.relatedTarget&&!this.inClass(t.relatedTarget,"highcharts-tooltip")&&(e.pointer.reset(),e.pointer.chartPosition=void 0)}onContainerMouseEnter(t){delete this.chartPosition}onContainerMouseMove(t){const e=this.chart,i=e.tooltip;t=this.normalize(t),this.setHoverChartIndex(),("mousedown"===e.mouseIsDown||this.touchSelect(t))&&this.drag(t),e.openMenu||!this.inClass(t.target,"highcharts-tracker")&&!e.isInsidePlot(t.chartX-e.plotLeft,t.chartY-e.plotTop,{visiblePlotOnly:!0})||i&&i.shouldStickOnContact(t)||(this.inClass(t.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(t))}onDocumentTouchEnd(t){const e=s[v(x.hoverChartIndex,-1)];e&&e.pointer.drop(t)}onContainerTouchMove(t){this.touchSelect(t)?this.onContainerMouseMove(t):this.touch(t)}onContainerTouchStart(t){this.touchSelect(t)?this.onContainerMouseDown(t):(this.zoomOption(t),this.touch(t,!0))}onDocumentMouseMove(t){const e=this.chart,i=e.tooltip,n=this.chartPosition;t=this.normalize(t,n),!n||e.isInsidePlot(t.chartX-e.plotLeft,t.chartY-e.plotTop,{visiblePlotOnly:!0})||i&&i.shouldStickOnContact(t)||this.inClass(t.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(t){const e=s[v(x.hoverChartIndex,-1)];e&&e.pointer.drop(t)}pinch(t){const e=this,i=e.chart,n=e.pinchDown,s=t.touches||[],o=s.length,a=e.lastValidTouch,l=e.hasZoom,h={},d=1===o&&(e.inClass(t.target,"highcharts-tracker")&&i.runTrackerClick||e.runChartClick),p={};var f=e.chart.tooltip;f=1===o&&v(f&&f.options.followTouchMove,!0);let m=e.selectionMarker;1<o?e.initiated=!0:f&&(e.initiated=!1),l&&e.initiated&&!d&&!1!==t.cancelable&&t.preventDefault(),[].map.call(s,(function(t){return e.normalize(t)})),"touchstart"===t.type?([].forEach.call(s,(function(t,e){n[e]={chartX:t.chartX,chartY:t.chartY}})),a.x=[n[0].chartX,n[1]&&n[1].chartX],a.y=[n[0].chartY,n[1]&&n[1].chartY],i.axes.forEach((function(t){if(t.zoomEnabled){const e=i.bounds[t.horiz?"h":"v"],n=t.minPixelPadding,s=t.toPixels(Math.min(v(t.options.min,t.dataMin),t.dataMin)),r=t.toPixels(Math.max(v(t.options.max,t.dataMax),t.dataMax)),o=Math.max(s,r);e.min=Math.min(t.pos,Math.min(s,r)-n),e.max=Math.max(t.pos+t.len,o+n)}})),e.res=!0):f?this.runPointActions(e.normalize(t)):n.length&&(u(i,"touchpan",{originalEvent:t},(()=>{m||(e.selectionMarker=m=c({destroy:r,touch:!0},i.plotBox)),e.pinchTranslate(n,s,h,m,p,a),e.hasPinched=l,e.scaleGroups(h,p)})),e.res&&(e.res=!1,this.reset(!1,0)))}pinchTranslate(t,e,i,n,s,r){this.zoomHor&&this.pinchTranslateDirection(!0,t,e,i,n,s,r),this.zoomVert&&this.pinchTranslateDirection(!1,t,e,i,n,s,r)}pinchTranslateDirection(t,e,i,n,s,r,o,a){const l=this.chart,h=t?"x":"y",c=t?"X":"Y",d="chart"+c,u=t?"width":"height",p=l["plot"+(t?"Left":"Top")],f=l.inverted,m=l.bounds[t?"h":"v"],g=1===e.length,v=e[0][d],_=!g&&e[1][d];e=function(){"number"==typeof w&&20<Math.abs(v-_)&&(M=a||Math.abs(S-w)/Math.abs(v-_)),y=(p-S)/M+v,x=l["plot"+(t?"Width":"Height")]/M};let x,y,b,M=a||1,S=i[0][d],w=!g&&i[1][d];e(),(i=y)<m.min?(i=m.min,b=!0):i+x>m.max&&(i=m.max-x,b=!0),b?(S-=.8*(S-o[h][0]),"number"==typeof w&&(w-=.8*(w-o[h][1])),e()):o[h]=[S,w],f||(r[h]=y-p,r[u]=x),r=f?1/M:M,s[u]=x,s[h]=i,n[f?t?"scaleY":"scaleX":"scale"+c]=M,n["translate"+c]=r*p+(S-r*v)}reset(t,e){const i=this.chart,n=i.hoverSeries,s=i.hoverPoint,r=i.hoverPoints,o=i.tooltip,a=o&&o.shared?r:s;t&&a&&_(a).forEach((function(e){e.series.isCartesian&&void 0===e.plotX&&(t=!1)})),t?o&&a&&_(a).length&&(o.refresh(a),o.shared&&r?r.forEach((function(t){t.setState(t.state,!0),t.series.isCartesian&&(t.series.xAxis.crosshair&&t.series.xAxis.drawCrosshair(null,t),t.series.yAxis.crosshair&&t.series.yAxis.drawCrosshair(null,t))})):s&&(s.setState(s.state,!0),i.axes.forEach((function(t){t.crosshair&&s.series[t.coll]===t&&t.drawCrosshair(null,s)})))):(s&&s.onMouseOut(),r&&r.forEach((function(t){t.setState()})),n&&n.onMouseOut(),o&&o.hide(e),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),i.axes.forEach((function(t){t.hideCrosshair()})),this.hoverX=i.hoverPoints=i.hoverPoint=null)}runPointActions(t,e,i){const n=this.chart,r=n.tooltip&&n.tooltip.options.enabled?n.tooltip:void 0,a=!!r&&r.shared;let l=e||n.hoverPoint,h=l&&l.series||n.hoverSeries;e=this.getHoverData(l,h,n.series,(!t||"touchmove"!==t.type)&&(!!e||h&&h.directTouch&&this.isDirectTouch),a,t),l=e.hoverPoint,h=e.hoverSeries;const c=e.hoverPoints;e=h&&h.tooltipOptions.followPointer&&!h.tooltipOptions.split;const u=a&&h&&!h.noSharedTooltip;if(l&&(i||l!==n.hoverPoint||r&&r.isHidden)){if((n.hoverPoints||[]).forEach((function(t){-1===c.indexOf(t)&&t.setState()})),n.hoverSeries!==h&&h.onMouseOver(),this.applyInactiveState(c),(c||[]).forEach((function(t){t.setState("hover")})),n.hoverPoint&&n.hoverPoint.firePointEvent("mouseOut"),!l.series)return;n.hoverPoints=c,n.hoverPoint=l,l.firePointEvent("mouseOver",void 0,(()=>{r&&l&&r.refresh(u?c:l,t)}))}else e&&r&&!r.isHidden&&(i=r.getAnchor([{}],t),n.isInsidePlot(i[0],i[1],{visiblePlotOnly:!0})&&r.updatePosition({plotX:i[0],plotY:i[1]}));this.unDocMouseMove||(this.unDocMouseMove=o(n.container.ownerDocument,"mousemove",(function(t){const e=s[x.hoverChartIndex];e&&e.pointer.onDocumentMouseMove(t)})),this.eventsToUnbind.push(this.unDocMouseMove)),n.axes.forEach((function(e){const i=v((e.crosshair||{}).snap,!0);let s;i&&((s=n.hoverPoint)&&s.series[e.coll]===e||(s=d(c,(t=>t.series&&t.series[e.coll]===e)))),s||!i?e.drawCrosshair(t,s):e.hideCrosshair()}))}scaleGroups(t,e){const i=this.chart;i.series.forEach((function(n){const s=t||n.getPlotBox();n.group&&(n.xAxis&&n.xAxis.zoomEnabled||i.mapView)&&(n.group.attr(s),n.markerGroup&&(n.markerGroup.attr(s),n.markerGroup.clip(e?i.clipRect:null)),n.dataLabelsGroup&&n.dataLabelsGroup.attr(s))})),i.clipRect.attr(e||i.clipBox)}setDOMEvents(){const t=this.chart.container,i=t.ownerDocument;t.onmousedown=this.onContainerMouseDown.bind(this),t.onmousemove=this.onContainerMouseMove.bind(this),t.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(o(t,"mouseenter",this.onContainerMouseEnter.bind(this))),this.eventsToUnbind.push(o(t,"mouseleave",this.onContainerMouseLeave.bind(this))),x.unbindDocumentMouseUp||(x.unbindDocumentMouseUp=o(i,"mouseup",this.onDocumentMouseUp.bind(this)));let n=this.chart.renderTo.parentElement;for(;n&&"BODY"!==n.tagName;)this.eventsToUnbind.push(o(n,"scroll",(()=>{delete this.chartPosition}))),n=n.parentElement;e.hasTouch&&(this.eventsToUnbind.push(o(t,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1})),this.eventsToUnbind.push(o(t,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),x.unbindDocumentTouchEnd||(x.unbindDocumentTouchEnd=o(i,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})))}setHoverChartIndex(){const t=this.chart,i=e.charts[v(x.hoverChartIndex,-1)];i&&i!==t&&i.pointer.onContainerMouseLeave({relatedTarget:t.container}),i&&i.mouseIsDown||(x.hoverChartIndex=t.index)}touch(t,e){const i=this.chart;let n,s;this.setHoverChartIndex(),1===t.touches.length?(t=this.normalize(t),(s=i.isInsidePlot(t.chartX-i.plotLeft,t.chartY-i.plotTop,{visiblePlotOnly:!0}))&&!i.openMenu?(e&&this.runPointActions(t),"touchmove"===t.type&&(n=!!(e=this.pinchDown)[0]&&4<=Math.sqrt(Math.pow(e[0].chartX-t.chartX,2)+Math.pow(e[0].chartY-t.chartY,2))),v(n,!0)&&this.pinch(t)):e&&this.reset()):2===t.touches.length&&this.pinch(t)}touchSelect(t){return!(!this.chart.zooming.singleTouch||!t.touches||1!==t.touches.length)}zoomOption(t){const e=this.chart,i=e.inverted;var n=e.zooming.type||"";/touch/.test(t.type)&&(n=v(e.zooming.pinchType,n)),this.zoomX=t=/x/.test(n),this.zoomY=n=/y/.test(n),this.zoomHor=t&&!i||n&&i,this.zoomVert=n&&!i||t&&i,this.hasZoom=t||n}}return function(t){const e=[],n=[];t.compose=function(e){i.pushUnique(n,e)&&o(e,"beforeRender",(function(){this.pointer=new t(this,this.options)}))},t.dissolve=function(){for(let t=0,i=e.length;t<i;++t)e[t]();e.length=0}}(x||(x={})),x})),e(i,"Core/Legend/Legend.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Templating.js"],i["Core/Globals.js"],i["Core/Series/Point.js"],i["Core/Renderer/RendererUtilities.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r){const{animObject:o,setAnimation:a}=t,{format:l}=e,{marginNames:h}=i,{distribute:c}=s,{addEvent:d,createElement:u,css:p,defined:f,discardElement:m,find:g,fireEvent:v,isNumber:_,merge:x,pick:y,relativeLength:b,stableSort:M,syncTimeout:S}=r;class w{constructor(t,e){this.allItems=[],this.contentGroup=this.box=void 0,this.display=!1,this.group=void 0,this.offsetWidth=this.maxLegendWidth=this.maxItemWidth=this.legendWidth=this.legendHeight=this.lastLineHeight=this.lastItemY=this.itemY=this.itemX=this.itemMarginTop=this.itemMarginBottom=this.itemHeight=this.initialItemY=0,this.options=void 0,this.padding=0,this.pages=[],this.proximate=!1,this.scrollGroup=void 0,this.widthOption=this.totalItemWidth=this.titleHeight=this.symbolWidth=this.symbolHeight=0,this.chart=t,this.init(t,e)}init(t,e){this.chart=t,this.setOptions(e),e.enabled&&(this.render(),d(this.chart,"endResize",(function(){this.legend.positionCheckboxes()})),d(this.chart,"render",(()=>{this.proximate&&(this.proximatePositions(),this.positionItems())})))}setOptions(t){const e=y(t.padding,8);this.options=t,this.chart.styledMode||(this.itemStyle=t.itemStyle,this.itemHiddenStyle=x(this.itemStyle,t.itemHiddenStyle)),this.itemMarginTop=t.itemMarginTop,this.itemMarginBottom=t.itemMarginBottom,this.padding=e,this.initialItemY=e-5,this.symbolWidth=y(t.symbolWidth,16),this.pages=[],this.proximate="proximate"===t.layout&&!this.chart.inverted,this.baseline=void 0}update(t,e){const i=this.chart;this.setOptions(x(!0,this.options,t)),this.destroy(),i.isDirtyLegend=i.isDirtyBox=!0,y(e,!0)&&i.redraw(),v(this,"afterUpdate")}colorizeItem(t,e){const{group:i,label:n,line:s,symbol:r}=t.legendItem||{};if(i&&i[e?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){const{itemHiddenStyle:i}=this,o=i.color,a=e&&t.color||o,l=t.options&&t.options.marker;let h={fill:a};null==n||n.css(x(e?this.itemStyle:i)),null==s||s.attr({stroke:a}),r&&(l&&r.isMarker&&(h=t.pointAttribs(),e||(h.stroke=h.fill=o)),r.attr(h))}v(this,"afterColorizeItem",{item:t,visible:e})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(t){const{group:e,x:i=0,y:n=0}=t.legendItem||{};var s=this.options,r=s.symbolPadding;const o=!s.rtl;s=t.checkbox,e&&e.element&&(r={translateX:o?i:this.legendWidth-i-2*r-4,translateY:n},e[f(e.translateY)?"animate":"attr"](r,void 0,(()=>{v(this,"afterPositionItem",{item:t})}))),s&&(s.x=i,s.y=n)}destroyItem(t){const e=t.checkbox,i=t.legendItem||{};for(const t of["group","label","line","symbol"])i[t]&&(i[t]=i[t].destroy());e&&m(e),t.legendItem=void 0}destroy(){for(const t of this.getAllItems())this.destroyItem(t);for(const t of"clipRect up down pager nav box title group".split(" "))this[t]&&(this[t]=this[t].destroy());this.display=null}positionCheckboxes(){const t=this.group&&this.group.alignAttr,e=this.clipHeight||this.legendHeight,i=this.titleHeight;let n;t&&(n=t.translateY,this.allItems.forEach((function(s){const r=s.checkbox;let o;r&&(o=n+i+r.y+(this.scrollOffset||0)+3,p(r,{left:t.translateX+s.checkboxOffset+r.x-20+"px",top:o+"px",display:this.proximate||o>n-6&&o<n+e-6?"":"none"}))}),this))}renderTitle(){var t=this.options;const e=this.padding,i=t.title;let n=0;i.text&&(this.title||(this.title=this.chart.renderer.label(i.text,e-3,e-4,void 0,void 0,void 0,t.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(i.style),this.title.add(this.group)),i.width||this.title.css({width:this.maxLegendWidth+"px"}),n=(t=this.title.getBBox()).height,this.offsetWidth=t.width,this.contentGroup.attr({translateY:n})),this.titleHeight=n}setText(t){const e=this.options;t.legendItem.label.attr({text:e.labelFormat?l(e.labelFormat,t,this.chart):e.labelFormatter.call(t)})}renderItem(t){const e=t.legendItem=t.legendItem||{};var i=this.chart,n=i.renderer;const s=this.options,r=this.symbolWidth,o=s.symbolPadding||0,a=this.itemStyle,l=this.itemHiddenStyle,h="horizontal"===s.layout?y(s.itemDistance,20):0,c=!s.rtl,d=!t.series,u=!d&&t.series.drawLegendSymbol?t.series:t;var p=u.options;const f=this.createCheckboxForItem&&p&&p.showCheckbox,m=s.useHTML,g=t.options.className;let v=e.label;p=r+o+h+(f?20:0),v||(e.group=n.g("legend-item").addClass("highcharts-"+u.type+"-series highcharts-color-"+t.colorIndex+(g?" "+g:"")+(d?" highcharts-series-"+t.index:"")).attr({zIndex:1}).add(this.scrollGroup),e.label=v=n.text("",c?r+o:-o,this.baseline||0,m),i.styledMode||v.css(x(t.visible?a:l)),v.attr({align:c?"left":"right",zIndex:2}).add(e.group),this.baseline||(this.fontMetrics=n.fontMetrics(v),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,v.attr("y",this.baseline),this.symbolHeight=y(s.symbolHeight,this.fontMetrics.f),s.squareSymbol&&(this.symbolWidth=y(s.symbolWidth,Math.max(this.symbolHeight,16)),p=this.symbolWidth+o+h+(f?20:0),c&&v.attr("x",this.symbolWidth+o))),u.drawLegendSymbol(this,t),this.setItemEvents&&this.setItemEvents(t,v,m)),f&&!t.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(t),this.colorizeItem(t,t.visible),!i.styledMode&&a.width||v.css({width:(s.itemWidth||this.widthOption||i.spacingBox.width)-p+"px"}),this.setText(t),i=v.getBBox(),n=this.fontMetrics&&this.fontMetrics.h||0,t.itemWidth=t.checkboxOffset=s.itemWidth||e.labelWidth||i.width+p,this.maxItemWidth=Math.max(this.maxItemWidth,t.itemWidth),this.totalItemWidth+=t.itemWidth,this.itemHeight=t.itemHeight=Math.round(e.labelHeight||(i.height>1.5*n?i.height:n))}layoutItem(t){var e=this.options;const i=this.padding,n="horizontal"===e.layout,s=t.itemHeight,r=this.itemMarginBottom,o=this.itemMarginTop,a=n?y(e.itemDistance,20):0,l=this.maxLegendWidth;e=e.alignColumns&&this.totalItemWidth>l?this.maxItemWidth:t.itemWidth;const h=t.legendItem||{};n&&this.itemX-i+e>l&&(this.itemX=i,this.lastLineHeight&&(this.itemY+=o+this.lastLineHeight+r),this.lastLineHeight=0),this.lastItemY=o+this.itemY+r,this.lastLineHeight=Math.max(s,this.lastLineHeight),h.x=this.itemX,h.y=this.itemY,n?this.itemX+=e:(this.itemY+=o+s+r,this.lastLineHeight=s),this.offsetWidth=this.widthOption||Math.max((n?this.itemX-i-(t.checkbox?0:a):e)+i,this.offsetWidth)}getAllItems(){let t=[];return this.chart.series.forEach((function(e){const i=e&&e.options;e&&y(i.showInLegend,!f(i.linkedTo)&&void 0,!0)&&(t=t.concat((e.legendItem||{}).labels||("point"===i.legendType?e.data:e)))})),v(this,"afterGetAllItems",{allItems:t}),t}getAlignment(){const t=this.options;return this.proximate?t.align.charAt(0)+"tv":t.floating?"":t.align.charAt(0)+t.verticalAlign.charAt(0)+t.layout.charAt(0)}adjustMargins(t,e){const i=this.chart,n=this.options,s=this.getAlignment();s&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach((function(r,o){r.test(s)&&!f(t[o])&&(i[h[o]]=Math.max(i[h[o]],i.legend[(o+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][o]*n[o%2?"x":"y"]+y(n.margin,12)+e[o]+(i.titleOffset[o]||0)))}))}proximatePositions(){const t=this.chart,e=[],i="left"===this.options.align;let n;this.allItems.forEach((function(n){var s,r=i;let o;n.yAxis&&(n.xAxis.options.reversed&&(r=!r),n.points&&(s=g(r?n.points:n.points.slice(0).reverse(),(function(t){return _(t.plotY)}))),r=this.itemMarginTop+n.legendItem.label.getBBox().height+this.itemMarginBottom,o=n.yAxis.top-t.plotTop,n.visible?(s=s?s.plotY:n.yAxis.height,s+=o-.3*r):s=o+n.yAxis.height,e.push({target:s,size:r,item:n}))}),this);for(const i of c(e,t.plotHeight))n=i.item.legendItem||{},_(i.pos)&&(n.y=t.plotTop-t.spacing[0]+i.pos)}render(){const t=this.chart,e=t.renderer,i=this.options,n=this.padding;var s=this.getAllItems();let r,o=this.group,a=this.box;this.itemX=n,this.itemY=this.initialItemY,this.lastItemY=this.offsetWidth=0,this.widthOption=b(i.width,t.spacingBox.width-n);var l=t.spacingBox.width-2*n-i.x;-1<["rm","lm"].indexOf(this.getAlignment().substring(0,2))&&(l/=2),this.maxLegendWidth=this.widthOption||l,o||(this.group=o=e.g("legend").addClass(i.className||"").attr({zIndex:7}).add(),this.contentGroup=e.g().attr({zIndex:1}).add(o),this.scrollGroup=e.g().add(this.contentGroup)),this.renderTitle(),M(s,((t,e)=>(t.options&&t.options.legendIndex||0)-(e.options&&e.options.legendIndex||0))),i.reversed&&s.reverse(),this.allItems=s,this.display=l=!!s.length,this.itemHeight=this.totalItemWidth=this.maxItemWidth=this.lastLineHeight=0,s.forEach(this.renderItem,this),s.forEach(this.layoutItem,this),s=(this.widthOption||this.offsetWidth)+n,r=this.lastItemY+this.lastLineHeight+this.titleHeight,r=this.handleOverflow(r),r+=n,a||(this.box=a=e.rect().addClass("highcharts-legend-box").attr({r:i.borderRadius}).add(o)),t.styledMode||a.attr({stroke:i.borderColor,"stroke-width":i.borderWidth||0,fill:i.backgroundColor||"none"}).shadow(i.shadow),0<s&&0<r&&a[a.placed?"animate":"attr"](a.crisp.call({},{x:0,y:0,width:s,height:r},a.strokeWidth())),o[l?"show":"hide"](),t.styledMode&&"none"===o.getStyle("display")&&(s=r=0),this.legendWidth=s,this.legendHeight=r,l&&this.align(),this.proximate||this.positionItems(),v(this,"afterRender")}align(t=this.chart.spacingBox){const e=this.chart,i=this.options;let n=t.y;/(lth|ct|rth)/.test(this.getAlignment())&&0<e.titleOffset[0]?n+=e.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&0<e.titleOffset[2]&&(n-=e.titleOffset[2]),n!==t.y&&(t=x(t,{y:n})),e.hasRendered||(this.group.placed=!1),this.group.align(x(i,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":i.verticalAlign}),!0,t)}handleOverflow(t){const e=this,i=this.chart,n=i.renderer,s=this.options;var r=s.y;const o="top"===s.verticalAlign,a=this.padding,l=s.maxHeight,h=s.navigation,c=y(h.animation,!0),d=h.arrowSize||12,u=this.pages,p=this.allItems,f=function(t){"number"==typeof t?b.attr({height:t}):b&&(e.clipRect=b.destroy(),e.contentGroup.clip()),e.contentGroup.div&&(e.contentGroup.div.style.clip=t?"rect("+a+"px,9999px,"+(a+t)+"px,0)":"auto")},m=function(t){return e[t]=n.circle(0,0,1.3*d).translate(d/2,d/2).add(x),i.styledMode||e[t].attr("fill","rgba(0,0,0,0.0001)"),e[t]};let g,v,_;r=i.spacingBox.height+(o?-r:r)-a;let x=this.nav,b=this.clipRect;return"horizontal"!==s.layout||"middle"===s.verticalAlign||s.floating||(r/=2),l&&(r=Math.min(r,l)),u.length=0,t&&0<r&&t>r&&!1!==h.enabled?(this.clipHeight=g=Math.max(r-20-this.titleHeight-a,0),this.currentPage=y(this.currentPage,1),this.fullHeight=t,p.forEach(((t,e)=>{_=t.legendItem||{},t=_.y||0;const i=Math.round(_.label.getBBox().height);let n=u.length;(!n||t-u[n-1]>g&&(v||t)!==u[n-1])&&(u.push(v||t),n++),_.pageIx=n-1,v&&((p[e-1].legendItem||{}).pageIx=n-1),e===p.length-1&&t+i-u[n-1]>g&&t>u[n-1]&&(u.push(t),_.pageIx=n),t!==v&&(v=t)})),b||(b=e.clipRect=n.clipRect(0,a-2,9999,0),e.contentGroup.clip(b)),f(g),x||(this.nav=x=n.g().attr({zIndex:1}).add(this.group),this.up=n.symbol("triangle",0,0,d,d).add(x),m("upTracker").on("click",(function(){e.scroll(-1,c)})),this.pager=n.text("",15,10).addClass("highcharts-legend-navigation"),!i.styledMode&&h.style&&this.pager.css(h.style),this.pager.add(x),this.down=n.symbol("triangle-down",0,0,d,d).add(x),m("downTracker").on("click",(function(){e.scroll(1,c)}))),e.scroll(0),t=r):x&&(f(),this.nav=x.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),t}scroll(t,e){const i=this.chart,n=this.pages,s=n.length,r=this.clipHeight,l=this.options.navigation,h=this.pager,c=this.padding;let d=this.currentPage+t;d>s&&(d=s),0<d&&(void 0!==e&&a(e,i),this.nav.attr({translateX:c,translateY:r+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach((function(t){t.attr({class:1===d?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})})),h.attr({text:d+"/"+s}),[this.down,this.downTracker].forEach((function(t){t.attr({x:18+this.pager.getBBox().width,class:d===s?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),this),i.styledMode||(this.up.attr({fill:1===d?l.inactiveColor:l.activeColor}),this.upTracker.css({cursor:1===d?"default":"pointer"}),this.down.attr({fill:d===s?l.inactiveColor:l.activeColor}),this.downTracker.css({cursor:d===s?"default":"pointer"})),this.scrollOffset=-n[d-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=d,this.positionCheckboxes(),t=o(y(e,i.renderer.globalAnimation,!0)),S((()=>{v(this,"afterScroll",{currentPage:d})}),t.duration))}setItemEvents(t,e,i){const s=this,r=t.legendItem||{},o=s.chart.renderer.boxWrapper,a=t instanceof n,l="highcharts-legend-"+(a?"point":"series")+"-active",h=s.chart.styledMode;i=i?[e,r.symbol]:[r.group];const c=e=>{s.allItems.forEach((i=>{t!==i&&[i].concat(i.linkedSeries||[]).forEach((t=>{t.setState(e,!a)}))}))};for(const n of i)n&&n.on("mouseover",(function(){t.visible&&c("inactive"),t.setState("hover"),t.visible&&o.addClass(l),h||e.css(s.options.itemHoverStyle)})).on("mouseout",(function(){s.chart.styledMode||e.css(x(t.visible?s.itemStyle:s.itemHiddenStyle)),c(""),o.removeClass(l),t.setState()})).on("click",(function(e){const i=function(){t.setVisible&&t.setVisible(),c(t.visible?"inactive":"")};o.removeClass(l),e={browserEvent:e},t.firePointEvent?t.firePointEvent("legendItemClick",e,i):v(t,"legendItemClick",e,i)}))}createCheckboxForItem(t){t.checkbox=u("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:t.selected,defaultChecked:t.selected},this.options.itemCheckboxStyle,this.chart.container),d(t.checkbox,"click",(function(e){v(t.series||t,"checkboxClick",{checked:e.target.checked,item:t},(function(){t.select()}))}))}}return function(t){const e=[];t.compose=function(i){r.pushUnique(e,i)&&d(i,"beforeMargins",(function(){this.legend=new t(this,this.options.legend)}))}}(w||(w={})),w})),e(i,"Core/Legend/LegendSymbol.js",[i["Core/Utilities.js"]],(function(t){const{extend:e,merge:i,pick:n}=t;var s;return function(t){t.lineMarker=function(t,s){s=this.legendItem=this.legendItem||{};var r=this.options;const o=t.symbolWidth,a=t.symbolHeight,l=a/2,h=this.chart.renderer,c=s.group;t=t.baseline-Math.round(.3*t.fontMetrics.b);let d={},u=r.marker,p=0;this.chart.styledMode||(d={"stroke-width":Math.min(r.lineWidth||0,24)},r.dashStyle?d.dashstyle=r.dashStyle:"square"!==r.linecap&&(d["stroke-linecap"]="round")),s.line=h.path().addClass("highcharts-graph").attr(d).add(c),d["stroke-linecap"]&&(p=Math.min(s.line.strokeWidth(),o)/2),o&&s.line.attr({d:[["M",p,t],["L",o-p,t]]}),u&&!1!==u.enabled&&o&&(r=Math.min(n(u.radius,l),l),0===this.symbol.indexOf("url")&&(u=i(u,{width:a,height:a}),r=0),s.symbol=s=h.symbol(this.symbol,o/2-r,t-r,2*r,2*r,e({context:"legend"},u)).addClass("highcharts-point").add(c),s.isMarker=!0)},t.rectangle=function(t,e){e=e.legendItem||{};const i=t.symbolHeight,s=t.options.squareSymbol;e.symbol=this.chart.renderer.rect(s?(t.symbolWidth-i)/2:0,t.baseline-i+1,s?i:t.symbolWidth,i,n(t.options.symbolRadius,i/2)).addClass("highcharts-point").attr({zIndex:3}).add(e.group)}}(s||(s={})),s})),e(i,"Core/Series/SeriesDefaults.js",[],(function(){return{lineWidth:1,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){const{numberFormatter:t}=this.series.chart;return"number"!=typeof this.y?"":t(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"}})),e(i,"Core/Series/SeriesRegistry.js",[i["Core/Globals.js"],i["Core/Defaults.js"],i["Core/Series/Point.js"],i["Core/Utilities.js"]],(function(t,e,i,n){const{defaultOptions:s}=e,{extendClass:r,merge:o}=n;var a;return function(e){function n(t,n){const r=s.plotOptions||{},o=n.defaultOptions,a=n.prototype;a.type=t,a.pointClass||(a.pointClass=i),o&&(r[t]=o),e.seriesTypes[t]=n}e.seriesTypes=t.seriesTypes,e.registerSeriesType=n,e.seriesType=function(t,a,l,h,c){const d=s.plotOptions||{};return a=a||"",d[t]=o(d[a],l),n(t,r(e.seriesTypes[a]||function(){},h)),e.seriesTypes[t].prototype.type=t,c&&(e.seriesTypes[t].prototype.pointClass=r(i,c)),e.seriesTypes[t]}}(a||(a={})),a})),e(i,"Core/Series/Series.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Defaults.js"],i["Core/Foundation.js"],i["Core/Globals.js"],i["Core/Legend/LegendSymbol.js"],i["Core/Series/Point.js"],i["Core/Series/SeriesDefaults.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r,o,a,l,h){const{animObject:c,setAnimation:d}=t,{defaultOptions:u}=e,{registerEventOptions:p}=i,{hasTouch:f,svg:m,win:g}=n,{seriesTypes:v}=a,{arrayMax:_,arrayMin:x,clamp:y,correctFloat:b,defined:M,diffObjects:S,erase:w,error:T,extend:E,find:A,fireEvent:C,getClosestDistance:P,getNestedProperty:L,insertItem:R,isArray:D,isNumber:I,isString:k,merge:O,objectEach:N,pick:U,removeEvent:B,splat:F,syncTimeout:z}=h;class H{constructor(){this.zones=this.yAxis=this.xAxis=this.userOptions=this.tooltipOptions=this.processedYData=this.processedXData=this.points=this.options=this.linkedSeries=this.index=this.eventsToUnbind=this.eventOptions=this.data=this.chart=this._i=void 0}init(t,e){C(this,"init",{options:e});const i=this,n=t.series;this.eventsToUnbind=[],i.chart=t,i.options=i.setOptions(e),e=i.options,i.linkedSeries=[],i.bindAxes(),E(i,{name:e.name,state:"",visible:!1!==e.visible,selected:!0===e.selected}),p(this,e);const s=e.events;let r;(s&&s.click||e.point&&e.point.events&&e.point.events.click||e.allowPointSelect)&&(t.runTrackerClick=!0),i.getColor(),i.getSymbol(),i.parallelArrays.forEach((function(t){i[t+"Data"]||(i[t+"Data"]=[])})),i.isCartesian&&(t.hasCartesianSeries=!0),n.length&&(r=n[n.length-1]),i._i=U(r&&r._i,-1)+1,i.opacity=i.options.opacity,t.orderItems("series",R(this,n)),e.dataSorting&&e.dataSorting.enabled?i.setDataSortingOptions():i.points||i.data||i.setData(e.data,!1),C(this,"afterInit")}is(t){return v[t]&&this instanceof v[t]}bindAxes(){const t=this,e=t.options,i=t.chart;let n;C(this,"bindAxes",null,(function(){(t.axisTypes||[]).forEach((function(s){i[s].forEach((function(i){n=i.options,(U(e[s],0)===i.index||void 0!==e[s]&&e[s]===n.id)&&(R(t,i.series),t[s]=i,i.isDirty=!0)})),t[s]||t.optionalAxis===s||T(18,!0,i)}))})),C(this,"afterBindAxes")}updateParallelArrays(t,e,i){const n=t.series,s=I(e)?function(i){const s="y"===i&&n.toYData?n.toYData(t):t[i];n[i+"Data"][e]=s}:function(t){Array.prototype[e].apply(n[t+"Data"],i)};n.parallelArrays.forEach(s)}hasData(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&this.yData&&0<this.yData.length}autoIncrement(t){var e=this.options;const i=e.pointIntervalUnit,n=e.relativeXValue,s=this.chart.time;let r,o=this.xIncrement;return o=U(o,e.pointStart,0),this.pointInterval=r=U(this.pointInterval,e.pointInterval,1),n&&I(t)&&(r*=t),i&&(e=new s.Date(o),"day"===i?s.set("Date",e,s.get("Date",e)+r):"month"===i?s.set("Month",e,s.get("Month",e)+r):"year"===i&&s.set("FullYear",e,s.get("FullYear",e)+r),r=e.getTime()-o),n&&I(t)?o+r:(this.xIncrement=o+r,o)}setDataSortingOptions(){const t=this.options;E(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),M(t.pointRange)||(t.pointRange=1)}setOptions(t){var e,i;const n=this.chart;var s=n.options.plotOptions,r=n.userOptions||{};const o=O(t);t=n.styledMode;const a={plotOptions:s,userOptions:o};C(this,"setOptions",a);const l=a.plotOptions[this.type],h=(r=r.plotOptions||{}).series||{},c=u.plotOptions[this.type]||{},d=r[this.type]||{};return this.userOptions=a.userOptions,s=O(l,s.series,d,o),this.tooltipOptions=O(u.tooltip,null===(e=u.plotOptions.series)||void 0===e?void 0:e.tooltip,null==c?void 0:c.tooltip,n.userOptions.tooltip,null===(i=r.series)||void 0===i?void 0:i.tooltip,d.tooltip,o.tooltip),this.stickyTracking=U(o.stickyTracking,d.stickyTracking,h.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||s.stickyTracking),null===l.marker&&delete s.marker,this.zoneAxis=s.zoneAxis,i=this.zones=(s.zones||[]).slice(),!s.negativeColor&&!s.negativeFillColor||s.zones||(e={value:s[this.zoneAxis+"Threshold"]||s.threshold||0,className:"highcharts-negative"},t||(e.color=s.negativeColor,e.fillColor=s.negativeFillColor),i.push(e)),i.length&&M(i[i.length-1].value)&&i.push(t?{}:{color:this.color,fillColor:this.fillColor}),C(this,"afterSetOptions",{options:s}),s}getName(){return U(this.options.name,"Series "+(this.index+1))}getCyclic(t,e,i){const n=this.chart,s=`${t}Index`,r=`${t}Counter`,o=(null==i?void 0:i.length)||n.options.chart.colorCount;if(!e){var a=U("color"===t?this.options.colorIndex:void 0,this[s]);M(a)||(n.series.length||(n[r]=0),a=n[r]%o,n[r]+=1),i&&(e=i[a])}void 0!==a&&(this[s]=a),this[t]=e}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||u.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){this.getCyclic("symbol",this.options.marker.symbol,this.chart.options.symbols)}findPointIndex(t,e){const i=t.id,n=t.x,s=this.points;var o,a=this.options.dataSorting;let l,h;if(i)(a=this.chart.get(i))instanceof r&&(o=a);else if((this.linkedParent||this.enabledDataSorting||this.options.relativeXValue)&&(o=e=>!e.touched&&e.index===t.index,a&&a.matchByName?o=e=>!e.touched&&e.name===t.name:this.options.relativeXValue&&(o=e=>!e.touched&&e.options.x===t.x),!(o=A(s,o))))return;return o&&(h=o&&o.index,void 0!==h&&(l=!0)),void 0===h&&I(n)&&(h=this.xData.indexOf(n,e)),-1!==h&&void 0!==h&&this.cropped&&(h=h>=this.cropStart?h-this.cropStart:h),!l&&I(h)&&s[h]&&s[h].touched&&(h=void 0),h}updateData(t,e){const i=this.options,n=i.dataSorting,s=this.points,r=[],o=this.requireSorting,a=t.length===s.length;let l,h,c,d=!0;if(this.xIncrement=null,t.forEach((function(t,e){var h=M(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{};const d=h.x;h.id||I(d)?(-1===(h=this.findPointIndex(h,c))||void 0===h?r.push(t):s[h]&&t!==i.data[h]?(s[h].update(t,!1,null,!1),s[h].touched=!0,o&&(c=h+1)):s[h]&&(s[h].touched=!0),(!a||e!==h||n&&n.enabled||this.hasDerivedData)&&(l=!0)):r.push(t)}),this),l)for(t=s.length;t--;)(h=s[t])&&!h.touched&&h.remove&&h.remove(!1,e);else!a||n&&n.enabled?d=!1:(t.forEach((function(t,e){t===s[e].y||s[e].destroyed||s[e].update(t,!1,null,!1)})),r.length=0);return s.forEach((function(t){t&&(t.touched=!1)})),!!d&&(r.forEach((function(t){this.addPoint(t,!1,null,null,!1)}),this),null===this.xIncrement&&this.xData&&this.xData.length&&(this.xIncrement=_(this.xData),this.autoIncrement()),!0)}setData(t,e=!0,i,n){var s;const r=this,o=r.points,a=o&&o.length||0,l=r.options,h=r.chart,c=l.dataSorting,d=r.xAxis,u=l.turboThreshold,p=this.xData,f=this.yData;var m=r.pointArrayMap;m=m&&m.length;const g=l.keys;let v,_=0,x=1,y=null;if(!h.options.chart.allowMutatingData){l.data&&delete r.options.data,r.userOptions.data&&delete r.userOptions.data;var b=O(!0,t)}if(b=(t=b||t||[]).length,c&&c.enabled&&(t=this.sortData(t)),h.options.chart.allowMutatingData&&!1!==n&&b&&a&&!r.cropped&&!r.hasGroupedData&&r.visible&&!r.boosted&&(v=this.updateData(t,i)),!v){if(r.xIncrement=null,r.colorCounter=0,this.parallelArrays.forEach((function(t){r[t+"Data"].length=0})),u&&b>u)if(y=r.getFirstValidPoint(t),I(y))for(i=0;i<b;i++)p[i]=this.autoIncrement(),f[i]=t[i];else if(D(y))if(m)if(y.length===m)for(i=0;i<b;i++)p[i]=this.autoIncrement(),f[i]=t[i];else for(i=0;i<b;i++)n=t[i],p[i]=n[0],f[i]=n.slice(1,m+1);else if(g&&(_=g.indexOf("x"),x=g.indexOf("y"),_=0<=_?_:0,x=0<=x?x:1),1===y.length&&(x=0),_===x)for(i=0;i<b;i++)p[i]=this.autoIncrement(),f[i]=t[i][x];else for(i=0;i<b;i++)n=t[i],p[i]=n[_],f[i]=n[x];else T(12,!1,h);else for(i=0;i<b;i++)n={series:r},r.pointClass.prototype.applyOptions.apply(n,[t[i]]),r.updateParallelArrays(n,i);for(f&&k(f[0])&&T(14,!0,h),r.data=[],r.options.data=r.userOptions.data=t,i=a;i--;)null===(s=o[i])||void 0===s||s.destroy();d&&(d.minRange=d.userMinRange),r.isDirty=h.isDirtyBox=!0,r.isDirtyData=!!o,i=!1}"point"===l.legendType&&(this.processData(),this.generatePoints()),e&&h.redraw(i)}sortData(t){const e=this,i=e.options.dataSorting.sortKey||"y",n=function(t,e){return M(e)&&t.pointClass.prototype.optionsToObject.call({series:t},e)||{}};return t.forEach((function(i,s){t[s]=n(e,i),t[s].index=s}),this),t.concat().sort(((t,e)=>(t=L(i,t),(e=L(i,e))<t?-1:e>t?1:0))).forEach((function(t,e){t.x=e}),this),e.linkedSeries&&e.linkedSeries.forEach((function(e){const i=e.options,s=i.data;i.dataSorting&&i.dataSorting.enabled||!s||(s.forEach((function(i,r){s[r]=n(e,i),t[r]&&(s[r].x=t[r].x,s[r].index=r)})),e.setData(s,!1))})),t}getProcessedData(t){const e=this;var i=e.xAxis,n=e.options;const s=n.cropThreshold,r=t||e.getExtremesFromAll||n.getExtremesFromAll,o=null==i?void 0:i.logarithmic,a=e.isCartesian;let l,h=0;t=e.xData,n=e.yData;let c=!1;const d=t.length;if(i){var u=i.getExtremes();l=u.min,u=u.max,c=!(!i.categories||i.names.length)}if(a&&e.sorted&&!r&&(!s||d>s||e.forceCrop))if(t[d-1]<l||t[0]>u)t=[],n=[];else if(e.yData&&(t[0]<l||t[d-1]>u)){var p=this.cropData(e.xData,e.yData,l,u);t=p.xData,n=p.yData,h=p.start,p=!0}return i=P([o?t.map(o.log2lin):t],(()=>e.requireSorting&&!c&&T(15,!1,e.chart))),{xData:t,yData:n,cropped:p,cropStart:h,closestPointRange:i}}processData(t){const e=this.xAxis;if(this.isCartesian&&!this.isDirty&&!e.isDirty&&!this.yAxis.isDirty&&!t)return!1;t=this.getProcessedData(),this.cropped=t.cropped,this.cropStart=t.cropStart,this.processedXData=t.xData,this.processedYData=t.yData,this.closestPointRange=this.basePointRange=t.closestPointRange,C(this,"afterProcessData")}cropData(t,e,i,n,s){const r=t.length;let o,a=0,l=r;for(s=U(s,this.cropShoulder),o=0;o<r;o++)if(t[o]>=i){a=Math.max(0,o-s);break}for(i=o;i<r;i++)if(t[i]>n){l=i+s;break}return{xData:t.slice(a,l),yData:e.slice(a,l),start:a,end:l}}generatePoints(){var t=this.options;const e=this.processedData||t.data,i=this.processedXData,n=this.processedYData,s=this.pointClass,r=i.length,o=this.cropStart||0,a=this.hasGroupedData,l=t.keys,h=[];let c;t=t.dataGrouping&&t.dataGrouping.groupAll?o:0;let d,u,p=this.data;if(!p&&!a){var f=[];f.length=e.length,p=this.data=f}for(l&&a&&(this.options.keys=!1),u=0;u<r;u++)f=o+u,a?(d=(new s).init(this,[i[u]].concat(F(n[u]))),d.dataGroup=this.groupMap[t+u],d.dataGroup.options&&(d.options=d.dataGroup.options,E(d,d.dataGroup.options),delete d.dataLabels)):(d=p[f])||void 0===e[f]||(p[f]=d=(new s).init(this,e[f],i[u])),d&&(d.index=a?t+u:f,h[u]=d);if(this.options.keys=l,p&&(r!==(c=p.length)||a))for(u=0;u<c;u++)u!==o||a||(u+=r),p[u]&&(p[u].destroyElements(),p[u].plotX=void 0);this.data=p,this.points=h,C(this,"afterGeneratePoints")}getXExtremes(t){return{min:x(t),max:_(t)}}getExtremes(t,e){const i=this.xAxis;var n=this.yAxis;const s=this.processedXData||this.xData,r=[],o=this.requireSorting?this.cropShoulder:0;n=!!n&&n.positiveValuesOnly;let a,l=0,h=0,c=0;const d=(t=t||this.stackedYData||this.processedYData||[]).length;if(i){var u=i.getExtremes();l=u.min,h=u.max}for(a=0;a<d;a++){var p=s[a];u=t[a];var f=(I(u)||D(u))&&(u.length||0<u||!n);if(p=e||this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!i||(s[a+o]||p)>=l&&(s[a-o]||p)<=h,f&&p)if(f=u.length)for(;f--;)I(u[f])&&(r[c++]=u[f]);else r[c++]=u}return t={activeYData:r,dataMin:x(r),dataMax:_(r)},C(this,"afterGetExtremes",{dataExtremes:t}),t}applyExtremes(){const t=this.getExtremes();return this.dataMin=t.dataMin,this.dataMax=t.dataMax,t}getFirstValidPoint(t){const e=t.length;let i=0,n=null;for(;null===n&&i<e;)n=t[i],i++;return n}translate(){var t;this.processedXData||this.processData(),this.generatePoints();var e=this.options;const i=e.stacking,n=this.xAxis,s=n.categories,r=this.enabledDataSorting,o=this.yAxis,a=this.points,l=a.length,h=this.pointPlacementToXValue(),c=!!h,d=e.threshold;e=e.startFromThreshold?d:0;let u,p,f,m,g=Number.MAX_VALUE;for(u=0;u<l;u++){const l=a[u],v=l.x;let _,x,S=l.y,w=l.low;const T=i&&(null===(t=o.stacking)||void 0===t?void 0:t.stacks[(this.negStacks&&S<(e?0:d)?"-":"")+this.stackKey]);let E;p=n.translate(v,!1,!1,!1,!0,h),l.plotX=I(p)?b(y(p,-1e5,1e5)):void 0,i&&this.visible&&T&&T[v]&&(m=this.getStackIndicator(m,v,this.index),!l.isNull&&m.key&&(_=T[v],x=_.points[m.key]),_&&D(x)&&(w=x[0],S=x[1],w===e&&m.key===T[v].base&&(w=U(I(d)?d:o.min)),o.positiveValuesOnly&&M(w)&&0>=w&&(w=void 0),l.total=l.stackTotal=U(_.total),l.percentage=M(l.y)&&_.total?l.y/_.total*100:void 0,l.stackY=S,this.irregularWidths||_.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),l.yBottom=M(w)?y(o.translate(w,!1,!0,!1,!0),-1e5,1e5):void 0,this.dataModify&&(S=this.dataModify.modifyValue(S,u)),I(S)&&void 0!==l.plotX&&(E=o.translate(S,!1,!0,!1,!0),E=I(E)?y(E,-1e5,1e5):void 0),l.plotY=E,l.isInside=this.isPointInside(l),l.clientX=c?b(n.translate(v,!1,!1,!1,!0,h)):p,l.negative=(l.y||0)<(d||0),l.category=U(s&&s[l.x],l.x),l.isNull||!1===l.visible||(void 0!==f&&(g=Math.min(g,Math.abs(p-f))),f=p),l.zone=this.zones.length?l.getZone():void 0,!l.graphic&&this.group&&r&&(l.isNew=!0)}this.closestPointRangePx=g,C(this,"afterTranslate")}getValidPoints(t,e,i){const n=this.chart;return(t||this.points||[]).filter((function(t){const{plotX:s,plotY:r}=t;return!(!(i||!t.isNull&&I(r))||e&&!n.isInsidePlot(s,r,{inverted:n.inverted}))&&!1!==t.visible}))}getClipBox(){const{chart:t,xAxis:e,yAxis:i}=this,n=O(t.clipBox);return e&&e.len!==t.plotSizeX&&(n.width=e.len),i&&i.len!==t.plotSizeY&&(n.height=i.len),n}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0)}setClip(){const{chart:t,group:e,markerGroup:i}=this,n=t.sharedClips,s=t.renderer,r=this.getClipBox(),o=this.getSharedClipKey();let a=n[o];a?a.animate(r):n[o]=a=s.clipRect(r),e&&e.clip(!1===this.options.clip?void 0:a),i&&i.clip()}animate(t){const{chart:e,group:i,markerGroup:n}=this,s=e.inverted;var r=c(this.options.animation),o=[this.getSharedClipKey(),r.duration,r.easing,r.defer].join();let a=e.sharedClips[o],l=e.sharedClips[o+"m"];if(t&&i)r=this.getClipBox(),a?a.attr("height",r.height):(r.width=0,s&&(r.x=e.plotHeight),a=e.renderer.clipRect(r),e.sharedClips[o]=a,l=e.renderer.clipRect({x:-99,y:-99,width:s?e.plotWidth+199:99,height:s?99:e.plotHeight+199}),e.sharedClips[o+"m"]=l),i.clip(a),n&&n.clip(l);else if(a&&!a.hasClass("highcharts-animating")){o=this.getClipBox();const t=r.step;n&&n.element.childNodes.length&&(r.step=function(e,i){t&&t.apply(i,arguments),"width"===i.prop&&l&&l.element&&l.attr(s?"height":"width",e+99)}),a.addClass("highcharts-animating").animate(o,r)}}afterAnimate(){this.setClip(),N(this.chart.sharedClips,((t,e,i)=>{t&&!this.chart.container.querySelector(`[clip-path="url(#${t.id})"]`)&&(t.destroy(),delete i[e])})),this.finishedAnimating=!0,C(this,"afterAnimate")}drawPoints(t=this.points){const e=this.chart,i=e.styledMode,{colorAxis:n,options:s}=this,r=s.marker,o=this[this.specialGroup||"markerGroup"],a=this.xAxis,l=U(r.enabled,!(a&&!a.isRadial)||null,this.closestPointRangePx>=r.enabledThreshold*r.radius);let h,c,d,u,p,f;if(!1!==r.enabled||this._hasPointMarkers)for(h=0;h<t.length;h++){c=t[h],u=(d=c.graphic)?"animate":"attr";var m=c.marker||{};if(p=!!c.marker,(l&&void 0===m.enabled||m.enabled)&&!c.isNull&&!1!==c.visible){const t=U(m.symbol,this.symbol,"rect");f=this.markerAttribs(c,c.selected&&"select"),this.enabledDataSorting&&(c.startXPos=a.reversed?-(f.width||0):a.width);const s=!1!==c.isInside;!d&&s&&(0<(f.width||0)||c.hasImage)&&(c.graphic=d=e.renderer.symbol(t,f.x,f.y,f.width,f.height,p?m:r).add(o),this.enabledDataSorting&&e.hasRendered&&(d.attr({x:c.startXPos}),u="animate")),d&&"animate"===u&&d[s?"show":"hide"](s).animate(f),d&&(m=this.pointAttribs(c,i||!c.selected?void 0:"select"),i?n&&d.css({fill:m.fill}):d[u](m)),d&&d.addClass(c.getClassName(),!0)}else d&&(c.graphic=d.destroy())}}markerAttribs(t,e){const i=this.options;var n=i.marker;const s=t.marker||{},r=s.symbol||n.symbol,o={};let a=U(s.radius,n&&n.radius);return e&&(n=n.states[e],e=s.states&&s.states[e],a=U(e&&e.radius,n&&n.radius,a&&a+(n&&n.radiusPlus||0))),t.hasImage=r&&0===r.indexOf("url"),t.hasImage&&(a=0),t=t.pos(),I(a)&&t&&(o.x=t[0]-a,o.y=t[1]-a,i.crisp&&(o.x=Math.floor(o.x))),a&&(o.width=o.height=2*a),o}pointAttribs(t,e){var i=this.options.marker,n=t&&t.options;const s=n&&n.marker||{};var r=n&&n.color,o=t&&t.color;const a=t&&t.zone&&t.zone.color;let l=this.color;return t=U(s.lineWidth,i.lineWidth),n=1,l=r||a||o||l,r=s.fillColor||i.fillColor||l,o=s.lineColor||i.lineColor||l,e=e||"normal",i=i.states[e]||{},e=s.states&&s.states[e]||{},t=U(e.lineWidth,i.lineWidth,t+U(e.lineWidthPlus,i.lineWidthPlus,0)),r=e.fillColor||i.fillColor||r,{stroke:o=e.lineColor||i.lineColor||o,"stroke-width":t,fill:r,opacity:n=U(e.opacity,i.opacity,n)}}destroy(t){const e=this,i=e.chart,n=/AppleWebKit\/533/.test(g.navigator.userAgent),s=e.data||[];let r,o,a,c;for(C(e,"destroy",{keepEventsForUpdate:t}),this.removeEvents(t),(e.axisTypes||[]).forEach((function(t){(c=e[t])&&c.series&&(w(c.series,e),c.isDirty=c.forceRedraw=!0)})),e.legendItem&&e.chart.legend.destroyItem(e),o=s.length;o--;)(a=s[o])&&a.destroy&&a.destroy();e.clips&&e.clips.forEach((t=>t.destroy())),h.clearTimeout(e.animationTimeout),N(e,(function(t,e){t instanceof l&&!t.survive&&(r=n&&"group"===e?"hide":"destroy",t[r]())})),i.hoverSeries===e&&(i.hoverSeries=void 0),w(i.series,e),i.orderItems("series"),N(e,(function(i,n){t&&"hcEvents"===n||delete e[n]}))}applyZones(){const t=this,e=this.chart,i=e.renderer,n=this.zones,s=this.clips||[],r=this.graph,o=this.area,a=Math.max(e.plotWidth,e.plotHeight),l=this[(this.zoneAxis||"y")+"Axis"],h=e.inverted;let c,d,u,p,f,m,g,v,_,x,b,M=!1;n.length&&(r||o)&&l&&void 0!==l.min?(f=l.reversed,m=l.horiz,r&&!this.showLine&&r.hide(),o&&o.hide(),p=l.getExtremes(),n.forEach((function(n,S){c=f?m?e.plotWidth:0:m?0:l.toPixels(p.min)||0,c=y(U(d,c),0,a),d=y(Math.round(l.toPixels(U(n.value,p.max),!0)||0),0,a),M&&(c=d=l.toPixels(p.max)),g=Math.abs(c-d),v=Math.min(c,d),_=Math.max(c,d),l.isXAxis?(u={x:h?_:v,y:0,width:g,height:a},m||(u.x=e.plotHeight-u.x)):(u={x:0,y:h?_:v,width:a,height:g},m&&(u.y=e.plotWidth-u.y)),s[S]?s[S].animate(u):s[S]=i.clipRect(u),x=t["zone-area-"+S],b=t["zone-graph-"+S],r&&b&&b.clip(s[S]),o&&x&&x.clip(s[S]),M=n.value>p.max,t.resetZones&&0===d&&(d=void 0)})),this.clips=s):t.visible&&(r&&r.show(),o&&o.show())}plotGroup(t,e,i,n,s){let r=this[t];const o=!r;return i={visibility:i,zIndex:n||.1},void 0===this.opacity||this.chart.styledMode||"inactive"===this.state||(i.opacity=this.opacity),o&&(this[t]=r=this.chart.renderer.g().add(s)),r.addClass("highcharts-"+e+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(M(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(r.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),r.attr(i)[o?"attr":"animate"](this.getPlotBox(e)),r}getPlotBox(t){let e=this.xAxis,i=this.yAxis;const n=this.chart;return t=n.inverted&&!n.polar&&e&&!1!==this.invertible&&"series"===t,n.inverted&&(e=i,i=this.xAxis),{translateX:e?e.left:n.plotLeft,translateY:i?i.top:n.plotTop,rotation:t?90:0,rotationOriginX:t?(e.len-i.len)/2:0,rotationOriginY:t?(e.len+i.len)/2:0,scaleX:t?-1:1,scaleY:1}}removeEvents(t){t||B(this),this.eventsToUnbind.length&&(this.eventsToUnbind.forEach((function(t){t()})),this.eventsToUnbind.length=0)}render(){const t=this;var e=t.chart;const i=t.options,n=c(i.animation),s=t.visible?"inherit":"hidden",r=i.zIndex,o=t.hasRendered;e=e.seriesGroup;let a=t.finishedAnimating?0:n.duration;C(this,"render"),t.plotGroup("group","series",s,r,e),t.markerGroup=t.plotGroup("markerGroup","markers",s,r,e),!1!==i.clip&&t.setClip(),t.animate&&a&&t.animate(!0),t.drawGraph&&(t.drawGraph(),t.applyZones()),t.visible&&t.drawPoints(),t.drawDataLabels&&t.drawDataLabels(),t.redrawPoints&&t.redrawPoints(),t.drawTracker&&i.enableMouseTracking&&t.drawTracker(),t.animate&&a&&t.animate(),o||(a&&n.defer&&(a+=n.defer),t.animationTimeout=z((function(){t.afterAnimate()}),a||0)),t.isDirty=!1,t.hasRendered=!0,C(t,"afterRender")}redraw(){const t=this.isDirty||this.isDirtyData;this.translate(),this.render(),t&&delete this.kdTree}searchPoint(t,e){const i=this.xAxis,n=this.yAxis,s=this.chart.inverted;return this.searchKDTree({clientX:s?i.len-t.chartY+i.pos:t.chartX-i.pos,plotY:s?n.len-t.chartX+n.pos:t.chartY-n.pos},e,t)}buildKDTree(t){function e(t,n,s){var r=t&&t.length;let o;if(r)return o=i.kdAxisArray[n%s],t.sort((function(t,e){return t[o]-e[o]})),{point:t[r=Math.floor(r/2)],left:e(t.slice(0,r),n+1,s),right:e(t.slice(r+1),n+1,s)}}this.buildingKdTree=!0;const i=this,n=-1<i.options.findNearestPointBy.indexOf("y")?2:1;delete i.kdTree,z((function(){i.kdTree=e(i.getValidPoints(null,!i.directTouch),n,n),i.buildingKdTree=!1}),i.options.kdNow||t&&"touchstart"===t.type?0:1)}searchKDTree(t,e,i){const n=this,s=this.kdAxisArray[0],r=this.kdAxisArray[1],o=e?"distX":"dist";if(e=-1<n.options.findNearestPointBy.indexOf("y")?2:1,this.kdTree||this.buildingKdTree||this.buildKDTree(i),this.kdTree)return function t(e,i,a,l){const h=i.point;var c=n.kdAxisArray[a%l];let d=h;var u=M(e[s])&&M(h[s])?Math.pow(e[s]-h[s],2):null,p=M(e[r])&&M(h[r])?Math.pow(e[r]-h[r],2):null;return p=(u||0)+(p||0),h.dist=M(p)?Math.sqrt(p):Number.MAX_VALUE,h.distX=M(u)?Math.sqrt(u):Number.MAX_VALUE,u=0>(c=e[c]-h[c])?"right":"left",i[p=0>c?"left":"right"]&&(d=(p=t(e,i[p],a+1,l))[o]<d[o]?p:h),i[u]&&Math.sqrt(c*c)<d[o]&&(d=(e=t(e,i[u],a+1,l))[o]<d[o]?e:d),d}(t,this.kdTree,e,e)}pointPlacementToXValue(){const{options:{pointPlacement:t,pointRange:e},xAxis:i}=this;let n=t;return"between"===n&&(n=i.reversed?-.5:.5),I(n)?n*(e||i.pointRange):0}isPointInside(t){const{chart:e,xAxis:i,yAxis:n}=this;return void 0!==t.plotY&&void 0!==t.plotX&&0<=t.plotY&&t.plotY<=(n?n.len:e.plotHeight)&&0<=t.plotX&&t.plotX<=(i?i.len:e.plotWidth)}drawTracker(){const t=this,e=t.options,i=e.trackByArea,n=[].concat(i?t.areaPath:t.graphPath),s=t.chart,r=s.pointer,o=s.renderer,a=s.options.tooltip.snap,l=t.tracker,h=function(i){e.enableMouseTracking&&s.hoverSeries!==t&&t.onMouseOver()},c="rgba(192,192,192,"+(m?1e-4:.002)+")";l?l.attr({d:n}):t.graph&&(t.tracker=o.path(n).attr({visibility:t.visible?"inherit":"hidden",zIndex:2}).addClass(i?"highcharts-tracker-area":"highcharts-tracker-line").add(t.group),s.styledMode||t.tracker.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:c,fill:i?c:"none","stroke-width":t.graph.strokeWidth()+(i?0:2*a)}),[t.tracker,t.markerGroup,t.dataLabelsGroup].forEach((function(t){t&&(t.addClass("highcharts-tracker").on("mouseover",h).on("mouseout",(function(t){r.onTrackerMouseOut(t)})),e.cursor&&!s.styledMode&&t.css({cursor:e.cursor}),f)&&t.on("touchstart",h)}))),C(this,"afterDrawTracker")}addPoint(t,e,i,n,s){const r=this.options,o=this.data,a=this.chart;var l=this.xAxis;l=l&&l.hasNames&&l.names;const h=r.data,c=this.xData;let d,u;e=U(e,!0);const p={series:this};this.pointClass.prototype.applyOptions.apply(p,[t]);const f=p.x;if(u=c.length,this.requireSorting&&f<c[u-1])for(d=!0;u&&c[u-1]>f;)u--;this.updateParallelArrays(p,"splice",[u,0,0]),this.updateParallelArrays(p,u),l&&p.name&&(l[f]=p.name),h.splice(u,0,t),(d||this.processedData)&&(this.data.splice(u,0,null),this.processData()),"point"===r.legendType&&this.generatePoints(),i&&(o[0]&&o[0].remove?o[0].remove(!1):(o.shift(),this.updateParallelArrays(p,"shift"),h.shift())),!1!==s&&C(this,"addPoint",{point:p}),this.isDirtyData=this.isDirty=!0,e&&a.redraw(n)}removePoint(t,e,i){const n=this,s=n.data,r=s[t],o=n.points,a=n.chart,l=function(){o&&o.length===s.length&&o.splice(t,1),s.splice(t,1),n.options.data.splice(t,1),n.updateParallelArrays(r||{series:n},"splice",[t,1]),r&&r.destroy(),n.isDirty=!0,n.isDirtyData=!0,e&&a.redraw()};d(i,a),e=U(e,!0),r?r.firePointEvent("remove",null,l):l()}remove(t,e,i,n){function s(){r.destroy(n),o.isDirtyLegend=o.isDirtyBox=!0,o.linkSeries(n),U(t,!0)&&o.redraw(e)}const r=this,o=r.chart;!1!==i?C(r,"remove",null,s):s()}update(t,e){t=S(t,this.userOptions),C(this,"update",{options:t});const i=this,n=i.chart;var s=i.userOptions;const r=i.initialType||i.type;var o=n.options.plotOptions;const a=v[r].prototype;var l=i.finishedAnimating&&{animation:!1};const h={};let c,d=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],u=t.type||s.type||n.options.chart.type;const p=!(this.hasDerivedData||u&&u!==this.type||void 0!==t.pointStart||void 0!==t.pointInterval||void 0!==t.relativeXValue||t.joinBy||t.mapData||i.hasOptionChanged("dataGrouping")||i.hasOptionChanged("pointStart")||i.hasOptionChanged("pointInterval")||i.hasOptionChanged("pointIntervalUnit")||i.hasOptionChanged("keys"));if(u=u||r,p&&(d.push("data","isDirtyData","points","processedData","processedXData","processedYData","xIncrement","cropped","_hasPointMarkers","_hasPointLabels","clips","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX"),!1!==t.visible&&d.push("area","graph"),i.parallelArrays.forEach((function(t){d.push(t+"Data")})),t.data&&(t.dataSorting&&E(i.options.dataSorting,t.dataSorting),this.setData(t.data,!1))),t=O(s,l,{index:void 0===s.index?i.index:s.index,pointStart:U(o&&o.series&&o.series.pointStart,s.pointStart,i.xData[0])},!p&&{data:i.options.data},t),p&&t.data&&(t.data=i.options.data),d=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(d),d.forEach((function(t){d[t]=i[t],delete i[t]})),o=!1,v[u]){if(o=u!==i.type,i.remove(!1,!1,!1,!0),o)if(Object.setPrototypeOf)Object.setPrototypeOf(i,v[u].prototype);else{for(c in l=Object.hasOwnProperty.call(i,"hcEvents")&&i.hcEvents,a)i[c]=void 0;E(i,v[u].prototype),l?i.hcEvents=l:delete i.hcEvents}}else T(17,!0,n,{missingModuleFor:u});if(d.forEach((function(t){i[t]=d[t]})),i.init(n,t),p&&this.points){if(!1===(t=i.options).visible)h.graphic=1,h.dataLabel=1;else if(!i._hasPointLabels){const{marker:e,dataLabels:i}=t;s=s.marker||{},!e||!1!==e.enabled&&s.symbol===e.symbol&&s.height===e.height&&s.width===e.width||(h.graphic=1),i&&!1===i.enabled&&(h.dataLabel=1)}for(const e of this.points)e&&e.series&&(e.resolveColor(),Object.keys(h).length&&e.destroyElements(h),!1===t.showInLegend&&e.legendItem&&n.legend.destroyItem(e))}i.initialType=r,n.linkSeries(),o&&i.linkedSeries.length&&(i.isDirtyData=!0),C(this,"afterUpdate"),U(e,!0)&&n.redraw(!!p&&void 0)}setName(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0}hasOptionChanged(t){const e=this.options[t],i=this.chart.options.plotOptions,n=this.userOptions[t];return n?e!==n:e!==U(i&&i[this.type]&&i[this.type][t],i&&i.series&&i.series[t],e)}onMouseOver(){const t=this.chart,e=t.hoverSeries;t.pointer.setHoverChartIndex(),e&&e!==this&&e.onMouseOut(),this.options.events.mouseOver&&C(this,"mouseOver"),this.setState("hover"),t.hoverSeries=this}onMouseOut(){const t=this.options,e=this.chart,i=e.tooltip,n=e.hoverPoint;e.hoverSeries=null,n&&n.onMouseOut(),this&&t.events.mouseOut&&C(this,"mouseOut"),!i||this.stickyTracking||i.shared&&!this.noSharedTooltip||i.hide(),e.series.forEach((function(t){t.setState("",!0)}))}setState(t,e){const i=this;var n=i.options;const s=i.graph,r=n.inactiveOtherPoints,o=n.states,a=U(o[t||"normal"]&&o[t||"normal"].animation,i.chart.options.chart.animation);let l=n.lineWidth,h=0,c=n.opacity;if(t=t||"",i.state!==t&&([i.group,i.markerGroup,i.dataLabelsGroup].forEach((function(e){e&&(i.state&&e.removeClass("highcharts-series-"+i.state),t&&e.addClass("highcharts-series-"+t))})),i.state=t,!i.chart.styledMode)){if(o[t]&&!1===o[t].enabled)return;if(t&&(l=o[t].lineWidth||l+(o[t].lineWidthPlus||0),c=U(o[t].opacity,c)),s&&!s.dashstyle&&I(l))for(n={"stroke-width":l},s.animate(n,a);i["zone-graph-"+h];)i["zone-graph-"+h].animate(n,a),h+=1;r||[i.group,i.markerGroup,i.dataLabelsGroup,i.labelBySeries].forEach((function(t){t&&t.animate({opacity:c},a)}))}e&&r&&i.points&&i.setAllPointsToState(t||void 0)}setAllPointsToState(t){this.points.forEach((function(e){e.setState&&e.setState(t)}))}setVisible(t,e){const i=this,n=i.chart,s=n.options.chart.ignoreHiddenSeries,r=i.visible,o=(i.visible=t=i.options.visible=i.userOptions.visible=void 0===t?!r:t)?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach((function(t){i[t]&&i[t][o]()})),n.hoverSeries!==i&&(n.hoverPoint&&n.hoverPoint.series)!==i||i.onMouseOut(),i.legendItem&&n.legend.colorizeItem(i,t),i.isDirty=!0,i.options.stacking&&n.series.forEach((function(t){t.options.stacking&&t.visible&&(t.isDirty=!0)})),i.linkedSeries.forEach((function(e){e.setVisible(t,!1)})),s&&(n.isDirtyBox=!0),C(i,o),!1!==e&&n.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(t){this.selected=t=this.options.selected=void 0===t?!this.selected:t,this.checkbox&&(this.checkbox.checked=t),C(this,t?"select":"unselect")}shouldShowTooltip(t,e,i={}){return i.series=this,i.visiblePlotOnly=!0,this.chart.isInsidePlot(t,e,i)}drawLegendSymbol(t,e){var i;null===(i=s[this.options.legendSymbol||"rectangle"])||void 0===i||i.call(this,t,e)}}return H.defaultOptions=o,H.types=a.seriesTypes,H.registerType=a.registerSeriesType,E(H.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:r,requireSorting:!0,sorted:!0}),a.series=H,H})),e(i,"Core/Chart/Chart.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Axis/Axis.js"],i["Core/Defaults.js"],i["Core/Templating.js"],i["Core/Foundation.js"],i["Core/Globals.js"],i["Core/Renderer/RendererRegistry.js"],i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Renderer/SVG/SVGRenderer.js"],i["Core/Time.js"],i["Core/Utilities.js"],i["Core/Renderer/HTML/AST.js"]],(function(t,e,i,n,s,r,o,a,l,h,c,d,u){const{animate:p,animObject:f,setAnimation:m}=t,{defaultOptions:g,defaultTime:v}=i,{numberFormat:_}=n,{registerEventOptions:x}=s,{charts:y,doc:b,marginNames:M,svg:S,win:w}=r,{seriesTypes:T}=l,{addEvent:E,attr:A,createElement:C,css:P,defined:L,diffObjects:R,discardElement:D,erase:I,error:k,extend:O,find:N,fireEvent:U,getStyle:B,isArray:F,isNumber:z,isObject:H,isString:V,merge:G,objectEach:W,pick:j,pInt:X,relativeLength:Y,removeEvent:q,splat:K,syncTimeout:Z,uniqueKey:$}=d;class J{static chart(t,e,i){return new J(t,e,i)}constructor(t,e,i){this.series=this.renderTo=this.renderer=this.pointer=this.pointCount=this.plotWidth=this.plotTop=this.plotLeft=this.plotHeight=this.plotBox=this.options=this.numberFormatter=this.margin=this.labelCollectors=this.isResizing=this.index=this.eventOptions=this.container=this.colorCounter=this.clipBox=this.chartWidth=this.chartHeight=this.bounds=this.axisOffset=this.axes=void 0,this.sharedClips={},this.zooming=this.yAxis=this.xAxis=this.userOptions=this.titleOffset=this.time=this.symbolCounter=this.spacingBox=this.spacing=void 0,this.getArgs(t,e,i)}getArgs(t,e,i){V(t)||t.nodeName?(this.renderTo=t,this.init(e,i)):this.init(t,e)}setZoomOptions(){const t=this.options.chart,e=t.zooming;this.zooming=Object.assign(Object.assign({},e),{type:j(t.zoomType,e.type),key:j(t.zoomKey,e.key),pinchType:j(t.pinchType,e.pinchType),singleTouch:j(t.zoomBySingleTouch,e.singleTouch,!1),resetButton:G(e.resetButton,t.resetZoomButton)})}init(t,e){U(this,"init",{args:arguments},(function(){const i=G(g,t),n=i.chart;this.userOptions=O({},t),this.margin=[],this.spacing=[],this.bounds={h:{},v:{}},this.labelCollectors=[],this.callback=e,this.isResizing=0,this.options=i,this.axes=[],this.series=[],this.time=t.time&&Object.keys(t.time).length?new c(t.time):r.time,this.numberFormatter=n.numberFormatter||_,this.styledMode=n.styledMode,this.hasCartesianSeries=n.showAxes,this.index=y.length,y.push(this),r.chartCount++,x(this,n),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),U(this,"afterInit"),this.firstRender()}))}initSeries(t){var e=this.options.chart;e=t.type||e.type;const i=T[e];return i||k(17,!0,this,{missingModuleFor:e}),"function"==typeof(e=new i).init&&e.init(this,t),e}setSeriesData(){this.getSeriesOrderByLinks().forEach((function(t){t.points||t.data||!t.enabledDataSorting||t.setData(t.options.data,!1)}))}getSeriesOrderByLinks(){return this.series.concat().sort((function(t,e){return t.linkedSeries.length||e.linkedSeries.length?e.linkedSeries.length-t.linkedSeries.length:0}))}orderItems(t,e=0){const i=this[t],n=this.options[t]=K(this.options[t]).slice();if(t=this.userOptions[t]=this.userOptions[t]?K(this.userOptions[t]).slice():[],this.hasRendered&&(n.splice(e),t.splice(e)),i)for(let s=e,r=i.length;s<r;++s)(e=i[s])&&(e.index=s,e instanceof a&&(e.name=e.getName()),e.options.isInternal||(n[s]=e.options,t[s]=e.userOptions))}isInsidePlot(t,e,i={}){const{inverted:n,plotBox:s,plotLeft:r,plotTop:o,scrollablePlotBox:a}=this;var l=0;let h=0;i.visiblePlotOnly&&this.scrollingContainer&&({scrollLeft:l,scrollTop:h}=this.scrollingContainer);const c=i.series,d=i.visiblePlotOnly&&a||s;var u=i.inverted?e:t;if(t={x:u,y:e=i.inverted?t:e,isInsidePlot:!0,options:i},!i.ignoreX){const e=c&&(n&&!this.polar?c.yAxis:c.xAxis)||{pos:r,len:1/0};(u=i.paneCoordinates?e.pos+u:r+u)>=Math.max(l+r,e.pos)&&u<=Math.min(l+r+d.width,e.pos+e.len)||(t.isInsidePlot=!1)}return!i.ignoreY&&t.isInsidePlot&&(l=!n&&i.axis&&!i.axis.isXAxis&&i.axis||c&&(n?c.xAxis:c.yAxis)||{pos:o,len:1/0},(i=i.paneCoordinates?l.pos+e:o+e)>=Math.max(h+o,l.pos)&&i<=Math.min(h+o+d.height,l.pos+l.len)||(t.isInsidePlot=!1)),U(this,"afterIsInsidePlot",t),t.isInsidePlot}redraw(t){U(this,"beforeRedraw");const e=this.hasCartesianSeries?this.axes:this.colorAxis||[],i=this.series,n=this.pointer,s=this.legend,r=this.userOptions.legend,o=this.renderer,a=o.isHidden(),l=[];let h,c,d,u=this.isDirtyBox,p=this.isDirtyLegend;for(o.rootFontSize=o.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),m(!!this.hasRendered&&t,this),a&&this.temporaryDisplay(),this.layOutTitles(!1),t=i.length;t--;)if(d=i[t],(d.options.stacking||d.options.centerInCategory)&&(c=!0,d.isDirty)){h=!0;break}if(h)for(t=i.length;t--;)d=i[t],d.options.stacking&&(d.isDirty=!0);i.forEach((function(t){t.isDirty&&("point"===t.options.legendType?("function"==typeof t.updateTotals&&t.updateTotals(),p=!0):r&&(r.labelFormatter||r.labelFormat)&&(p=!0)),t.isDirtyData&&U(t,"updatedData")})),p&&s&&s.options.enabled&&(s.render(),this.isDirtyLegend=!1),c&&this.getStacks(),e.forEach((function(t){t.updateNames(),t.setScale()})),this.getMargins(),e.forEach((function(t){t.isDirty&&(u=!0)})),e.forEach((function(t){const e=t.min+","+t.max;t.extKey!==e&&(t.extKey=e,l.push((function(){U(t,"afterSetExtremes",O(t.eventArgs,t.getExtremes())),delete t.eventArgs}))),(u||c)&&t.redraw()})),u&&this.drawChartBox(),U(this,"predraw"),i.forEach((function(t){(u||t.isDirty)&&t.visible&&t.redraw(),t.isDirtyData=!1})),n&&n.reset(!0),o.draw(),U(this,"redraw"),U(this,"render"),a&&this.temporaryDisplay(!0),l.forEach((function(t){t.call()}))}get(t){function e(e){return e.id===t||e.options&&e.options.id===t}const i=this.series;let n=N(this.axes,e)||N(this.series,e);for(let t=0;!n&&t<i.length;t++)n=N(i[t].points||[],e);return n}getAxes(){const t=this.options;U(this,"getAxes");for(const i of["xAxis","yAxis"]){const n=t[i]=K(t[i]||{});for(const t of n)new e(this,t,i)}U(this,"afterGetAxes")}getSelectedPoints(){return this.series.reduce(((t,e)=>(e.getPointsCollection().forEach((e=>{j(e.selectedStaging,e.selected)&&t.push(e)})),t)),[])}getSelectedSeries(){return this.series.filter((function(t){return t.selected}))}setTitle(t,e,i){this.applyDescription("title",t),this.applyDescription("subtitle",e),this.applyDescription("caption",void 0),this.layOutTitles(i)}applyDescription(t,e){const i=this,n=this.options[t]=G(this.options[t],e);let s=this[t];s&&e&&(this[t]=s=s.destroy()),n&&!s&&(s=this.renderer.text(n.text,0,0,n.useHTML).attr({align:n.align,class:"highcharts-"+t,zIndex:n.zIndex||4}).add(),s.update=function(e,n){i.applyDescription(t,e),i.layOutTitles(n)},this.styledMode||s.css(O("title"===t?{fontSize:this.options.isStock?"1em":"1.2em"}:{},n.style)),this[t]=s)}layOutTitles(t=!0){const e=[0,0,0],i=this.renderer,n=this.spacingBox;["title","subtitle","caption"].forEach((function(t){const s=this[t],r=this.options[t],o=r.verticalAlign||"top";if(t="title"===t?"top"===o?-3:0:"top"===o?e[0]+2:0,s){s.css({width:(r.width||n.width+(r.widthAdjust||0))+"px"});const a=i.fontMetrics(s).b,l=Math.round(s.getBBox(r.useHTML).height);s.align(O({y:"bottom"===o?a:t+a,height:l},r),!1,"spacingBox"),r.floating||("top"===o?e[0]=Math.ceil(e[0]+l):"bottom"===o&&(e[2]=Math.ceil(e[2]+l)))}}),this),e[0]&&"top"===(this.options.title.verticalAlign||"top")&&(e[0]+=this.options.title.margin),e[2]&&"bottom"===this.options.caption.verticalAlign&&(e[2]+=this.options.caption.margin);const s=!this.titleOffset||this.titleOffset.join(",")!==e.join(",");this.titleOffset=e,U(this,"afterLayOutTitles"),!this.isDirtyBox&&s&&(this.isDirtyBox=this.isDirtyLegend=s,this.hasRendered&&t&&this.isDirtyBox&&this.redraw())}getContainerBox(){return{width:B(this.renderTo,"width",!0)||0,height:B(this.renderTo,"height",!0)||0}}getChartSize(){var t=this.options.chart;const e=t.width;t=t.height;const i=this.getContainerBox();this.chartWidth=Math.max(0,e||i.width||600),this.chartHeight=Math.max(0,Y(t,this.chartWidth)||(1<i.height?i.height:400)),this.containerBox=i}temporaryDisplay(t){let e=this.renderTo;if(t)for(;e&&e.style;)e.hcOrigStyle&&(P(e,e.hcOrigStyle),delete e.hcOrigStyle),e.hcOrigDetached&&(b.body.removeChild(e),e.hcOrigDetached=!1),e=e.parentNode;else for(;e&&e.style&&(b.body.contains(e)||e.parentNode||(e.hcOrigDetached=!0,b.body.appendChild(e)),("none"===B(e,"display",!1)||e.hcOricDetached)&&(e.hcOrigStyle={display:e.style.display,height:e.style.height,overflow:e.style.overflow},t={display:"block",overflow:"hidden"},e!==this.renderTo&&(t.height=0),P(e,t),e.offsetWidth||e.style.setProperty("display","block","important")),e=e.parentNode,e!==b.body););}setClassName(t){this.container.className="highcharts-container "+(t||"")}getContainer(){const t=this.options,e=t.chart;var i=$();let n,s=this.renderTo;s||(this.renderTo=s=e.renderTo),V(s)&&(this.renderTo=s=b.getElementById(s)),s||k(13,!0,this);var r=X(A(s,"data-highcharts-chart"));z(r)&&y[r]&&y[r].hasRendered&&y[r].destroy(),A(s,"data-highcharts-chart",this.index),s.innerHTML=u.emptyHTML,e.skipClone||s.offsetWidth||this.temporaryDisplay(),this.getChartSize(),r=this.chartWidth;const a=this.chartHeight;if(P(s,{overflow:"hidden"}),this.styledMode||(n=O({position:"relative",overflow:"hidden",width:r+"px",height:a+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none"},e.style||{})),this.container=i=C("div",{id:i},n,s),this._cursor=i.style.cursor,this.renderer=new(e.renderer||!S?o.getRendererType(e.renderer):h)(i,r,a,void 0,e.forExport,t.exporting&&t.exporting.allowHTML,this.styledMode),this.containerBox=this.getContainerBox(),m(void 0,this),this.setClassName(e.className),this.styledMode)for(const e in t.defs)this.renderer.definition(t.defs[e]);else this.renderer.setStyle(e.style);this.renderer.chartIndex=this.index,U(this,"afterGetContainer")}getMargins(t){const{spacing:e,margin:i,titleOffset:n}=this;this.resetMargins(),n[0]&&!L(i[0])&&(this.plotTop=Math.max(this.plotTop,n[0]+e[0])),n[2]&&!L(i[2])&&(this.marginBottom=Math.max(this.marginBottom,n[2]+e[2])),this.legend&&this.legend.display&&this.legend.adjustMargins(i,e),U(this,"getMargins"),t||this.getAxisMargins()}getAxisMargins(){const t=this,e=t.axisOffset=[0,0,0,0],i=t.colorAxis,n=t.margin,s=function(t){t.forEach((function(t){t.visible&&t.getOffset()}))};t.hasCartesianSeries?s(t.axes):i&&i.length&&s(i),M.forEach((function(i,s){L(n[s])||(t[i]+=e[s])})),t.setChartSize()}getOptions(){return R(this.userOptions,g)}reflow(t){const e=this;var i=e.options.chart;i=L(i.width)&&L(i.height);const n=e.containerBox,s=e.getContainerBox();delete e.pointer.chartPosition,!i&&!e.isPrinting&&n&&s.width&&(s.width===n.width&&s.height===n.height||(d.clearTimeout(e.reflowTimeout),e.reflowTimeout=Z((function(){e.container&&e.setSize(void 0,void 0,!1)}),t?100:0)),e.containerBox=s)}setReflow(){const t=this;var e=e=>{var i;null!==(i=t.options)&&void 0!==i&&i.chart.reflow&&t.hasLoaded&&t.reflow(e)};"function"==typeof ResizeObserver?new ResizeObserver(e).observe(t.renderTo):(e=E(w,"resize",e),E(this,"destroy",e))}setSize(t,e,i){const n=this,s=n.renderer;n.isResizing+=1,m(i,n),i=s.globalAnimation,n.oldChartHeight=n.chartHeight,n.oldChartWidth=n.chartWidth,void 0!==t&&(n.options.chart.width=t),void 0!==e&&(n.options.chart.height=e),n.getChartSize(),n.styledMode||(i?p:P)(n.container,{width:n.chartWidth+"px",height:n.chartHeight+"px"},i),n.setChartSize(!0),s.setSize(n.chartWidth,n.chartHeight,i),n.axes.forEach((function(t){t.isDirty=!0,t.setScale()})),n.isDirtyLegend=!0,n.isDirtyBox=!0,n.layOutTitles(),n.getMargins(),n.redraw(i),n.oldChartHeight=null,U(n,"resize"),Z((function(){n&&U(n,"endResize",null,(function(){--n.isResizing}))}),f(i).duration)}setChartSize(t){var e=this.inverted;const i=this.renderer;var n=this.chartWidth,s=this.chartHeight;const r=this.options.chart,o=this.spacing,a=this.clipOffset;let l,h,c,d;this.plotLeft=l=Math.round(this.plotLeft),this.plotTop=h=Math.round(this.plotTop),this.plotWidth=c=Math.max(0,Math.round(n-l-this.marginRight)),this.plotHeight=d=Math.max(0,Math.round(s-h-this.marginBottom)),this.plotSizeX=e?d:c,this.plotSizeY=e?c:d,this.plotBorderWidth=r.plotBorderWidth||0,this.spacingBox=i.spacingBox={x:o[3],y:o[0],width:n-o[3]-o[1],height:s-o[0]-o[2]},this.plotBox=i.plotBox={x:l,y:h,width:c,height:d},e=2*Math.floor(this.plotBorderWidth/2),n=Math.ceil(Math.max(e,a[3])/2),s=Math.ceil(Math.max(e,a[0])/2),this.clipBox={x:n,y:s,width:Math.floor(this.plotSizeX-Math.max(e,a[1])/2-n),height:Math.max(0,Math.floor(this.plotSizeY-Math.max(e,a[2])/2-s))},t||(this.axes.forEach((function(t){t.setAxisSize(),t.setAxisTranslation()})),i.alignElements()),U(this,"afterSetChartSize",{skipAxes:t})}resetMargins(){U(this,"resetMargins");const t=this,e=t.options.chart;["margin","spacing"].forEach((function(i){const n=e[i],s=H(n)?n:[n,n,n,n];["Top","Right","Bottom","Left"].forEach((function(n,r){t[i][r]=j(e[i+n],s[r])}))})),M.forEach((function(e,i){t[e]=j(t.margin[i],t.spacing[i])})),t.axisOffset=[0,0,0,0],t.clipOffset=[0,0,0,0]}drawChartBox(){const t=this.options.chart,e=this.renderer,i=this.chartWidth,n=this.chartHeight,s=this.styledMode,r=this.plotBGImage;var o=t.backgroundColor;const a=t.plotBackgroundColor,l=t.plotBackgroundImage,h=this.plotLeft,c=this.plotTop,d=this.plotWidth,u=this.plotHeight,p=this.plotBox,f=this.clipRect,m=this.clipBox;let g,v,_=this.chartBackground,x=this.plotBackground,y=this.plotBorder,b="animate";_||(this.chartBackground=_=e.rect().addClass("highcharts-background").add(),b="attr"),s?g=v=_.strokeWidth():(g=t.borderWidth||0,v=g+(t.shadow?8:0),o={fill:o||"none"},(g||_["stroke-width"])&&(o.stroke=t.borderColor,o["stroke-width"]=g),_.attr(o).shadow(t.shadow)),_[b]({x:v/2,y:v/2,width:i-v-g%2,height:n-v-g%2,r:t.borderRadius}),b="animate",x||(b="attr",this.plotBackground=x=e.rect().addClass("highcharts-plot-background").add()),x[b](p),s||(x.attr({fill:a||"none"}).shadow(t.plotShadow),l&&(r?(l!==r.attr("href")&&r.attr("href",l),r.animate(p)):this.plotBGImage=e.image(l,h,c,d,u).add())),f?f.animate({width:m.width,height:m.height}):this.clipRect=e.clipRect(m),b="animate",y||(b="attr",this.plotBorder=y=e.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),s||y.attr({stroke:t.plotBorderColor,"stroke-width":t.plotBorderWidth||0,fill:"none"}),y[b](y.crisp({x:h,y:c,width:d,height:u},-y.strokeWidth())),this.isDirtyBox=!1,U(this,"afterDrawChartBox")}propFromSeries(){const t=this,e=t.options.chart,i=t.options.series;let n,s,r;["inverted","angular","polar"].forEach((function(o){for(s=T[e.type],r=e[o]||s&&s.prototype[o],n=i&&i.length;!r&&n--;)(s=T[i[n].type])&&s.prototype[o]&&(r=!0);t[o]=r}))}linkSeries(t){const e=this,i=e.series;i.forEach((function(t){t.linkedSeries.length=0})),i.forEach((function(t){let i=t.options.linkedTo;V(i)&&(i=":previous"===i?e.series[t.index-1]:e.get(i))&&i.linkedParent!==t&&(i.linkedSeries.push(t),t.linkedParent=i,i.enabledDataSorting&&t.setDataSortingOptions(),t.visible=j(t.options.visible,i.options.visible,t.visible))})),U(this,"afterLinkSeries",{isUpdating:t})}renderSeries(){this.series.forEach((function(t){t.translate(),t.render()}))}render(){const t=this.axes,e=this.colorAxis,i=this.renderer,n=function(t){t.forEach((function(t){t.visible&&t.render()}))};let s=0;this.setTitle(),U(this,"beforeMargins"),this.getStacks&&this.getStacks(),this.getMargins(!0),this.setChartSize();const r=this.plotWidth;t.some((function(t){if(t.horiz&&t.visible&&t.options.labels.enabled&&t.series.length)return s=21,!0}));const o=this.plotHeight=Math.max(this.plotHeight-s,0);t.forEach((function(t){t.setScale()})),this.getAxisMargins();const a=1.1<r/this.plotWidth,l=1.05<o/this.plotHeight;(a||l)&&(t.forEach((function(t){(t.horiz&&a||!t.horiz&&l)&&t.setTickInterval(!0)})),this.getMargins()),this.drawChartBox(),this.hasCartesianSeries?n(t):e&&e.length&&n(e),this.seriesGroup||(this.seriesGroup=i.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(t){const e=this,i=G(!0,this.options.credits,t);i.enabled&&!this.credits&&(this.credits=this.renderer.text(i.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",(function(){i.href&&(w.location.href=i.href)})).attr({align:i.position.align,zIndex:8}),e.styledMode||this.credits.css(i.style),this.credits.add().align(i.position),this.credits.update=function(t){e.credits=e.credits.destroy(),e.addCredits(t)})}destroy(){const t=this,e=t.axes,i=t.series,n=t.container,s=n&&n.parentNode;let o;for(U(t,"destroy"),t.renderer.forExport?I(y,t):y[t.index]=void 0,r.chartCount--,t.renderTo.removeAttribute("data-highcharts-chart"),q(t),o=e.length;o--;)e[o]=e[o].destroy();for(this.scroller&&this.scroller.destroy&&this.scroller.destroy(),o=i.length;o--;)i[o]=i[o].destroy();"title subtitle chartBackground plotBackground plotBGImage plotBorder seriesGroup clipRect credits pointer rangeSelector legend resetZoomButton tooltip renderer".split(" ").forEach((function(e){const i=t[e];i&&i.destroy&&(t[e]=i.destroy())})),n&&(n.innerHTML=u.emptyHTML,q(n),s&&D(n)),W(t,(function(e,i){delete t[i]}))}firstRender(){const t=this,e=t.options;t.getContainer(),t.resetMargins(),t.setChartSize(),t.propFromSeries(),t.getAxes();const i=F(e.series)?e.series:[];e.series=[],i.forEach((function(e){t.initSeries(e)})),t.linkSeries(),t.setSeriesData(),U(t,"beforeRender"),t.render(),t.pointer.getChartPosition(),t.renderer.imgCount||t.hasLoaded||t.onload(),t.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach((function(t){t&&void 0!==this.index&&t.apply(this,[this])}),this),U(this,"load"),U(this,"render"),L(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){const{options:t,title:e}=this;t&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":(e&&e.element.textContent||"").replace(/</g,"&lt;")}),t.accessibility&&!1===t.accessibility.enabled||k('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(t,e,i){const n=this;let s;return t&&(e=j(e,!0),U(n,"addSeries",{options:t},(function(){s=n.initSeries(t),n.isDirtyLegend=!0,n.linkSeries(),s.enabledDataSorting&&s.setData(t.data,!1),U(n,"afterAddSeries",{series:s}),e&&n.redraw(i)}))),s}addAxis(t,e,i,n){return this.createAxis(e?"xAxis":"yAxis",{axis:t,redraw:i,animation:n})}addColorAxis(t,e,i){return this.createAxis("colorAxis",{axis:t,redraw:e,animation:i})}createAxis(t,i){return t=new e(this,i.axis,t),j(i.redraw,!0)&&this.redraw(i.animation),t}showLoading(t){const e=this,i=e.options,n=i.loading,s=function(){r&&P(r,{left:e.plotLeft+"px",top:e.plotTop+"px",width:e.plotWidth+"px",height:e.plotHeight+"px"})};let r=e.loadingDiv,o=e.loadingSpan;r||(e.loadingDiv=r=C("div",{className:"highcharts-loading highcharts-loading-hidden"},null,e.container)),o||(e.loadingSpan=o=C("span",{className:"highcharts-loading-inner"},null,r),E(e,"redraw",s)),r.className="highcharts-loading",u.setElementHTML(o,j(t,i.lang.loading,"")),e.styledMode||(P(r,O(n.style,{zIndex:10})),P(o,n.labelStyle),e.loadingShown||(P(r,{opacity:0,display:""}),p(r,{opacity:n.style.opacity||.5},{duration:n.showDuration||0}))),e.loadingShown=!0,s()}hideLoading(){const t=this.options,e=this.loadingDiv;e&&(e.className="highcharts-loading highcharts-loading-hidden",this.styledMode||p(e,{opacity:0},{duration:t.loading.hideDuration||100,complete:function(){P(e,{display:"none"})}})),this.loadingShown=!1}update(t,e,i,n){const s=this,r={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},o=t.isResponsiveOptions,a=[];let l,h;U(s,"update",{options:t}),o||s.setResponsive(!1,!0),t=R(t,s.options),s.userOptions=G(s.userOptions,t);var d=t.chart;if(d){if(G(!0,s.options.chart,d),this.setZoomOptions(),"className"in d&&s.setClassName(d.className),"inverted"in d||"polar"in d||"type"in d){s.propFromSeries();var u=!0}"alignTicks"in d&&(u=!0),"events"in d&&x(this,d),W(d,(function(t,e){-1!==s.propsRequireUpdateSeries.indexOf("chart."+e)&&(l=!0),-1!==s.propsRequireDirtyBox.indexOf(e)&&(s.isDirtyBox=!0),-1!==s.propsRequireReflow.indexOf(e)&&(o?s.isDirtyBox=!0:h=!0)})),!s.styledMode&&d.style&&s.renderer.setStyle(s.options.chart.style||{})}!s.styledMode&&t.colors&&(this.options.colors=t.colors),t.time&&(this.time===v&&(this.time=new c(t.time)),G(!0,s.options.time,t.time)),W(t,(function(e,i){s[i]&&"function"==typeof s[i].update?s[i].update(e,!1):"function"==typeof s[r[i]]?s[r[i]](e):"colors"!==i&&-1===s.collectionsWithUpdate.indexOf(i)&&G(!0,s.options[i],t[i]),"chart"!==i&&-1!==s.propsRequireUpdateSeries.indexOf(i)&&(l=!0)})),this.collectionsWithUpdate.forEach((function(e){t[e]&&(K(t[e]).forEach((function(t,n){const r=L(t.id);let o;r&&(o=s.get(t.id)),!o&&s[e]&&(o=s[e][j(t.index,n)])&&(r&&L(o.options.id)||o.options.isInternal)&&(o=void 0),o&&o.coll===e&&(o.update(t,!1),i&&(o.touched=!0)),!o&&i&&s.collectionsWithInit[e]&&(s.collectionsWithInit[e][0].apply(s,[t].concat(s.collectionsWithInit[e][1]||[]).concat([!1])).touched=!0)})),i&&s[e].forEach((function(t){t.touched||t.options.isInternal?delete t.touched:a.push(t)})))})),a.forEach((function(t){t.chart&&t.remove&&t.remove(!1)})),u&&s.axes.forEach((function(t){t.update({},!1)})),l&&s.getSeriesOrderByLinks().forEach((function(t){t.chart&&t.update({},!1)}),this),u=d&&d.width,d=d&&(V(d.height)?Y(d.height,u||s.chartWidth):d.height),h||z(u)&&u!==s.chartWidth||z(d)&&d!==s.chartHeight?s.setSize(u,d,n):j(e,!0)&&s.redraw(n),U(s,"afterUpdate",{options:t,redraw:e,animation:n})}setSubtitle(t,e){this.applyDescription("subtitle",t),this.layOutTitles(e)}setCaption(t,e){this.applyDescription("caption",t),this.layOutTitles(e)}showResetZoom(){function t(){e.zoomOut()}const e=this,i=g.lang,n=e.zooming.resetButton,s=n.theme,r="chart"===n.relativeTo||"spacingBox"===n.relativeTo?null:"scrollablePlotBox";U(this,"beforeShowResetZoom",null,(function(){e.resetZoomButton=e.renderer.button(i.resetZoom,null,null,t,s).attr({align:n.position.align,title:i.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(n.position,!1,r)})),U(this,"afterShowResetZoom")}zoomOut(){U(this,"selection",{resetSelection:!0},this.zoom)}zoom(t){const e=this,i=e.pointer;let n,s=!1;!t||t.resetSelection?(e.axes.forEach((function(t){n=t.zoom()})),i.initiated=!1):t.xAxis.concat(t.yAxis).forEach((function(t){const r=t.axis;(i[r.isXAxis?"zoomX":"zoomY"]&&L(i.mouseDownX)&&L(i.mouseDownY)&&e.isInsidePlot(i.mouseDownX-e.plotLeft,i.mouseDownY-e.plotTop,{axis:r})||!L(e.inverted?i.mouseDownX:i.mouseDownY))&&(n=r.zoom(t.min,t.max),r.displayBtn&&(s=!0))}));const r=e.resetZoomButton;s&&!r?e.showResetZoom():!s&&H(r)&&(e.resetZoomButton=r.destroy()),n&&e.redraw(j(e.options.chart.animation,t&&t.animation,100>e.pointCount))}pan(t,e){const i=this,n=i.hoverPoints;e="object"==typeof e?e:{enabled:e,type:"x"};const s=i.options.chart;s&&s.panning&&(s.panning=e);const r=e.type;let o;U(this,"pan",{originalEvent:t},(function(){n&&n.forEach((function(t){t.setState()}));let e=i.xAxis;"xy"===r?e=e.concat(i.yAxis):"y"===r&&(e=i.yAxis);const s={};e.forEach((function(e){if(e.options.panningEnabled&&!e.options.isInternal){var n=e.horiz,a=t[n?"chartX":"chartY"],l=i[n=n?"mouseDownX":"mouseDownY"],h=e.minPointOffset||0,c=e.reversed&&!i.inverted||!e.reversed&&i.inverted?-1:1,d=e.getExtremes(),u=e.toValue(l-a,!0)+h*c,p=e.toValue(l+e.len-a,!0)-(h*c||e.isXAxis&&e.pointRangePadding||0),f=p<u;c=e.hasVerticalPanning(),l=f?p:u,u=f?u:p;var m=e.panningState;!c||e.isXAxis||m&&!m.isDirty||e.series.forEach((function(t){var e=t.getProcessedData(!0);e=t.getExtremes(e.yData,!0),m||(m={startMin:Number.MAX_VALUE,startMax:-Number.MAX_VALUE}),z(e.dataMin)&&z(e.dataMax)&&(m.startMin=Math.min(j(t.options.threshold,1/0),e.dataMin,m.startMin),m.startMax=Math.max(j(t.options.threshold,-1/0),e.dataMax,m.startMax))})),c=Math.min(j(m&&m.startMin,d.dataMin),h?d.min:e.toValue(e.toPixels(d.min)-e.minPixelPadding)),p=Math.max(j(m&&m.startMax,d.dataMax),h?d.max:e.toValue(e.toPixels(d.max)+e.minPixelPadding)),e.panningState=m,e.isOrdinal||(0<(h=c-l)&&(u+=h,l=c),0<(h=u-p)&&(u=p,l-=h),e.series.length&&l!==d.min&&u!==d.max&&l>=c&&u<=p&&(e.setExtremes(l,u,!1,!1,{trigger:"pan"}),!i.resetZoomButton&&l!==c&&u!==p&&r.match("y")&&(i.showResetZoom(),e.displayBtn=!1),o=!0),s[n]=a)}})),W(s,((t,e)=>{i[e]=t})),o&&i.redraw(!1),P(i.container,{cursor:"move"})}))}}return O(J.prototype,{callbacks:[],collectionsWithInit:{xAxis:[J.prototype.addAxis,[!0]],yAxis:[J.prototype.addAxis,[!1]],series:[J.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:"backgroundColor borderColor borderWidth borderRadius plotBackgroundColor plotBackgroundImage plotBorderColor plotBorderWidth plotShadow shadow".split(" "),propsRequireReflow:"margin marginTop marginRight marginBottom marginLeft spacing spacingTop spacingRight spacingBottom spacingLeft".split(" "),propsRequireUpdateSeries:"chart.inverted chart.polar chart.ignoreHiddenSeries chart.type colors plotOptions time tooltip".split(" ")}),J})),e(i,"Extensions/ScrollablePlotArea.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Axis/Axis.js"],i["Core/Chart/Chart.js"],i["Core/Series/Series.js"],i["Core/Renderer/RendererRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r){const{stop:o}=t,{addEvent:a,createElement:l,defined:h,merge:c,pick:d}=r;a(i,"afterSetChartSize",(function(t){var i=this.options.chart.scrollablePlotArea,n=i&&i.minWidth;let s;i=i&&i.minHeight,this.renderer.forExport||(n?(this.scrollablePixelsX=n=Math.max(0,n-this.chartWidth))&&(this.scrollablePlotBox=this.renderer.scrollablePlotBox=c(this.plotBox),this.plotBox.width=this.plotWidth+=n,this.inverted?this.clipBox.height+=n:this.clipBox.width+=n,s={1:{name:"right",value:n}}):i&&(this.scrollablePixelsY=n=Math.max(0,i-this.chartHeight),h(n)&&(this.scrollablePlotBox=this.renderer.scrollablePlotBox=c(this.plotBox),this.plotBox.height=this.plotHeight+=n,this.inverted?this.clipBox.width+=n:this.clipBox.height+=n,s={2:{name:"bottom",value:n}})),s&&!t.skipAxes&&this.axes.forEach((function(t){s[t.side]?t.getPlotLinePath=function(){let i,n=s[t.side].name,r=this[n];return this[n]=r-s[t.side].value,i=e.prototype.getPlotLinePath.apply(this,arguments),this[n]=r,i}:(t.setAxisSize(),t.setAxisTranslation())})))})),a(i,"render",(function(){this.scrollablePixelsX||this.scrollablePixelsY?(this.setUpScrolling&&this.setUpScrolling(),this.applyFixed()):this.fixedDiv&&this.applyFixed()})),i.prototype.setUpScrolling=function(){const t={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};let e;this.scrollablePixelsX&&(t.overflowX="auto"),this.scrollablePixelsY&&(t.overflowY="auto"),this.scrollingParent=l("div",{className:"highcharts-scrolling-parent"},{position:"relative"},this.renderTo),this.scrollingContainer=l("div",{className:"highcharts-scrolling"},t,this.scrollingParent),a(this.scrollingContainer,"scroll",(()=>{this.pointer&&(delete this.pointer.chartPosition,this.hoverPoint&&(e=this.hoverPoint),this.pointer.runPointActions(void 0,e,!0))})),this.innerContainer=l("div",{className:"highcharts-inner-container"},null,this.scrollingContainer),this.innerContainer.appendChild(this.container),this.setUpScrolling=null},i.prototype.moveFixedElements=function(){let t,e=this.container,i=this.fixedRenderer,n=".highcharts-breadcrumbs-group .highcharts-contextbutton .highcharts-credits .highcharts-legend .highcharts-legend-checkbox .highcharts-navigator-series .highcharts-navigator-xaxis .highcharts-navigator-yaxis .highcharts-navigator .highcharts-reset-zoom .highcharts-drillup-button .highcharts-scrollbar .highcharts-subtitle .highcharts-title".split(" ");this.scrollablePixelsX&&!this.inverted?t=".highcharts-yaxis":this.scrollablePixelsX&&this.inverted||this.scrollablePixelsY&&!this.inverted?t=".highcharts-xaxis":this.scrollablePixelsY&&this.inverted&&(t=".highcharts-yaxis"),t&&n.push(`${t}:not(.highcharts-radial-axis)`,`${t}-labels:not(.highcharts-radial-axis-labels)`),n.forEach((function(t){[].forEach.call(e.querySelectorAll(t),(function(t){(t.namespaceURI===i.SVG_NS?i.box:i.box.parentNode).appendChild(t),t.style.pointerEvents="auto"}))}))},i.prototype.applyFixed=function(){var t=!this.fixedDiv,e=this.options.chart,i=e.scrollablePlotArea,n=s.getRendererType();t?(this.fixedDiv=l("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(e.style&&e.style.zIndex||0)+2,top:0},null,!0),this.scrollingContainer&&this.scrollingContainer.parentNode.insertBefore(this.fixedDiv,this.scrollingContainer),this.renderTo.style.overflow="visible",this.fixedRenderer=e=new n(this.fixedDiv,this.chartWidth,this.chartHeight,this.options.chart.style),this.scrollableMask=e.path().attr({fill:this.options.chart.backgroundColor||"#fff","fill-opacity":d(i.opacity,.85),zIndex:-1}).addClass("highcharts-scrollable-mask").add(),a(this,"afterShowResetZoom",this.moveFixedElements),a(this,"afterApplyDrilldown",this.moveFixedElements),a(this,"afterLayOutTitles",this.moveFixedElements)):this.fixedRenderer.setSize(this.chartWidth,this.chartHeight),(this.scrollableDirty||t)&&(this.scrollableDirty=!1,this.moveFixedElements()),e=this.chartWidth+(this.scrollablePixelsX||0),n=this.chartHeight+(this.scrollablePixelsY||0),o(this.container),this.container.style.width=e+"px",this.container.style.height=n+"px",this.renderer.boxWrapper.attr({width:e,height:n,viewBox:[0,0,e,n].join(" ")}),this.chartBackground.attr({width:e,height:n}),this.scrollingContainer.style.height=this.chartHeight+"px",t&&(i.scrollPositionX&&(this.scrollingContainer.scrollLeft=this.scrollablePixelsX*i.scrollPositionX),i.scrollPositionY&&(this.scrollingContainer.scrollTop=this.scrollablePixelsY*i.scrollPositionY)),n=this.axisOffset,t=this.plotTop-n[0]-1,i=this.plotLeft-n[3]-1,e=this.plotTop+this.plotHeight+n[2]+1,n=this.plotLeft+this.plotWidth+n[1]+1;let r=this.plotLeft+this.plotWidth-(this.scrollablePixelsX||0),h=this.plotTop+this.plotHeight-(this.scrollablePixelsY||0);t=this.scrollablePixelsX?[["M",0,t],["L",this.plotLeft-1,t],["L",this.plotLeft-1,e],["L",0,e],["Z"],["M",r,t],["L",this.chartWidth,t],["L",this.chartWidth,e],["L",r,e],["Z"]]:this.scrollablePixelsY?[["M",i,0],["L",i,this.plotTop-1],["L",n,this.plotTop-1],["L",n,0],["Z"],["M",i,h],["L",i,this.chartHeight],["L",n,this.chartHeight],["L",n,h],["Z"]]:[["M",0,0]],"adjustHeight"!==this.redrawTrigger&&this.scrollableMask.attr({d:t})},a(e,"afterInit",(function(){this.chart.scrollableDirty=!0})),a(n,"show",(function(){this.chart.scrollableDirty=!0}))})),e(i,"Core/Axis/Stacking/StackItem.js",[i["Core/Templating.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{format:n}=t,{series:s}=e,{destroyObjectProperties:r,fireEvent:o,isNumber:a,pick:l}=i;return class{constructor(t,e,i,n,s){const r=t.chart.inverted,o=t.reversed;this.axis=t,t=this.isNegative=!!i!=!!o,this.options=e=e||{},this.x=n,this.cumulative=this.total=null,this.points={},this.hasValidPoints=!1,this.stack=s,this.rightCliff=this.leftCliff=0,this.alignOptions={align:e.align||(r?t?"left":"right":"center"),verticalAlign:e.verticalAlign||(r?"middle":t?"bottom":"top"),y:e.y,x:e.x},this.textAlign=e.textAlign||(r?t?"right":"left":"center")}destroy(){r(this,this.axis)}render(t){const e=this.axis.chart,i=this.options;var s=i.format;s=s?n(s,this,e):i.formatter.call(this),this.label?this.label.attr({text:s,visibility:"hidden"}):(this.label=e.renderer.label(s,null,void 0,i.shape,void 0,void 0,i.useHTML,!1,"stack-labels"),s={r:i.borderRadius||0,text:s,padding:l(i.padding,5),visibility:"hidden"},e.styledMode||(s.fill=i.backgroundColor,s.stroke=i.borderColor,s["stroke-width"]=i.borderWidth,this.label.css(i.style||{})),this.label.attr(s),this.label.added||this.label.add(t)),this.label.labelrank=e.plotSizeY,o(this,"afterRender")}setOffset(t,e,i,n,r,h){const{alignOptions:c,axis:d,label:u,options:p,textAlign:f}=this,m=d.chart;i=this.getStackBox({xOffset:t,width:e,boxBottom:i,boxTop:n,defaultX:r,xAxis:h});var{verticalAlign:g}=c;if(u&&i){n=u.getBBox(),r=u.padding,h="justify"===l(p.overflow,"justify"),c.x=p.x||0,c.y=p.y||0;const{x:t,y:e}=this.adjustStackPosition({labelBox:n,verticalAlign:g,textAlign:f});i.x-=t,i.y-=e,u.align(c,!1,i),(g=m.isInsidePlot(u.alignAttr.x+c.x+t,u.alignAttr.y+c.y+e))||(h=!1),h&&s.prototype.justifyDataLabel.call(d,u,c,u.alignAttr,n,i),u.attr({x:u.alignAttr.x,y:u.alignAttr.y,rotation:p.rotation,rotationOriginX:n.width/2,rotationOriginY:n.height/2}),l(!h&&p.crop,!0)&&(g=a(u.x)&&a(u.y)&&m.isInsidePlot(u.x-r+u.width,u.y)&&m.isInsidePlot(u.x+r,u.y)),u[g?"show":"hide"]()}o(this,"afterSetOffset",{xOffset:t,width:e})}adjustStackPosition({labelBox:t,verticalAlign:e,textAlign:i}){const n={bottom:0,middle:1,top:2,right:1,center:0,left:-1};return{x:t.width/2+t.width/2*n[i],y:t.height/2*n[e]}}getStackBox(t){var e=this.axis;const i=e.chart,{boxTop:n,defaultX:s,xOffset:r,width:o,boxBottom:h}=t;var c=e.stacking.usePercentage?100:l(n,this.total,0);c=e.toPixels(c),t=t.xAxis||i.xAxis[0];const d=l(s,t.translate(this.x))+r;e=e.toPixels(h||a(e.min)&&e.logarithmic&&e.logarithmic.lin2log(e.min)||0),e=Math.abs(c-e);const u=this.isNegative;return i.inverted?{x:(u?c:c-e)-i.plotLeft,y:t.height-d-o,width:e,height:o}:{x:d+t.transB-i.plotLeft,y:(u?c-e:c)-i.plotTop,width:o,height:e}}}})),e(i,"Core/Axis/Stacking/StackingAxis.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Axis/Axis.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Axis/Stacking/StackItem.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s){function r(){const t=this,e=t.inverted;t.yAxis.forEach((t=>{t.stacking&&t.stacking.stacks&&t.hasVisibleSeries&&(t.stacking.oldStacks=t.stacking.stacks)})),t.series.forEach((i=>{const n=i.xAxis&&i.xAxis.options||{};!i.options.stacking||!0!==i.visible&&!1!==t.options.chart.ignoreHiddenSeries||(i.stackKey=[i.type,S(i.options.stack,""),e?n.top:n.left,e?n.height:n.width].join())}))}function o(){const t=this.stacking;if(t){var e=t.stacks;M(e,(function(t,i){_(t),e[i]=null})),t&&t.stackTotalGroup&&t.stackTotalGroup.destroy()}}function a(){"yAxis"!==this.coll||this.stacking||(this.stacking=new w(this))}function l(t,e,i,n){return!v(t)||t.x!==e||n&&t.stackKey!==n?t={x:e,index:0,key:n,stackKey:n}:t.index++,t.key=[i,e,t.index].join(),t}function h(){const t=this,e=t.stackKey,i=t.yAxis.stacking.stacks,n=t.processedXData,s=t[t.options.stacking+"Stacker"];let r;s&&[e,"-"+e].forEach((e=>{let o,a=n.length;for(;a--;){var l=n[a];r=t.getStackIndicator(r,l,t.index,e),(o=(l=i[e]&&i[e][l])&&l.points[r.key])&&s.call(t,o,l,a)}}))}function c(t,e,i){e=e.total?100/e.total:0,t[0]=g(t[0]*e),t[1]=g(t[1]*e),this.stackedYData[i]=t[1]}function d(){const t=this.yAxis.stacking;this.options.centerInCategory&&(this.is("column")||this.is("columnrange"))&&!this.options.stacking&&1<this.chart.series.length?f.setStackedPoints.call(this,"group"):t&&M(t.stacks,((e,i)=>{"group"===i.slice(-5)&&(M(e,(t=>t.destroy())),delete t.stacks[i])}))}function u(t){var e=this.chart;const i=t||this.options.stacking;if(i&&(!0===this.visible||!1===e.options.chart.ignoreHiddenSeries)){var s=this.processedXData,r=this.processedYData,o=[],a=r.length,l=this.options,h=l.threshold,c=S(l.startFromThreshold&&h,0);l=l.stack;var d,u,p="-"+(t=t?`${this.type},${i}`:this.stackKey),f=this.negStacks,m=(e="group"===i?e.yAxis[0]:this.yAxis).stacking.stacks,_=e.stacking.oldStacks;for(e.stacking.stacksTouched+=1,u=0;u<a;u++){var x=s[u],b=r[u],M=this.getStackIndicator(M,x,this.index),w=M.key,T=(d=f&&b<(c?0:h))?p:t;m[T]||(m[T]={}),m[T][x]||(_[T]&&_[T][x]?(m[T][x]=_[T][x],m[T][x].total=null):m[T][x]=new n(e,e.options.stackLabels,!!d,x,l)),T=m[T][x],null!==b?(T.points[w]=T.points[this.index]=[S(T.cumulative,c)],v(T.cumulative)||(T.base=w),T.touched=e.stacking.stacksTouched,0<M.index&&!1===this.singleStacks&&(T.points[w][0]=T.points[this.index+","+x+",0"][0])):T.points[w]=T.points[this.index]=null,"percent"===i?(d=d?t:p,f&&m[d]&&m[d][x]?(d=m[d][x],T.total=d.total=Math.max(d.total,T.total)+Math.abs(b)||0):T.total=g(T.total+(Math.abs(b)||0))):"group"===i?(y(b)&&(b=b[0]),null!==b&&(T.total=(T.total||0)+1)):T.total=g(T.total+(b||0)),T.cumulative="group"===i?(T.total||1)-1:g(S(T.cumulative,c)+(b||0)),null!==b&&(T.points[w].push(T.cumulative),o[u]=T.cumulative,T.hasValidPoints=!0)}"percent"===i&&(e.stacking.usePercentage=!0),"group"!==i&&(this.stackedYData=o),e.stacking.oldStacks={}}}const{getDeferredAnimation:p}=t,{series:{prototype:f}}=i,{addEvent:m,correctFloat:g,defined:v,destroyObjectProperties:_,fireEvent:x,isArray:y,isNumber:b,objectEach:M,pick:S}=s;class w{constructor(t){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=t}buildStacks(){const t=this.axis,e=t.series,i=t.options.reversedStacks,n=e.length;let s,r;for(this.usePercentage=!1,r=n;r--;)s=e[i?r:n-r-1],s.setStackedPoints(),s.setGroupedPoints();for(r=0;r<n;r++)e[r].modifyStacks();x(t,"afterBuildStacks")}cleanStacks(){let t;this.oldStacks&&(t=this.stacks=this.oldStacks),M(t,(function(t){M(t,(function(t){t.cumulative=t.total}))}))}resetStacks(){M(this.stacks,(t=>{M(t,((e,i)=>{b(e.touched)&&e.touched<this.stacksTouched?(e.destroy(),delete t[i]):(e.total=null,e.cumulative=null)}))}))}renderStackTotals(){var t=this.axis;const e=t.chart,i=e.renderer,n=this.stacks;t=p(e,t.options.stackLabels&&t.options.stackLabels.animation||!1);const s=this.stackTotalGroup=this.stackTotalGroup||i.g("stack-labels").attr({zIndex:6,opacity:0}).add();s.translate(e.plotLeft,e.plotTop),M(n,(function(t){M(t,(function(t){t.render(s)}))})),s.animate({opacity:1},t)}}var T;return function(t){const e=[];t.compose=function(t,i,n){s.pushUnique(e,t)&&(m(t,"init",a),m(t,"destroy",o)),s.pushUnique(e,i)&&(i.prototype.getStacks=r),s.pushUnique(e,n)&&((t=n.prototype).getStackIndicator=l,t.modifyStacks=h,t.percentStacker=c,t.setGroupedPoints=d,t.setStackedPoints=u)}}(T||(T={})),T})),e(i,"Series/Line/LineSeries.js",[i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{defined:n,merge:s}=i;class r extends t{constructor(){super(...arguments),this.points=this.options=this.data=void 0}drawGraph(){const t=this,e=this.options,i=(this.gappedPath||this.getGraphPath).call(this),n=this.chart.styledMode;let s=[["graph","highcharts-graph"]];n||s[0].push(e.lineColor||this.color||"#cccccc",e.dashStyle),s=t.getZonesGraphs(s),s.forEach((function(s,r){var o=s[0];let a=t[o];const l=a?"animate":"attr";a?(a.endX=t.preventGraphAnimation?null:i.xMap,a.animate({d:i})):i.length&&(t[o]=a=t.chart.renderer.path(i).addClass(s[1]).attr({zIndex:1}).add(t.group)),a&&!n&&(o={stroke:s[2],"stroke-width":e.lineWidth||0,fill:t.fillGraph&&t.color||"none"},s[3]?o.dashstyle=s[3]:"square"!==e.linecap&&(o["stroke-linecap"]=o["stroke-linejoin"]="round"),a[l](o).shadow(2>r&&e.shadow)),a&&(a.startX=i.xMap,a.isArea=i.isArea)}))}getGraphPath(t,e,i){const s=this,r=s.options,o=[],a=[];let l,h=r.step;const c=(t=t||s.points).reversed;return c&&t.reverse(),(h={right:1,center:2}[h]||h&&3)&&c&&(h=4-h),(t=this.getValidPoints(t,!1,!(r.connectNulls&&!e&&!i))).forEach((function(c,d){const u=c.plotX,p=c.plotY,f=t[d-1],m=c.isNull||"number"!=typeof p;(c.leftCliff||f&&f.rightCliff)&&!i&&(l=!0),m&&!n(e)&&0<d?l=!r.connectNulls:m&&!e?l=!0:(0===d||l?d=[["M",c.plotX,c.plotY]]:s.getPointSpline?d=[s.getPointSpline(t,c,d)]:h?(d=1===h?[["L",f.plotX,p]]:2===h?[["L",(f.plotX+u)/2,f.plotY],["L",(f.plotX+u)/2,p]]:[["L",u,f.plotY]]).push(["L",u,p]):d=[["L",u,p]],a.push(c.x),h&&(a.push(c.x),2===h&&a.push(c.x)),o.push.apply(o,d),l=!1)})),o.xMap=a,s.graphPath=o}getZonesGraphs(t){return this.zones.forEach((function(e,i){i=["zone-graph-"+i,"highcharts-graph highcharts-zone-graph-"+i+" "+(e.className||"")],this.chart.styledMode||i.push(e.color||this.color,e.dashStyle||this.options.dashStyle),t.push(i)}),this),t}}return r.defaultOptions=s(t.defaultOptions,{legendSymbol:"lineMarker"}),e.registerSeriesType("line",r),r})),e(i,"Series/Area/AreaSeries.js",[i["Core/Color/Color.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{seriesTypes:{line:n}}=e,{extend:s,merge:r,objectEach:o,pick:a}=i;class l extends n{constructor(){super(...arguments),this.points=this.options=this.data=void 0}drawGraph(){this.areaPath=[],super.drawGraph.apply(this);const t=this,e=this.areaPath,i=this.options,n=[["area","highcharts-area",this.color,i.fillColor]];this.zones.forEach((function(e,s){n.push(["zone-area-"+s,"highcharts-area highcharts-zone-area-"+s+" "+e.className,e.color||t.color,e.fillColor||i.fillColor])})),n.forEach((function(n){const s=n[0],r={};let o=t[s];const l=o?"animate":"attr";o?(o.endX=t.preventGraphAnimation?null:e.xMap,o.animate({d:e})):(r.zIndex=0,o=t[s]=t.chart.renderer.path(e).addClass(n[1]).add(t.group),o.isArea=!0),t.chart.styledMode||(n[3]?r.fill=n[3]:(r.fill=n[2],r["fill-opacity"]=a(i.fillOpacity,.75))),o[l](r),o.startX=e.xMap,o.shiftUnit=i.step?2:1}))}getGraphPath(t){var e=n.prototype.getGraphPath,i=this.options;const s=i.stacking,r=this.yAxis,o=[],l=[],h=this.index,c=r.stacking.stacks[this.stackKey],d=i.threshold,u=Math.round(r.getThreshold(i.threshold));i=a(i.connectNulls,"percent"===s);var p=function(e,i,n){var a=t[e];e=s&&c[a.x].points[h];const p=a[n+"Null"]||0;let m,g;n=a[n+"Cliff"]||0,a=!0,n||p?(m=(p?e[0]:e[1])+n,g=e[0]+n,a=!!p):!s&&t[i]&&t[i].isNull&&(m=g=d),void 0!==m&&(l.push({plotX:f,plotY:null===m?u:r.getThreshold(m),isNull:a,isCliff:!0}),o.push({plotX:f,plotY:null===g?u:r.getThreshold(g),doCurve:!1}))};let f;t=t||this.points,s&&(t=this.getStackPoints(t));for(let e=0,n=t.length;e<n;++e){s||(t[e].leftCliff=t[e].rightCliff=t[e].leftNull=t[e].rightNull=void 0);var m=t[e].isNull;f=a(t[e].rectPlotX,t[e].plotX);var g=s?a(t[e].yBottom,u):u;m&&!i||(i||p(e,e-1,"left"),m&&!s&&i||(l.push(t[e]),o.push({x:e,plotX:f,plotY:g})),i||p(e,e+1,"right"))}return p=e.call(this,l,!0,!0),o.reversed=!0,(g=(m=e.call(this,o,!0,!0))[0])&&"M"===g[0]&&(m[0]=["L",g[1],g[2]]),(m=p.concat(m)).length&&m.push(["Z"]),e=e.call(this,l,!1,i),m.xMap=p.xMap,this.areaPath=m,e}getStackPoints(t){const e=this,i=[],n=[],s=this.xAxis,r=this.yAxis,l=r.stacking.stacks[this.stackKey],h={},c=r.series,d=c.length,u=r.options.reversedStacks?1:-1,p=c.indexOf(e);if(t=t||this.points,this.options.stacking){for(let e=0;e<t.length;e++)t[e].leftNull=t[e].rightNull=void 0,h[t[e].x]=t[e];o(l,(function(t,e){null!==t.total&&n.push(e)})),n.sort((function(t,e){return t-e}));const f=c.map((t=>t.visible));n.forEach((function(t,o){let m,g,v=0;if(h[t]&&!h[t].isNull)i.push(h[t]),[-1,1].forEach((function(i){const s=1===i?"rightNull":"leftNull",r=l[n[o+i]];let a=0;if(r){let i=p;for(;0<=i&&i<d;){const n=c[i].index;m=r.points[n],m||(n===e.index?h[t][s]=!0:f[i]&&(g=l[t].points[n])&&(a-=g[1]-g[0])),i+=u}}h[t][1===i?"rightCliff":"leftCliff"]=a}));else{let e=p;for(;0<=e&&e<d;){if(m=l[t].points[c[e].index]){v=m[1];break}e+=u}v=a(v,0),v=r.translate(v,0,1,0,1),i.push({isNull:!0,plotX:s.translate(t,0,0,0,1),x:t,plotY:v,yBottom:v})}}))}return i}}return l.defaultOptions=r(n.defaultOptions,{threshold:0,legendSymbol:"rectangle"}),s(l.prototype,{singleStacks:!1}),e.registerSeriesType("area",l),l})),e(i,"Series/Spline/SplineSeries.js",[i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e){const{line:i}=t.seriesTypes,{merge:n,pick:s}=e;class r extends i{constructor(){super(...arguments),this.points=this.options=this.data=void 0}getPointSpline(t,e,i){const n=e.plotX||0,r=e.plotY||0,o=t[i-1];let a,l,h;if(i=t[i+1],o&&!o.isNull&&!1!==o.doCurve&&!e.isCliff&&i&&!i.isNull&&!1!==i.doCurve&&!e.isCliff){t=o.plotY||0;var c=i.plotX||0;i=i.plotY||0;let s=0;a=(1.5*n+(o.plotX||0))/2.5,l=(1.5*r+t)/2.5,h=(1.5*r+i)/2.5,(c=(1.5*n+c)/2.5)!==a&&(s=(h-l)*(c-n)/(c-a)+r-h),l+=s,h+=s,l>t&&l>r?(l=Math.max(t,r),h=2*r-l):l<t&&l<r&&(l=Math.min(t,r),h=2*r-l),h>i&&h>r?(h=Math.max(i,r),l=2*r-h):h<i&&h<r&&(h=Math.min(i,r),l=2*r-h),e.rightContX=c,e.rightContY=h}return e=["C",s(o.rightContX,o.plotX,0),s(o.rightContY,o.plotY,0),s(a,n,0),s(l,r,0),n,r],o.rightContX=o.rightContY=void 0,e}}return r.defaultOptions=n(i.defaultOptions),t.registerSeriesType("spline",r),r})),e(i,"Series/AreaSpline/AreaSplineSeries.js",[i["Series/Spline/SplineSeries.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{area:n,area:{prototype:s}}=e.seriesTypes,{extend:r,merge:o}=i;class a extends t{constructor(){super(...arguments),this.options=this.points=this.data=void 0}}return a.defaultOptions=o(t.defaultOptions,n.defaultOptions),r(a.prototype,{getGraphPath:s.getGraphPath,getStackPoints:s.getStackPoints,drawGraph:s.drawGraph}),e.registerSeriesType("areaspline",a),a})),e(i,"Series/Column/ColumnSeriesDefaults.js",[],(function(){return{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}})),e(i,"Series/Column/ColumnSeries.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Color/Color.js"],i["Series/Column/ColumnSeriesDefaults.js"],i["Core/Globals.js"],i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r,o){const{animObject:a}=t,{parse:l}=e,{hasTouch:h,noop:c}=n,{clamp:d,defined:u,extend:p,fireEvent:f,isArray:m,isNumber:g,merge:v,pick:_,objectEach:x}=o;class y extends s{constructor(){super(...arguments),this.points=this.options=this.group=this.data=this.borderWidth=void 0}animate(t){const e=this,i=this.yAxis,n=i.pos,s=e.options,r=this.chart.inverted,o={},l=r?"translateX":"translateY";let h;t?(o.scaleY=.001,t=d(i.toPixels(s.threshold),n,n+i.len),r?o.translateX=t-i.len:o.translateY=t,e.clipBox&&e.setClip(),e.group.attr(o)):(h=Number(e.group.attr(l)),e.group.animate({scaleY:1},p(a(e.options.animation),{step:function(t,i){e.group&&(o[l]=h+i.pos*(n-h),e.group.attr(o))}})))}init(t,e){super.init.apply(this,arguments);const i=this;(t=i.chart).hasRendered&&t.series.forEach((function(t){t.type===i.type&&(t.isDirty=!0)}))}getColumnMetrics(){const t=this;var e=t.options;const i=t.xAxis,n=t.yAxis;var s=i.options.reversedStacks;s=i.reversed&&!s||!i.reversed&&s;const r={};let o,a=0;!1===e.grouping?a=1:t.chart.series.forEach((function(e){const i=e.yAxis,s=e.options;let l;e.type!==t.type||!e.visible&&t.chart.options.chart.ignoreHiddenSeries||n.len!==i.len||n.pos!==i.pos||(s.stacking&&"group"!==s.stacking?(o=e.stackKey,void 0===r[o]&&(r[o]=a++),l=r[o]):!1!==s.grouping&&(l=a++),e.columnIndex=l)}));const l=Math.min(Math.abs(i.transA)*(i.ordinal&&i.ordinal.slope||e.pointRange||i.closestPointRange||i.tickInterval||1),i.len),h=l*e.groupPadding,c=(l-2*h)/(a||1);return e=Math.min(e.maxPointWidth||i.len,_(e.pointWidth,c*(1-2*e.pointPadding))),t.columnMetrics={width:e,offset:(c-e)/2+(h+((t.columnIndex||0)+(s?1:0))*c-l/2)*(s?-1:1),paddedWidth:c,columnCount:a},t.columnMetrics}crispCol(t,e,i,n){var s=this.borderWidth,r=-(s%2?.5:0);return s=s%2?.5:1,this.options.crisp&&(i=Math.round(t+i)+r,i-=t=Math.round(t)+r),n=Math.round(e+n)+s,r=.5>=Math.abs(e)&&.5<n,n-=e=Math.round(e)+s,r&&n&&(--e,n+=1),{x:t,y:e,width:i,height:n}}adjustForMissingColumns(t,e,i,n){const s=this.options.stacking;if(!i.isNull&&1<n.columnCount){const r=this.yAxis.options.reversedStacks;let o=0,a=r?0:-n.columnCount;x(this.yAxis.stacking&&this.yAxis.stacking.stacks,(t=>{if("number"==typeof i.x){const e=t[i.x.toString()];e&&(t=e.points[this.index],s?(t&&(o=a),e.hasValidPoints&&(r?a++:a--)):m(t)&&(t=Object.keys(e.points).filter((t=>!t.match(",")&&e.points[t]&&1<e.points[t].length)).map(parseFloat).sort(((t,e)=>e-t)),o=t.indexOf(this.index),a=t.length))}})),t=(i.plotX||0)+((a-1)*n.paddedWidth+e)/2-e-o*n.paddedWidth}return t}translate(){const t=this,e=t.chart,i=t.options;var n=t.dense=2>t.closestPointRange*t.xAxis.transA;n=t.borderWidth=_(i.borderWidth,n?0:1);const r=t.xAxis,o=t.yAxis,a=i.threshold,l=_(i.minPointLength,5),h=t.getColumnMetrics(),c=h.width,p=t.pointXOffset=h.offset,m=t.dataMin,v=t.dataMax;let x=t.barW=Math.max(c,1+2*n),y=t.translatedThreshold=o.getThreshold(a);e.inverted&&(y-=.5),i.pointPadding&&(x=Math.ceil(x)),s.prototype.translate.apply(t),t.points.forEach((function(n){const s=_(n.yBottom,y);var f=999+Math.abs(s),b=n.plotX||0;f=d(n.plotY,-f,o.len+f);let M=Math.min(f,s),S=Math.max(f,s)-M,w=c,T=b+p,E=x;l&&Math.abs(S)<l&&(S=l,b=!o.reversed&&!n.negative||o.reversed&&n.negative,g(a)&&g(v)&&n.y===a&&v<=a&&(o.min||0)<a&&(m!==v||(o.max||0)<=a)&&(b=!b,n.negative=!n.negative),M=Math.abs(M-y)>l?s-l:y-(b?l:0)),u(n.options.pointWidth)&&(w=E=Math.ceil(n.options.pointWidth),T-=Math.round((w-c)/2)),i.centerInCategory&&(T=t.adjustForMissingColumns(T,w,n,h)),n.barX=T,n.pointWidth=w,n.tooltipPos=e.inverted?[d(o.len+o.pos-e.plotLeft-f,o.pos-e.plotLeft,o.len+o.pos-e.plotLeft),r.len+r.pos-e.plotTop-T-E/2,S]:[r.left-e.plotLeft+T+E/2,d(f+o.pos-e.plotTop,o.pos-e.plotTop,o.len+o.pos-e.plotTop),S],n.shapeType=t.pointClass.prototype.shapeType||"roundedRect",n.shapeArgs=t.crispCol(T,n.isNull?y:M,E,n.isNull?0:S)})),f(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(t,e){const i=this.options;var n=this.pointAttrToOptions||{},s=n.stroke||"borderColor";const r=n["stroke-width"]||"borderWidth";let o,a=t&&t.color||this.color,h=t&&t[s]||i[s]||a;n=t&&t.options.dashStyle||i.dashStyle;let c=t&&t[r]||i[r]||this[r]||0,d=_(t&&t.opacity,i.opacity,1);return t&&this.zones.length&&(o=t.getZone(),a=t.options.color||o&&(o.color||t.nonZonedColor)||this.color,o&&(h=o.borderColor||h,n=o.dashStyle||n,c=o.borderWidth||c)),e&&t&&(e=(t=v(i.states[e],t.options.states&&t.options.states[e]||{})).brightness,a=t.color||void 0!==e&&l(a).brighten(t.brightness).get()||a,h=t[s]||h,c=t[r]||c,n=t.dashStyle||n,d=_(t.opacity,d)),s={fill:a,stroke:h,"stroke-width":c,opacity:d},n&&(s.dashstyle=n),s}drawPoints(t=this.points){const e=this,i=this.chart,n=e.options,s=i.renderer,r=n.animationLimit||250;let o;t.forEach((function(t){let a=t.graphic,l=!!a,h=a&&i.pointCount<r?"animate":"attr";g(t.plotY)&&null!==t.y?(o=t.shapeArgs,a&&t.hasNewShapeType()&&(a=a.destroy()),e.enabledDataSorting&&(t.startXPos=e.xAxis.reversed?-(o&&o.width||0):e.xAxis.width),a||(t.graphic=a=s[t.shapeType](o).add(t.group||e.group))&&e.enabledDataSorting&&i.hasRendered&&i.pointCount<r&&(a.attr({x:t.startXPos}),l=!0,h="animate"),a&&l&&a[h](v(o)),i.styledMode||a[h](e.pointAttribs(t,t.selected&&"select")).shadow(!1!==t.allowShadow&&n.shadow),a&&(a.addClass(t.getClassName(),!0),a.attr({visibility:t.visible?"inherit":"hidden"}))):a&&(t.graphic=a.destroy())}))}drawTracker(t=this.points){const e=this,i=e.chart,n=i.pointer,s=function(t){const i=n.getPointFromEvent(t);void 0!==i&&e.options.enableMouseTracking&&(n.isDirectTouch=!0,i.onMouseOver(t))};let r;t.forEach((function(t){r=m(t.dataLabels)?t.dataLabels:t.dataLabel?[t.dataLabel]:[],t.graphic&&(t.graphic.element.point=t),r.forEach((function(e){e.div?e.div.point=t:e.element.point=t}))})),e._hasTracking||(e.trackerGroups.forEach((function(t){e[t]&&(e[t].addClass("highcharts-tracker").on("mouseover",s).on("mouseout",(function(t){n.onTrackerMouseOut(t)})),h&&e[t].on("touchstart",s),!i.styledMode&&e.options.cursor&&e[t].css({cursor:e.options.cursor}))})),e._hasTracking=!0),f(this,"afterDrawTracker")}remove(){const t=this,e=t.chart;e.hasRendered&&e.series.forEach((function(e){e.type===t.type&&(e.isDirty=!0)})),s.prototype.remove.apply(t,arguments)}}return y.defaultOptions=v(s.defaultOptions,i),p(y.prototype,{cropShoulder:0,directTouch:!0,getSymbol:c,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),r.registerSeriesType("column",y),y})),e(i,"Core/Series/DataLabel.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Templating.js"],i["Core/Utilities.js"]],(function(t,e,i){const{getDeferredAnimation:n}=t,{format:s}=e,{defined:r,extend:o,fireEvent:a,isArray:l,isString:h,merge:c,objectEach:d,pick:u,splat:p}=i;var f;return function(t){function e(t,e,i,n,s){const a=this.chart;var l=this.isCartesian&&a.inverted;const h=this.enabledDataSorting;var c=t.plotX,d=t.plotY;const p=i.rotation;var f=i.align;d=r(c)&&r(d)&&a.isInsidePlot(c,Math.round(d),{inverted:l,paneCoordinates:!0,series:this});let m="justify"===u(i.overflow,h?"none":"justify");if(l=this.visible&&!1!==t.visible&&r(c)&&(t.series.forceDL||h&&!m||d||u(i.inside,!!this.options.stacking)&&n&&a.isInsidePlot(c,l?n.x+1:n.y+n.height-1,{inverted:l,paneCoordinates:!0,series:this})),c=t.pos(),l&&c){p&&e.attr({align:f}),f=e.getBBox(!0);var g=[0,0],v=a.renderer.fontMetrics(e).b;if(n=o({x:c[0],y:Math.round(c[1]),width:0,height:0},n),o(i,{width:f.width,height:f.height}),p?(m=!1,g=a.renderer.rotCorr(v,p),v={x:n.x+(i.x||0)+n.width/2+g.x,y:n.y+(i.y||0)+{top:0,middle:.5,bottom:1}[i.verticalAlign]*n.height},g=[f.x-Number(e.attr("x")),f.y-Number(e.attr("y"))],h&&this.xAxis&&!m&&this.setDataLabelStartPos(t,e,s,d,v),e[s?"attr":"animate"](v)):(h&&this.xAxis&&!m&&this.setDataLabelStartPos(t,e,s,d,n),e.align(i,void 0,n),v=e.alignAttr),m&&0<=n.height)this.justifyDataLabel(e,i,v,f,n,s);else if(u(i.crop,!0)){let{x:t,y:e}=v;t+=g[0],e+=g[1],l=a.isInsidePlot(t,e,{paneCoordinates:!0,series:this})&&a.isInsidePlot(t+f.width,e+f.height,{paneCoordinates:!0,series:this})}i.shape&&!p&&e[s?"attr":"animate"]({anchorX:c[0],anchorY:c[1]})}s&&h&&(e.placed=!1),l||h&&!m?e.show():(e.hide(),e.placed=!1)}function f(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function m(t){const e=this.hasRendered||0,i=this.initDataLabelsGroup().attr({opacity:+e});return!e&&i&&(this.visible&&i.show(),this.options.animation?i.animate({opacity:1},t):i.attr({opacity:1})),i}function g(t=this.points){var e,i;const o=this,c=o.chart,f=o.options,m=c.renderer,{backgroundColor:g,plotBackgroundColor:v}=c.options.chart,x=c.options.plotOptions,y=m.getContrast(h(v)&&v||h(g)&&g||"#000000");let b,M,S=f.dataLabels;var w=p(S)[0];const T=w.animation;w=w.defer?n(c,T,o):{defer:0,duration:0},S=_(_(null===(e=null==x?void 0:x.series)||void 0===e?void 0:e.dataLabels,null===(i=null==x?void 0:x[o.type])||void 0===i?void 0:i.dataLabels),S),a(this,"drawDataLabels"),(l(S)||S.enabled||o._hasPointLabels)&&(M=this.initDataLabels(w),t.forEach((t=>{var e;const i=t.dataLabels||[];for(b=p(_(S,t.dlOptions||(null===(e=t.options)||void 0===e?void 0:e.dataLabels))),b.forEach(((e,n)=>{var a,l=e.enabled&&(!t.isNull||t.dataLabelOnNull)&&function(t,e){var i=e.filter;return!i||(e=i.operator,t=t[i.property],i=i.value,">"===e&&t>i||"<"===e&&t<i||">="===e&&t>=i||"<="===e&&t<=i||"=="===e&&t==i||"==="===e&&t===i)}(t,e);const p=t.connectors?t.connectors[n]:t.connector,g=e.style||{};let v={},_=i[n],x=!_;const b=u(e.distance,t.labelDistance);if(l){var S=u(e[t.formatPrefix+"Format"],e.format),w=t.getLabelConfig();if(w=r(S)?s(S,w,c):(e[t.formatPrefix+"Formatter"]||e.formatter).call(w,e),S=e.rotation,c.styledMode||(g.color=u(e.color,g.color,h(o.color)?o.color:void 0,"#000000"),"contrast"===g.color?(t.contrastColor=m.getContrast(t.color||o.color),g.color=!r(b)&&e.inside||0>(b||0)||f.stacking?t.contrastColor:y):delete t.contrastColor,f.cursor&&(g.cursor=f.cursor)),v={r:e.borderRadius||0,rotation:S,padding:e.padding,zIndex:1},!c.styledMode){const{backgroundColor:i,borderColor:n}=e;v.fill="auto"===i?t.color:i,v.stroke="auto"===n?t.color:n,v["stroke-width"]=e.borderWidth}d(v,((t,e)=>{void 0===t&&delete v[e]}))}!_||l&&r(w)&&!!_.div==!!e.useHTML&&(_.rotation&&e.rotation||_.rotation===e.rotation)||(_=void 0,x=!0,p&&t.connector&&(t.connector=t.connector.destroy(),t.connectors&&(1===t.connectors.length?delete t.connectors:delete t.connectors[n]))),l&&r(w)&&(_?v.text=w:(_=S?m.text(w,0,0,e.useHTML).addClass("highcharts-data-label"):m.label(w,0,0,e.shape,void 0,void 0,e.useHTML,void 0,"data-label"))&&_.addClass(" highcharts-data-label-color-"+t.colorIndex+" "+(e.className||"")+(e.useHTML?" highcharts-tracker":"")),_&&(_.options=e,_.attr(v),c.styledMode||_.css(g).shadow(e.shadow),(l=e[t.formatPrefix+"TextPath"]||e.textPath)&&!e.useHTML&&(_.setTextPath((null===(a=t.getDataLabelPath)||void 0===a?void 0:a.call(t,_))||t.graphic,l),t.dataLabelPath&&!l.enabled&&(t.dataLabelPath=t.dataLabelPath.destroy())),_.added||_.add(M),o.alignDataLabel(t,_,e,void 0,x),_.isActive=!0,i[n]&&i[n]!==_&&i[n].destroy(),i[n]=_))})),e=i.length;e--;)i[e].isActive?i[e].isActive=!1:(i[e].destroy(),i.splice(e,1));t.dataLabel=i[0],t.dataLabels=i}))),a(this,"afterDrawDataLabels")}function v(t,e,i,n,s,r){const o=this.chart,a=e.align,l=e.verticalAlign,h=t.box?0:t.padding||0;let c,d,{x:u=0,y:p=0}=e;return c=(i.x||0)+h,0>c&&("right"===a&&0<=u?(e.align="left",e.inside=!0):u-=c,d=!0),c=(i.x||0)+n.width-h,c>o.plotWidth&&("left"===a&&0>=u?(e.align="right",e.inside=!0):u+=o.plotWidth-c,d=!0),c=i.y+h,0>c&&("bottom"===l&&0<=p?(e.verticalAlign="top",e.inside=!0):p-=c,d=!0),c=(i.y||0)+n.height-h,c>o.plotHeight&&("top"===l&&0>=p?(e.verticalAlign="bottom",e.inside=!0):p+=o.plotHeight-c,d=!0),d&&(e.x=u,e.y=p,t.placed=!r,t.align(e,void 0,s)),d}function _(t,e){let i,n=[];if(l(t)&&!l(e))n=t.map((function(t){return c(t,e)}));else if(l(e)&&!l(t))n=e.map((function(e){return c(t,e)}));else if(l(t)||l(e)){if(l(t)&&l(e))for(i=Math.max(t.length,e.length);i--;)n[i]=c(t[i],e[i])}else n=c(t,e);return n}function x(t,e,i,n,s){const r=this.chart,o=r.inverted,a=this.xAxis,l=a.reversed,h=o?e.height/2:e.width/2;t=(t=t.pointWidth)?t/2:0,e.startXPos=o?s.x:l?-h-t:a.width-h+t,e.startYPos=o?l?this.yAxis.height-h+t:-h-t:s.y,n?"hidden"===e.visibility&&(e.show(),e.attr({opacity:0}).animate({opacity:1})):e.attr({opacity:1}).animate({opacity:0},void 0,e.hide),r.hasRendered&&(i&&e.attr({x:e.startXPos,y:e.startYPos}),e.placed=!0)}const y=[];t.compose=function(t){i.pushUnique(y,t)&&((t=t.prototype).initDataLabelsGroup=f,t.initDataLabels=m,t.alignDataLabel=e,t.drawDataLabels=g,t.justifyDataLabel=v,t.setDataLabelStartPos=x)}}(f||(f={})),f})),e(i,"Series/Column/ColumnDataLabel.js",[i["Core/Series/DataLabel.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{series:n}=e,{merge:s,pick:r}=i;var o;return function(e){function o(t,e,i,o,a){let l=this.chart.inverted;var h=t.series;let c=(h.xAxis?h.xAxis.len:this.chart.plotSizeX)||0;h=(h.yAxis?h.yAxis.len:this.chart.plotSizeY)||0;var d=t.dlBox||t.shapeArgs;let u=r(t.below,t.plotY>r(this.translatedThreshold,h)),p=r(i.inside,!!this.options.stacking);d&&(0>(o=s(d)).y&&(o.height+=o.y,o.y=0),0<(d=o.y+o.height-h)&&d<o.height&&(o.height-=d),l&&(o={x:h-o.y-o.height,y:c-o.x-o.width,width:o.height,height:o.width}),p||(l?(o.x+=u?0:o.width,o.width=0):(o.y+=u?o.height:0,o.height=0))),i.align=r(i.align,!l||p?"center":u?"right":"left"),i.verticalAlign=r(i.verticalAlign,l||p?"middle":u?"top":"bottom"),n.prototype.alignDataLabel.call(this,t,e,i,o,a),i.inside&&t.contrastColor&&e.css({color:t.contrastColor})}const a=[];e.compose=function(e){t.compose(n),i.pushUnique(a,e)&&(e.prototype.alignDataLabel=o)}}(o||(o={})),o})),e(i,"Series/Bar/BarSeries.js",[i["Series/Column/ColumnSeries.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{extend:n,merge:s}=i;class r extends t{constructor(){super(...arguments),this.points=this.options=this.data=void 0}}return r.defaultOptions=s(t.defaultOptions,{}),n(r.prototype,{inverted:!0}),e.registerSeriesType("bar",r),r})),e(i,"Series/Scatter/ScatterSeriesDefaults.js",[],(function(){return{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}})),e(i,"Series/Scatter/ScatterSeries.js",[i["Series/Scatter/ScatterSeriesDefaults.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i){const{column:n,line:s}=e.seriesTypes,{addEvent:r,extend:o,merge:a}=i;class l extends s{constructor(){super(...arguments),this.points=this.options=this.data=void 0}applyJitter(){const t=this,e=this.options.jitter,i=this.points.length;e&&this.points.forEach((function(n,s){["x","y"].forEach((function(r,o){let a,l,h="plot"+r.toUpperCase();if(e[r]&&!n.isNull){var c=t[r+"Axis"];l=e[r]*c.transA,c&&!c.isLog&&(a=Math.max(0,n[h]-l),c=Math.min(c.len,n[h]+l),o=1e4*Math.sin(s+o*i),o-=Math.floor(o),n[h]=a+(c-a)*o,"x"===r&&(n.clientX=n.plotX))}}))}))}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}return l.defaultOptions=a(s.defaultOptions,t),o(l.prototype,{drawTracker:n.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1}),r(l,"afterTranslate",(function(){this.applyJitter()})),e.registerSeriesType("scatter",l),l})),e(i,"Series/CenteredUtilities.js",[i["Core/Globals.js"],i["Core/Series/Series.js"],i["Core/Utilities.js"]],(function(t,e,i){const{deg2rad:n}=t,{fireEvent:s,isNumber:r,pick:o,relativeLength:a}=i;var l;return function(t){t.getCenter=function(){var t=this.options,i=this.chart;const n=2*(t.slicedOffset||0),l=i.plotWidth-2*n,h=i.plotHeight-2*n;var c=t.center;const d=Math.min(l,h),u=t.thickness;var p=t.size;let f=t.innerSize||0;for("string"==typeof p&&(p=parseFloat(p)),"string"==typeof f&&(f=parseFloat(f)),t=[o(c[0],"50%"),o(c[1],"50%"),o(p&&0>p?void 0:t.size,"100%"),o(f&&0>f?void 0:t.innerSize||0,"0%")],!i.angular||this instanceof e||(t[3]=0),c=0;4>c;++c)p=t[c],i=2>c||2===c&&/%$/.test(p),t[c]=a(p,[l,h,d,t[2]][c])+(i?n:0);return t[3]>t[2]&&(t[3]=t[2]),r(u)&&2*u<t[2]&&0<u&&(t[3]=t[2]-2*u),s(this,"afterGetCenter",{positions:t}),t},t.getStartAndEndRadians=function(t,e){return t=r(t)?t:0,e=r(e)&&e>t&&360>e-t?e:t+360,{start:n*(t+-90),end:n*(e+-90)}}}(l||(l={})),l})),e(i,"Series/Pie/PiePoint.js",[i["Core/Animation/AnimationUtilities.js"],i["Core/Series/Point.js"],i["Core/Utilities.js"]],(function(t,e,i){const{setAnimation:n}=t,{addEvent:s,defined:r,extend:o,isNumber:a,pick:l,relativeLength:h}=i;class c extends e{constructor(){super(...arguments),this.series=this.options=this.labelDistance=void 0}getConnectorPath(){const t=this.labelPosition,e=this.series.options.dataLabels,i=this.connectorShapes;let n=e.connectorShape;return i[n]&&(n=i[n]),n.call(this,{x:t.computed.x,y:t.computed.y,alignment:t.alignment},t.connectorPosition,e)}getTranslate(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}}haloPath(t){const e=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(e.x,e.y,e.r+t,e.r+t,{innerR:e.r-1,start:e.start,end:e.end,borderRadius:e.borderRadius})}init(){super.init.apply(this,arguments),this.name=l(this.name,"Slice");const t=t=>{this.slice("select"===t.type)};return s(this,"select",t),s(this,"unselect",t),this}isValid(){return a(this.y)&&0<=this.y}setVisible(t,e){const i=this.series,n=i.chart,s=i.options.ignoreHiddenPoint;e=l(e,s),t!==this.visible&&(this.visible=this.options.visible=t=void 0===t?!this.visible:t,i.options.data[i.data.indexOf(this)]=this.options,["graphic","dataLabel","connector"].forEach((e=>{this[e]&&this[e][t?"show":"hide"](t)})),this.legendItem&&n.legend.colorizeItem(this,t),t||"hover"!==this.state||this.setState(""),s&&(i.isDirty=!0),e&&n.redraw())}slice(t,e,i){const s=this.series;n(i,s.chart),l(e,!0),this.sliced=this.options.sliced=r(t)?t:!this.sliced,s.options.data[s.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}return o(c.prototype,{connectorShapes:{fixedOffset:function(t,e,i){const n=e.breakAt;return e=e.touchingSliceAt,[["M",t.x,t.y],i.softConnector?["C",t.x+("left"===t.alignment?-5:5),t.y,2*n.x-e.x,2*n.y-e.y,n.x,n.y]:["L",n.x,n.y],["L",e.x,e.y]]},straight:function(t,e){return e=e.touchingSliceAt,[["M",t.x,t.y],["L",e.x,e.y]]},crookedLine:function(t,e,i){const{breakAt:n,touchingSliceAt:s}=e;({series:e}=this);const[r,o,a]=e.center,l=a/2,c=e.chart.plotWidth,d=e.chart.plotLeft;e="left"===t.alignment;const{x:u,y:p}=t;return i.crookDistance?(t=h(i.crookDistance,1),t=e?r+l+(c+d-r-l)*(1-t):d+(r-l)*t):t=r+(o-p)*Math.tan((this.angle||0)-Math.PI/2),i=[["M",u,p]],(e?t<=u&&t>=n.x:t>=u&&t<=n.x)&&i.push(["L",t,p]),i.push(["L",n.x,n.y],["L",s.x,s.y]),i}}}),c})),e(i,"Series/Pie/PieSeriesDefaults.js",[],(function(){return{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}})),e(i,"Series/Pie/PieSeries.js",[i["Series/CenteredUtilities.js"],i["Series/Column/ColumnSeries.js"],i["Core/Globals.js"],i["Series/Pie/PiePoint.js"],i["Series/Pie/PieSeriesDefaults.js"],i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Renderer/SVG/Symbols.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r,o,a,l){const{getStartAndEndRadians:h}=t;({noop:i}=i);const{clamp:c,extend:d,fireEvent:u,merge:p,pick:f,relativeLength:m}=l;class g extends r{constructor(){super(...arguments),this.points=this.options=this.maxLabelDistance=this.data=this.center=void 0}animate(t){const e=this,i=e.points,n=e.startAngleRad;t||i.forEach((function(t){const i=t.graphic,s=t.shapeArgs;i&&s&&(i.attr({r:f(t.startR,e.center&&e.center[3]/2),start:n,end:n}),i.animate({r:s.r,start:s.start,end:s.end},e.options.animation))}))}drawEmpty(){const t=this.startAngleRad,e=this.endAngleRad,i=this.options;let n,s;0===this.total&&this.center?(n=this.center[0],s=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(n,s,this.center[1]/2,0,t,e).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:a.arc(n,s,this.center[2]/2,0,{start:t,end:e,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":i.borderWidth,fill:i.fillColor||"none",stroke:i.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){const t=this.chart.renderer;this.points.forEach((function(e){e.graphic&&e.hasNewShapeType()&&(e.graphic=e.graphic.destroy()),e.graphic||(e.graphic=t[e.shapeType](e.shapeArgs).add(e.series.group),e.delayedRendering=!0)}))}generatePoints(){super.generatePoints(),this.updateTotals()}getX(t,e,i){const n=this.center,s=this.radii?this.radii[i.index]||0:n[2]/2;return t=Math.asin(c((t-n[1])/(s+i.labelDistance),-1,1)),n[0]+(e?-1:1)*Math.cos(t)*(s+i.labelDistance)+(0<i.labelDistance?(e?-1:1)*this.options.dataLabels.padding:0)}hasData(){return!!this.processedXData.length}redrawPoints(){const t=this,e=t.chart;let i,n,s,r;this.drawEmpty(),t.group&&!e.styledMode&&t.group.shadow(t.options.shadow),t.points.forEach((function(o){const a={};n=o.graphic,!o.isNull&&n?(r=o.shapeArgs,i=o.getTranslate(),e.styledMode||(s=t.pointAttribs(o,o.selected&&"select")),o.delayedRendering?(n.setRadialReference(t.center).attr(r).attr(i),e.styledMode||n.attr(s).attr({"stroke-linejoin":"round"}),o.delayedRendering=!1):(n.setRadialReference(t.center),e.styledMode||p(!0,a,s),p(!0,a,r,i),n.animate(a)),n.attr({visibility:o.visible?"inherit":"hidden"}),n.addClass(o.getClassName(),!0)):n&&(o.graphic=n.destroy())}))}sortByAngle(t,e){t.sort((function(t,i){return void 0!==t.angle&&(i.angle-t.angle)*e}))}translate(t){u(this,"translate"),this.generatePoints();var e=this.options;const i=e.slicedOffset,n=i+(e.borderWidth||0);var s=h(e.startAngle,e.endAngle);const r=this.startAngleRad=s.start;s=(this.endAngleRad=s.end)-r;const o=this.points,a=e.dataLabels.distance;e=e.ignoreHiddenPoint;const l=o.length;let c,d,p,g=0;for(t||(this.center=t=this.getCenter()),d=0;d<l;d++){p=o[d];var v=r+g*s;!p.isValid()||e&&!p.visible||(g+=p.percentage/100);var _=r+g*s,x={x:t[0],y:t[1],r:t[2]/2,innerR:t[3]/2,start:Math.round(1e3*v)/1e3,end:Math.round(1e3*_)/1e3};p.shapeType="arc",p.shapeArgs=x,p.labelDistance=f(p.options.dataLabels&&p.options.dataLabels.distance,a),p.labelDistance=m(p.labelDistance,x.r),this.maxLabelDistance=Math.max(this.maxLabelDistance||0,p.labelDistance),(_=(_+v)/2)>1.5*Math.PI?_-=2*Math.PI:_<-Math.PI/2&&(_+=2*Math.PI),p.slicedTranslation={translateX:Math.round(Math.cos(_)*i),translateY:Math.round(Math.sin(_)*i)},x=Math.cos(_)*t[2]/2,c=Math.sin(_)*t[2]/2,p.tooltipPos=[t[0]+.7*x,t[1]+.7*c],p.half=_<-Math.PI/2||_>Math.PI/2?1:0,p.angle=_,v=Math.min(n,p.labelDistance/5),p.labelPosition={natural:{x:t[0]+x+Math.cos(_)*p.labelDistance,y:t[1]+c+Math.sin(_)*p.labelDistance},computed:{},alignment:0>p.labelDistance?"center":p.half?"right":"left",connectorPosition:{breakAt:{x:t[0]+x+Math.cos(_)*v,y:t[1]+c+Math.sin(_)*v},touchingSliceAt:{x:t[0]+x,y:t[1]+c}}}}u(this,"afterTranslate")}updateTotals(){const t=this.points,e=t.length,i=this.options.ignoreHiddenPoint;let n,s,r=0;for(n=0;n<e;n++)s=t[n],!s.isValid()||i&&!s.visible||(r+=s.y);for(this.total=r,n=0;n<e;n++)s=t[n],s.percentage=0<r&&(s.visible||!i)?s.y/r*100:0,s.total=r}}return g.defaultOptions=p(r.defaultOptions,s),d(g.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:e.prototype.drawTracker,getCenter:t.getCenter,getSymbol:i,isCartesian:!1,noSharedTooltip:!0,pointAttribs:e.prototype.pointAttribs,pointClass:n,requireSorting:!1,searchPoint:i,trackerGroups:["group","dataLabelsGroup"]}),o.registerSeriesType("pie",g),g})),e(i,"Series/Pie/PieDataLabel.js",[i["Core/Series/DataLabel.js"],i["Core/Globals.js"],i["Core/Renderer/RendererUtilities.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s){const{noop:r}=e,{distribute:o}=i,{series:a}=n,{arrayMax:l,clamp:h,defined:c,merge:d,pick:u,relativeLength:p}=s;var f;return function(e){function i(){const t=this,e=t.data,i=t.chart,n=t.options.dataLabels||{},s=n.connectorPadding,r=i.plotWidth,h=i.plotHeight,p=i.plotLeft,f=Math.round(i.chartWidth/3),m=t.center,g=m[2]/2,v=m[1],_=[[],[]],x=[0,0,0,0],y=t.dataLabelPositioners;let b,M,S,w,T,E,A,C,P,L,R,D;t.visible&&(n.enabled||t._hasPointLabels)&&(e.forEach((function(t){t.dataLabel&&t.visible&&t.dataLabel.shortened&&(t.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.dataLabel.shortened=!1)})),a.prototype.drawDataLabels.apply(t),e.forEach((function(t){t.dataLabel&&(t.visible?(_[t.half].push(t),t.dataLabel._pos=null,!c(n.style.width)&&!c(t.options.dataLabels&&t.options.dataLabels.style&&t.options.dataLabels.style.width)&&t.dataLabel.getBBox().width>f&&(t.dataLabel.css({width:Math.round(.7*f)+"px"}),t.dataLabel.shortened=!0)):(t.dataLabel=t.dataLabel.destroy(),t.dataLabels&&1===t.dataLabels.length&&delete t.dataLabels))})),_.forEach(((e,a)=>{const l=e.length,d=[];let f,_=0;if(l){if(t.sortByAngle(e,a-.5),0<t.maxLabelDistance){var M=Math.max(0,v-g-t.maxLabelDistance);f=Math.min(v+g+t.maxLabelDistance,i.plotHeight),e.forEach((function(t){0<t.labelDistance&&t.dataLabel&&(t.top=Math.max(0,v-g-t.labelDistance),t.bottom=Math.min(v+g+t.labelDistance,i.plotHeight),_=t.dataLabel.getBBox().height||21,t.distributeBox={target:t.labelPosition.natural.y-t.top+_/2,size:_,rank:t.y},d.push(t.distributeBox))})),o(d,M=f+_-M,M/5)}for(R=0;R<l;R++){if(b=e[R],E=b.labelPosition,w=b.dataLabel,L=!1===b.visible?"hidden":"inherit",P=M=E.natural.y,d&&c(b.distributeBox)&&(void 0===b.distributeBox.pos?L="hidden":(A=b.distributeBox.size,P=y.radialDistributionY(b))),delete b.positionIndex,n.justify)C=y.justify(b,g,m);else switch(n.alignTo){case"connectors":C=y.alignToConnectors(e,a,r,p);break;case"plotEdges":C=y.alignToPlotEdges(w,a,r,p);break;default:C=y.radialDistributionX(t,b,P,M)}w._attr={visibility:L,align:E.alignment},D=b.options.dataLabels||{},w._pos={x:C+u(D.x,n.x)+({left:s,right:-s}[E.alignment]||0),y:P+u(D.y,n.y)-w.getBBox().height/2},E&&(E.computed.x=C,E.computed.y=P),u(n.crop,!0)&&(T=w.getBBox().width,M=null,C-T<s&&1===a?(M=Math.round(T-C+s),x[3]=Math.max(M,x[3])):C+T>r-s&&0===a&&(M=Math.round(C+T-r+s),x[1]=Math.max(M,x[1])),0>P-A/2?x[0]=Math.max(Math.round(A/2-P),x[0]):P+A/2>h&&(x[2]=Math.max(Math.round(P+A/2-h),x[2])),w.sideOverflow=M)}}})),0===l(x)||this.verifyDataLabelOverflow(x))&&(this.placeDataLabels(),this.points.forEach((function(e){if(D=d(n,e.options.dataLabels),M=u(D.connectorWidth,1)){let n;S=e.connector,(w=e.dataLabel)&&w._pos&&e.visible&&0<e.labelDistance?(L=w._attr.visibility,(n=!S)&&(e.connector=S=i.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+e.colorIndex+(e.className?" "+e.className:"")).add(t.dataLabelsGroup),i.styledMode||S.attr({"stroke-width":M,stroke:D.connectorColor||e.color||"#666666"})),S[n?"attr":"animate"]({d:e.getConnectorPath()}),S.attr("visibility",L)):S&&(e.connector=S.destroy())}})))}function n(){this.points.forEach((function(t){let e,i=t.dataLabel;i&&t.visible&&((e=i._pos)?(i.sideOverflow&&(i._attr.width=Math.max(i.getBBox().width-i.sideOverflow,0),i.css({width:i._attr.width+"px",textOverflow:(this.options.dataLabels.style||{}).textOverflow||"ellipsis"}),i.shortened=!0),i.attr(i._attr),i[i.moved?"animate":"attr"](e),i.moved=!0):i&&i.attr({y:-9999})),delete t.distributeBox}),this)}function f(t){let e,i=this.center,n=this.options,s=n.center,r=n.minSize||80,o=null!==n.size;return o||(null!==s[0]?e=Math.max(i[2]-Math.max(t[1],t[3]),r):(e=Math.max(i[2]-t[1]-t[3],r),i[0]+=(t[3]-t[1])/2),null!==s[1]?e=h(e,r,i[2]-Math.max(t[0],t[2])):(e=h(e,r,i[2]-t[0]-t[2]),i[1]+=(t[0]-t[2])/2),e<i[2]?(i[2]=e,i[3]=Math.min(n.thickness?Math.max(0,e-2*n.thickness):Math.max(0,p(n.innerSize||0,e)),e),this.translate(i),this.drawDataLabels&&this.drawDataLabels()):o=!0),o}const m=[],g={radialDistributionY:function(t){return t.top+t.distributeBox.pos},radialDistributionX:function(t,e,i,n){return t.getX(i<e.top+2||i>e.bottom-2?n:i,e.half,e)},justify:function(t,e,i){return i[0]+(t.half?-1:1)*(e+t.labelDistance)},alignToPlotEdges:function(t,e,i,n){return t=t.getBBox().width,e?t+n:i-t-n},alignToConnectors:function(t,e,i,n){let s,r=0;return t.forEach((function(t){s=t.dataLabel.getBBox().width,s>r&&(r=s)})),e?r+n:i-r-n}};e.compose=function(e){t.compose(a),s.pushUnique(m,e)&&((e=e.prototype).dataLabelPositioners=g,e.alignDataLabel=r,e.drawDataLabels=i,e.placeDataLabels=n,e.verifyDataLabelOverflow=f)}}(f||(f={})),f})),e(i,"Extensions/OverlappingDataLabels.js",[i["Core/Chart/Chart.js"],i["Core/Utilities.js"]],(function(t,e){function i(t,e){let i,n=!1;return t&&(i=t.newOpacity,t.oldOpacity!==i&&(t.alignAttr&&t.placed?(t[i?"removeClass":"addClass"]("highcharts-data-label-hidden"),n=!0,t.alignAttr.opacity=i,t[t.isOld?"animate":"attr"](t.alignAttr,null,(function(){e.styledMode||t.css({pointerEvents:i?"auto":"none"})})),s(e,"afterHideOverlappingLabel")):t.attr({opacity:i})),t.isOld=!0),n}const{addEvent:n,fireEvent:s,isArray:r,isNumber:o,objectEach:a,pick:l}=e;n(t,"render",(function(){let t=this,e=[];(this.labelCollectors||[]).forEach((function(t){e=e.concat(t())})),(this.yAxis||[]).forEach((function(t){t.stacking&&t.options.stackLabels&&!t.options.stackLabels.allowOverlap&&a(t.stacking.stacks,(function(t){a(t,(function(t){t.label&&e.push(t.label)}))}))})),(this.series||[]).forEach((function(n){var s=n.options.dataLabels;n.visible&&(!1!==s.enabled||n._hasPointLabels)&&((s=n=>n.forEach((n=>{n.visible&&(r(n.dataLabels)?n.dataLabels:n.dataLabel?[n.dataLabel]:[]).forEach((function(s){const r=s.options;s.labelrank=l(r.labelrank,n.labelrank,n.shapeArgs&&n.shapeArgs.height),r.allowOverlap?(s.oldOpacity=s.opacity,s.newOpacity=1,i(s,t)):e.push(s)}))})))(n.nodes||[]),s(n.points))})),this.hideOverlappingLabels(e)})),t.prototype.hideOverlappingLabels=function(t){let e=this,n=t.length,r=e.renderer;var a;let l,h,c,d,u=!1;var p=function(t){let e,i;var n;let s,a,l=t.box?0:t.padding||0,h=n=0;if(t&&(!t.alignAttr||t.placed))return e=t.alignAttr||{x:t.attr("x"),y:t.attr("y")},i=t.parentGroup,t.width||(n=t.getBBox(),t.width=n.width,t.height=n.height,n=r.fontMetrics(t.element).h),s=t.width-2*l,(a={left:"0",center:"0.5",right:"1"}[t.alignValue])?h=+a*s:o(t.x)&&Math.round(t.x)!==t.translateX&&(h=t.x-t.translateX),{x:e.x+(i.translateX||0)+l-(h||0),y:e.y+(i.translateY||0)+l-n,width:t.width-2*l,height:t.height-2*l}};for(l=0;l<n;l++)(a=t[l])&&(a.oldOpacity=a.opacity,a.newOpacity=1,a.absoluteBox=p(a));for(t.sort((function(t,e){return(e.labelrank||0)-(t.labelrank||0)})),l=0;l<n;l++)for(c=(p=t[l])&&p.absoluteBox,a=l+1;a<n;++a)d=(h=t[a])&&h.absoluteBox,!c||!d||p===h||0===p.newOpacity||0===h.newOpacity||"hidden"===p.visibility||"hidden"===h.visibility||d.x>=c.x+c.width||d.x+d.width<=c.x||d.y>=c.y+c.height||d.y+d.height<=c.y||((p.labelrank<h.labelrank?p:h).newOpacity=0);t.forEach((function(t){i(t,e)&&(u=!0)})),u&&s(e,"afterHideAllOverlappingLabels")}})),e(i,"Extensions/BorderRadius.js",[i["Core/Defaults.js"],i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Renderer/SVG/SVGRenderer.js"],i["Core/Utilities.js"]],(function(t,e,i,n,s,r){const{defaultOptions:o}=t;({seriesTypes:t}=i);const{addEvent:a,extend:l,isObject:h,merge:c,relativeLength:d}=r,u={radius:0,scope:"stack",where:void 0},p=(t,e)=>(h(t)||(t={radius:t||0}),c(u,e,t));if(-1===n.symbolCustomAttribs.indexOf("borderRadius")){n.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY");const i=s.prototype.symbols.arc;s.prototype.symbols.arc=function(t,e,n,s,r={}){t=i(t,e,n,s,r);const{innerR:o=0,r:a=n,start:l=0,end:h=0}=r;if(r.open||!r.borderRadius)return t;for(n=h-l,e=Math.sin(n/2),r=Math.max(Math.min(d(r.borderRadius||0,a-o),(a-o)/2,a*e/(1+e)),0),n=Math.min(r,n/Math.PI*2*o),e=t.length-1;e--;){let i,o,a;var c=e,u=1<e?n:r,p=(s=t)[c],f=s[c+1];if("Z"===f[0]&&(f=s[0]),"M"!==p[0]&&"L"!==p[0]||"A"!==f[0]?"A"!==p[0]||"M"!==f[0]&&"L"!==f[0]||(a=f,o=p):(a=p,o=f,i=!0),a&&o&&o.params){p=o[1];var m=o[5];f=o.params;const{start:t,end:e,cx:n,cy:r}=f;var g=m?p-u:p+u;const l=g?Math.asin(u/g):0;m=m?l:-l,g*=Math.cos(l),i?(f.start=t+m,a[1]=n+g*Math.cos(t),a[2]=r+g*Math.sin(t),s.splice(c+1,0,["A",u,u,0,0,1,n+p*Math.cos(f.start),r+p*Math.sin(f.start)])):(f.end=e-m,o[6]=n+p*Math.cos(f.end),o[7]=r+p*Math.sin(f.end),s.splice(c+1,0,["A",u,u,0,0,1,n+g*Math.cos(e),r+g*Math.sin(e)])),o[4]=Math.abs(f.end-f.start)<Math.PI?0:1}}return t};const r=s.prototype.symbols.roundedRect;s.prototype.symbols.roundedRect=function(t,e,i,n,s={}){const o=r(t,e,i,n,s),{r:a=0,brBoxHeight:l=n,brBoxY:h=e}=s;var c=e-h,d=h+l-(e+n);s=-.1<c-a?0:a;const u=-.1<d-a?0:a;var p=Math.max(s&&c,0);const f=Math.max(u&&d,0);d=[t+s,e],c=[t+i-s,e];const m=[t+i,e+s],g=[t+i,e+n-u],v=[t+i-u,e+n],_=[t+u,e+n],x=[t,e+n-u],y=[t,e+s];if(p){const t=Math.sqrt(Math.pow(s,2)-Math.pow(s-p,2));d[0]-=t,c[0]+=t,m[1]=y[1]=e+s-p}return n<s-p&&(p=Math.sqrt(Math.pow(s,2)-Math.pow(s-p-n,2)),m[0]=g[0]=t+i-s+p,v[0]=Math.min(m[0],v[0]),_[0]=Math.max(g[0],_[0]),x[0]=y[0]=t+s-p,m[1]=y[1]=e+n),f&&(p=Math.sqrt(Math.pow(u,2)-Math.pow(u-f,2)),v[0]+=p,_[0]-=p,g[1]=x[1]=e+n-u+f),n<u-f&&(n=Math.sqrt(Math.pow(u,2)-Math.pow(u-f-n,2)),m[0]=g[0]=t+i-u+n,c[0]=Math.min(m[0],c[0]),d[0]=Math.max(g[0],d[0]),x[0]=y[0]=t+u-n,g[1]=x[1]=e),o.length=0,o.push(["M",...d],["L",...c],["A",s,s,0,0,1,...m],["L",...g],["A",u,u,0,0,1,...v],["L",..._],["A",u,u,0,0,1,...x],["L",...y],["A",s,s,0,0,1,...d],["Z"]),o},a(t.pie,"afterTranslate",(function(){const t=p(this.options.borderRadius);for(const e of this.points){const i=e.shapeArgs;i&&(i.borderRadius=d(t.radius,(i.r||0)-(i.innerR||0)))}})),a(e,"afterColumnTranslate",(function(){var t,e;if(this.options.borderRadius&&(!this.chart.is3d||!this.chart.is3d())){const{options:r,yAxis:a}=this,c="percent"===r.stacking;var i=null===(e=null===(t=o.plotOptions)||void 0===t?void 0:t[this.type])||void 0===e?void 0:e.borderRadius;t=p(r.borderRadius,h(i)?i:{}),e=a.options.reversed;for(const o of this.points)if(({shapeArgs:i}=o),"roundedRect"===o.shapeType&&i){const{width:h=0,height:u=0,y:p=0}=i;var n=p,s=u;"stack"===t.scope&&o.stackTotal&&(n=a.translate(c?100:o.stackTotal,!1,!0,!1,!0),s=a.translate(r.threshold||0,!1,!0,!1,!0),n=(s=this.crispCol(0,Math.min(n,s),0,Math.abs(n-s))).y,s=s.height);const f=-1==(o.negative?-1:1)*(e?-1:1);let m=t.where;!m&&this.is("waterfall")&&Math.abs((o.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(m="all"),m||(m="end");const g=Math.min(d(t.radius,h),h/2,"all"===m?u/2:1/0)||0;"end"===m&&(f&&(n-=g),s+=g),l(i,{brBoxHeight:s,brBoxY:n,r:g})}}}),{order:9})}return{optionsToObject:p}})),e(i,"Core/Responsive.js",[i["Core/Utilities.js"]],(function(t){const{diffObjects:e,extend:i,find:n,merge:s,pick:r,uniqueKey:o}=t;var a;return function(a){function l(t,e){const i=t.condition;(i.callback||function(){return this.chartWidth<=r(i.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=r(i.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=r(i.minWidth,0)&&this.chartHeight>=r(i.minHeight,0)}).call(this)&&e.push(t._id)}function h(t,i){const r=this.options.responsive;var a=this.currentResponsive;let l=[];!i&&r&&r.rules&&r.rules.forEach((t=>{void 0===t._id&&(t._id=o()),this.matchResponsiveRule(t,l)}),this),i=s(...l.map((t=>n((r||{}).rules||[],(e=>e._id===t)))).map((t=>t&&t.chartOptions))),i.isResponsiveOptions=!0,l=l.toString()||void 0,l!==(a&&a.ruleIds)&&(a&&this.update(a.undoOptions,t,!0),l?((a=e(i,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:l,mergedOptions:i,undoOptions:a},this.update(i,t,!0)):this.currentResponsive=void 0)}const c=[];a.compose=function(e){return t.pushUnique(c,e)&&i(e.prototype,{matchResponsiveRule:l,setResponsive:h}),e}}(a||(a={})),a})),e(i,"masters/highcharts.src.js",[i["Core/Globals.js"],i["Core/Utilities.js"],i["Core/Defaults.js"],i["Core/Animation/Fx.js"],i["Core/Animation/AnimationUtilities.js"],i["Core/Renderer/HTML/AST.js"],i["Core/Templating.js"],i["Core/Renderer/RendererUtilities.js"],i["Core/Renderer/SVG/SVGElement.js"],i["Core/Renderer/SVG/SVGRenderer.js"],i["Core/Renderer/HTML/HTMLElement.js"],i["Core/Renderer/HTML/HTMLRenderer.js"],i["Core/Axis/Axis.js"],i["Core/Axis/DateTimeAxis.js"],i["Core/Axis/LogarithmicAxis.js"],i["Core/Axis/PlotLineOrBand/PlotLineOrBand.js"],i["Core/Axis/Tick.js"],i["Core/Tooltip.js"],i["Core/Series/Point.js"],i["Core/Pointer.js"],i["Core/Legend/Legend.js"],i["Core/Chart/Chart.js"],i["Core/Axis/Stacking/StackingAxis.js"],i["Core/Axis/Stacking/StackItem.js"],i["Core/Series/Series.js"],i["Core/Series/SeriesRegistry.js"],i["Series/Column/ColumnSeries.js"],i["Series/Column/ColumnDataLabel.js"],i["Series/Pie/PieSeries.js"],i["Series/Pie/PieDataLabel.js"],i["Core/Series/DataLabel.js"],i["Core/Responsive.js"],i["Core/Color/Color.js"],i["Core/Time.js"]],(function(t,e,i,n,s,r,o,a,l,h,c,d,u,p,f,m,g,v,_,x,y,b,M,S,w,T,E,A,C,P,L,R,D,I){return t.animate=s.animate,t.animObject=s.animObject,t.getDeferredAnimation=s.getDeferredAnimation,t.setAnimation=s.setAnimation,t.stop=s.stop,t.timers=n.timers,t.AST=r,t.Axis=u,t.Chart=b,t.chart=b.chart,t.Fx=n,t.Legend=y,t.PlotLineOrBand=m,t.Point=_,t.Pointer=x,t.Series=w,t.StackItem=S,t.SVGElement=l,t.SVGRenderer=h,t.Templating=o,t.Tick=g,t.Time=I,t.Tooltip=v,t.Color=D,t.color=D.parse,d.compose(h),c.compose(l),x.compose(b),y.compose(b),t.defaultOptions=i.defaultOptions,t.getOptions=i.getOptions,t.time=i.defaultTime,t.setOptions=i.setOptions,t.dateFormat=o.dateFormat,t.format=o.format,t.numberFormat=o.numberFormat,t.addEvent=e.addEvent,t.arrayMax=e.arrayMax,t.arrayMin=e.arrayMin,t.attr=e.attr,t.clearTimeout=e.clearTimeout,t.correctFloat=e.correctFloat,t.createElement=e.createElement,t.css=e.css,t.defined=e.defined,t.destroyObjectProperties=e.destroyObjectProperties,t.discardElement=e.discardElement,t.distribute=a.distribute,t.erase=e.erase,t.error=e.error,t.extend=e.extend,t.extendClass=e.extendClass,t.find=e.find,t.fireEvent=e.fireEvent,t.getMagnitude=e.getMagnitude,t.getStyle=e.getStyle,t.inArray=e.inArray,t.isArray=e.isArray,t.isClass=e.isClass,t.isDOMElement=e.isDOMElement,t.isFunction=e.isFunction,t.isNumber=e.isNumber,t.isObject=e.isObject,t.isString=e.isString,t.keys=e.keys,t.merge=e.merge,t.normalizeTickInterval=e.normalizeTickInterval,t.objectEach=e.objectEach,t.offset=e.offset,t.pad=e.pad,t.pick=e.pick,t.pInt=e.pInt,t.relativeLength=e.relativeLength,t.removeEvent=e.removeEvent,t.seriesType=T.seriesType,t.splat=e.splat,t.stableSort=e.stableSort,t.syncTimeout=e.syncTimeout,t.timeUnits=e.timeUnits,t.uniqueKey=e.uniqueKey,t.useSerialIds=e.useSerialIds,t.wrap=e.wrap,A.compose(E),L.compose(w),p.compose(u),f.compose(u),P.compose(C),m.compose(u),R.compose(b),M.compose(u,b,w),v.compose(x),t})),i["masters/highcharts.src.js"]._modules=i,i["masters/highcharts.src.js"]},t.exports?(r.default=r,t.exports=s.document?r(s):r):void 0===(n=function(){return r(s)}.call(e,i,e,t))||(t.exports=n)}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};(()=>{i.d(n,{I6:()=>Cx,K9:()=>Ix,gm:()=>kx,yi:()=>Dx,u0:()=>Tx,Yl:()=>wx,R3:()=>Ax,b5:()=>Px,Ov:()=>bx,xb:()=>Ox,qA:()=>Mx,kl:()=>Sx,bF:()=>Rx});const t={blueTheme:"#189C9B",purpleTheme:"#ca18cd",orangeTheme:"#cd4b18",greenTheme:"#27cd18",grayscaleTheme:"#777777"};function e(t,e,i){return(1-i)*t+i*e}Math.PI,Math.PI;class s{constructor(t,e,i,n){let s=80;window.innerWidth/window.innerHeight>2.5&&(s=65);let r=document.createElement("div");r.className="cellWithPreview",r.style.width=s/e+"vw",r.style.height=s/e*9/16+"vw",t.appendChild(r),this._preview=document.createElement("img"),this._preview.className="fullres",this._preview.src=n,this._preview.style.objectFit="cover",r.appendChild(this._preview);let o=document.createElement("div");o.className="cellWithPreviewProgressBar",r.appendChild(o),r.addEventListener("mouseenter",(()=>{r.style.cursor="pointer"})),r.addEventListener("mouseleave",(()=>{r.style.cursor="default"})),r.onclick=()=>{Ox.activateView(i,o)}}updateColorTheme(){"grayscaleTheme"==document.documentElement.className?this._preview.classList.add("grayscale"):this._preview.classList.remove("grayscale")}}class r{constructor(t,e,i,n,s,r,o){this._inputBoxes=[],this._navLabels=[],this._isImageItem=[],this._actualItems=[],this._currentSelectedIndex=0,this._isMouseOverGallery=!1,this._imageDuration=0,this._currentDuration=1e4,this._startTime=0,this.onInputClicked=this.onInputClicked.bind(this),this._imageDuration=r,this._startTime=Mx.currentTime,this._galleryParent=document.createElement("div"),this._galleryParent.className="gallery",t.appendChild(this._galleryParent);let a=document.createElement("div");a.className="gallerySlidesParent",a.style.width=`${n}00%`,this._galleryParent.appendChild(a);let l=document.createElement("div");l.className="galleryNavigation",this._galleryParent.appendChild(l),this._pauseBtn=document.createElement("div"),this._pauseBtn.className="pauseBtn",this._pauseBtn.style.display="none",this._galleryParent.appendChild(this._pauseBtn);for(let t=0;t<n;++t){let i=document.createElement("input");i.type="radio",i.name="r",i.id="gallery"+e+"R"+t,0==t&&(i.checked=!0),i.onclick=this.onInputClicked,this._inputBoxes.push(i),a.appendChild(i)}for(let t=0;t<n;++t){let r=document.createElement("div");if(r.className="gallerySlide",r.style.width=100/n+"%",a.appendChild(r),0==t&&(r.classList.add("gallery"+e+"S0"),this._galleryItem=r),s.includes(t)){let e=document.createElement("video");e.className="galleryVisualItem",e.src=i+t.toString()+".mp4",r.appendChild(e),this._actualItems.push(e),this._isImageItem.push(!1),0==t&&e.addEventListener("loadedmetadata",(()=>{this._currentDuration=1e3*e.duration+500}))}else{let e=document.createElement("img");e.className="galleryVisualItem",e.src=i+t.toString()+"."+(void 0===o?"jpg":o),r.appendChild(e),this._actualItems.push(e),this._isImageItem.push(!0)}let h=document.createElement("label");h.className="galleryBar",h.htmlFor="gallery"+e+"R"+t,0==t&&(h.style.backgroundColor="#999999"),h.onmouseenter=t=>{t.target.style.backgroundColor="#fff"},h.onmouseleave=t=>{let e=t.target;void 0!==e&&(e.style.backgroundColor=e.htmlFor==this._navLabels[this._currentSelectedIndex].htmlFor?"#999999":"transparent")},l.appendChild(h),this._navLabels.push(h)}setTimeout((()=>{this.checkAspectRatio()}),1e3),window.addEventListener("mousemove",(t=>{this.onMouseMove(t)}))}update(){if(Mx.currentTime>3e3&&Mx.currentTime-this._startTime>this._currentDuration){if(!this.isElementInViewport())return void(this._startTime=Mx.currentTime);this.clearCurrentSelection(),this._currentSelectedIndex++,this._currentSelectedIndex>=this._navLabels.length&&(this._currentSelectedIndex=0),this.applyCurrentSelection()}if(this._isImageItem[this._currentSelectedIndex])this._pauseBtn.style.display="none";else{let t=this._actualItems[this._currentSelectedIndex];this._pauseBtn.style.display=t.paused?"block":"none","grayscaleTheme"==document.documentElement.className?this._pauseBtn.style.filter="grayscale(100%)":this._pauseBtn.style.filter="",this._isMouseOverGallery&&t.currentTime<t.duration?(Sx.value&&t.play(),this._currentDuration=1e3*(t.duration-t.currentTime)+500,this._startTime=Mx.currentTime):t.pause()}}onMouseMove(t){const e=this._galleryParent.getBoundingClientRect(),i=t.clientX,n=t.clientY;i>=e.left&&i<=e.right&&n>=e.top&&n<=e.bottom?this._isMouseOverGallery=!0:this._isMouseOverGallery=!1}isElementInViewport(){var t=this._galleryParent.getBoundingClientRect();return t.top>=.1*-window.innerHeight&&t.bottom<=window.innerHeight+.1*window.innerHeight}applyCurrentSelection(){if(this._isImageItem[this._currentSelectedIndex])this._currentDuration=this._imageDuration;else{let t=this._actualItems[this._currentSelectedIndex];this._currentDuration=1e3*t.duration+500}this._galleryItem.style.marginLeft=`-${100/this._navLabels.length*this._currentSelectedIndex}%`,this._navLabels[this._currentSelectedIndex].style.backgroundColor="#999999",this._startTime=Mx.currentTime}checkAspectRatio(){let t=!1;for(let e=0;e<this._actualItems.length;++e)if(this._actualItems[e].clientWidth/this._actualItems[e].clientHeight<=17/9){t=!0;break}if(t)for(let t=0;t<this._actualItems.length;++t)this._actualItems[t].style.height=9*this._actualItems[t].clientWidth/16+"px"}clearCurrentSelection(){if(!this._isImageItem[this._currentSelectedIndex]){let t=this._actualItems[this._currentSelectedIndex];t.pause(),t.currentTime=0}this._navLabels[this._currentSelectedIndex].style.backgroundColor="transparent"}onInputClicked(t){this.clearCurrentSelection();for(let e=0;e<this._inputBoxes.length;++e)if(this._navLabels[this._currentSelectedIndex].style.backgroundColor="transparent",this._inputBoxes[e].id==t.target.id){this._currentSelectedIndex=e,this.applyCurrentSelection();break}}updateColorTheme(){for(let t=0;t<this._actualItems.length;++t)"grayscaleTheme"==document.documentElement.className?this._actualItems[t].classList.add("grayscale"):this._actualItems[t].classList.remove("grayscale")}}class o{constructor(t,e,i){this._tags=[];let n=document.createElement("div");n.id=i._id,n.className="multiCellWithGallery",n.style.width=wx.value?"95%":94/e+"%",t.appendChild(n);let s=document.createElement("div");s.className="multiCellWithGalleryTopPanel",n.appendChild(s);let o=document.createElement("div");o.className="multiCellWithGalleryDownPanel",n.appendChild(o);let a=document.createElement("div");a.className="multiCellWithGalleryTitle",a.innerHTML=i._title,s.appendChild(a);let l=document.createElement("div");l.className="multiCellWithGalleryTagsList",o.appendChild(l);for(let t=0;t<i._tags.length;++t){let e=document.createElement("div");e.className="multiCellWithGalleryTag",e.innerHTML=i._tags[t],e.style.backgroundColor=i._tagColors[t],l.appendChild(e),this._tags.push(e)}let h=document.createElement("div");if(h.className="multiCellWithGalleryDescription",h.innerHTML=i._description,o.appendChild(h),this._gallery=new r(s,i._id,i._imagesPath,i._imageCount,i._videoFormatIndices,i._imageDurationMs,i._imgExtension),""!=i._btn1Name||""!=i._btn2Name)if(""==i._btn1Name&&""!=i._btn2Name){let t=document.createElement("div");t.className="cellButtonBorder",t.style.width="20vw",t.style.height="3vw",o.appendChild(t);let e=document.createElement("div");e.className="cellButton",e.addEventListener("mousedown",(()=>{window.open(i._btn2Link,"_blank")})),t.appendChild(e);let n=document.createElement("div");n.className="centerText",n.innerHTML=i._btn2Name,n.style.fontSize="2vw",e.appendChild(n)}else if(""!=i._btn1Name&&""==i._btn2Name){let t=document.createElement("div");t.className="cellButtonBorder",t.style.width="10vw",t.style.height="1vw",o.appendChild(t);let e=document.createElement("div");e.className="cellButton",e.addEventListener("mousedown",(()=>{window.open(i._btn1Link,"_blank")})),t.appendChild(e);let n=document.createElement("div");n.className="centerText",n.innerHTML=i._btn1Name,n.style.fontSize="1vw",e.appendChild(n)}else{let t=document.createElement("div");t.className="combinedBtnParent",o.appendChild(t);let e=document.createElement("div");e.className="combinedBtnLeftBorder",t.appendChild(e);let n=document.createElement("div");n.className="combinedBtnLeft",n.addEventListener("mousedown",(()=>{window.open(i._btn1Link,"_blank")})),e.appendChild(n);let s=document.createElement("div");s.className="centerText",s.innerHTML="More Details",n.appendChild(s);let r=document.createElement("div");r.className="combinedBtnRightBorder",t.appendChild(r);let a=document.createElement("div");a.className="combinedBtnRight",a.addEventListener("mousedown",(()=>{this.downloadFile(i._downloadPath,i._downloadName)})),r.appendChild(a);let l=document.createElement("div");l.className="centerText",l.innerHTML="Download",a.appendChild(l)}}update(){this._gallery.update()}downloadFile(t,e){const i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}updateColorTheme(){for(let t=0;t<this._tags.length;++t)"grayscaleTheme"==document.documentElement.className?this._tags[t].classList.add("grayscale"):this._tags[t].classList.remove("grayscale");this._gallery.updateColorTheme()}}const a={fill:!0,backgroundColor:"rgba(232, 88, 65, 0.75)",borderColor:"rgb(255, 99, 132)"},l={fill:!0,backgroundColor:"rgba(0, 200, 255, 0.75)",borderColor:"rgb(54, 162, 235)"},h={fill:!0,backgroundColor:"rgba(43, 153, 31, 0.75)",borderColor:"rgb(51, 179, 48)"},c={fill:!0,backgroundColor:"rgba(200, 73, 230, 0.75)",borderColor:"rgb(226, 92, 255)"},d={fill:!0,backgroundColor:"rgba(232, 188, 30, 0.75)",borderColor:"rgb(226, 92, 255)"},u={fill:!0,backgroundColor:"rgba(48, 55, 219, 0.75)",borderColor:"rgb(226, 92, 255)"},p={fill:!0,backgroundColor:"rgba(204, 106, 41, 0.75)",borderColor:"rgb(226, 92, 255)"},f={fill:!0,backgroundColor:"rgba(200, 200, 200, 0.75)",borderColor:"rgb(226, 92, 255)"},m={fill:!0,backgroundColor:"rgba(110, 110, 110, 0.75)",borderColor:"rgb(226, 92, 255)"},g={fill:!0,backgroundColor:"rgba(75, 75, 75, 0.75)",borderColor:"rgb(226, 92, 255)"},v="#9e1c1c",_="#245e8c",x="#299648",y="#bd572b",b={blueTheme:"./images/banners/0.jpg",purpleTheme:"./images/banners/alter_purple.jpg",orangeTheme:"./images/banners/alter_orange.jpg",greenTheme:"./images/banners/alter_green.jpg",grayscaleTheme:"./images/banners/grayscale.jpg"};function M(t){return t+.5|0}const S=(t,e,i)=>Math.max(Math.min(t,i),e);function w(t){return S(M(2.55*t),0,255)}function T(t){return S(M(255*t),0,255)}function E(t){return S(M(t/2.55)/100,0,1)}function A(t){return S(M(100*t),0,100)}const C={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},P=[..."0123456789ABCDEF"],L=t=>P[15&t],R=t=>P[(240&t)>>4]+P[15&t],D=t=>(240&t)>>4==(15&t);const I=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function k(t,e,i){const n=e*Math.min(i,1-i),s=(e,s=(e+t/30)%12)=>i-n*Math.max(Math.min(s-3,9-s,1),-1);return[s(0),s(8),s(4)]}function O(t,e,i){const n=(n,s=(n+t/60)%6)=>i-i*e*Math.max(Math.min(s,4-s,1),0);return[n(5),n(3),n(1)]}function N(t,e,i){const n=k(t,1,.5);let s;for(e+i>1&&(s=1/(e+i),e*=s,i*=s),s=0;s<3;s++)n[s]*=1-e-i,n[s]+=e;return n}function U(t){const e=t.r/255,i=t.g/255,n=t.b/255,s=Math.max(e,i,n),r=Math.min(e,i,n),o=(s+r)/2;let a,l,h;return s!==r&&(h=s-r,l=o>.5?h/(2-s-r):h/(s+r),a=function(t,e,i,n,s){return t===s?(e-i)/n+(e<i?6:0):e===s?(i-t)/n+2:(t-e)/n+4}(e,i,n,h,s),a=60*a+.5),[0|a,l||0,o]}function B(t,e,i,n){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,i,n)).map(T)}function F(t,e,i){return B(k,t,e,i)}function z(t){return(t%360+360)%360}const H={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},V={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let G;const W=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,j=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,X=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Y(t,e,i){if(t){let n=U(t);n[e]=Math.max(0,Math.min(n[e]+n[e]*i,0===e?360:1)),n=F(n),t.r=n[0],t.g=n[1],t.b=n[2]}}function q(t,e){return t?Object.assign(e||{},t):t}function K(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=T(t[3]))):(e=q(t,{r:0,g:0,b:0,a:1})).a=T(e.a),e}function Z(t){return"r"===t.charAt(0)?function(t){const e=W.exec(t);let i,n,s,r=255;if(e){if(e[7]!==i){const t=+e[7];r=e[8]?w(t):S(255*t,0,255)}return i=+e[1],n=+e[3],s=+e[5],i=255&(e[2]?w(i):S(i,0,255)),n=255&(e[4]?w(n):S(n,0,255)),s=255&(e[6]?w(s):S(s,0,255)),{r:i,g:n,b:s,a:r}}}(t):function(t){const e=I.exec(t);let i,n=255;if(!e)return;e[5]!==i&&(n=e[6]?w(+e[5]):T(+e[5]));const s=z(+e[2]),r=+e[3]/100,o=+e[4]/100;return i="hwb"===e[1]?function(t,e,i){return B(N,t,e,i)}(s,r,o):"hsv"===e[1]?function(t,e,i){return B(O,t,e,i)}(s,r,o):F(s,r,o),{r:i[0],g:i[1],b:i[2],a:n}}(t)}class ${constructor(t){if(t instanceof $)return t;const e=typeof t;let i;var n,s,r;"object"===e?i=K(t):"string"===e&&(r=(n=t).length,"#"===n[0]&&(4===r||5===r?s={r:255&17*C[n[1]],g:255&17*C[n[2]],b:255&17*C[n[3]],a:5===r?17*C[n[4]]:255}:7!==r&&9!==r||(s={r:C[n[1]]<<4|C[n[2]],g:C[n[3]]<<4|C[n[4]],b:C[n[5]]<<4|C[n[6]],a:9===r?C[n[7]]<<4|C[n[8]]:255})),i=s||function(t){G||(G=function(){const t={},e=Object.keys(V),i=Object.keys(H);let n,s,r,o,a;for(n=0;n<e.length;n++){for(o=a=e[n],s=0;s<i.length;s++)r=i[s],a=a.replace(r,H[r]);r=parseInt(V[o],16),t[a]=[r>>16&255,r>>8&255,255&r]}return t}(),G.transparent=[0,0,0,0]);const e=G[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(t)||Z(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=q(this._rgb);return t&&(t.a=E(t.a)),t}set rgb(t){this._rgb=K(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${E(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?function(t){var e=(t=>D(t.r)&&D(t.g)&&D(t.b)&&D(t.a))(t)?L:R;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=U(t),i=e[0],n=A(e[1]),s=A(e[2]);return t.a<255?`hsla(${i}, ${n}%, ${s}%, ${E(t.a)})`:`hsl(${i}, ${n}%, ${s}%)`}(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,n=t.rgb;let s;const r=e===s?.5:e,o=2*r-1,a=i.a-n.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;s=1-l,i.r=255&l*i.r+s*n.r+.5,i.g=255&l*i.g+s*n.g+.5,i.b=255&l*i.b+s*n.b+.5,i.a=r*i.a+(1-r)*n.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,i){const n=X(E(t.r)),s=X(E(t.g)),r=X(E(t.b));return{r:T(j(n+i*(X(E(e.r))-n))),g:T(j(s+i*(X(E(e.g))-s))),b:T(j(r+i*(X(E(e.b))-r))),a:t.a+i*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new $(this.rgb)}alpha(t){return this._rgb.a=T(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=M(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Y(this._rgb,2,t),this}darken(t){return Y(this._rgb,2,-t),this}saturate(t){return Y(this._rgb,1,t),this}desaturate(t){return Y(this._rgb,1,-t),this}rotate(t){return function(t,e){var i=U(t);i[0]=z(i[0]+e),i=F(i),t.r=i[0],t.g=i[1],t.b=i[2]}(this._rgb,t),this}}function J(){}const Q=(()=>{let t=0;return()=>t++})();function tt(t){return null==t}function et(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function it(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function nt(t){return("number"==typeof t||t instanceof Number)&&isFinite(+t)}function st(t,e){return nt(t)?t:e}function rt(t,e){return void 0===t?e:t}const ot=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function at(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)}function lt(t,e,i,n){let s,r,o;if(et(t))if(r=t.length,n)for(s=r-1;s>=0;s--)e.call(i,t[s],s);else for(s=0;s<r;s++)e.call(i,t[s],s);else if(it(t))for(o=Object.keys(t),r=o.length,s=0;s<r;s++)e.call(i,t[o[s]],o[s])}function ht(t,e){let i,n,s,r;if(!t||!e||t.length!==e.length)return!1;for(i=0,n=t.length;i<n;++i)if(s=t[i],r=e[i],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function ct(t){if(et(t))return t.map(ct);if(it(t)){const e=Object.create(null),i=Object.keys(t),n=i.length;let s=0;for(;s<n;++s)e[i[s]]=ct(t[i[s]]);return e}return t}function dt(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function ut(t,e,i,n){if(!dt(t))return;const s=e[t],r=i[t];it(s)&&it(r)?pt(s,r,n):e[t]=ct(r)}function pt(t,e,i){const n=et(e)?e:[e],s=n.length;if(!it(t))return t;const r=(i=i||{}).merger||ut;let o;for(let e=0;e<s;++e){if(o=n[e],!it(o))continue;const s=Object.keys(o);for(let e=0,n=s.length;e<n;++e)r(s[e],t,o,i)}return t}function ft(t,e){return pt(t,e,{merger:mt})}function mt(t,e,i){if(!dt(t))return;const n=e[t],s=i[t];it(n)&&it(s)?ft(n,s):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=ct(s))}const gt={"":t=>t,x:t=>t.x,y:t=>t.y};function vt(t,e){const i=gt[e]||(gt[e]=function(t){const e=function(t){const e=t.split("."),i=[];let n="";for(const t of e)n+=t,n.endsWith("\\")?n=n.slice(0,-1)+".":(i.push(n),n="");return i}(t);return t=>{for(const i of e){if(""===i)break;t=t&&t[i]}return t}}(e));return i(t)}function _t(t){return t.charAt(0).toUpperCase()+t.slice(1)}const xt=t=>void 0!==t,yt=t=>"function"==typeof t,bt=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},Mt=Math.PI,St=2*Mt,wt=St+Mt,Tt=Number.POSITIVE_INFINITY,Et=Mt/180,At=Mt/2,Ct=Mt/4,Pt=2*Mt/3,Lt=Math.log10,Rt=Math.sign;function Dt(t,e,i){return Math.abs(t-e)<i}function It(t){const e=Math.round(t);t=Dt(t,e,t/1e3)?e:t;const i=Math.pow(10,Math.floor(Lt(t))),n=t/i;return(n<=1?1:n<=2?2:n<=5?5:10)*i}function kt(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Ot(t,e,i){let n,s,r;for(n=0,s=t.length;n<s;n++)r=t[n][i],isNaN(r)||(e.min=Math.min(e.min,r),e.max=Math.max(e.max,r))}function Nt(t){return t*(Mt/180)}function Ut(t){return t*(180/Mt)}function Bt(t){if(!nt(t))return;let e=1,i=0;for(;Math.round(t*e)/e!==t;)e*=10,i++;return i}function Ft(t,e){const i=e.x-t.x,n=e.y-t.y,s=Math.sqrt(i*i+n*n);let r=Math.atan2(n,i);return r<-.5*Mt&&(r+=St),{angle:r,distance:s}}function zt(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ht(t,e){return(t-e+wt)%St-Mt}function Vt(t){return(t%St+St)%St}function Gt(t,e,i,n){const s=Vt(t),r=Vt(e),o=Vt(i),a=Vt(r-s),l=Vt(o-s),h=Vt(s-r),c=Vt(s-o);return s===r||s===o||n&&r===o||a>l&&h<c}function Wt(t,e,i){return Math.max(e,Math.min(i,t))}function jt(t,e,i,n=1e-6){return t>=Math.min(e,i)-n&&t<=Math.max(e,i)+n}function Xt(t,e,i){i=i||(i=>t[i]<e);let n,s=t.length-1,r=0;for(;s-r>1;)n=r+s>>1,i(n)?r=n:s=n;return{lo:r,hi:s}}const Yt=(t,e,i,n)=>Xt(t,i,n?n=>{const s=t[n][e];return s<i||s===i&&t[n+1][e]===i}:n=>t[n][e]<i),qt=(t,e,i)=>Xt(t,i,(n=>t[n][e]>=i)),Kt=["push","pop","shift","splice","unshift"];function Zt(t,e){const i=t._chartjs;if(!i)return;const n=i.listeners,s=n.indexOf(e);-1!==s&&n.splice(s,1),n.length>0||(Kt.forEach((e=>{delete t[e]})),delete t._chartjs)}function $t(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const Jt="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function Qt(t,e){let i=[],n=!1;return function(...s){i=s,n||(n=!0,Jt.call(window,(()=>{n=!1,t.apply(e,i)})))}}const te=t=>"start"===t?"left":"end"===t?"right":"center",ee=(t,e,i)=>"start"===t?e:"end"===t?i:(e+i)/2;function ie(t,e,i){const n=e.length;let s=0,r=n;if(t._sorted){const{iScale:o,_parsed:a}=t,l=o.axis,{min:h,max:c,minDefined:d,maxDefined:u}=o.getUserBounds();d&&(s=Wt(Math.min(Yt(a,l,h).lo,i?n:Yt(e,l,o.getPixelForValue(h)).lo),0,n-1)),r=u?Wt(Math.max(Yt(a,o.axis,c,!0).hi+1,i?0:Yt(e,l,o.getPixelForValue(c),!0).hi+1),s,n)-s:n-s}return{start:s,count:r}}function ne(t){const{xScale:e,yScale:i,_scaleRanges:n}=t,s={xmin:e.min,xmax:e.max,ymin:i.min,ymax:i.max};if(!n)return t._scaleRanges=s,!0;const r=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==i.min||n.ymax!==i.max;return Object.assign(n,s),r}const se=t=>0===t||1===t,re=(t,e,i)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*St/i),oe=(t,e,i)=>Math.pow(2,-10*t)*Math.sin((t-e)*St/i)+1,ae={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*At),easeOutSine:t=>Math.sin(t*At),easeInOutSine:t=>-.5*(Math.cos(Mt*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>se(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>se(t)?t:re(t,.075,.3),easeOutElastic:t=>se(t)?t:oe(t,.075,.3),easeInOutElastic(t){const e=.1125;return se(t)?t:t<.5?.5*re(2*t,e,.45):.5+.5*oe(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-ae.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeInOutBounce:t=>t<.5?.5*ae.easeInBounce(2*t):.5*ae.easeOutBounce(2*t-1)+.5};function le(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function he(t){return le(t)?t:new $(t)}function ce(t){return le(t)?t:new $(t).saturate(.5).darken(.1).hexString()}const de=["x","y","borderWidth","radius","tension"],ue=["color","borderColor","backgroundColor"],pe=new Map;function fe(t,e,i){return function(t,e){e=e||{};const i=t+JSON.stringify(e);let n=pe.get(i);return n||(n=new Intl.NumberFormat(t,e),pe.set(i,n)),n}(e,i).format(t)}const me={values:t=>et(t)?t:""+t,numeric(t,e,i){if(0===t)return"0";const n=this.chart.options.locale;let s,r=t;if(i.length>1){const e=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(e<1e-4||e>1e15)&&(s="scientific"),r=function(t,e){let i=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(i)>=1&&t!==Math.floor(t)&&(i=t-Math.floor(t)),i}(t,i)}const o=Lt(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),fe(t,n,l)},logarithmic(t,e,i){if(0===t)return"0";const n=i[e].significand||t/Math.pow(10,Math.floor(Lt(t)));return[1,2,3,5,10,15].includes(n)||e>.8*i.length?me.numeric.call(this,t,e,i):""}};var ge={formatters:me};const ve=Object.create(null),_e=Object.create(null);function xe(t,e){if(!e)return t;const i=e.split(".");for(let e=0,n=i.length;e<n;++e){const n=i[e];t=t[n]||(t[n]=Object.create(null))}return t}function ye(t,e,i){return"string"==typeof e?pt(xe(t,e),i):pt(xe(t,""),e)}class be{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>ce(e.backgroundColor),this.hoverBorderColor=(t,e)=>ce(e.borderColor),this.hoverColor=(t,e)=>ce(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return ye(this,t,e)}get(t){return xe(this,t)}describe(t,e){return ye(_e,t,e)}override(t,e){return ye(ve,t,e)}route(t,e,i,n){const s=xe(this,t),r=xe(this,i),o="_"+e;Object.defineProperties(s,{[o]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=r[n];return it(t)?Object.assign({},e,t):rt(t,e)},set(t){this[o]=t}}})}apply(t){t.forEach((t=>t(this)))}}var Me=new be({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),t.set("animations",{colors:{type:"color",properties:ue},numbers:{type:"number",properties:de}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}})},function(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:ge.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t&&"dash"!==t}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t})}]);function Se(t,e,i,n,s){let r=e[s];return r||(r=e[s]=t.measureText(s).width,i.push(s)),r>n&&(n=r),n}function we(t,e,i,n){let s=(n=n||{}).data=n.data||{},r=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(s=n.data={},r=n.garbageCollect=[],n.font=e),t.save(),t.font=e;let o=0;const a=i.length;let l,h,c,d,u;for(l=0;l<a;l++)if(d=i[l],null==d||et(d)){if(et(d))for(h=0,c=d.length;h<c;h++)u=d[h],null==u||et(u)||(o=Se(t,s,r,o,u))}else o=Se(t,s,r,o,d);t.restore();const p=r.length/2;if(p>i.length){for(l=0;l<p;l++)delete s[r[l]];r.splice(0,p)}return o}function Te(t,e,i){const n=t.currentDevicePixelRatio,s=0!==i?Math.max(i/2,.5):0;return Math.round((e-s)*n)/n+s}function Ee(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Ae(t,e,i,n){Ce(t,e,i,n,null)}function Ce(t,e,i,n,s){let r,o,a,l,h,c,d,u;const p=e.pointStyle,f=e.rotation,m=e.radius;let g=(f||0)*Et;if(p&&"object"==typeof p&&(r=p.toString(),"[object HTMLImageElement]"===r||"[object HTMLCanvasElement]"===r))return t.save(),t.translate(i,n),t.rotate(g),t.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void t.restore();if(!(isNaN(m)||m<=0)){switch(t.beginPath(),p){default:s?t.ellipse(i,n,s/2,m,0,0,St):t.arc(i,n,m,0,St),t.closePath();break;case"triangle":c=s?s/2:m,t.moveTo(i+Math.sin(g)*c,n-Math.cos(g)*m),g+=Pt,t.lineTo(i+Math.sin(g)*c,n-Math.cos(g)*m),g+=Pt,t.lineTo(i+Math.sin(g)*c,n-Math.cos(g)*m),t.closePath();break;case"rectRounded":h=.516*m,l=m-h,o=Math.cos(g+Ct)*l,d=Math.cos(g+Ct)*(s?s/2-h:l),a=Math.sin(g+Ct)*l,u=Math.sin(g+Ct)*(s?s/2-h:l),t.arc(i-d,n-a,h,g-Mt,g-At),t.arc(i+u,n-o,h,g-At,g),t.arc(i+d,n+a,h,g,g+At),t.arc(i-u,n+o,h,g+At,g+Mt),t.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,c=s?s/2:l,t.rect(i-c,n-l,2*c,2*l);break}g+=Ct;case"rectRot":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,u=Math.sin(g)*(s?s/2:m),t.moveTo(i-d,n-a),t.lineTo(i+u,n-o),t.lineTo(i+d,n+a),t.lineTo(i-u,n+o),t.closePath();break;case"crossRot":g+=Ct;case"cross":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,u=Math.sin(g)*(s?s/2:m),t.moveTo(i-d,n-a),t.lineTo(i+d,n+a),t.moveTo(i+u,n-o),t.lineTo(i-u,n+o);break;case"star":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,u=Math.sin(g)*(s?s/2:m),t.moveTo(i-d,n-a),t.lineTo(i+d,n+a),t.moveTo(i+u,n-o),t.lineTo(i-u,n+o),g+=Ct,d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,u=Math.sin(g)*(s?s/2:m),t.moveTo(i-d,n-a),t.lineTo(i+d,n+a),t.moveTo(i+u,n-o),t.lineTo(i-u,n+o);break;case"line":o=s?s/2:Math.cos(g)*m,a=Math.sin(g)*m,t.moveTo(i-o,n-a),t.lineTo(i+o,n+a);break;case"dash":t.moveTo(i,n),t.lineTo(i+Math.cos(g)*(s?s/2:m),n+Math.sin(g)*m);break;case!1:t.closePath()}t.fill(),e.borderWidth>0&&t.stroke()}}function Pe(t,e,i){return i=i||.5,!e||t&&t.x>e.left-i&&t.x<e.right+i&&t.y>e.top-i&&t.y<e.bottom+i}function Le(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function Re(t){t.restore()}function De(t,e,i,n,s){if(!e)return t.lineTo(i.x,i.y);if("middle"===s){const n=(e.x+i.x)/2;t.lineTo(n,e.y),t.lineTo(n,i.y)}else"after"===s!=!!n?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}function Ie(t,e,i,n){if(!e)return t.lineTo(i.x,i.y);t.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?i.cp2x:i.cp1x,n?i.cp2y:i.cp1y,i.x,i.y)}function ke(t,e,i,n,s){if(s.strikethrough||s.underline){const r=t.measureText(n),o=e-r.actualBoundingBoxLeft,a=e+r.actualBoundingBoxRight,l=i-r.actualBoundingBoxAscent,h=i+r.actualBoundingBoxDescent,c=s.strikethrough?(l+h)/2:h;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=s.decorationWidth||2,t.moveTo(o,c),t.lineTo(a,c),t.stroke()}}function Oe(t,e){const i=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=i}function Ne(t,e,i,n,s,r={}){const o=et(e)?e:[e],a=r.strokeWidth>0&&""!==r.strokeColor;let l,h;for(t.save(),t.font=s.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),tt(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,r),l=0;l<o.length;++l)h=o[l],r.backdrop&&Oe(t,r.backdrop),a&&(r.strokeColor&&(t.strokeStyle=r.strokeColor),tt(r.strokeWidth)||(t.lineWidth=r.strokeWidth),t.strokeText(h,i,n,r.maxWidth)),t.fillText(h,i,n,r.maxWidth),ke(t,i,n,h,r),n+=Number(s.lineHeight);t.restore()}function Ue(t,e){const{x:i,y:n,w:s,h:r,radius:o}=e;t.arc(i+o.topLeft,n+o.topLeft,o.topLeft,-At,Mt,!0),t.lineTo(i,n+r-o.bottomLeft),t.arc(i+o.bottomLeft,n+r-o.bottomLeft,o.bottomLeft,Mt,At,!0),t.lineTo(i+s-o.bottomRight,n+r),t.arc(i+s-o.bottomRight,n+r-o.bottomRight,o.bottomRight,At,0,!0),t.lineTo(i+s,n+o.topRight),t.arc(i+s-o.topRight,n+o.topRight,o.topRight,0,-At,!0),t.lineTo(i+o.topLeft,n)}const Be=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Fe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function ze(t,e){const i=(""+t).match(Be);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t}const He=t=>+t||0;function Ve(t,e){const i={},n=it(e),s=n?Object.keys(e):e,r=it(t)?n?i=>rt(t[i],t[e[i]]):e=>t[e]:()=>t;for(const t of s)i[t]=He(r(t));return i}function Ge(t){return Ve(t,{top:"y",right:"x",bottom:"y",left:"x"})}function We(t){return Ve(t,["topLeft","topRight","bottomLeft","bottomRight"])}function je(t){const e=Ge(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Xe(t,e){t=t||{},e=e||Me.font;let i=rt(t.size,e.size);"string"==typeof i&&(i=parseInt(i,10));let n=rt(t.style,e.style);n&&!(""+n).match(Fe)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const s={family:rt(t.family,e.family),lineHeight:ze(rt(t.lineHeight,e.lineHeight),i),size:i,style:n,weight:rt(t.weight,e.weight),string:""};return s.string=function(t){return!t||tt(t.size)||tt(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(s),s}function Ye(t,e,i,n){let s,r,o,a=!0;for(s=0,r=t.length;s<r;++s)if(o=t[s],void 0!==o&&(void 0!==e&&"function"==typeof o&&(o=o(e),a=!1),void 0!==i&&et(o)&&(o=o[i%o.length],a=!1),void 0!==o))return n&&!a&&(n.cacheable=!1),o}function qe(t,e){return Object.assign(Object.create(t),e)}function Ke(t,e=[""],i,n,s=(()=>t[0])){const r=i||t;void 0===n&&(n=oi("_fallback",t));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:r,_fallback:n,_getTarget:s,override:i=>Ke([i,...t],e,r,n)};return new Proxy(o,{deleteProperty:(e,i)=>(delete e[i],delete e._keys,delete t[0][i],!0),get:(i,n)=>ti(i,n,(()=>function(t,e,i,n){let s;for(const r of e)if(s=oi(Je(r,t),i),void 0!==s)return Qe(t,s)?si(i,n,t,s):s}(n,e,t,i))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>ai(t).includes(e),ownKeys:t=>ai(t),set(t,e,i){const n=t._storage||(t._storage=s());return t[e]=n[e]=i,delete t._keys,!0}})}function Ze(t,e,i,n){const s={_cacheable:!1,_proxy:t,_context:e,_subProxy:i,_stack:new Set,_descriptors:$e(t,n),setContext:e=>Ze(t,e,i,n),override:s=>Ze(t.override(s),e,i,n)};return new Proxy(s,{deleteProperty:(e,i)=>(delete e[i],delete t[i],!0),get:(t,e,i)=>ti(t,e,(()=>function(t,e,i){const{_proxy:n,_context:s,_subProxy:r,_descriptors:o}=t;let a=n[e];return yt(a)&&o.isScriptable(e)&&(a=function(t,e,i,n){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=i;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);a.add(t);let l=e(r,o||n);return a.delete(t),Qe(t,l)&&(l=si(s._scopes,s,t,l)),l}(e,a,t,i)),et(a)&&a.length&&(a=function(t,e,i,n){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=i;if(void 0!==r.index&&n(t))return e[r.index%e.length];if(it(e[0])){const i=e,n=s._scopes.filter((t=>t!==i));e=[];for(const l of i){const i=si(n,s,t,l);e.push(Ze(i,r,o&&o[t],a))}}return e}(e,a,t,o.isIndexable)),Qe(e,a)&&(a=Ze(a,s,r&&r[e],o)),a}(t,e,i))),getOwnPropertyDescriptor:(e,i)=>e._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,i)=>Reflect.has(t,i),ownKeys:()=>Reflect.ownKeys(t),set:(e,i,n)=>(t[i]=n,delete e[i],!0)})}function $e(t,e={scriptable:!0,indexable:!0}){const{_scriptable:i=e.scriptable,_indexable:n=e.indexable,_allKeys:s=e.allKeys}=t;return{allKeys:s,scriptable:i,indexable:n,isScriptable:yt(i)?i:()=>i,isIndexable:yt(n)?n:()=>n}}const Je=(t,e)=>t?t+_t(e):e,Qe=(t,e)=>it(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function ti(t,e,i){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const n=i();return t[e]=n,n}function ei(t,e,i){return yt(t)?t(e,i):t}const ii=(t,e)=>!0===t?e:"string"==typeof t?vt(e,t):void 0;function ni(t,e,i,n,s){for(const r of e){const e=ii(i,r);if(e){t.add(e);const r=ei(e._fallback,i,s);if(void 0!==r&&r!==i&&r!==n)return r}else if(!1===e&&void 0!==n&&i!==n)return null}return!1}function si(t,e,i,n){const s=e._rootScopes,r=ei(e._fallback,i,n),o=[...t,...s],a=new Set;a.add(n);let l=ri(a,o,i,r||i,n);return null!==l&&(void 0===r||r===i||(l=ri(a,o,r,l,n),null!==l))&&Ke(Array.from(a),[""],s,r,(()=>function(t,e,i){const n=t._getTarget();e in n||(n[e]={});const s=n[e];return et(s)&&it(i)?i:s||{}}(e,i,n)))}function ri(t,e,i,n,s){for(;i;)i=ni(t,e,i,n,s);return i}function oi(t,e){for(const i of e){if(!i)continue;const e=i[t];if(void 0!==e)return e}}function ai(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const i of t)for(const t of Object.keys(i).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function li(t,e,i,n){const{iScale:s}=t,{key:r="r"}=this._parsing,o=new Array(n);let a,l,h,c;for(a=0,l=n;a<l;++a)h=a+i,c=e[h],o[a]={r:s.parse(vt(c,r),h)};return o}const hi=Number.EPSILON||1e-14,ci=(t,e)=>e<t.length&&!t[e].skip&&t[e],di=t=>"x"===t?"y":"x";function ui(t,e,i,n){const s=t.skip?e:t,r=e,o=i.skip?e:i,a=zt(r,s),l=zt(o,r);let h=a/(a+l),c=l/(a+l);h=isNaN(h)?0:h,c=isNaN(c)?0:c;const d=n*h,u=n*c;return{previous:{x:r.x-d*(o.x-s.x),y:r.y-d*(o.y-s.y)},next:{x:r.x+u*(o.x-s.x),y:r.y+u*(o.y-s.y)}}}function pi(t,e,i){return Math.max(Math.min(t,i),e)}function fi(t,e,i,n,s){let r,o,a,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)!function(t,e="x"){const i=di(e),n=t.length,s=Array(n).fill(0),r=Array(n);let o,a,l,h=ci(t,0);for(o=0;o<n;++o)if(a=l,l=h,h=ci(t,o+1),l){if(h){const t=h[e]-l[e];s[o]=0!==t?(h[i]-l[i])/t:0}r[o]=a?h?Rt(s[o-1])!==Rt(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}!function(t,e,i){const n=t.length;let s,r,o,a,l,h=ci(t,0);for(let c=0;c<n-1;++c)l=h,h=ci(t,c+1),l&&h&&(Dt(e[c],0,hi)?i[c]=i[c+1]=0:(s=i[c]/e[c],r=i[c+1]/e[c],a=Math.pow(s,2)+Math.pow(r,2),a<=9||(o=3/Math.sqrt(a),i[c]=s*o*e[c],i[c+1]=r*o*e[c])))}(t,s,r),function(t,e,i="x"){const n=di(i),s=t.length;let r,o,a,l=ci(t,0);for(let h=0;h<s;++h){if(o=a,a=l,l=ci(t,h+1),!a)continue;const s=a[i],c=a[n];o&&(r=(s-o[i])/3,a[`cp1${i}`]=s-r,a[`cp1${n}`]=c-r*e[h]),l&&(r=(l[i]-s)/3,a[`cp2${i}`]=s+r,a[`cp2${n}`]=c+r*e[h])}}(t,r,e)}(t,s);else{let i=n?t[t.length-1]:t[0];for(r=0,o=t.length;r<o;++r)a=t[r],l=ui(i,a,t[Math.min(r+1,o-(n?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,i=a}e.capBezierPoints&&function(t,e){let i,n,s,r,o,a=Pe(t[0],e);for(i=0,n=t.length;i<n;++i)o=r,r=a,a=i<n-1&&Pe(t[i+1],e),r&&(s=t[i],o&&(s.cp1x=pi(s.cp1x,e.left,e.right),s.cp1y=pi(s.cp1y,e.top,e.bottom)),a&&(s.cp2x=pi(s.cp2x,e.left,e.right),s.cp2y=pi(s.cp2y,e.top,e.bottom)))}(t,i)}function mi(){return"undefined"!=typeof window&&"undefined"!=typeof document}function gi(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function vi(t,e,i){let n;return"string"==typeof t?(n=parseInt(t,10),-1!==t.indexOf("%")&&(n=n/100*e.parentNode[i])):n=t,n}const _i=t=>t.ownerDocument.defaultView.getComputedStyle(t,null),xi=["top","right","bottom","left"];function yi(t,e,i){const n={};i=i?"-"+i:"";for(let s=0;s<4;s++){const r=xi[s];n[r]=parseFloat(t[e+"-"+r+i])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const bi=(t,e,i)=>(t>0||e>0)&&(!i||!i.shadowRoot);function Mi(t,e){if("native"in t)return t;const{canvas:i,currentDevicePixelRatio:n}=e,s=_i(i),r="border-box"===s.boxSizing,o=yi(s,"padding"),a=yi(s,"border","width"),{x:l,y:h,box:c}=function(t,e){const i=t.touches,n=i&&i.length?i[0]:t,{offsetX:s,offsetY:r}=n;let o,a,l=!1;if(bi(s,r,t.target))o=s,a=r;else{const t=e.getBoundingClientRect();o=n.clientX-t.left,a=n.clientY-t.top,l=!0}return{x:o,y:a,box:l}}(t,i),d=o.left+(c&&a.left),u=o.top+(c&&a.top);let{width:p,height:f}=e;return r&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-d)/p*i.width/n),y:Math.round((h-u)/f*i.height/n)}}const Si=t=>Math.round(10*t)/10;function wi(t,e,i){const n=e||1,s=Math.floor(t.height*n),r=Math.floor(t.width*n);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const o=t.canvas;return o.style&&(i||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==n||o.height!==s||o.width!==r)&&(t.currentDevicePixelRatio=n,o.height=s,o.width=r,t.ctx.setTransform(n,0,0,n,0,0),!0)}const Ti=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function Ei(t,e){const i=function(t,e){return _i(t).getPropertyValue(e)}(t,e),n=i&&i.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Ai(t,e,i,n){return{x:t.x+i*(e.x-t.x),y:t.y+i*(e.y-t.y)}}function Ci(t,e,i,n){return{x:t.x+i*(e.x-t.x),y:"middle"===n?i<.5?t.y:e.y:"after"===n?i<1?t.y:e.y:i>0?e.y:t.y}}function Pi(t,e,i,n){const s={x:t.cp2x,y:t.cp2y},r={x:e.cp1x,y:e.cp1y},o=Ai(t,s,i),a=Ai(s,r,i),l=Ai(r,e,i),h=Ai(o,a,i),c=Ai(a,l,i);return Ai(h,c,i)}function Li(t,e,i){return t?function(t,e){return{x:i=>t+t+e-i,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,i):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function Ri(t,e){let i,n;"ltr"!==e&&"rtl"!==e||(i=t.canvas.style,n=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",e,"important"),t.prevTextDirection=n)}function Di(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Ii(t){return"angle"===t?{between:Gt,compare:Ht,normalize:Vt}:{between:jt,compare:(t,e)=>t-e,normalize:t=>t}}function ki({start:t,end:e,count:i,loop:n,style:s}){return{start:t%i,end:e%i,loop:n&&(e-t+1)%i==0,style:s}}function Oi(t,e,i){if(!i)return[t];const{property:n,start:s,end:r}=i,o=e.length,{compare:a,between:l,normalize:h}=Ii(n),{start:c,end:d,loop:u,style:p}=function(t,e,i){const{property:n,start:s,end:r}=i,{between:o,normalize:a}=Ii(n),l=e.length;let h,c,{start:d,end:u,loop:p}=t;if(p){for(d+=l,u+=l,h=0,c=l;h<c&&o(a(e[d%l][n]),s,r);++h)d--,u--;d%=l,u%=l}return u<d&&(u+=l),{start:d,end:u,loop:p,style:t.style}}(t,e,i),f=[];let m,g,v,_=!1,x=null;for(let t=c,i=c;t<=d;++t)g=e[t%o],g.skip||(m=h(g[n]),m!==v&&(_=l(m,s,r),null===x&&(_||l(s,v,m)&&0!==a(s,v))&&(x=0===a(m,s)?t:i),null!==x&&(!_||0===a(r,m)||l(r,v,m))&&(f.push(ki({start:x,end:t,loop:u,count:o,style:p})),x=null),i=t,v=m));return null!==x&&f.push(ki({start:x,end:d,loop:u,count:o,style:p})),f}function Ni(t,e){const i=[],n=t.segments;for(let s=0;s<n.length;s++){const r=Oi(n[s],t.points,e);r.length&&i.push(...r)}return i}function Ui(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Bi(t,e){if(!e)return!1;const i=[],n=function(t,e){return le(e)?(i.includes(e)||i.push(e),i.indexOf(e)):e};return JSON.stringify(t,n)!==JSON.stringify(e,n)}class Fi{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,n){const s=e.listeners[n],r=e.duration;s.forEach((n=>n({chart:t,initial:e.initial,numSteps:r,currentStep:Math.min(i-e.start,r)})))}_refresh(){this._request||(this._running=!0,this._request=Jt.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((i,n)=>{if(!i.running||!i.items.length)return;const s=i.items;let r,o=s.length-1,a=!1;for(;o>=0;--o)r=s[o],r._active?(r._total>i.duration&&(i.duration=r._total),r.tick(t),a=!0):(s[o]=s[s.length-1],s.pop());a&&(n.draw(),this._notify(n,i,t,"progress")),s.length||(i.running=!1,this._notify(n,i,t,"complete"),i.initial=!1),e+=s.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var zi=new Fi;const Hi="transparent",Vi={boolean:(t,e,i)=>i>.5?e:t,color(t,e,i){const n=he(t||Hi),s=n.valid&&he(e||Hi);return s&&s.valid?s.mix(n,i).hexString():e},number:(t,e,i)=>t+(e-t)*i};class Gi{constructor(t,e,i,n){const s=e[i];n=Ye([t.to,n,s,t.from]);const r=Ye([t.from,s,n]);this._active=!0,this._fn=t.fn||Vi[t.type||typeof r],this._easing=ae[t.easing]||ae.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=r,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const n=this._target[this._prop],s=i-this._start,r=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=Ye([t.to,e,n,t.from]),this._from=Ye([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,n=this._prop,s=this._from,r=this._loop,o=this._to;let a;if(this._active=s!==o&&(r||e<i),!this._active)return this._target[n]=o,void this._notify(!0);e<0?this._target[n]=s:(a=e/i%2,a=r&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[n]=this._fn(s,o,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,i)=>{t.push({res:e,rej:i})}))}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let t=0;t<i.length;t++)i[t][e]()}}class Wi{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!it(t))return;const e=Object.keys(Me.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const s=t[n];if(!it(s))return;const r={};for(const t of e)r[t]=s[t];(et(s.properties)&&s.properties||[n]).forEach((t=>{t!==n&&i.has(t)||i.set(t,r)}))}))}_animateOptions(t,e){const i=e.options,n=function(t,e){if(!e)return;let i=t.options;if(i)return i.$shared&&(t.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i;t.options=e}(t,i);if(!n)return[];const s=this._createAnimations(n,i);return i.$shared&&function(t,e){const i=[],n=Object.keys(e);for(let e=0;e<n.length;e++){const s=t[n[e]];s&&s.active()&&i.push(s.wait())}return Promise.all(i)}(t.options.$animations,i).then((()=>{t.options=i}),(()=>{})),s}_createAnimations(t,e){const i=this._properties,n=[],s=t.$animations||(t.$animations={}),r=Object.keys(e),o=Date.now();let a;for(a=r.length-1;a>=0;--a){const l=r[a];if("$"===l.charAt(0))continue;if("options"===l){n.push(...this._animateOptions(t,e));continue}const h=e[l];let c=s[l];const d=i.get(l);if(c){if(d&&c.active()){c.update(d,h,o);continue}c.cancel()}d&&d.duration?(s[l]=c=new Gi(d,t,l,h),n.push(c)):t[l]=h}return n}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const i=this._createAnimations(t,e);return i.length?(zi.add(this._chart,i),!0):void 0}}function ji(t,e){const i=t&&t.options||{},n=i.reverse,s=void 0===i.min?e:0,r=void 0===i.max?e:0;return{start:n?r:s,end:n?s:r}}function Xi(t,e){const i=[],n=t._getSortedDatasetMetas(e);let s,r;for(s=0,r=n.length;s<r;++s)i.push(n[s].index);return i}function Yi(t,e,i,n={}){const s=t.keys,r="single"===n.mode;let o,a,l,h;if(null!==e){for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===i){if(n.all)continue;break}h=t.values[l],nt(h)&&(r||0===e||Rt(e)===Rt(h))&&(e+=h)}return e}}function qi(t,e){const i=t&&t.options.stacked;return i||void 0===i&&void 0!==e.stack}function Ki(t,e,i){const n=t[e]||(t[e]={});return n[i]||(n[i]={})}function Zi(t,e,i,n){for(const s of e.getMatchingVisibleMetas(n).reverse()){const e=t[s.index];if(i&&e>0||!i&&e<0)return s.index}return null}function $i(t,e){const{chart:i,_cachedMeta:n}=t,s=i._stacks||(i._stacks={}),{iScale:r,vScale:o,index:a}=n,l=r.axis,h=o.axis,c=function(t,e,i){return`${t.id}.${e.id}.${i.stack||i.type}`}(r,o,n),d=e.length;let u;for(let t=0;t<d;++t){const i=e[t],{[l]:r,[h]:d}=i;u=(i._stacks||(i._stacks={}))[h]=Ki(s,c,r),u[a]=d,u._top=Zi(u,o,!0,n.type),u._bottom=Zi(u,o,!1,n.type),(u._visualValues||(u._visualValues={}))[a]=d}}function Ji(t,e){const i=t.scales;return Object.keys(i).filter((t=>i[t].axis===e)).shift()}function Qi(t,e){const i=t.controller.index,n=t.vScale&&t.vScale.axis;if(n){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[n]||void 0===e[n][i])return;delete e[n][i],void 0!==e[n]._visualValues&&void 0!==e[n]._visualValues[i]&&delete e[n]._visualValues[i]}}}const tn=t=>"reset"===t||"none"===t,en=(t,e)=>e?t:Object.assign({},t);class nn{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=qi(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Qi(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),n=(t,e,i,n)=>"x"===t?e:"r"===t?n:i,s=e.xAxisID=rt(i.xAxisID,Ji(t,"x")),r=e.yAxisID=rt(i.yAxisID,Ji(t,"y")),o=e.rAxisID=rt(i.rAxisID,Ji(t,"r")),a=e.indexAxis,l=e.iAxisID=n(a,s,r,o),h=e.vAxisID=n(a,r,s,o);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(r),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Zt(this._data,this),t._stacked&&Qi(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(it(e))this._data=function(t){const e=Object.keys(t),i=new Array(e.length);let n,s,r;for(n=0,s=e.length;n<s;++n)r=e[n],i[n]={x:r,y:t[r]};return i}(e);else if(i!==e){if(i){Zt(i,this);const t=this._cachedMeta;Qi(t),t._parsed=[]}e&&Object.isExtensible(e)&&(this,(n=e)._chartjs?n._chartjs.listeners.push(this):(Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),Kt.forEach((t=>{const e="_onData"+_t(t),i=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...t){const s=i.apply(this,t);return n._chartjs.listeners.forEach((i=>{"function"==typeof i[e]&&i[e](...t)})),s}})})))),this._syncList=[],this._data=e}var n}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const s=e._stacked;e._stacked=qi(e.vScale,e),e.stack!==i.stack&&(n=!0,Qi(e),e.stack=i.stack),this._resyncElements(t),(n||s!==e._stacked)&&$i(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:n}=this,{iScale:s,_stacked:r}=i,o=s.axis;let a,l,h,c=0===t&&e===n.length||i._sorted,d=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=n,i._sorted=!0,h=n;else{h=et(n[t])?this.parseArrayData(i,n,t,e):it(n[t])?this.parseObjectData(i,n,t,e):this.parsePrimitiveData(i,n,t,e);const s=()=>null===l[o]||d&&l[o]<d[o];for(a=0;a<e;++a)i._parsed[a+t]=l=h[a],c&&(s()&&(c=!1),d=l);i._sorted=c}r&&$i(this,h)}parsePrimitiveData(t,e,i,n){const{iScale:s,vScale:r}=t,o=s.axis,a=r.axis,l=s.getLabels(),h=s===r,c=new Array(n);let d,u,p;for(d=0,u=n;d<u;++d)p=d+i,c[d]={[o]:h||s.parse(l[p],p),[a]:r.parse(e[p],p)};return c}parseArrayData(t,e,i,n){const{xScale:s,yScale:r}=t,o=new Array(n);let a,l,h,c;for(a=0,l=n;a<l;++a)h=a+i,c=e[h],o[a]={x:s.parse(c[0],h),y:r.parse(c[1],h)};return o}parseObjectData(t,e,i,n){const{xScale:s,yScale:r}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(n);let h,c,d,u;for(h=0,c=n;h<c;++h)d=h+i,u=e[d],l[h]={x:s.parse(vt(u,o),d),y:r.parse(vt(u,a),d)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const n=this.chart,s=this._cachedMeta,r=e[t.axis];return Yi({keys:Xi(n,!0),values:e._stacks[t.axis]._visualValues},r,s.index,{mode:i})}updateRangeFromParsed(t,e,i,n){const s=i[e.axis];let r=null===s?NaN:s;const o=n&&i._stacks[e.axis];n&&o&&(n.values=o,r=Yi(n,s,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,e){const i=this._cachedMeta,n=i._parsed,s=i._sorted&&t===i.iScale,r=n.length,o=this._getOtherScale(t),a=((t,e,i)=>t&&!e.hidden&&e._stacked&&{keys:Xi(i,!0),values:null})(e,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:c}=function(t){const{min:e,max:i,minDefined:n,maxDefined:s}=t.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:s?i:Number.POSITIVE_INFINITY}}(o);let d,u;function p(){u=n[d];const e=u[o.axis];return!nt(u[t.axis])||h>e||c<e}for(d=0;d<r&&(p()||(this.updateRangeFromParsed(l,t,u,a),!s));++d);if(s)for(d=r-1;d>=0;--d)if(!p()){this.updateRangeFromParsed(l,t,u,a);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let n,s,r;for(n=0,s=e.length;n<s;++n)r=e[n][t.axis],nt(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,n=e.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:n?""+n.getLabelForValue(s[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,i,n,s;return it(t)?(e=t.top,i=t.right,n=t.bottom,s=t.left):e=i=n=s=t,{top:e,right:i,bottom:n,left:s,disabled:!1===t}}(rt(this.options.clip,function(t,e,i){if(!1===i)return!1;const n=ji(t,i),s=ji(e,i);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,n=i.data||[],s=e.chartArea,r=[],o=this._drawStart||0,a=this._drawCount||n.length-o,l=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,s,o,a),h=o;h<o+a;++h){const e=n[h];e.hidden||(e.active&&l?r.push(e):e.draw(t,s))}for(h=0;h<r.length;++h)r[h].draw(t,s)}getStyle(t,e){const i=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const n=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];s=e.$context||(e.$context=function(t,e,i){return qe(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:i,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),s.parsed=this.getParsed(t),s.raw=n.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=function(t,e){return qe(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=n,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const n="active"===e,s=this._cachedDataOpts,r=t+"-"+e,o=s[r],a=this.enableOptionSharing&&xt(i);if(o)return en(o,a);const l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),c=n?[`${t}Hover`,"hover",t,""]:[t,""],d=l.getOptionScopes(this.getDataset(),h),u=Object.keys(Me.elements[t]),p=l.resolveNamedOptions(d,u,(()=>this.getContext(i,n,e)),c);return p.$shared&&(p.$shared=a,s[r]=Object.freeze(en(p,a))),p}_resolveAnimations(t,e,i){const n=this.chart,s=this._cachedDataOpts,r=`animation-${e}`,o=s[r];if(o)return o;let a;if(!1!==n.options.animation){const n=this.chart.config,s=n.datasetAnimationScopeKeys(this._type,e),r=n.getOptionScopes(this.getDataset(),s);a=n.createResolver(r,this.getContext(t,i,e))}const l=new Wi(n,a&&a.animations);return a&&a._cacheable&&(s[r]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||tn(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),n=this._sharedOptions,s=this.getSharedOptions(i),r=this.includeOptions(e,s)||s!==n;return this.updateSharedOptions(s,e,i),{sharedOptions:s,includeOptions:r}}updateElement(t,e,i,n){tn(n)?Object.assign(t,i):this._resolveAnimations(e,n).update(t,i)}updateSharedOptions(t,e,i){t&&!tn(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,n){t.active=n;const s=this.getStyle(e,n);this._resolveAnimations(e,i,n).update(t,{options:!n&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[t,e,i]of this._syncList)this[t](e,i);this._syncList=[];const n=i.length,s=e.length,r=Math.min(s,n);r&&this.parse(0,r),s>n?this._insertElements(n,s-n,t):s<n&&this._removeElements(s,n-s)}_insertElements(t,e,i=!0){const n=this._cachedMeta,s=n.data,r=t+e;let o;const a=t=>{for(t.length+=e,o=t.length-1;o>=r;o--)t[o]=t[o-e]};for(a(s),o=t;o<r;++o)s[o]=new this.dataElementType;this._parsing&&a(n._parsed),this.parse(t,e),i&&this.updateElements(s,t,e,"reset")}updateElements(t,e,i,n){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(t,e);i._stacked&&Qi(i,n)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,n]=t;this[e](i,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function sn(t){const e=t.iScale,i=function(t,e){if(!t._cache.$bar){const i=t.getMatchingVisibleMetas(e);let n=[];for(let e=0,s=i.length;e<s;e++)n=n.concat(i[e].controller.getAllParsedValues(t));t._cache.$bar=$t(n.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let n,s,r,o,a=e._length;const l=()=>{32767!==r&&-32768!==r&&(xt(o)&&(a=Math.min(a,Math.abs(r-o)||a)),o=r)};for(n=0,s=i.length;n<s;++n)r=e.getPixelForValue(i[n]),l();for(o=void 0,n=0,s=e.ticks.length;n<s;++n)r=e.getPixelForTick(n),l();return a}function rn(t,e,i,n){return et(t)?function(t,e,i,n){const s=i.parse(t[0],n),r=i.parse(t[1],n),o=Math.min(s,r),a=Math.max(s,r);let l=o,h=a;Math.abs(o)>Math.abs(a)&&(l=a,h=o),e[i.axis]=h,e._custom={barStart:l,barEnd:h,start:s,end:r,min:o,max:a}}(t,e,i,n):e[i.axis]=i.parse(t,n),e}function on(t,e,i,n){const s=t.iScale,r=t.vScale,o=s.getLabels(),a=s===r,l=[];let h,c,d,u;for(h=i,c=i+n;h<c;++h)u=e[h],d={},d[s.axis]=a||s.parse(o[h],h),l.push(rn(u,d,r,h));return l}function an(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function ln(t,e,i,n){let s=e.borderSkipped;const r={};if(!s)return void(t.borderSkipped=r);if(!0===s)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:l,top:h,bottom:c}=function(t){let e,i,n,s,r;return t.horizontal?(e=t.base>t.x,i="left",n="right"):(e=t.base<t.y,i="bottom",n="top"),e?(s="end",r="start"):(s="start",r="end"),{start:i,end:n,reverse:e,top:s,bottom:r}}(t);"middle"===s&&i&&(t.enableBorderRadius=!0,(i._top||0)===n?s=h:(i._bottom||0)===n?s=c:(r[hn(c,o,a,l)]=!0,s=h)),r[hn(s,o,a,l)]=!0,t.borderSkipped=r}function hn(t,e,i,n){var s,r,o;return n?(o=i,t=cn(t=(s=t)===(r=e)?o:s===o?r:s,i,e)):t=cn(t,e,i),t}function cn(t,e,i){return"start"===t?e:"end"===t?i:t}function dn(t,{inflateAmount:e},i){t.inflateAmount="auto"===e?1===i?.33:0:e}class un extends nn{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map(((e,s)=>{const r=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:n,lineWidth:r.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,n=this._cachedMeta;if(!1===this._parsing)n._parsed=i;else{let s,r,o=t=>+i[t];if(it(i[t])){const{key:t="value"}=this._parsing;o=e=>+vt(i[e],t)}for(s=t,r=t+e;s<r;++s)n._parsed[s]=o(s)}}_getRotation(){return Nt(this.options.rotation-90)}_getCircumference(){return Nt(this.options.circumference)}_getRotationExtents(){let t=St,e=-St;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,s=n._getRotation(),r=n._getCircumference();t=Math.min(t,s),e=Math.max(e,s+r)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,n=this._cachedMeta,s=n.data,r=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,o=Math.max((Math.min(i.width,i.height)-r)/2,0),a=Math.min((h=o,"string"==typeof(l=this.options.cutout)&&l.endsWith("%")?parseFloat(l)/100:+l/h),1);var l,h;const c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,i){let n=1,s=1,r=0,o=0;if(e<St){const a=t,l=a+e,h=Math.cos(a),c=Math.sin(a),d=Math.cos(l),u=Math.sin(l),p=(t,e,n)=>Gt(t,a,l,!0)?1:Math.max(e,e*i,n,n*i),f=(t,e,n)=>Gt(t,a,l,!0)?-1:Math.min(e,e*i,n,n*i),m=p(0,h,d),g=p(At,c,u),v=f(Mt,h,d),_=f(Mt+At,c,u);n=(m-v)/2,s=(g-_)/2,r=-(m+v)/2,o=-(g+_)/2}return{ratioX:n,ratioY:s,offsetX:r,offsetY:o}}(u,d,a),v=(i.width-r)/p,_=(i.height-r)/f,x=Math.max(Math.min(v,_)/2,0),y=ot(this.options.radius,x),b=(y-Math.max(y*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*y,this.offsetY=g*y,n.total=this.calculateTotal(),this.outerRadius=y-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*c,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const i=this.options,n=this._cachedMeta,s=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===n._parsed[t]||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*s/St)}updateElements(t,e,i,n){const s="reset"===n,r=this.chart,o=r.chartArea,a=r.options.animation,l=(o.left+o.right)/2,h=(o.top+o.bottom)/2,c=s&&a.animateScale,d=c?0:this.innerRadius,u=c?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,n);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,s);for(m=e;m<e+i;++m){const e=this._circumference(m,s),i=t[m],r={x:l+this.offsetX,y:h+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:u,innerRadius:d};f&&(r.options=p||this.resolveDataElementOptions(m,i.active?"active":n)),g+=e,this.updateElement(i,m,r,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i,n=0;for(i=0;i<e.length;i++){const s=t._parsed[i];null===s||isNaN(s)||!this.chart.getDataVisibility(i)||e[i].hidden||(n+=Math.abs(s))}return n}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?St*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],s=fe(e._parsed[t],i.options.locale);return{label:n[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const i=this.chart;let n,s,r,o,a;if(!t)for(n=0,s=i.data.datasets.length;n<s;++n)if(i.isDatasetVisible(n)){r=i.getDatasetMeta(n),t=r.data,o=r.controller;break}if(!t)return 0;for(n=0,s=t.length;n<s;++n)a=o.resolveDataElementOptions(n),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,n=t.length;i<n;++i){const t=this.resolveDataElementOptions(i);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(rt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class pn extends nn{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map(((e,s)=>{const r=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:n,lineWidth:r.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],s=fe(e._parsed[t].r,i.options.locale);return{label:n[t]||"",value:s}}parseObjectData(t,e,i,n){return li.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,i)=>{const n=this.getParsed(i).r;!isNaN(n)&&this.chart.getDataVisibility(i)&&(n<e.min&&(e.min=n),n>e.max&&(e.max=n))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(n/2,0),r=(s-Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,i,n){const s="reset"===n,r=this.chart,o=r.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,h=a.yCenter,c=a.getIndexAngle(0)-.5*Mt;let d,u=c;const p=360/this.countVisibleElements();for(d=0;d<e;++d)u+=this._computeAngle(d,n,p);for(d=e;d<e+i;d++){const e=t[d];let i=u,f=u+this._computeAngle(d,n,p),m=r.getDataVisibility(d)?a.getDistanceFromCenterForValue(this.getParsed(d).r):0;u=f,s&&(o.animateScale&&(m=0),o.animateRotate&&(i=f=c));const g={x:l,y:h,innerRadius:0,outerRadius:m,startAngle:i,endAngle:f,options:this.resolveDataElementOptions(d,e.active?"active":n)};this.updateElement(e,d,g,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++})),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?Nt(this.resolveDataElementOptions(t,e).angle||i):0}}var fn=Object.freeze({__proto__:null,BarController:class extends nn{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,n){return on(t,e,i,n)}parseArrayData(t,e,i,n){return on(t,e,i,n)}parseObjectData(t,e,i,n){const{iScale:s,vScale:r}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===s.axis?o:a,h="x"===r.axis?o:a,c=[];let d,u,p,f;for(d=i,u=i+n;d<u;++d)f=e[d],p={},p[s.axis]=s.parse(vt(f,l),d),c.push(rn(vt(f,h),p,r,d));return c}updateRangeFromParsed(t,e,i,n){super.updateRangeFromParsed(t,e,i,n);const s=i._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:n}=e,s=this.getParsed(t),r=s._custom,o=an(r)?"["+r.start+", "+r.end+"]":""+n.getLabelForValue(s[n.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const s="reset"===n,{index:r,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),h=this._getRuler(),{sharedOptions:c,includeOptions:d}=this._getSharedOptions(e,n);for(let u=e;u<e+i;u++){const e=this.getParsed(u),i=s||tt(e[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(u),p=this._calculateBarIndexPixels(u,h),f=(e._stacks||{})[o.axis],m={horizontal:l,base:i.base,enableBorderRadius:!f||an(e._custom)||r===f._top||r===f._bottom,x:l?i.head:p.center,y:l?p.center:i.head,height:l?p.size:Math.abs(i.size),width:l?Math.abs(i.size):p.size};d&&(m.options=c||this.resolveDataElementOptions(u,t[u].active?"active":n));const g=m.options||t[u].options;ln(m,g,f,r),dn(m,g,h.ratio),this.updateElement(t[u],u,m,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),s=i.options.stacked,r=[],o=t=>{const i=t.controller.getParsed(e),n=i&&i[t.vScale.axis];if(tt(n)||isNaN(n))return!0};for(const i of n)if((void 0===e||!o(i))&&((!1===s||-1===r.indexOf(i.stack)||void 0===s&&void 0===i.stack)&&r.push(i.stack),i.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,i){const n=this._getStacks(t,i),s=void 0!==e?n.indexOf(e):-1;return-1===s?n.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,n=[];let s,r;for(s=0,r=e.data.length;s<r;++s)n.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const o=t.barThickness;return{min:o||sn(e),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:s,minBarLength:r}}=this,o=s||0,a=this.getParsed(t),l=a._custom,h=an(l);let c,d,u=a[e.axis],p=0,f=i?this.applyStack(e,a,i):u;f!==u&&(p=f-u,f=u),h&&(u=l.barStart,f=l.barEnd-l.barStart,0!==u&&Rt(u)!==Rt(l.barEnd)&&(p=0),p+=u);const m=tt(s)||h?p:s;let g=e.getPixelForValue(m);if(c=this.chart.getDataVisibility(t)?e.getPixelForValue(p+f):g,d=c-g,Math.abs(d)<r){d=function(t,e,i){return 0!==t?Rt(t):(e.isHorizontal()?1:-1)*(e.min>=i?1:-1)}(d,e,o)*r,u===o&&(g-=d/2);const t=e.getPixelForDecimal(0),s=e.getPixelForDecimal(1),l=Math.min(t,s),p=Math.max(t,s);g=Math.max(Math.min(g,p),l),c=g+d,i&&!h&&(a._stacks[e.axis]._visualValues[n]=e.getValueForPixel(c)-e.getValueForPixel(g))}if(g===e.getPixelForValue(o)){const t=Rt(d)*e.getLineWidthForValue(o)/2;g+=t,d-=t}return{size:d,base:g,head:c,center:c+d/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,s=n.skipNull,r=rt(n.maxBarThickness,1/0);let o,a;if(e.grouped){const i=s?this._getStackCount(t):e.stackCount,l="flex"===n.barThickness?function(t,e,i,n){const s=e.pixels,r=s[t];let o=t>0?s[t-1]:null,a=t<s.length-1?s[t+1]:null;const l=i.categoryPercentage;null===o&&(o=r-(null===a?e.end-e.start:a-r)),null===a&&(a=r+r-o);const h=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/n,ratio:i.barPercentage,start:h}}(t,e,n,i):function(t,e,i,n){const s=i.barThickness;let r,o;return tt(s)?(r=e.min*i.categoryPercentage,o=i.barPercentage):(r=s*n,o=1),{chunk:r/n,ratio:o,start:e.pixels[t]-r/2}}(t,e,n,i),h=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0);o=l.start+l.chunk*h+l.chunk/2,a=Math.min(r,l.chunk*l.ratio)}else o=i.getPixelForValue(this.getParsed(t)[i.axis],t),a=Math.min(r,e.min*e.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,n=i.length;let s=0;for(;s<n;++s)null!==this.getParsed(s)[e.axis]&&i[s].draw(this._ctx)}},BubbleController:class extends nn{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,n){const s=super.parsePrimitiveData(t,e,i,n);for(let t=0;t<s.length;t++)s[t]._custom=this.resolveDataElementOptions(t+i).radius;return s}parseArrayData(t,e,i,n){const s=super.parseArrayData(t,e,i,n);for(let t=0;t<s.length;t++){const n=e[i+t];s[t]._custom=rt(n[2],this.resolveDataElementOptions(t+i).radius)}return s}parseObjectData(t,e,i,n){const s=super.parseObjectData(t,e,i,n);for(let t=0;t<s.length;t++){const n=e[i+t];s[t]._custom=rt(n&&n.r&&+n.r,this.resolveDataElementOptions(t+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:s}=e,r=this.getParsed(t),o=n.getLabelForValue(r.x),a=s.getLabelForValue(r.y),l=r._custom;return{label:i[t]||"",value:"("+o+", "+a+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,n){const s="reset"===n,{iScale:r,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(e,n),h=r.axis,c=o.axis;for(let d=e;d<e+i;d++){const e=t[d],i=!s&&this.getParsed(d),u={},p=u[h]=s?r.getPixelForDecimal(.5):r.getPixelForValue(i[h]),f=u[c]=s?o.getBasePixel():o.getPixelForValue(i[c]);u.skip=isNaN(p)||isNaN(f),l&&(u.options=a||this.resolveDataElementOptions(d,e.active?"active":n),s&&(u.options.radius=0)),this.updateElement(e,d,u,n)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const s=n.radius;return"active"!==e&&(n.radius=0),n.radius+=rt(i&&i._custom,s),n}},DoughnutController:un,LineController:class extends nn{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:n=[],_dataset:s}=e,r=this.chart._animationsDisabled;let{start:o,count:a}=ie(e,n,r);this._drawStart=o,this._drawCount=a,ne(e)&&(o=0,a=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=n;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:l},t),this.updateElements(n,o,a,t)}updateElements(t,e,i,n){const s="reset"===n,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:h,includeOptions:c}=this._getSharedOptions(e,n),d=r.axis,u=o.axis,{spanGaps:p,segment:f}=this.options,m=kt(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||s||"none"===n,v=e+i,_=t.length;let x=e>0&&this.getParsed(e-1);for(let i=0;i<_;++i){const p=t[i],_=g?p:{};if(i<e||i>=v){_.skip=!0;continue}const y=this.getParsed(i),b=tt(y[u]),M=_[d]=r.getPixelForValue(y[d],i),S=_[u]=s||b?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,y,a):y[u],i);_.skip=isNaN(M)||isNaN(S)||b,_.stop=i>0&&Math.abs(y[d]-x[d])>m,f&&(_.parsed=y,_.raw=l.data[i]),c&&(_.options=h||this.resolveDataElementOptions(i,p.active?"active":n)),g||this.updateElement(p,i,_,n),x=y}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return i;const s=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,s,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}},PieController:class extends un{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:pn,RadarController:class extends nn{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,n){return li.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta,i=e.dataset,n=e.data||[],s=e.iScale.getLabels();if(i.points=n,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===n.length,options:e};this.updateElement(i,void 0,r,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,i,n){const s=this._cachedMeta.rScale,r="reset"===n;for(let o=e;o<e+i;o++){const e=t[o],i=this.resolveDataElementOptions(o,e.active?"active":n),a=s.getPointPositionForValue(o,this.getParsed(o).r),l=r?s.xCenter:a.x,h=r?s.yCenter:a.y,c={x:l,y:h,angle:a.angle,skip:isNaN(l)||isNaN(h),options:i};this.updateElement(e,o,c,n)}}},ScatterController:class extends nn{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:s}=e,r=this.getParsed(t),o=n.getLabelForValue(r.x),a=s.getLabelForValue(r.y);return{label:i[t]||"",value:"("+o+", "+a+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,n=this.chart._animationsDisabled;let{start:s,count:r}=ie(e,i,n);if(this._drawStart=s,this._drawCount=r,ne(e)&&(s=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:s,_dataset:r}=e;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=i;const o=this.resolveDatasetElementOptions(t);o.segment=this.options.segment,this.updateElement(s,void 0,{animated:!n,options:o},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,s,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const s="reset"===n,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,h=this.resolveDataElementOptions(e,n),c=this.getSharedOptions(h),d=this.includeOptions(n,c),u=r.axis,p=o.axis,{spanGaps:f,segment:m}=this.options,g=kt(f)?f:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||s||"none"===n;let _=e>0&&this.getParsed(e-1);for(let h=e;h<e+i;++h){const e=t[h],i=this.getParsed(h),f=v?e:{},x=tt(i[p]),y=f[u]=r.getPixelForValue(i[u],h),b=f[p]=s||x?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,i,a):i[p],h);f.skip=isNaN(y)||isNaN(b)||x,f.stop=h>0&&Math.abs(i[u]-_[u])>g,m&&(f.parsed=i,f.raw=l.data[h]),d&&(f.options=c||this.resolveDataElementOptions(h,e.active?"active":n)),v||this.updateElement(e,h,f,n),_=i}this.updateSharedOptions(c,n,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}const i=t.dataset,n=i.options&&i.options.borderWidth||0;if(!e.length)return n;const s=e[0].size(this.resolveDataElementOptions(0)),r=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,s,r)/2}}});function mn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class gn{static override(t){Object.assign(gn.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return mn()}parse(){return mn()}format(){return mn()}add(){return mn()}diff(){return mn()}startOf(){return mn()}endOf(){return mn()}}var vn=gn;function _n(t,e,i,n){const{controller:s,data:r,_sorted:o}=t,a=s._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&o&&r.length){const t=a._reversePixels?qt:Yt;if(!n)return t(r,e,i);if(s._sharedOptions){const n=r[0],s="function"==typeof n.getRange&&n.getRange(e);if(s){const n=t(r,e,i-s),o=t(r,e,i+s);return{lo:n.lo,hi:o.hi}}}}return{lo:0,hi:r.length-1}}function xn(t,e,i,n,s){const r=t.getSortedVisibleDatasetMetas(),o=i[e];for(let t=0,i=r.length;t<i;++t){const{index:i,data:a}=r[t],{lo:l,hi:h}=_n(r[t],e,o,s);for(let t=l;t<=h;++t){const e=a[t];e.skip||n(e,i,t)}}}function yn(t,e,i,n,s){const r=[];return s||t.isPointInArea(e)?(xn(t,i,e,(function(i,o,a){(s||Pe(i,t.chartArea,0))&&i.inRange(e.x,e.y,n)&&r.push({element:i,datasetIndex:o,index:a})}),!0),r):r}function bn(t,e,i,n,s,r){return r||t.isPointInArea(e)?"r"!==i||n?function(t,e,i,n,s,r){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,n){const s=e?Math.abs(t.x-n.x):0,r=i?Math.abs(t.y-n.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(r,2))}}(i);let l=Number.POSITIVE_INFINITY;return xn(t,i,e,(function(i,h,c){const d=i.inRange(e.x,e.y,s);if(n&&!d)return;const u=i.getCenterPoint(s);if(!r&&!t.isPointInArea(u)&&!d)return;const p=a(e,u);p<l?(o=[{element:i,datasetIndex:h,index:c}],l=p):p===l&&o.push({element:i,datasetIndex:h,index:c})})),o}(t,e,i,n,s,r):function(t,e,i,n){let s=[];return xn(t,i,e,(function(t,i,r){const{startAngle:o,endAngle:a}=t.getProps(["startAngle","endAngle"],n),{angle:l}=Ft(t,{x:e.x,y:e.y});Gt(l,o,a)&&s.push({element:t,datasetIndex:i,index:r})})),s}(t,e,i,s):[]}function Mn(t,e,i,n,s){const r=[],o="x"===i?"inXRange":"inYRange";let a=!1;return xn(t,i,e,((t,n,l)=>{t[o](e[i],s)&&(r.push({element:t,datasetIndex:n,index:l}),a=a||t.inRange(e.x,e.y,s))})),n&&!a?[]:r}var Sn={evaluateInteractionItems:xn,modes:{index(t,e,i,n){const s=Mi(e,t),r=i.axis||"x",o=i.includeInvisible||!1,a=i.intersect?yn(t,s,r,n,o):bn(t,s,r,!1,n,o),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,i=t.data[e];i&&!i.skip&&l.push({element:i,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,i,n){const s=Mi(e,t),r=i.axis||"xy",o=i.includeInvisible||!1;let a=i.intersect?yn(t,s,r,n,o):bn(t,s,r,!1,n,o);if(a.length>0){const e=a[0].datasetIndex,i=t.getDatasetMeta(e).data;a=[];for(let t=0;t<i.length;++t)a.push({element:i[t],datasetIndex:e,index:t})}return a},point:(t,e,i,n)=>yn(t,Mi(e,t),i.axis||"xy",n,i.includeInvisible||!1),nearest(t,e,i,n){const s=Mi(e,t),r=i.axis||"xy",o=i.includeInvisible||!1;return bn(t,s,r,i.intersect,n,o)},x:(t,e,i,n)=>Mn(t,Mi(e,t),"x",i.intersect,n),y:(t,e,i,n)=>Mn(t,Mi(e,t),"y",i.intersect,n)}};const wn=["left","top","right","bottom"];function Tn(t,e){return t.filter((t=>t.pos===e))}function En(t,e){return t.filter((t=>-1===wn.indexOf(t.pos)&&t.box.axis===e))}function An(t,e){return t.sort(((t,i)=>{const n=e?i:t,s=e?t:i;return n.weight===s.weight?n.index-s.index:n.weight-s.weight}))}function Cn(t,e,i,n){return Math.max(t[i],e[i])+Math.max(t[n],e[n])}function Pn(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Ln(t,e,i,n){const{pos:s,box:r}=i,o=t.maxPadding;if(!it(s)){i.size&&(t[s]-=i.size);const e=n[i.stack]||{size:0,count:1};e.size=Math.max(e.size,i.horizontal?r.height:r.width),i.size=e.size/e.count,t[s]+=i.size}r.getPadding&&Pn(o,r.getPadding());const a=Math.max(0,e.outerWidth-Cn(o,t,"left","right")),l=Math.max(0,e.outerHeight-Cn(o,t,"top","bottom")),h=a!==t.w,c=l!==t.h;return t.w=a,t.h=l,i.horizontal?{same:h,other:c}:{same:c,other:h}}function Rn(t,e){const i=e.maxPadding;return function(t){const n={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{n[t]=Math.max(e[t],i[t])})),n}(t?["left","right"]:["top","bottom"])}function Dn(t,e,i,n){const s=[];let r,o,a,l,h,c;for(r=0,o=t.length,h=0;r<o;++r){a=t[r],l=a.box,l.update(a.width||e.w,a.height||e.h,Rn(a.horizontal,e));const{same:o,other:d}=Ln(e,i,a,n);h|=o&&s.length,c=c||d,l.fullSize||s.push(a)}return h&&Dn(s,e,i,n)||c}function In(t,e,i,n,s){t.top=i,t.left=e,t.right=e+n,t.bottom=i+s,t.width=n,t.height=s}function kn(t,e,i,n){const s=i.padding;let{x:r,y:o}=e;for(const a of t){const t=a.box,l=n[a.stack]||{count:1,placed:0,weight:1},h=a.stackWeight/l.weight||1;if(a.horizontal){const n=e.w*h,r=l.size||t.height;xt(l.start)&&(o=l.start),t.fullSize?In(t,s.left,o,i.outerWidth-s.right-s.left,r):In(t,e.left+l.placed,o,n,r),l.start=o,l.placed+=n,o=t.bottom}else{const n=e.h*h,o=l.size||t.width;xt(l.start)&&(r=l.start),t.fullSize?In(t,r,s.top,o,i.outerHeight-s.bottom-s.top):In(t,r,e.top+l.placed,o,n),l.start=r,l.placed+=n,r=t.right}}e.x=r,e.y=o}var On={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure(t,e,i){e.fullSize=i.fullSize,e.position=i.position,e.weight=i.weight},update(t,e,i,n){if(!t)return;const s=je(t.options.layout.padding),r=Math.max(e-s.width,0),o=Math.max(i-s.height,0),a=function(t){const e=function(t){const e=[];let i,n,s,r,o,a;for(i=0,n=(t||[]).length;i<n;++i)s=t[i],({position:r,options:{stack:o,stackWeight:a=1}}=s),e.push({index:i,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return e}(t),i=An(e.filter((t=>t.box.fullSize)),!0),n=An(Tn(e,"left"),!0),s=An(Tn(e,"right")),r=An(Tn(e,"top"),!0),o=An(Tn(e,"bottom")),a=En(e,"x"),l=En(e,"y");return{fullSize:i,leftAndTop:n.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:Tn(e,"chartArea"),vertical:n.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}(t.boxes),l=a.vertical,h=a.horizontal;lt(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const c=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,d=Object.freeze({outerWidth:e,outerHeight:i,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/c,hBoxMaxHeight:o/2}),u=Object.assign({},s);Pn(u,je(n));const p=Object.assign({maxPadding:u,w:r,h:o,x:s.left,y:s.top},s),f=function(t,e){const i=function(t){const e={};for(const i of t){const{stack:t,pos:n,stackWeight:s}=i;if(!t||!wn.includes(n))continue;const r=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=s}return e}(t),{vBoxMaxWidth:n,hBoxMaxHeight:s}=e;let r,o,a;for(r=0,o=t.length;r<o;++r){a=t[r];const{fullSize:o}=a.box,l=i[a.stack],h=l&&a.stackWeight/l.weight;a.horizontal?(a.width=h?h*n:o&&e.availableWidth,a.height=s):(a.width=n,a.height=h?h*s:o&&e.availableHeight)}return i}(l.concat(h),d);Dn(a.fullSize,p,d,f),Dn(l,p,d,f),Dn(h,p,d,f)&&Dn(l,p,d,f),function(t){const e=t.maxPadding;function i(i){const n=Math.max(e[i]-t[i],0);return t[i]+=n,n}t.y+=i("top"),t.x+=i("left"),i("right"),i("bottom")}(p),kn(a.leftAndTop,p,d,f),p.x+=p.w,p.y+=p.h,kn(a.rightAndBottom,p,d,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},lt(a.chartArea,(e=>{const i=e.box;Object.assign(i,t.chartArea),i.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class Nn{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,n){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):i)}}isAttached(t){return!0}updateConfig(t){}}class Un extends Nn{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Bn="$chartjs",Fn={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zn=t=>null===t||""===t,Hn=!!Ti&&{passive:!0};function Vn(t,e,i){t.canvas.removeEventListener(e,i,Hn)}function Gn(t,e){for(const i of t)if(i===e||i.contains(e))return!0}function Wn(t,e,i){const n=t.canvas,s=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||Gn(i.addedNodes,n),e=e&&!Gn(i.removedNodes,n);e&&i()}));return s.observe(document,{childList:!0,subtree:!0}),s}function jn(t,e,i){const n=t.canvas,s=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||Gn(i.removedNodes,n),e=e&&!Gn(i.addedNodes,n);e&&i()}));return s.observe(document,{childList:!0,subtree:!0}),s}const Xn=new Map;let Yn=0;function qn(){const t=window.devicePixelRatio;t!==Yn&&(Yn=t,Xn.forEach(((e,i)=>{i.currentDevicePixelRatio!==t&&e()})))}function Kn(t,e,i){const n=t.canvas,s=n&&gi(n);if(!s)return;const r=Qt(((t,e)=>{const n=s.clientWidth;i(t,e),n<s.clientWidth&&i()}),window),o=new ResizeObserver((t=>{const e=t[0],i=e.contentRect.width,n=e.contentRect.height;0===i&&0===n||r(i,n)}));return o.observe(s),function(t,e){Xn.size||window.addEventListener("resize",qn),Xn.set(t,e)}(t,r),o}function Zn(t,e,i){i&&i.disconnect(),"resize"===e&&function(t){Xn.delete(t),Xn.size||window.removeEventListener("resize",qn)}(t)}function $n(t,e,i){const n=t.canvas,s=Qt((e=>{null!==t.ctx&&i(function(t,e){const i=Fn[t.type]||t.type,{x:n,y:s}=Mi(t,e);return{type:i,chart:e,native:t,x:void 0!==n?n:null,y:void 0!==s?s:null}}(e,t))}),t);return function(t,e,i){t.addEventListener(e,i,Hn)}(n,e,s),s}class Jn extends Nn{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function(t,e){const i=t.style,n=t.getAttribute("height"),s=t.getAttribute("width");if(t[Bn]={initial:{height:n,width:s,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",zn(s)){const e=Ei(t,"width");void 0!==e&&(t.width=e)}if(zn(n))if(""===t.style.height)t.height=t.width/(e||2);else{const e=Ei(t,"height");void 0!==e&&(t.height=e)}}(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[Bn])return!1;const i=e[Bn].initial;["height","width"].forEach((t=>{const n=i[t];tt(n)?e.removeAttribute(t):e.setAttribute(t,n)}));const n=i.style||{};return Object.keys(n).forEach((t=>{e.style[t]=n[t]})),e.width=e.width,delete e[Bn],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),s={attach:Wn,detach:jn,resize:Kn}[e]||$n;n[e]=s(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),n=i[e];n&&(({attach:Zn,detach:Zn,resize:Zn}[e]||Vn)(t,e,n),i[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,n){return function(t,e,i,n){const s=_i(t),r=yi(s,"margin"),o=vi(s.maxWidth,t,"clientWidth")||Tt,a=vi(s.maxHeight,t,"clientHeight")||Tt,l=function(t,e,i){let n,s;if(void 0===e||void 0===i){const r=gi(t);if(r){const t=r.getBoundingClientRect(),o=_i(r),a=yi(o,"border","width"),l=yi(o,"padding");e=t.width-l.width-a.width,i=t.height-l.height-a.height,n=vi(o.maxWidth,r,"clientWidth"),s=vi(o.maxHeight,r,"clientHeight")}else e=t.clientWidth,i=t.clientHeight}return{width:e,height:i,maxWidth:n||Tt,maxHeight:s||Tt}}(t,e,i);let{width:h,height:c}=l;if("content-box"===s.boxSizing){const t=yi(s,"border","width"),e=yi(s,"padding");h-=e.width+t.width,c-=e.height+t.height}return h=Math.max(0,h-r.width),c=Math.max(0,n?h/n:c-r.height),h=Si(Math.min(h,o,l.maxWidth)),c=Si(Math.min(c,a,l.maxHeight)),h&&!c&&(c=Si(h/2)),(void 0!==e||void 0!==i)&&n&&l.height&&c>l.height&&(c=l.height,h=Si(Math.floor(c*n))),{width:h,height:c}}(t,e,i,n)}isAttached(t){const e=gi(t);return!(!e||!e.isConnected)}}class Qn{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return kt(this.x)&&kt(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const n={};return t.forEach((t=>{n[t]=i[t]&&i[t].active()?i[t]._to:this[t]})),n}}function ts(t,e,i,n,s){const r=rt(n,0),o=Math.min(rt(s,t.length),t.length);let a,l,h,c=0;for(i=Math.ceil(i),s&&(a=s-n,i=a/Math.floor(a/i)),h=r;h<0;)c++,h=Math.round(r+c*i);for(l=Math.max(r,0);l<o;l++)l===h&&(e.push(t[l]),c++,h=Math.round(r+c*i))}const es=(t,e,i)=>"top"===e||"left"===e?t[e]+i:t[e]-i,is=(t,e)=>Math.min(e||t,t);function ns(t,e){const i=[],n=t.length/e,s=t.length;let r=0;for(;r<s;r+=n)i.push(t[Math.floor(r)]);return i}function ss(t,e,i){const n=t.ticks.length,s=Math.min(e,n-1),r=t._startPixel,o=t._endPixel,a=1e-6;let l,h=t.getPixelForTick(s);if(!(i&&(l=1===n?Math.max(h-r,o-h):0===e?(t.getPixelForTick(1)-h)/2:(h-t.getPixelForTick(s-1))/2,h+=s<e?l:-l,h<r-a||h>o+a)))return h}function rs(t){return t.drawTicks?t.tickLength:0}function os(t,e){if(!t.display)return 0;const i=Xe(t.font,e),n=je(t.padding);return(et(t.text)?t.text.length:1)*i.lineHeight+n.height}function as(t,e,i){let n=te(t);return(i&&"right"!==e||!i&&"right"===e)&&(n=(t=>"left"===t?"right":"right"===t?"left":t)(n)),n}class ls extends Qn{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:n}=this;return t=st(t,Number.POSITIVE_INFINITY),e=st(e,Number.NEGATIVE_INFINITY),i=st(i,Number.POSITIVE_INFINITY),n=st(n,Number.NEGATIVE_INFINITY),{min:st(t,i),max:st(e,n),minDefined:nt(t),maxDefined:nt(e)}}getMinMax(t){let e,{min:i,max:n,minDefined:s,maxDefined:r}=this.getUserBounds();if(s&&r)return{min:i,max:n};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)e=o[a].controller.getMinMax(this,t),s||(i=Math.min(i,e.min)),r||(n=Math.max(n,e.max));return i=r&&i>n?n:i,n=s&&i>n?i:n,{min:st(i,st(n,i)),max:st(n,st(i,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){at(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:n,grace:s,ticks:r}=this.options,o=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,i){const{min:n,max:s}=t,r=ot(e,(s-n)/2),o=(t,e)=>i&&0===t?0:t+e;return{min:o(n,-Math.abs(r)),max:o(s,r)}}(this,s,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?ns(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||"auto"===r.source)&&(this.ticks=function(t,e){const i=t.options.ticks,n=function(t){const e=t.options.offset,i=t._tickSize(),n=t._length/i+(e?0:1),s=t._maxLength/i;return Math.floor(Math.min(n,s))}(t),s=Math.min(i.maxTicksLimit||n,n),r=i.major.enabled?function(t){const e=[];let i,n;for(i=0,n=t.length;i<n;i++)t[i].major&&e.push(i);return e}(e):[],o=r.length,a=r[0],l=r[o-1],h=[];if(o>s)return function(t,e,i,n){let s,r=0,o=i[0];for(n=Math.ceil(n),s=0;s<t.length;s++)s===o&&(e.push(t[s]),r++,o=i[r*n])}(e,h,r,o/s),h;const c=function(t,e,i){const n=function(t){const e=t.length;let i,n;if(e<2)return!1;for(n=t[0],i=1;i<e;++i)if(t[i]-t[i-1]!==n)return!1;return n}(t),s=e.length/i;if(!n)return Math.max(s,1);const r=function(t){const e=[],i=Math.sqrt(t);let n;for(n=1;n<i;n++)t%n==0&&(e.push(n),e.push(t/n));return i===(0|i)&&e.push(i),e.sort(((t,e)=>t-e)).pop(),e}(n);for(let t=0,e=r.length-1;t<e;t++){const e=r[t];if(e>s)return e}return Math.max(s,1)}(r,e,s);if(o>0){let t,i;const n=o>1?Math.round((l-a)/(o-1)):null;for(ts(e,h,c,tt(n)?0:a-n,a),t=0,i=o-1;t<i;t++)ts(e,h,c,r[t],r[t+1]);return ts(e,h,c,l,tt(n)?e.length:l+n),h}return ts(e,h,c),h}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,i=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,i=!i),this._startPixel=t,this._endPixel=e,this._reversePixels=i,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){at(this.options.afterUpdate,[this])}beforeSetDimensions(){at(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){at(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),at(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){at(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,n,s;for(i=0,n=t.length;i<n;i++)s=t[i],s.label=at(e.callback,[s.value,i,t],this)}afterTickToLabelConversion(){at(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){at(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=is(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,s=e.maxRotation;let r,o,a,l=n;if(!this._isVisible()||!e.display||n>=s||i<=1||!this.isHorizontal())return void(this.labelRotation=n);const h=this._getLabelSizes(),c=h.widest.width,d=h.highest.height,u=Wt(this.chart.width-c,0,this.maxWidth);r=t.offset?this.maxWidth/i:u/(i-1),c+6>r&&(r=u/(i-(t.offset?.5:1)),o=this.maxHeight-rs(t.grid)-e.padding-os(t.title,this.chart.options.font),a=Math.sqrt(c*c+d*d),l=Ut(Math.min(Math.asin(Wt((h.highest.height+6)/r,-1,1)),Math.asin(Wt(o/a,-1,1))-Math.asin(Wt(d/a,-1,1)))),l=Math.max(n,Math.min(s,l))),this.labelRotation=l}afterCalculateLabelRotation(){at(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){at(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:n,grid:s}}=this,r=this._isVisible(),o=this.isHorizontal();if(r){const r=os(n,e.options.font);if(o?(t.width=this.maxWidth,t.height=rs(s)+r):(t.height=this.maxHeight,t.width=rs(s)+r),i.display&&this.ticks.length){const{first:e,last:n,widest:s,highest:r}=this._getLabelSizes(),a=2*i.padding,l=Nt(this.labelRotation),h=Math.cos(l),c=Math.sin(l);if(o){const e=i.mirror?0:c*s.width+h*r.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=i.mirror?0:h*s.width+c*r.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,n,c,h)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,n){const{ticks:{align:s,padding:r},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,d=0;a?l?(c=n*t.width,d=i*e.height):(c=i*t.height,d=n*e.width):"start"===s?d=e.width:"end"===s?c=t.width:"inner"!==s&&(c=t.width/2,d=e.width/2),this.paddingLeft=Math.max((c-o+r)*this.width/(this.width-o),0),this.paddingRight=Math.max((d-h+r)*this.width/(this.width-h),0)}else{let i=e.height/2,n=t.height/2;"start"===s?(i=0,n=t.height):"end"===s&&(i=e.height,n=0),this.paddingTop=i+r,this.paddingBottom=n+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){at(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,i=t.length;e<i;e++)tt(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=ns(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:n,_longestTextCache:s}=this,r=[],o=[],a=Math.floor(e/is(e,i));let l,h,c,d,u,p,f,m,g,v,_,x=0,y=0;for(l=0;l<e;l+=a){if(d=t[l].label,u=this._resolveTickFontOptions(l),n.font=p=u.string,f=s[p]=s[p]||{data:{},gc:[]},m=u.lineHeight,g=v=0,tt(d)||et(d)){if(et(d))for(h=0,c=d.length;h<c;++h)_=d[h],tt(_)||et(_)||(g=Se(n,f.data,f.gc,g,_),v+=m)}else g=Se(n,f.data,f.gc,g,d),v=m;r.push(g),o.push(v),x=Math.max(g,x),y=Math.max(v,y)}!function(t,e){lt(t,(t=>{const i=t.gc,n=i.length/2;let s;if(n>e){for(s=0;s<n;++s)delete t.data[i[s]];i.splice(0,n)}}))}(s,e);const b=r.indexOf(x),M=o.indexOf(y),S=t=>({width:r[t]||0,height:o[t]||0});return{first:S(0),last:S(e-1),widest:S(b),highest:S(M),widths:r,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Wt(this._alignToPixels?Te(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=function(t,e,i){return qe(t,{tick:i,index:e,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=qe(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=Nt(this.labelRotation),i=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),s=this._getLabelSizes(),r=t.autoSkipPadding||0,o=s?s.widest.width+r:0,a=s?s.highest.height+r:0;return this.isHorizontal()?a*i>o*n?o/i:a/n:a*n<o*i?a/i:o/n}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,n=this.options,{grid:s,position:r,border:o}=n,a=s.offset,l=this.isHorizontal(),h=this.ticks.length+(a?1:0),c=rs(s),d=[],u=o.setContext(this.getContext()),p=u.display?u.width:0,f=p/2,m=function(t){return Te(i,t,p)};let g,v,_,x,y,b,M,S,w,T,E,A;if("top"===r)g=m(this.bottom),b=this.bottom-c,S=g-f,T=m(t.top)+f,A=t.bottom;else if("bottom"===r)g=m(this.top),T=t.top,A=m(t.bottom)-f,b=g+f,S=this.top+c;else if("left"===r)g=m(this.right),y=this.right-c,M=g-f,w=m(t.left)+f,E=t.right;else if("right"===r)g=m(this.left),w=t.left,E=m(t.right)-f,y=g+f,M=this.left+c;else if("x"===e){if("center"===r)g=m((t.top+t.bottom)/2+.5);else if(it(r)){const t=Object.keys(r)[0],e=r[t];g=m(this.chart.scales[t].getPixelForValue(e))}T=t.top,A=t.bottom,b=g+f,S=b+c}else if("y"===e){if("center"===r)g=m((t.left+t.right)/2);else if(it(r)){const t=Object.keys(r)[0],e=r[t];g=m(this.chart.scales[t].getPixelForValue(e))}y=g-f,M=y-c,w=t.left,E=t.right}const C=rt(n.ticks.maxTicksLimit,h),P=Math.max(1,Math.ceil(h/C));for(v=0;v<h;v+=P){const t=this.getContext(v),e=s.setContext(t),n=o.setContext(t),r=e.lineWidth,h=e.color,c=n.dash||[],u=n.dashOffset,p=e.tickWidth,f=e.tickColor,m=e.tickBorderDash||[],g=e.tickBorderDashOffset;_=ss(this,v,a),void 0!==_&&(x=Te(i,_,r),l?y=M=w=E=x:b=S=T=A=x,d.push({tx1:y,ty1:b,tx2:M,ty2:S,x1:w,y1:T,x2:E,y2:A,width:r,color:h,borderDash:c,borderDashOffset:u,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=h,this._borderValue=g,d}_computeLabelItems(t){const e=this.axis,i=this.options,{position:n,ticks:s}=i,r=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:h,mirror:c}=s,d=rs(i.grid),u=d+h,p=c?-h:u,f=-Nt(this.labelRotation),m=[];let g,v,_,x,y,b,M,S,w,T,E,A,C="middle";if("top"===n)b=this.bottom-p,M=this._getXAxisLabelAlignment();else if("bottom"===n)b=this.top+p,M=this._getXAxisLabelAlignment();else if("left"===n){const t=this._getYAxisLabelAlignment(d);M=t.textAlign,y=t.x}else if("right"===n){const t=this._getYAxisLabelAlignment(d);M=t.textAlign,y=t.x}else if("x"===e){if("center"===n)b=(t.top+t.bottom)/2+u;else if(it(n)){const t=Object.keys(n)[0],e=n[t];b=this.chart.scales[t].getPixelForValue(e)+u}M=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===n)y=(t.left+t.right)/2-u;else if(it(n)){const t=Object.keys(n)[0],e=n[t];y=this.chart.scales[t].getPixelForValue(e)}M=this._getYAxisLabelAlignment(d).textAlign}"y"===e&&("start"===a?C="top":"end"===a&&(C="bottom"));const P=this._getLabelSizes();for(g=0,v=o.length;g<v;++g){_=o[g],x=_.label;const t=s.setContext(this.getContext(g));S=this.getPixelForTick(g)+s.labelOffset,w=this._resolveTickFontOptions(g),T=w.lineHeight,E=et(x)?x.length:1;const e=E/2,i=t.color,a=t.textStrokeColor,h=t.textStrokeWidth;let d,u=M;if(r?(y=S,"inner"===M&&(u=g===v-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),A="top"===n?"near"===l||0!==f?-E*T+T/2:"center"===l?-P.highest.height/2-e*T+T:-P.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?P.highest.height/2-e*T:P.highest.height-E*T,c&&(A*=-1),0===f||t.showLabelBackdrop||(y+=T/2*Math.sin(f))):(b=S,A=(1-E)*T/2),t.showLabelBackdrop){const e=je(t.backdropPadding),i=P.heights[g],n=P.widths[g];let s=A-e.top,r=0-e.left;switch(C){case"middle":s-=i/2;break;case"bottom":s-=i}switch(M){case"center":r-=n/2;break;case"right":r-=n}d={left:r,top:s,width:n+e.width,height:i+e.height,color:t.backdropColor}}m.push({label:x,font:w,textOffset:A,options:{rotation:f,color:i,strokeColor:a,strokeWidth:h,textAlign:u,textBaseline:C,translation:[y,b],backdrop:d}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Nt(this.labelRotation))return"top"===t?"left":"right";let i="center";return"start"===e.align?i="left":"end"===e.align?i="right":"inner"===e.align&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:n,padding:s}}=this.options,r=t+s,o=this._getLabelSizes().widest.width;let a,l;return"left"===e?n?(l=this.right+s,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-r,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l=this.left)):"right"===e?n?(l=this.left+s,"near"===i?a="right":"center"===i?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+r,"near"===i?a="left":"center"===i?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:n,width:s,height:r}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,n,s,r),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex((e=>e.value===t));return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,r;const o=(t,e,n)=>{n.width&&n.color&&(i.save(),i.lineWidth=n.width,i.strokeStyle=n.color,i.setLineDash(n.borderDash||[]),i.lineDashOffset=n.borderDashOffset,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.restore())};if(e.display)for(s=0,r=n.length;s<r;++s){const t=n[s];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:n}}=this,s=i.setContext(this.getContext()),r=i.display?s.width:0;if(!r)return;const o=n.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,h,c,d;this.isHorizontal()?(l=Te(t,this.left,r)-r/2,h=Te(t,this.right,o)+o/2,c=d=a):(c=Te(t,this.top,r)-r/2,d=Te(t,this.bottom,o)+o/2,l=h=a),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(l,c),e.lineTo(h,d),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,i=this._computeLabelArea();i&&Le(e,i);const n=this.getLabelItems(t);for(const t of n){const i=t.options,n=t.font;Ne(e,t.label,0,t.textOffset,n,i)}i&&Re(e)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:n}}=this;if(!i.display)return;const s=Xe(i.font),r=je(i.padding),o=i.align;let a=s.lineHeight/2;"bottom"===e||"center"===e||it(e)?(a+=r.bottom,et(i.text)&&(a+=s.lineHeight*(i.text.length-1))):a+=r.top;const{titleX:l,titleY:h,maxWidth:c,rotation:d}=function(t,e,i,n){const{top:s,left:r,bottom:o,right:a,chart:l}=t,{chartArea:h,scales:c}=l;let d,u,p,f=0;const m=o-s,g=a-r;if(t.isHorizontal()){if(u=ee(n,r,a),it(i)){const t=Object.keys(i)[0],n=i[t];p=c[t].getPixelForValue(n)+m-e}else p="center"===i?(h.bottom+h.top)/2+m-e:es(t,i,e);d=a-r}else{if(it(i)){const t=Object.keys(i)[0],n=i[t];u=c[t].getPixelForValue(n)-g+e}else u="center"===i?(h.left+h.right)/2-g+e:es(t,i,e);p=ee(n,o,s),f="left"===i?-At:At}return{titleX:u,titleY:p,maxWidth:d,rotation:f}}(this,a,e,o);Ne(t,i.text,0,0,s,{color:i.color,maxWidth:c,rotation:d,textAlign:as(o,e,n),textBaseline:"middle",translation:[l,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=rt(t.grid&&t.grid.z,-1),n=rt(t.border&&t.border.z,0);return this._isVisible()&&this.draw===ls.prototype.draw?[{z:i,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let s,r;for(s=0,r=e.length;s<r;++s){const r=e[s];r[i]!==this.id||t&&r.type!==t||n.push(r)}return n}_resolveTickFontOptions(t){return Xe(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class hs{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;(function(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const n=this.items,s=t.id,r=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in n||(n[s]=t,function(t,e,i){const n=pt(Object.create(null),[i?Me.get(i):{},Me.get(e),t.defaults]);Me.set(e,n),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((i=>{const n=i.split("."),s=n.pop(),r=[t].concat(n).join("."),o=e[i].split("."),a=o.pop(),l=o.join(".");Me.route(r,s,l,a)}))}(e,t.defaultRoutes),t.descriptors&&Me.describe(e,t.descriptors)}(t,r,i),this.override&&Me.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,n=this.scope;i in e&&delete e[i],n&&i in Me[n]&&(delete Me[n][i],this.override&&delete ve[i])}}class cs{constructor(){this.controllers=new hs(nn,"datasets",!0),this.elements=new hs(Qn,"elements"),this.plugins=new hs(Object,"plugins"),this.scales=new hs(ls,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach((e=>{const n=i||this._getRegistryForType(e);i||n.isForType(e)||n===this.plugins&&e.id?this._exec(t,n,e):lt(e,(e=>{const n=i||this._getRegistryForType(e);this._exec(t,n,e)}))}))}_exec(t,e,i){const n=_t(t);at(i["before"+n],[],i),e[t](i),at(i["after"+n],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const n=e.get(t);if(void 0===n)throw new Error('"'+t+'" is not a registered '+i+".");return n}}var ds=new cs;class us{constructor(){this._init=[]}notify(t,e,i,n){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const s=n?this._descriptors(t).filter(n):this._descriptors(t),r=this._notify(s,t,e,i);return"afterDestroy"===e&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall")),r}_notify(t,e,i,n){n=n||{};for(const s of t){const t=s.plugin;if(!1===at(t[i],[e,n,s.options],t)&&n.cancelable)return!1}return!0}invalidate(){tt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,n=rt(i.options&&i.options.plugins,{}),s=function(t){const e={},i=[],n=Object.keys(ds.plugins.items);for(let t=0;t<n.length;t++)i.push(ds.getPlugin(n[t]));const s=t.plugins||[];for(let t=0;t<s.length;t++){const n=s[t];-1===i.indexOf(n)&&(i.push(n),e[n.id]=!0)}return{plugins:i,localIds:e}}(i);return!1!==n||e?function(t,{plugins:e,localIds:i},n,s){const r=[],o=t.getContext();for(const a of e){const e=a.id,l=ps(n[e],s);null!==l&&r.push({plugin:a,options:fs(t.config,{plugin:a,local:i[e]},l,o)})}return r}(t,s,n,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,n=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(n(e,i),t,"stop"),this._notify(n(i,e),t,"start")}}function ps(t,e){return e||!1!==t?!0===t?{}:t:null}function fs(t,{plugin:e,local:i},n,s){const r=t.pluginScopeKeys(e),o=t.getOptionScopes(n,r);return i&&e.defaults&&o.push(e.defaults),t.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ms(t,e){const i=Me.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||i.indexAxis||"x"}function gs(t){if("x"===t||"y"===t||"r"===t)return t}function vs(t,...e){if(gs(t))return t;for(const n of e){const e=n.axis||("top"===(i=n.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||t.length>1&&gs(t[0].toLowerCase());if(e)return e}var i;throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function _s(t,e,i){if(i[e+"AxisID"]===t)return{axis:e}}function xs(t){const e=t.options||(t.options={});e.plugins=rt(e.plugins,{}),e.scales=function(t,e){const i=ve[t.type]||{scales:{}},n=e.scales||{},s=ms(t.type,e),r=Object.create(null);return Object.keys(n).forEach((e=>{const o=n[e];if(!it(o))return console.error(`Invalid scale configuration for scale: ${e}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${e}`);const a=vs(e,o,function(t,e){if(e.data&&e.data.datasets){const i=e.data.datasets.filter((e=>e.xAxisID===t||e.yAxisID===t));if(i.length)return _s(t,"x",i[0])||_s(t,"y",i[0])}return{}}(e,t),Me.scales[o.type]),l=function(t,e){return t===e?"_index_":"_value_"}(a,s),h=i.scales||{};r[e]=ft(Object.create(null),[{axis:a},o,h[a],h[l]])})),t.data.datasets.forEach((i=>{const s=i.type||t.type,o=i.indexAxis||ms(s,e),a=(ve[s]||{}).scales||{};Object.keys(a).forEach((t=>{const e=function(t,e){let i=t;return"_index_"===t?i=e:"_value_"===t&&(i="x"===e?"y":"x"),i}(t,o),s=i[e+"AxisID"]||e;r[s]=r[s]||Object.create(null),ft(r[s],[{axis:e},n[s],a[t]])}))})),Object.keys(r).forEach((t=>{const e=r[t];ft(e,[Me.scales[e.type],Me.scale])})),r}(t,e)}function ys(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const bs=new Map,Ms=new Set;function Ss(t,e){let i=bs.get(t);return i||(i=e(),bs.set(t,i),Ms.add(i)),i}const ws=(t,e,i)=>{const n=vt(e,i);void 0!==n&&t.add(n)};class Ts{constructor(t){this._config=function(t){return(t=t||{}).data=ys(t.data),xs(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=ys(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),xs(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ss(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return Ss(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return Ss(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return Ss(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const i=this._scopeCache;let n=i.get(t);return n&&!e||(n=new Map,i.set(t,n)),n}getOptionScopes(t,e,i){const{options:n,type:s}=this,r=this._cachedScopes(t,i),o=r.get(e);if(o)return o;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>ws(a,t,e)))),e.forEach((t=>ws(a,n,t))),e.forEach((t=>ws(a,ve[s]||{},t))),e.forEach((t=>ws(a,Me,t))),e.forEach((t=>ws(a,_e,t)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),Ms.has(e)&&r.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,ve[e]||{},Me.datasets[e]||{},{type:e},Me,_e]}resolveNamedOptions(t,e,i,n=[""]){const s={$shared:!0},{resolver:r,subPrefixes:o}=Es(this._resolverCache,t,n);let a=r;(function(t,e){const{isScriptable:i,isIndexable:n}=$e(t);for(const s of e){const e=i(s),r=n(s),o=(r||e)&&t[s];if(e&&(yt(o)||As(o))||r&&et(o))return!0}return!1})(r,e)&&(s.$shared=!1,a=Ze(r,i=yt(i)?i():i,this.createResolver(t,i,o)));for(const t of e)s[t]=a[t];return s}createResolver(t,e,i=[""],n){const{resolver:s}=Es(this._resolverCache,t,i);return it(e)?Ze(s,e,void 0,n):s}}function Es(t,e,i){let n=t.get(e);n||(n=new Map,t.set(e,n));const s=i.join();let r=n.get(s);return r||(r={resolver:Ke(e,i),subPrefixes:i.filter((t=>!t.toLowerCase().includes("hover")))},n.set(s,r)),r}const As=t=>it(t)&&Object.getOwnPropertyNames(t).reduce(((e,i)=>e||yt(t[i])),!1),Cs=["top","bottom","left","right","chartArea"];function Ps(t,e){return"top"===t||"bottom"===t||-1===Cs.indexOf(t)&&"x"===e}function Ls(t,e){return function(i,n){return i[t]===n[t]?i[e]-n[e]:i[t]-n[t]}}function Rs(t){const e=t.chart,i=e.options.animation;e.notifyPlugins("afterRender"),at(i&&i.onComplete,[t],e)}function Ds(t){const e=t.chart,i=e.options.animation;at(i&&i.onProgress,[t],e)}function Is(t){return mi()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const ks={},Os=t=>{const e=Is(t);return Object.values(ks).filter((t=>t.canvas===e)).pop()};function Ns(t,e,i){const n=Object.keys(t);for(const s of n){const n=+s;if(n>=e){const r=t[s];delete t[s],(i>0||n>e)&&(t[n+i]=r)}}}class Us{static defaults=Me;static instances=ks;static overrides=ve;static registry=ds;static version="4.3.3";static getChart=Os;static register(...t){ds.add(...t),Bs()}static unregister(...t){ds.remove(...t),Bs()}constructor(t,e){const i=this.config=new Ts(e),n=Is(t),s=Os(n);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function(t){return!mi()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Un:Jn}(n)),this.platform.updateConfig(i);const o=this.platform.acquireContext(n,r.aspectRatio),a=o&&o.canvas,l=a&&a.height,h=a&&a.width;this.id=Q(),this.ctx=o,this.canvas=a,this.width=h,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new us,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let i;return function(...n){return e?(clearTimeout(i),i=setTimeout(t,e,n)):t.apply(this,n),e}}((t=>this.update(t)),r.resizeDelay||0),this._dataChanges=[],ks[this.id]=this,o&&a?(zi.listen(this,"complete",Rs),zi.listen(this,"progress",Ds),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:s}=this;return tt(t)?e&&s?s:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return ds}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():wi(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ee(this.canvas,this.ctx),this}stop(){return zi.stop(this),this}resize(t,e){zi.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,n=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(n,t,e,s),o=i.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,wi(this,o,!0)&&(this.notifyPlugins("resize",{size:r}),at(i.onResize,[this,r],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){lt(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,n=Object.keys(i).reduce(((t,e)=>(t[e]=!1,t)),{});let s=[];e&&(s=s.concat(Object.keys(e).map((t=>{const i=e[t],n=vs(t,i),s="r"===n,r="x"===n;return{options:i,dposition:s?"chartArea":r?"bottom":"left",dtype:s?"radialLinear":r?"category":"linear"}})))),lt(s,(e=>{const s=e.options,r=s.id,o=vs(r,s),a=rt(s.type,e.dtype);void 0!==s.position&&Ps(s.position,o)===Ps(e.dposition)||(s.position=e.dposition),n[r]=!0;let l=null;r in i&&i[r].type===a?l=i[r]:(l=new(ds.getScale(a))({id:r,type:a,ctx:this.ctx,chart:this}),i[l.id]=l),l.init(s,t)})),lt(n,((t,e)=>{t||delete i[e]})),lt(i,(t=>{On.configure(this,t,t.options),On.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort(((t,e)=>t.index-e.index)),i>e){for(let t=e;t<i;++t)this._destroyDatasetMeta(t);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(Ls("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,i)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=e.length;i<n;i++){const n=e[i];let s=this.getDatasetMeta(i);const r=n.type||this.config.type;if(s.type&&s.type!==r&&(this._destroyDatasetMeta(i),s=this.getDatasetMeta(i)),s.type=r,s.indexAxis=n.indexAxis||ms(r,this.options),s.order=n.order||0,s.index=i,s.label=""+n.label,s.visible=this.isDatasetVisible(i),s.controller)s.controller.updateIndex(i),s.controller.linkScales();else{const e=ds.getController(r),{datasetElementType:n,dataElementType:o}=Me.datasets[r];Object.assign(e,{dataElementType:ds.getElement(o),datasetElementType:n&&ds.getElement(n)}),s.controller=new e(this,i),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){lt(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),i=!n&&-1===s.indexOf(e);e.buildOrUpdateElements(i),r=Math.max(+e.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),n||lt(s,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Ls("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){lt(this.scales,(t=>{On.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);bt(e,i)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:s}of e)Ns(t,n,"_removeElements"===i?-s:s)}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),n=i(0);for(let t=1;t<e;t++)if(!bt(n,i(t)))return;return Array.from(n).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;On.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],lt(this.boxes,(t=>{i&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,yt(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),n={meta:i,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",n)&&(i.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(zi.has(this)?this.attached&&!zi.running(this)&&zi.start(this):(this.draw(),Rs({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let n,s;for(n=0,s=e.length;n<s;++n){const s=e[n];t&&!s.visible||i.push(s)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i=t._clip,n=!i.disabled,s=function(t){const{xScale:e,yScale:i}=t;if(e&&i)return{left:e.left,right:e.right,top:i.top,bottom:i.bottom}}(t)||this.chartArea,r={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",r)&&(n&&Le(e,{left:!1===i.left?0:s.left-i.left,right:!1===i.right?this.width:s.right+i.right,top:!1===i.top?0:s.top-i.top,bottom:!1===i.bottom?this.height:s.bottom+i.bottom}),t.controller.draw(),n&&Re(e),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(t){return Pe(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,n){const s=Sn.modes[e];return"function"==typeof s?s(this,t,i,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let n=i.filter((t=>t&&t._dataset===e)).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=qe(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const n=i?"show":"hide",s=this.getDatasetMeta(t),r=s.controller._resolveAnimations(void 0,n);xt(e)?(s.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(s,{visible:i}),this.update((e=>e.datasetIndex===t?n:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),zi.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Ee(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete ks[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(i,n)=>{e.addEventListener(this,i,n),t[i]=n},n=(t,e,i)=>{t.offsetX=e,t.offsetY=i,this._eventHandler(t)};lt(this.options.events,(t=>i(t,n)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(i,n)=>{e.addEventListener(this,i,n),t[i]=n},n=(i,n)=>{t[i]&&(e.removeEventListener(this,i,n),delete t[i])},s=(t,e)=>{this.canvas&&this.resize(t,e)};let r;const o=()=>{n("attach",o),this.attached=!0,this.resize(),i("resize",s),i("detach",r)};r=()=>{this.attached=!1,n("resize",s),this._stop(),this._resize(0,0),i("attach",o)},e.isAttached(this.canvas)?o():r()}unbindEvents(){lt(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},lt(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const n=i?"set":"remove";let s,r,o,a;for("dataset"===e&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+n+"DatasetHoverStyle"]()),o=0,a=t.length;o<a;++o){r=t[o];const e=r&&this.getDatasetMeta(r.datasetIndex).controller;e&&e[n+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[e],index:e}}));!ht(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return 1===this._plugins._cache.filter((e=>e.plugin.id===t)).length}_updateHoverStyles(t,e,i){const n=this.options.hover,s=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),r=s(e,t),o=i?t:s(t,e);r.length&&this.updateHoverStyle(r,n.mode,!1),o.length&&n.mode&&this.updateHoverStyle(o,n.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,n))return;const s=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(s||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:n=[],options:s}=this,r=e,o=this._getActiveElements(t,n,i,r),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,i,n){return i&&"mouseout"!==t.type?n?e:t:null}(t,this._lastEvent,i,a);i&&(this._lastEvent=null,at(s.onHover,[t,o,this],this),a&&at(s.onClick,[t,o,this],this));const h=!ht(o,n);return(h||e)&&(this._active=o,this._updateHoverStyles(o,n,e)),this._lastEvent=l,h}_getActiveElements(t,e,i,n){if("mouseout"===t.type)return[];if(!i)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,n)}}function Bs(){return lt(Us.instances,(t=>t._plugins.invalidate()))}function Fs(t,e,i,n){return{x:i+t*Math.cos(e),y:n+t*Math.sin(e)}}function zs(t,e,i,n,s,r){const{x:o,y:a,startAngle:l,pixelMargin:h,innerRadius:c}=e,d=Math.max(e.outerRadius+n+i-h,0),u=c>0?c+n+i+h:0;let p=0;const f=s-l;if(n){const t=((c>0?c-n:0)+(d>0?d-n:0))/2;p=(f-(0!==t?f*t/(t+n):f))/2}const m=(f-Math.max(.001,f*d-i/Mt)/d)/2,g=l+m+p,v=s-m-p,{outerStart:_,outerEnd:x,innerStart:y,innerEnd:b}=function(t,e,i,n){const s=Ve(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),r=(i-e)/2,o=Math.min(r,n*e/2),a=t=>{const e=(i-Math.min(r,t))*n/2;return Wt(t,0,Math.min(r,e))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:Wt(s.innerStart,0,o),innerEnd:Wt(s.innerEnd,0,o)}}(e,u,d,v-g),M=d-_,S=d-x,w=g+_/M,T=v-x/S,E=u+y,A=u+b,C=g+y/E,P=v-b/A;if(t.beginPath(),r){const e=(w+T)/2;if(t.arc(o,a,d,w,e),t.arc(o,a,d,e,T),x>0){const e=Fs(S,T,o,a);t.arc(e.x,e.y,x,T,v+At)}const i=Fs(A,v,o,a);if(t.lineTo(i.x,i.y),b>0){const e=Fs(A,P,o,a);t.arc(e.x,e.y,b,v+At,P+Math.PI)}const n=(v-b/u+(g+y/u))/2;if(t.arc(o,a,u,v-b/u,n,!0),t.arc(o,a,u,n,g+y/u,!0),y>0){const e=Fs(E,C,o,a);t.arc(e.x,e.y,y,C+Math.PI,g-At)}const s=Fs(M,g,o,a);if(t.lineTo(s.x,s.y),_>0){const e=Fs(M,w,o,a);t.arc(e.x,e.y,_,g-At,w)}}else{t.moveTo(o,a);const e=Math.cos(w)*d+o,i=Math.sin(w)*d+a;t.lineTo(e,i);const n=Math.cos(T)*d+o,s=Math.sin(T)*d+a;t.lineTo(n,s)}t.closePath()}function Hs(t,e,i=e){t.lineCap=rt(i.borderCapStyle,e.borderCapStyle),t.setLineDash(rt(i.borderDash,e.borderDash)),t.lineDashOffset=rt(i.borderDashOffset,e.borderDashOffset),t.lineJoin=rt(i.borderJoinStyle,e.borderJoinStyle),t.lineWidth=rt(i.borderWidth,e.borderWidth),t.strokeStyle=rt(i.borderColor,e.borderColor)}function Vs(t,e,i){t.lineTo(i.x,i.y)}function Gs(t,e,i={}){const n=t.length,{start:s=0,end:r=n-1}=i,{start:o,end:a}=e,l=Math.max(s,o),h=Math.min(r,a),c=s<o&&r<o||s>a&&r>a;return{count:n,start:l,loop:e.loop,ilen:h<l&&!c?n+h-l:h-l}}function Ws(t,e,i,n){const{points:s,options:r}=e,{count:o,start:a,loop:l,ilen:h}=Gs(s,i,n),c=function(t){return t.stepped?De:t.tension||"monotone"===t.cubicInterpolationMode?Ie:Vs}(r);let d,u,p,{move:f=!0,reverse:m}=n||{};for(d=0;d<=h;++d)u=s[(a+(m?h-d:d))%o],u.skip||(f?(t.moveTo(u.x,u.y),f=!1):c(t,p,u,m,r.stepped),p=u);return l&&(u=s[(a+(m?h:0))%o],c(t,p,u,m,r.stepped)),!!l}function js(t,e,i,n){const s=e.points,{count:r,start:o,ilen:a}=Gs(s,i,n),{move:l=!0,reverse:h}=n||{};let c,d,u,p,f,m,g=0,v=0;const _=t=>(o+(h?a-t:t))%r,x=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(d=s[_(0)],t.moveTo(d.x,d.y)),c=0;c<=a;++c){if(d=s[_(c)],d.skip)continue;const e=d.x,i=d.y,n=0|e;n===u?(i<p?p=i:i>f&&(f=i),g=(v*g+e)/++v):(x(),t.lineTo(e,i),u=n,v=0,p=f=i),m=i}x()}function Xs(t){const e=t.options,i=e.borderDash&&e.borderDash.length;return t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||i?Ws:js}const Ys="function"==typeof Path2D;class qs extends Qn{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;fi(this._points,i,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const i=t.points,n=t.options.spanGaps,s=i.length;if(!s)return[];const r=!!t._loop,{start:o,end:a}=function(t,e,i,n){let s=0,r=e-1;if(i&&!n)for(;s<e&&!t[s].skip;)s++;for(;s<e&&t[s].skip;)s++;for(s%=e,i&&(r+=s);r>s&&t[r%e].skip;)r--;return r%=e,{start:s,end:r}}(i,s,r,n);return function(t,e,i,n){return n&&n.setContext&&i?function(t,e,i,n){const s=t._chart.getContext(),r=Ui(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=i.length,h=[];let c=r,d=e[0].start,u=d;function p(t,e,n,s){const r=a?-1:1;if(t!==e){for(t+=l;i[t%l].skip;)t-=r;for(;i[e%l].skip;)e+=r;t%l!=e%l&&(h.push({start:t%l,end:e%l,loop:n,style:s}),c=s,d=e%l)}}for(const t of e){d=a?d:t.start;let e,r=i[d%l];for(u=d+1;u<=t.end;u++){const a=i[u%l];e=Ui(n.setContext(qe(s,{type:"segment",p0:r,p1:a,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:o}))),Bi(e,c)&&p(d,u-1,t.loop,c),r=a,c=e}d<u-1&&p(d,u-1,t.loop,c)}return h}(t,e,i,n):e}(t,!0===n?[{start:o,end:a,loop:r}]:function(t,e,i,n){const s=t.length,r=[];let o,a=e,l=t[e];for(o=e+1;o<=i;++o){const i=t[o%s];i.skip||i.stop?l.skip||(n=!1,r.push({start:e%s,end:(o-1)%s,loop:n}),e=a=i.stop?o:null):(a=o,l.skip&&(e=o)),l=i}return null!==a&&r.push({start:e%s,end:a%s,loop:n}),r}(i,o,a<o?a+s:a,!!t._fullLoop&&0===o&&a===s-1),i,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,n=t[e],s=this.points,r=Ni(this,{property:e,start:n,end:n});if(!r.length)return;const o=[],a=function(t){return t.stepped?Ci:t.tension||"monotone"===t.cubicInterpolationMode?Pi:Ai}(i);let l,h;for(l=0,h=r.length;l<h;++l){const{start:h,end:c}=r[l],d=s[h],u=s[c];if(d===u){o.push(d);continue}const p=a(d,u,Math.abs((n-d[e])/(u[e]-d[e])),i.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,i){return Xs(this)(t,this,e,i)}path(t,e,i){const n=this.segments,s=Xs(this);let r=this._loop;e=e||0,i=i||this.points.length-e;for(const o of n)r&=s(t,this,o,{start:e,end:e+i-1});return!!r}draw(t,e,i,n){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),function(t,e,i,n){Ys&&!e.options.segment?function(t,e,i,n){let s=e._path;s||(s=e._path=new Path2D,e.path(s,i,n)&&s.closePath()),Hs(t,e.options),t.stroke(s)}(t,e,i,n):function(t,e,i,n){const{segments:s,options:r}=e,o=Xs(e);for(const a of s)Hs(t,r,a.style),t.beginPath(),o(t,e,a,{start:i,end:i+n-1})&&t.closePath(),t.stroke()}(t,e,i,n)}(t,this,i,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Ks(t,e,i,n){const s=t.options,{[i]:r}=t.getProps([i],n);return Math.abs(e-r)<s.radius+s.hitRadius}function Zs(t,e){const{x:i,y:n,base:s,width:r,height:o}=t.getProps(["x","y","base","width","height"],e);let a,l,h,c,d;return t.horizontal?(d=o/2,a=Math.min(i,s),l=Math.max(i,s),h=n-d,c=n+d):(d=r/2,a=i-d,l=i+d,h=Math.min(n,s),c=Math.max(n,s)),{left:a,top:h,right:l,bottom:c}}function $s(t,e,i,n){return t?0:Wt(e,i,n)}function Js(t,e,i,n){const s=null===e,r=null===i,o=t&&!(s&&r)&&Zs(t,n);return o&&(s||jt(e,o.left,o.right))&&(r||jt(i,o.top,o.bottom))}function Qs(t,e){t.rect(e.x,e.y,e.w,e.h)}function tr(t,e,i={}){const n=t.x!==i.x?-e:0,s=t.y!==i.y?-e:0,r=(t.x+t.w!==i.x+i.w?e:0)-n,o=(t.y+t.h!==i.y+i.h?e:0)-s;return{x:t.x+n,y:t.y+s,w:t.w+r,h:t.h+o,radius:t.radius}}var er=Object.freeze({__proto__:null,ArcElement:class extends Qn{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.getProps(["x","y"],i),{angle:s,distance:r}=Ft(n,{x:t,y:e}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:h,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=(this.options.spacing+this.options.borderWidth)/2,u=rt(c,a-o)>=St||Gt(s,o,a),p=jt(r,l+d,h+d);return u&&p}getCenterPoint(t){const{x:e,y:i,startAngle:n,endAngle:s,innerRadius:r,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:a,spacing:l}=this.options,h=(n+s)/2,c=(r+o+l+a)/2;return{x:e+Math.cos(h)*c,y:i+Math.sin(h)*c}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,n=(e.offset||0)/4,s=(e.spacing||0)/2,r=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>St?Math.floor(i/St):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();const o=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(o)*n,Math.sin(o)*n);const a=n*(1-Math.sin(Math.min(Mt,i||0)));t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,function(t,e,i,n,s){const{fullCircles:r,startAngle:o,circumference:a}=e;let l=e.endAngle;if(r){zs(t,e,i,n,l,s);for(let e=0;e<r;++e)t.fill();isNaN(a)||(l=o+(a%St||St))}zs(t,e,i,n,l,s),t.fill()}(t,this,a,s,r),function(t,e,i,n,s){const{fullCircles:r,startAngle:o,circumference:a,options:l}=e,{borderWidth:h,borderJoinStyle:c,borderDash:d,borderDashOffset:u}=l,p="inner"===l.borderAlign;if(!h)return;t.setLineDash(d||[]),t.lineDashOffset=u,p?(t.lineWidth=2*h,t.lineJoin=c||"round"):(t.lineWidth=h,t.lineJoin=c||"bevel");let f=e.endAngle;if(r){zs(t,e,i,n,f,s);for(let e=0;e<r;++e)t.stroke();isNaN(a)||(f=o+(a%St||St))}p&&function(t,e,i){const{startAngle:n,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=e;let h=s/a;t.beginPath(),t.arc(r,o,a,n-h,i+h),l>s?(h=s/l,t.arc(r,o,l,i+h,n-h,!0)):t.arc(r,o,s,i+At,n-At),t.closePath(),t.clip()}(t,e,f),r||(zs(t,e,i,n,f,s),t.stroke())}(t,this,a,s,r),t.restore()}},BarElement:class extends Qn{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:n}}=this,{inner:s,outer:r}=function(t){const e=Zs(t),i=e.right-e.left,n=e.bottom-e.top,s=function(t,e,i){const n=t.options.borderWidth,s=t.borderSkipped,r=Ge(n);return{t:$s(s.top,r.top,0,i),r:$s(s.right,r.right,0,e),b:$s(s.bottom,r.bottom,0,i),l:$s(s.left,r.left,0,e)}}(t,i/2,n/2),r=function(t,e,i){const{enableBorderRadius:n}=t.getProps(["enableBorderRadius"]),s=t.options.borderRadius,r=We(s),o=Math.min(e,i),a=t.borderSkipped,l=n||it(s);return{topLeft:$s(!l||a.top||a.left,r.topLeft,0,o),topRight:$s(!l||a.top||a.right,r.topRight,0,o),bottomLeft:$s(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:$s(!l||a.bottom||a.right,r.bottomRight,0,o)}}(t,i/2,n/2);return{outer:{x:e.left,y:e.top,w:i,h:n,radius:r},inner:{x:e.left+s.l,y:e.top+s.t,w:i-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}(this),o=(a=r.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?Ue:Qs;var a;t.save(),r.w===s.w&&r.h===s.h||(t.beginPath(),o(t,tr(r,e,s)),t.clip(),o(t,tr(s,-e,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),o(t,tr(s,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,i){return Js(this,t,e,i)}inXRange(t,e){return Js(this,t,null,e)}inYRange(t,e){return Js(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:n,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+n)/2:e,y:s?i:(i+n)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}},LineElement:qs,PointElement:class extends Qn{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const n=this.options,{x:s,y:r}=this.getProps(["x","y"],i);return Math.pow(t-s,2)+Math.pow(e-r,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(t,e){return Ks(this,t,"x",e)}inYRange(t,e){return Ks(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){let e=(t=t||this.options||{}).radius||0;return e=Math.max(e,e&&t.hoverRadius||0),2*(e+(e&&t.borderWidth||0))}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Pe(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Ae(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}});const ir=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],nr=ir.map((t=>t.replace("rgb(","rgba(").replace(")",", 0.5)")));function sr(t){return ir[t%ir.length]}function rr(t){return nr[t%nr.length]}function or(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}var ar={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,i){if(!i.enabled)return;const{data:{datasets:n},options:s}=t.config,{elements:r}=s;if(!i.forceOverride&&(or(n)||(o=s)&&(o.borderColor||o.backgroundColor)||r&&or(r)))return;var o;const a=function(t){let e=0;return(i,n)=>{const s=t.getDatasetMeta(n).controller;s instanceof un?e=function(t,e){return t.backgroundColor=t.data.map((()=>sr(e++))),e}(i,e):s instanceof pn?e=function(t,e){return t.backgroundColor=t.data.map((()=>rr(e++))),e}(i,e):s&&(e=function(t,e){return t.borderColor=sr(e),t.backgroundColor=rr(e),++e}(i,e))}}(t);n.forEach(a)}};function lr(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function hr(t){t.data.datasets.forEach((t=>{lr(t)}))}var cr={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,i)=>{if(!i.enabled)return void hr(t);const n=t.width;t.data.datasets.forEach(((e,s)=>{const{_data:r,indexAxis:o}=e,a=t.getDatasetMeta(s),l=r||e.data;if("y"===Ye([o,t.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const h=t.scales[a.xAxisID];if("linear"!==h.type&&"time"!==h.type)return;if(t.options.parsing)return;let c,{start:d,count:u}=function(t,e){const i=e.length;let n,s=0;const{iScale:r}=t,{min:o,max:a,minDefined:l,maxDefined:h}=r.getUserBounds();return l&&(s=Wt(Yt(e,r.axis,o).lo,0,i-1)),n=h?Wt(Yt(e,r.axis,a).hi+1,s,i)-s:i-s,{start:s,count:n}}(a,l);if(u<=(i.threshold||4*n))lr(e);else{switch(tt(r)&&(e._data=l,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),i.algorithm){case"lttb":c=function(t,e,i,n,s){const r=s.samples||n;if(r>=i)return t.slice(e,e+i);const o=[],a=(i-2)/(r-2);let l=0;const h=e+i-1;let c,d,u,p,f,m=e;for(o[l++]=t[m],c=0;c<r-2;c++){let n,s=0,r=0;const h=Math.floor((c+1)*a)+1+e,g=Math.min(Math.floor((c+2)*a)+1,i)+e,v=g-h;for(n=h;n<g;n++)s+=t[n].x,r+=t[n].y;s/=v,r/=v;const _=Math.floor(c*a)+1+e,x=Math.min(Math.floor((c+1)*a)+1,i)+e,{x:y,y:b}=t[m];for(u=p=-1,n=_;n<x;n++)p=.5*Math.abs((y-s)*(t[n].y-b)-(y-t[n].x)*(r-b)),p>u&&(u=p,d=t[n],f=n);o[l++]=d,m=f}return o[l++]=t[h],o}(l,d,u,n,i);break;case"min-max":c=function(t,e,i,n){let s,r,o,a,l,h,c,d,u,p,f=0,m=0;const g=[],v=e+i-1,_=t[e].x,x=t[v].x-_;for(s=e;s<e+i;++s){r=t[s],o=(r.x-_)/x*n,a=r.y;const e=0|o;if(e===l)a<u?(u=a,h=s):a>p&&(p=a,c=s),f=(m*f+r.x)/++m;else{const i=s-1;if(!tt(h)&&!tt(c)){const e=Math.min(h,c),n=Math.max(h,c);e!==d&&e!==i&&g.push({...t[e],x:f}),n!==d&&n!==i&&g.push({...t[n],x:f})}s>0&&i!==d&&g.push(t[i]),g.push(r),l=e,m=0,u=p=a,h=c=d=s}}return g}(l,d,u,n);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}e._decimated=c}}))},destroy(t){hr(t)}};function dr(t,e,i,n){if(n)return;let s=e[t],r=i[t];return"angle"===t&&(s=Vt(s),r=Vt(r)),{property:t,start:s,end:r}}function ur(t,e,i){for(;e>t;e--){const t=i[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function pr(t,e,i,n){return t&&e?n(t[i],e[i]):t?t[i]:e?e[i]:0}function fr(t,e){let i=[],n=!1;return et(t)?(n=!0,i=t):i=function(t,e){const{x:i=null,y:n=null}=t||{},s=e.points,r=[];return e.segments.forEach((({start:t,end:e})=>{e=ur(t,e,s);const o=s[t],a=s[e];null!==n?(r.push({x:o.x,y:n}),r.push({x:a.x,y:n})):null!==i&&(r.push({x:i,y:o.y}),r.push({x:i,y:a.y}))})),r}(t,e),i.length?new qs({points:i,options:{tension:0},_loop:n,_fullLoop:n}):null}function mr(t){return t&&!1!==t.fill}function gr(t,e,i){let n=t[e].fill;const s=[e];let r;if(!i)return n;for(;!1!==n&&-1===s.indexOf(n);){if(!nt(n))return n;if(r=t[n],!r)return!1;if(r.visible)return n;s.push(n),n=r.fill}return!1}function vr(t,e,i){const n=function(t){const e=t.options,i=e.fill;let n=rt(i&&i.target,i);return void 0===n&&(n=!!e.backgroundColor),!1!==n&&null!==n&&(!0===n?"origin":n)}(t);if(it(n))return!isNaN(n.value)&&n;let s=parseFloat(n);return nt(s)&&Math.floor(s)===s?function(t,e,i,n){return"-"!==t&&"+"!==t||(i=e+i),!(i===e||i<0||i>=n)&&i}(n[0],e,s,i):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function _r(t,e,i){const n=[];for(let s=0;s<i.length;s++){const r=i[s],{first:o,last:a,point:l}=xr(r,e,"x");if(!(!l||o&&a))if(o)n.unshift(l);else if(t.push(l),!a)break}t.push(...n)}function xr(t,e,i){const n=t.interpolate(e,i);if(!n)return{};const s=n[i],r=t.segments,o=t.points;let a=!1,l=!1;for(let t=0;t<r.length;t++){const e=r[t],n=o[e.start][i],h=o[e.end][i];if(jt(s,n,h)){a=s===n,l=s===h;break}}return{first:a,last:l,point:n}}class yr{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:n,y:s,radius:r}=this;return e=e||{start:0,end:St},t.arc(n,s,r,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:n}=this,s=t.angle;return{x:e+Math.cos(s)*n,y:i+Math.sin(s)*n,angle:s}}}function br(t,e,i){const n=function(t){const{chart:e,fill:i,line:n}=t;if(nt(i))return function(t,e){const i=t.getDatasetMeta(e);return i&&t.isDatasetVisible(e)?i.dataset:null}(e,i);if("stack"===i)return function(t){const{scale:e,index:i,line:n}=t,s=[],r=n.segments,o=n.points,a=function(t,e){const i=[],n=t.getMatchingVisibleMetas("line");for(let t=0;t<n.length;t++){const s=n[t];if(s.index===e)break;s.hidden||i.unshift(s.dataset)}return i}(e,i);a.push(fr({x:null,y:e.bottom},n));for(let t=0;t<r.length;t++){const e=r[t];for(let t=e.start;t<=e.end;t++)_r(s,o[t],a)}return new qs({points:s,options:{}})}(t);if("shape"===i)return!0;const s=function(t){return(t.scale||{}).getPointPositionForValue?function(t){const{scale:e,fill:i}=t,n=e.options,s=e.getLabels().length,r=n.reverse?e.max:e.min,o=function(t,e,i){let n;return n="start"===t?i:"end"===t?e.options.reverse?e.min:e.max:it(t)?t.value:e.getBaseValue(),n}(i,e,r),a=[];if(n.grid.circular){const t=e.getPointPositionForValue(0,r);return new yr({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let t=0;t<s;++t)a.push(e.getPointPositionForValue(t,o));return a}(t):function(t){const{scale:e={},fill:i}=t,n=function(t,e){let i=null;return"start"===t?i=e.bottom:"end"===t?i=e.top:it(t)?i=e.getPixelForValue(t.value):e.getBasePixel&&(i=e.getBasePixel()),i}(i,e);if(nt(n)){const t=e.isHorizontal();return{x:t?n:null,y:t?null:n}}return null}(t)}(t);return s instanceof yr?s:fr(s,n)}(e),{line:s,scale:r,axis:o}=e,a=s.options,l=a.fill,h=a.backgroundColor,{above:c=h,below:d=h}=l||{};n&&s.points.length&&(Le(t,i),function(t,e){const{line:i,target:n,above:s,below:r,area:o,scale:a}=e,l=i._loop?"angle":e.axis;t.save(),"x"===l&&r!==s&&(Mr(t,n,o.top),Sr(t,{line:i,target:n,color:s,scale:a,property:l}),t.restore(),t.save(),Mr(t,n,o.bottom)),Sr(t,{line:i,target:n,color:r,scale:a,property:l}),t.restore()}(t,{line:s,target:n,above:c,below:d,area:i,scale:r,axis:o}),Re(t))}function Mr(t,e,i){const{segments:n,points:s}=e;let r=!0,o=!1;t.beginPath();for(const a of n){const{start:n,end:l}=a,h=s[n],c=s[ur(n,l,s)];r?(t.moveTo(h.x,h.y),r=!1):(t.lineTo(h.x,i),t.lineTo(h.x,h.y)),o=!!e.pathSegment(t,a,{move:o}),o?t.closePath():t.lineTo(c.x,i)}t.lineTo(e.first().x,i),t.closePath(),t.clip()}function Sr(t,e){const{line:i,target:n,property:s,color:r,scale:o}=e,a=function(t,e,i){const n=t.segments,s=t.points,r=e.points,o=[];for(const t of n){let{start:n,end:a}=t;a=ur(n,a,s);const l=dr(i,s[n],s[a],t.loop);if(!e.segments){o.push({source:t,target:l,start:s[n],end:s[a]});continue}const h=Ni(e,l);for(const e of h){const n=dr(i,r[e.start],r[e.end],e.loop),a=Oi(t,s,n);for(const t of a)o.push({source:t,target:e,start:{[i]:pr(l,n,"start",Math.max)},end:{[i]:pr(l,n,"end",Math.min)}})}}return o}(i,n,s);for(const{source:e,target:l,start:h,end:c}of a){const{style:{backgroundColor:a=r}={}}=e,d=!0!==n;t.save(),t.fillStyle=a,wr(t,o,d&&dr(s,h,c)),t.beginPath();const u=!!i.pathSegment(t,e);let p;if(d){u?t.closePath():Tr(t,n,c,s);const e=!!n.pathSegment(t,l,{move:u,reverse:!0});p=u&&e,p||Tr(t,n,h,s)}t.closePath(),t.fill(p?"evenodd":"nonzero"),t.restore()}}function wr(t,e,i){const{top:n,bottom:s}=e.chart.chartArea,{property:r,start:o,end:a}=i||{};"x"===r&&(t.beginPath(),t.rect(o,n,a-o,s-n),t.clip())}function Tr(t,e,i,n){const s=e.interpolate(i,n);s&&t.lineTo(s.x,s.y)}var Er={id:"filler",afterDatasetsUpdate(t,e,i){const n=(t.data.datasets||[]).length,s=[];let r,o,a,l;for(o=0;o<n;++o)r=t.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof qs&&(l={visible:t.isDatasetVisible(o),index:o,fill:vr(a,o,n),chart:t,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,s.push(l);for(o=0;o<n;++o)l=s[o],l&&!1!==l.fill&&(l.fill=gr(s,o,i.propagate))},beforeDraw(t,e,i){const n="beforeDraw"===i.drawTime,s=t.getSortedVisibleDatasetMetas(),r=t.chartArea;for(let e=s.length-1;e>=0;--e){const i=s[e].$filler;i&&(i.line.updateControlPoints(r,i.axis),n&&i.fill&&br(t.ctx,i,r))}},beforeDatasetsDraw(t,e,i){if("beforeDatasetsDraw"!==i.drawTime)return;const n=t.getSortedVisibleDatasetMetas();for(let e=n.length-1;e>=0;--e){const i=n[e].$filler;mr(i)&&br(t.ctx,i,t.chartArea)}},beforeDatasetDraw(t,e,i){const n=e.meta.$filler;mr(n)&&"beforeDatasetDraw"===i.drawTime&&br(t.ctx,n,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Ar=(t,e)=>{let{boxHeight:i=e,boxWidth:n=e}=t;return t.usePointStyle&&(i=Math.min(i,e),n=t.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:i,itemHeight:Math.max(e,i)}};class Cr extends Qn{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=at(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,i)=>t.sort(e,i,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,n=Xe(i.font),s=n.size,r=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=Ar(i,s);let l,h;e.font=n.string,this.isHorizontal()?(l=this.maxWidth,h=this._fitRows(r,s,o,a)+10):(h=this.maxHeight,l=this._fitCols(r,n,o,a)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,n){const{ctx:s,maxWidth:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],h=n+o;let c=t;s.textAlign="left",s.textBaseline="middle";let d=-1,u=-h;return this.legendItems.forEach(((t,p)=>{const f=i+e/2+s.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>r)&&(c+=h,l[l.length-(p>0?0:1)]=0,u+=h,d++),a[p]={left:0,top:u,row:d,width:f,height:n},l[l.length-1]+=f+o})),c}_fitCols(t,e,i,n){const{ctx:s,maxHeight:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],h=r-t;let c=o,d=0,u=0,p=0,f=0;return this.legendItems.forEach(((t,r)=>{const{itemWidth:m,itemHeight:g}=function(t,e,i,n,s){const r=function(t,e,i,n){let s=t.text;return s&&"string"!=typeof s&&(s=s.reduce(((t,e)=>t.length>e.length?t:e))),e+i.size/2+n.measureText(s).width}(n,t,e,i),o=function(t,e,i){let n=t;return"string"!=typeof e.text&&(n=Pr(e,i)),n}(s,n,e.lineHeight);return{itemWidth:r,itemHeight:o}}(i,e,s,t,n);r>0&&u+g+2*o>h&&(c+=d+o,l.push({width:d,height:u}),p+=d+o,f++,d=u=0),a[r]={left:p,top:u,col:f,width:m,height:g},d=Math.max(d,m),u+=g+o})),c+=d,l.push({width:d,height:u}),c}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:n},rtl:s}}=this,r=Li(s,this.left,this.width);if(this.isHorizontal()){let s=0,o=ee(i,this.left+n,this.right-this.lineWidths[s]);for(const a of e)s!==a.row&&(s=a.row,o=ee(i,this.left+n,this.right-this.lineWidths[s])),a.top+=this.top+t+n,a.left=r.leftForLtr(r.x(o),a.width),o+=a.width+n}else{let s=0,o=ee(i,this.top+t+n,this.bottom-this.columnSizes[s].height);for(const a of e)a.col!==s&&(s=a.col,o=ee(i,this.top+t+n,this.bottom-this.columnSizes[s].height)),a.top=o,a.left+=this.left+n,a.left=r.leftForLtr(r.x(a.left),a.width),o+=a.height+n}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;Le(t,this),this._draw(),Re(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:n}=this,{align:s,labels:r}=t,o=Me.color,a=Li(t.rtl,this.left,this.width),l=Xe(r.font),{padding:h}=r,c=l.size,d=c/2;let u;this.drawTitle(),n.textAlign=a.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=Ar(r,c),g=this.isHorizontal(),v=this._computeTitleHeight();u=g?{x:ee(s,this.left+h,this.right-i[0]),y:this.top+h+v,line:0}:{x:this.left+h,y:ee(s,this.top+v+h,this.bottom-e[0].height),line:0},Ri(this.ctx,t.textDirection);const _=m+h;this.legendItems.forEach(((x,y)=>{n.strokeStyle=x.fontColor,n.fillStyle=x.fontColor;const b=n.measureText(x.text).width,M=a.textAlign(x.textAlign||(x.textAlign=r.textAlign)),S=p+d+b;let w=u.x,T=u.y;if(a.setWidth(this.width),g?y>0&&w+S+h>this.right&&(T=u.y+=_,u.line++,w=u.x=ee(s,this.left+h,this.right-i[u.line])):y>0&&T+_>this.bottom&&(w=u.x=w+e[u.line].width+h,u.line++,T=u.y=ee(s,this.top+v+h,this.bottom-e[u.line].height)),function(t,e,i){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;n.save();const s=rt(i.lineWidth,1);if(n.fillStyle=rt(i.fillStyle,o),n.lineCap=rt(i.lineCap,"butt"),n.lineDashOffset=rt(i.lineDashOffset,0),n.lineJoin=rt(i.lineJoin,"miter"),n.lineWidth=s,n.strokeStyle=rt(i.strokeStyle,o),n.setLineDash(rt(i.lineDash,[])),r.usePointStyle){const o={radius:f*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:s},l=a.xPlus(t,p/2);Ce(n,o,l,e+d,r.pointStyleWidth&&p)}else{const r=e+Math.max((c-f)/2,0),o=a.leftForLtr(t,p),l=We(i.borderRadius);n.beginPath(),Object.values(l).some((t=>0!==t))?Ue(n,{x:o,y:r,w:p,h:f,radius:l}):n.rect(o,r,p,f),n.fill(),0!==s&&n.stroke()}n.restore()}(a.x(w),T,x),w=((t,e,i,n)=>t===(n?"left":"right")?i:"center"===t?(e+i)/2:e)(M,w+p+d,g?w+S:this.right,t.rtl),function(t,e,i){Ne(n,i.text,t,e+m/2,l,{strikethrough:i.hidden,textAlign:a.textAlign(i.textAlign)})}(a.x(w),T,x),g)u.x+=S+h;else if("string"!=typeof x.text){const t=l.lineHeight;u.y+=Pr(x,t)+h}else u.y+=_})),Di(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Xe(e.font),n=je(e.padding);if(!e.display)return;const s=Li(t.rtl,this.left,this.width),r=this.ctx,o=e.position,a=i.size/2,l=n.top+a;let h,c=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+l,c=ee(t.align,c,this.right-d);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);h=l+ee(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const u=ee(o,c,c+d);r.textAlign=s.textAlign(te(o)),r.textBaseline="middle",r.strokeStyle=e.color,r.fillStyle=e.color,r.font=i.string,Ne(r,e.text,u,h,i)}_computeTitleHeight(){const t=this.options.title,e=Xe(t.font),i=je(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,n,s;if(jt(t,this.left,this.right)&&jt(e,this.top,this.bottom))for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(n=s[i],jt(t,n.left,n.left+n.width)&&jt(e,n.top,n.top+n.height))return this.legendItems[i];return null}handleEvent(t){const e=this.options;if(!function(t,e){return!("mousemove"!==t&&"mouseout"!==t||!e.onHover&&!e.onLeave)||!(!e.onClick||"click"!==t&&"mouseup"!==t)}(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const r=this._hoveredItem,o=(s=i,null!==(n=r)&&null!==s&&n.datasetIndex===s.datasetIndex&&n.index===s.index);r&&!o&&at(e.onLeave,[t,r,this],this),this._hoveredItem=i,i&&!o&&at(e.onHover,[t,i,this],this)}else i&&at(e.onClick,[t,i,this],this);var n,s}}function Pr(t,e){return e*(t.text?t.text.length:0)}var Lr={id:"legend",_element:Cr,start(t,e,i){const n=t.legend=new Cr({ctx:t.ctx,options:i,chart:t});On.configure(t,n,i),On.addBox(t,n)},stop(t){On.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,i){const n=t.legend;On.configure(t,n,i),n.options=i},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,i){const n=e.datasetIndex,s=i.chart;s.isDatasetVisible(n)?(s.hide(n),e.hidden=!0):(s.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:i,pointStyle:n,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const l=t.controller.getStyle(i?0:void 0),h=je(l.borderWidth);return{text:e[t.index].label,fillStyle:l.backgroundColor,fontColor:r,hidden:!t.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:l.borderColor,pointStyle:n||l.pointStyle,rotation:l.rotation,textAlign:s||l.textAlign,borderRadius:o&&(a||l.borderRadius),datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Rr extends Qn{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const n=et(i.text)?i.text.length:1;this._padding=je(i.padding);const s=n*Xe(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:i,bottom:n,right:s,options:r}=this,o=r.align;let a,l,h,c=0;return this.isHorizontal()?(l=ee(o,i,s),h=e+t,a=s-i):("left"===r.position?(l=i+t,h=ee(o,n,e),c=-.5*Mt):(l=s-t,h=ee(o,e,n),c=.5*Mt),a=n-e),{titleX:l,titleY:h,maxWidth:a,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Xe(e.font),n=i.lineHeight/2+this._padding.top,{titleX:s,titleY:r,maxWidth:o,rotation:a}=this._drawArgs(n);Ne(t,e.text,0,0,i,{color:e.color,maxWidth:o,rotation:a,textAlign:te(e.align),textBaseline:"middle",translation:[s,r]})}}var Dr={id:"title",_element:Rr,start(t,e,i){!function(t,e){const i=new Rr({ctx:t.ctx,options:e,chart:t});On.configure(t,i,e),On.addBox(t,i),t.titleBlock=i}(t,i)},stop(t){const e=t.titleBlock;On.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,i){const n=t.titleBlock;On.configure(t,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ir=new WeakMap;var kr={id:"subtitle",start(t,e,i){const n=new Rr({ctx:t.ctx,options:i,chart:t});On.configure(t,n,i),On.addBox(t,n),Ir.set(t,n)},stop(t){On.removeBox(t,Ir.get(t)),Ir.delete(t)},beforeUpdate(t,e,i){const n=Ir.get(t);On.configure(t,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Or={average(t){if(!t.length)return!1;let e,i,n=0,s=0,r=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.tooltipPosition();n+=t.x,s+=t.y,++r}}return{x:n/r,y:s/r}},nearest(t,e){if(!t.length)return!1;let i,n,s,r=e.x,o=e.y,a=Number.POSITIVE_INFINITY;for(i=0,n=t.length;i<n;++i){const n=t[i].element;if(n&&n.hasValue()){const t=zt(e,n.getCenterPoint());t<a&&(a=t,s=n)}}if(s){const t=s.tooltipPosition();r=t.x,o=t.y}return{x:r,y:o}}};function Nr(t,e){return e&&(et(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Ur(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function Br(t,e){const{element:i,datasetIndex:n,index:s}=e,r=t.getDatasetMeta(n).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:t,label:o,parsed:r.getParsed(s),raw:t.data.datasets[n].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:n,element:i}}function Fr(t,e){const i=t.chart.ctx,{body:n,footer:s,title:r}=t,{boxWidth:o,boxHeight:a}=e,l=Xe(e.bodyFont),h=Xe(e.titleFont),c=Xe(e.footerFont),d=r.length,u=s.length,p=n.length,f=je(e.padding);let m=f.height,g=0,v=n.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);v+=t.beforeBody.length+t.afterBody.length,d&&(m+=d*h.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),v&&(m+=p*(e.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(v-p)*l.lineHeight+(v-1)*e.bodySpacing),u&&(m+=e.footerMarginTop+u*c.lineHeight+(u-1)*e.footerSpacing);let _=0;const x=function(t){g=Math.max(g,i.measureText(t).width+_)};return i.save(),i.font=h.string,lt(t.title,x),i.font=l.string,lt(t.beforeBody.concat(t.afterBody),x),_=e.displayColors?o+2+e.boxPadding:0,lt(n,(t=>{lt(t.before,x),lt(t.lines,x),lt(t.after,x)})),_=0,i.font=c.string,lt(t.footer,x),i.restore(),g+=f.width,{width:g,height:m}}function zr(t,e,i,n){const{x:s,width:r}=i,{width:o,chartArea:{left:a,right:l}}=t;let h="center";return"center"===n?h=s<=(a+l)/2?"left":"right":s<=r/2?h="left":s>=o-r/2&&(h="right"),function(t,e,i,n){const{x:s,width:r}=n,o=i.caretSize+i.caretPadding;return"left"===t&&s+r+o>e.width||"right"===t&&s-r-o<0||void 0}(h,t,e,i)&&(h="center"),h}function Hr(t,e,i){const n=i.yAlign||e.yAlign||function(t,e){const{y:i,height:n}=e;return i<n/2?"top":i>t.height-n/2?"bottom":"center"}(t,i);return{xAlign:i.xAlign||e.xAlign||zr(t,e,i,n),yAlign:n}}function Vr(t,e,i,n){const{caretSize:s,caretPadding:r,cornerRadius:o}=t,{xAlign:a,yAlign:l}=i,h=s+r,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:p}=We(o);let f=function(t,e){let{x:i,width:n}=t;return"right"===e?i-=n:"center"===e&&(i-=n/2),i}(e,a);const m=function(t,e,i){let{y:n,height:s}=t;return"top"===e?n+=i:n-="bottom"===e?s+i:s/2,n}(e,l,h);return"center"===l?"left"===a?f+=h:"right"===a&&(f-=h):"left"===a?f-=Math.max(c,u)+s:"right"===a&&(f+=Math.max(d,p)+s),{x:Wt(f,0,n.width-e.width),y:Wt(m,0,n.height-e.height)}}function Gr(t,e,i){const n=je(i.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-n.right:t.x+n.left}function Wr(t){return Nr([],Ur(t))}function jr(t,e){const i=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return i?t.override(i):t}const Xr={beforeTitle:J,title(t){if(t.length>0){const e=t[0],i=e.chart.data.labels,n=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return i[e.dataIndex]}return""},afterTitle:J,beforeBody:J,beforeLabel:J,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const i=t.formattedValue;return tt(i)||(e+=i),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:J,afterBody:J,beforeFooter:J,footer:J,afterFooter:J};function Yr(t,e,i,n){const s=t[e].call(i,n);return void 0===s?Xr[e].call(i,n):s}class qr extends Qn{static positioners=Or;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&e.options.animation&&i.animations,s=new Wi(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=(this,qe(this.chart.getContext(),{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"})))}getTitle(t,e){const{callbacks:i}=e,n=Yr(i,"beforeTitle",this,t),s=Yr(i,"title",this,t),r=Yr(i,"afterTitle",this,t);let o=[];return o=Nr(o,Ur(n)),o=Nr(o,Ur(s)),o=Nr(o,Ur(r)),o}getBeforeBody(t,e){return Wr(Yr(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,n=[];return lt(t,(t=>{const e={before:[],lines:[],after:[]},s=jr(i,t);Nr(e.before,Ur(Yr(s,"beforeLabel",this,t))),Nr(e.lines,Yr(s,"label",this,t)),Nr(e.after,Ur(Yr(s,"afterLabel",this,t))),n.push(e)})),n}getAfterBody(t,e){return Wr(Yr(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,n=Yr(i,"beforeFooter",this,t),s=Yr(i,"footer",this,t),r=Yr(i,"afterFooter",this,t);let o=[];return o=Nr(o,Ur(n)),o=Nr(o,Ur(s)),o=Nr(o,Ur(r)),o}_createItems(t){const e=this._active,i=this.chart.data,n=[],s=[],r=[];let o,a,l=[];for(o=0,a=e.length;o<a;++o)l.push(Br(this.chart,e[o]));return t.filter&&(l=l.filter(((e,n,s)=>t.filter(e,n,s,i)))),t.itemSort&&(l=l.sort(((e,n)=>t.itemSort(e,n,i)))),lt(l,(e=>{const i=jr(t.callbacks,e);n.push(Yr(i,"labelColor",this,e)),s.push(Yr(i,"labelPointStyle",this,e)),r.push(Yr(i,"labelTextColor",this,e))})),this.labelColors=n,this.labelPointStyles=s,this.labelTextColors=r,this.dataPoints=l,l}update(t,e){const i=this.options.setContext(this.getContext()),n=this._active;let s,r=[];if(n.length){const t=Or[i.position].call(this,n,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const e=this._size=Fr(this,i),o=Object.assign({},t,e),a=Hr(this.chart,i,o),l=Vr(i,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,s={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=r,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,n){const s=this.getCaretPosition(t,i,n);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,i){const{xAlign:n,yAlign:s}=this,{caretSize:r,cornerRadius:o}=i,{topLeft:a,topRight:l,bottomLeft:h,bottomRight:c}=We(o),{x:d,y:u}=t,{width:p,height:f}=e;let m,g,v,_,x,y;return"center"===s?(x=u+f/2,"left"===n?(m=d,g=m-r,_=x+r,y=x-r):(m=d+p,g=m+r,_=x-r,y=x+r),v=m):(g="left"===n?d+Math.max(a,h)+r:"right"===n?d+p-Math.max(l,c)-r:this.caretX,"top"===s?(_=u,x=_-r,m=g-r,v=g+r):(_=u+f,x=_+r,m=g+r,v=g-r),y=_),{x1:m,x2:g,x3:v,y1:_,y2:x,y3:y}}drawTitle(t,e,i){const n=this.title,s=n.length;let r,o,a;if(s){const l=Li(i.rtl,this.x,this.width);for(t.x=Gr(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",r=Xe(i.titleFont),o=i.titleSpacing,e.fillStyle=i.titleColor,e.font=r.string,a=0;a<s;++a)e.fillText(n[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+o,a+1===s&&(t.y+=i.titleMarginBottom-o)}}_drawColorBox(t,e,i,n,s){const r=this.labelColors[i],o=this.labelPointStyles[i],{boxHeight:a,boxWidth:l}=s,h=Xe(s.bodyFont),c=Gr(this,"left",s),d=n.x(c),u=a<h.lineHeight?(h.lineHeight-a)/2:0,p=e.y+u;if(s.usePointStyle){const e={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},i=n.leftForLtr(d,l)+l/2,h=p+a/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,Ae(t,e,i,h),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,Ae(t,e,i,h)}else{t.lineWidth=it(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const e=n.leftForLtr(d,l),i=n.leftForLtr(n.xPlus(d,1),l-2),o=We(r.borderRadius);Object.values(o).some((t=>0!==t))?(t.beginPath(),t.fillStyle=s.multiKeyBackground,Ue(t,{x:e,y:p,w:l,h:a,radius:o}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),Ue(t,{x:i,y:p+1,w:l-2,h:a-2,radius:o}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(e,p,l,a),t.strokeRect(e,p,l,a),t.fillStyle=r.backgroundColor,t.fillRect(i,p+1,l-2,a-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:n}=this,{bodySpacing:s,bodyAlign:r,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:h}=i,c=Xe(i.bodyFont);let d=c.lineHeight,u=0;const p=Li(i.rtl,this.x,this.width),f=function(i){e.fillText(i,p.x(t.x+u),t.y+d/2),t.y+=d+s},m=p.textAlign(r);let g,v,_,x,y,b,M;for(e.textAlign=r,e.textBaseline="middle",e.font=c.string,t.x=Gr(this,m,i),e.fillStyle=i.bodyColor,lt(this.beforeBody,f),u=o&&"right"!==m?"center"===r?l/2+h:l+2+h:0,x=0,b=n.length;x<b;++x){for(g=n[x],v=this.labelTextColors[x],e.fillStyle=v,lt(g.before,f),_=g.lines,o&&_.length&&(this._drawColorBox(e,t,x,p,i),d=Math.max(c.lineHeight,a)),y=0,M=_.length;y<M;++y)f(_[y]),d=c.lineHeight;lt(g.after,f)}u=0,d=c.lineHeight,lt(this.afterBody,f),t.y-=s}drawFooter(t,e,i){const n=this.footer,s=n.length;let r,o;if(s){const a=Li(i.rtl,this.x,this.width);for(t.x=Gr(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=a.textAlign(i.footerAlign),e.textBaseline="middle",r=Xe(i.footerFont),e.fillStyle=i.footerColor,e.font=r.string,o=0;o<s;++o)e.fillText(n[o],a.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,e,i,n){const{xAlign:s,yAlign:r}=this,{x:o,y:a}=t,{width:l,height:h}=i,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:p}=We(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(o+c,a),"top"===r&&this.drawCaret(t,e,i,n),e.lineTo(o+l-d,a),e.quadraticCurveTo(o+l,a,o+l,a+d),"center"===r&&"right"===s&&this.drawCaret(t,e,i,n),e.lineTo(o+l,a+h-p),e.quadraticCurveTo(o+l,a+h,o+l-p,a+h),"bottom"===r&&this.drawCaret(t,e,i,n),e.lineTo(o+u,a+h),e.quadraticCurveTo(o,a+h,o,a+h-u),"center"===r&&"left"===s&&this.drawCaret(t,e,i,n),e.lineTo(o,a+c),e.quadraticCurveTo(o,a,o+c,a),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,n=i&&i.x,s=i&&i.y;if(n||s){const i=Or[t.position].call(this,this._active,this._eventPosition);if(!i)return;const r=this._size=Fr(this,t),o=Object.assign({},i,this._size),a=Hr(e,t,o),l=Vr(t,o,a,e);n._to===l.x&&s._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=r.width,this.height=r.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=je(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,n,e),Ri(t,e.textDirection),s.y+=r.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),Di(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,n=t.map((({datasetIndex:t,index:e})=>{const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[e],index:e}})),s=!ht(i,n),r=this._positionChanged(n,e);(s||r)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,s=this._active||[],r=this._getActiveElements(t,s,e,i),o=this._positionChanged(r,t),a=e||!ht(r,s)||o;return a&&(this._active=r,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,i,n){const s=this.options;if("mouseout"===t.type)return[];if(!n)return e;const r=this.chart.getElementsAtEventForMode(t,s.mode,s,i);return s.reverse&&r.reverse(),r}_positionChanged(t,e){const{caretX:i,caretY:n,options:s}=this,r=Or[s.position].call(this,t,e);return!1!==r&&(i!==r.x||n!==r.y)}}var Kr={id:"tooltip",_element:qr,positioners:Or,afterInit(t,e,i){i&&(t.tooltip=new qr({chart:t,options:i}))},beforeUpdate(t,e,i){t.tooltip&&t.tooltip.initialize(i)},reset(t,e,i){t.tooltip&&t.tooltip.initialize(i)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const i={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",i)}},afterEvent(t,e){if(t.tooltip){const i=e.replay;t.tooltip.handleEvent(e.event,i,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Xr},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Zr=Object.freeze({__proto__:null,Colors:ar,Decimation:cr,Filler:Er,Legend:Lr,SubTitle:kr,Title:Dr,Tooltip:Kr});function $r(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}function Jr(t,e,{horizontal:i,minRotation:n}){const s=Nt(n),r=(i?Math.sin(s):Math.cos(s))||.001,o=.75*e*(""+t).length;return Math.min(e/r,o)}class Qr extends ls{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return tt(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:n,max:s}=this;const r=t=>n=e?n:t,o=t=>s=i?s:t;if(t){const t=Rt(n),e=Rt(s);t<0&&e<0?o(0):t>0&&e>0&&r(0)}if(n===s){let e=0===s?1:Math.abs(.05*s);o(s+e),t||r(n-e)}this.min=n,this.max=s}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:i,stepSize:n}=t;return n?(e=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),i=i||11),i&&(e=Math.min(i,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n=function(t,e){const i=[],{bounds:n,step:s,min:r,max:o,precision:a,count:l,maxTicks:h,maxDigits:c,includeBounds:d}=t,u=s||1,p=h-1,{min:f,max:m}=e,g=!tt(r),v=!tt(o),_=!tt(l),x=(m-f)/(c+1);let y,b,M,S,w=It((m-f)/p/u)*u;if(w<1e-14&&!g&&!v)return[{value:f},{value:m}];S=Math.ceil(m/w)-Math.floor(f/w),S>p&&(w=It(S*w/p/u)*u),tt(a)||(y=Math.pow(10,a),w=Math.ceil(w*y)/y),"ticks"===n?(b=Math.floor(f/w)*w,M=Math.ceil(m/w)*w):(b=f,M=m),g&&v&&s&&function(t,e){const i=Math.round(t);return i-e<=t&&i+e>=t}((o-r)/s,w/1e3)?(S=Math.round(Math.min((o-r)/w,h)),w=(o-r)/S,b=r,M=o):_?(b=g?r:b,M=v?o:M,S=l-1,w=(M-b)/S):(S=(M-b)/w,S=Dt(S,Math.round(S),w/1e3)?Math.round(S):Math.ceil(S));const T=Math.max(Bt(w),Bt(b));y=Math.pow(10,tt(a)?T:a),b=Math.round(b*y)/y,M=Math.round(M*y)/y;let E=0;for(g&&(d&&b!==r?(i.push({value:r}),b<r&&E++,Dt(Math.round((b+E*w)*y)/y,r,Jr(r,x,t))&&E++):b<r&&E++);E<S;++E){const t=Math.round((b+E*w)*y)/y;if(v&&t>o)break;i.push({value:t})}return v&&d&&M!==o?i.length&&Dt(i[i.length-1].value,o,Jr(o,x,t))?i[i.length-1].value=o:i.push({value:o}):v&&M!==o||i.push({value:M}),i}({maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&Ot(n,this,"value"),t.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const n=(i-e)/Math.max(t.length-1,1)/2;e-=n,i+=n}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return fe(t,this.chart.options.locale,this.options.ticks.format)}}class to extends Qr{static id="linear";static defaults={ticks:{callback:ge.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=nt(t)?t:0,this.max=nt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=Nt(this.options.ticks.minRotation),n=(t?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/n))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const eo=t=>Math.floor(Lt(t)),io=(t,e)=>Math.pow(10,eo(t)+e);function no(t){return 1==t/Math.pow(10,eo(t))}function so(t,e,i){const n=Math.pow(10,i),s=Math.floor(t/n);return Math.ceil(e/n)-s}class ro extends ls{static id="logarithmic";static defaults={ticks:{callback:ge.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Qr.prototype.parse.apply(this,[t,e]);if(0!==i)return nt(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=nt(t)?Math.max(0,t):null,this.max=nt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!nt(this._userMin)&&(this.min=t===io(this.min,0)?io(this.min,-1):io(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,n=this.max;const s=e=>i=t?i:e,r=t=>n=e?n:t;i===n&&(i<=0?(s(1),r(10)):(s(io(i,-1)),r(io(n,1)))),i<=0&&s(io(n,-1)),n<=0&&r(io(i,1)),this.min=i,this.max=n}buildTicks(){const t=this.options,e=function(t,{min:e,max:i}){e=st(t.min,e);const n=[],s=eo(e);let r=function(t,e){let i=eo(e-t);for(;so(t,e,i)>10;)i++;for(;so(t,e,i)<10;)i--;return Math.min(i,eo(t))}(e,i),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=s>r?Math.pow(10,s):0,h=Math.round((e-l)*o)/o,c=Math.floor((e-l)/a/10)*a*10;let d=Math.floor((h-c)/Math.pow(10,r)),u=st(t.min,Math.round((l+c+d*Math.pow(10,r))*o)/o);for(;u<i;)n.push({value:u,major:no(u),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(r++,d=2,o=r>=0?1:o),u=Math.round((l+c+d*Math.pow(10,r))*o)/o;const p=st(t.max,u);return n.push({value:p,major:no(p),significand:d}),n}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&Ot(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":fe(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Lt(t),this._valueRange=Lt(this.max)-Lt(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Lt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function oo(t){const e=t.ticks;if(e.display&&t.display){const t=je(e.backdropPadding);return rt(e.font&&e.font.size,Me.font.size)+t.height}return 0}function ao(t,e,i,n,s){return t===n||t===s?{start:e-i/2,end:e+i/2}:t<n||t>s?{start:e-i,end:e}:{start:e,end:e+i}}function lo(t,e,i,n,s){const r=Math.abs(Math.sin(i)),o=Math.abs(Math.cos(i));let a=0,l=0;n.start<e.l?(a=(e.l-n.start)/r,t.l=Math.min(t.l,e.l-a)):n.end>e.r&&(a=(n.end-e.r)/r,t.r=Math.max(t.r,e.r+a)),s.start<e.t?(l=(e.t-s.start)/o,t.t=Math.min(t.t,e.t-l)):s.end>e.b&&(l=(s.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function ho(t,e,i){const n=t.drawingArea,{extra:s,additionalAngle:r,padding:o,size:a}=i,l=t.getPointPosition(e,n+s+o,r),h=Math.round(Ut(Vt(l.angle+At))),c=function(t,e,i){return 90===i||270===i?t-=e/2:(i>270||i<90)&&(t-=e),t}(l.y,a.h,h),d=function(t){return 0===t||180===t?"center":t<180?"left":"right"}(h),u=function(t,e,i){return"right"===i?t-=e:"center"===i&&(t-=e/2),t}(l.x,a.w,d);return{visible:!0,x:l.x,y:c,textAlign:d,left:u,top:c,right:u+a.w,bottom:c+a.h}}function co(t,e){if(!e)return!0;const{left:i,top:n,right:s,bottom:r}=t;return!(Pe({x:i,y:n},e)||Pe({x:i,y:r},e)||Pe({x:s,y:n},e)||Pe({x:s,y:r},e))}function uo(t,e,i){const{left:n,top:s,right:r,bottom:o}=i,{backdropColor:a}=e;if(!tt(a)){const i=We(e.borderRadius),l=je(e.backdropPadding);t.fillStyle=a;const h=n-l.left,c=s-l.top,d=r-n+l.width,u=o-s+l.height;Object.values(i).some((t=>0!==t))?(t.beginPath(),Ue(t,{x:h,y:c,w:d,h:u,radius:i}),t.fill()):t.fillRect(h,c,d,u)}}function po(t,e,i,n){const{ctx:s}=t;if(i)s.arc(t.xCenter,t.yCenter,e,0,St);else{let i=t.getPointPosition(0,e);s.moveTo(i.x,i.y);for(let r=1;r<n;r++)i=t.getPointPosition(r,e),s.lineTo(i.x,i.y)}}class fo extends Qr{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:ge.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=je(oo(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=nt(t)&&!isNaN(t)?t:0,this.max=nt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/oo(this.options))}generateTickLabels(t){Qr.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const i=at(this.options.pointLabels.callback,[t,e],this);return i||0===i?i:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?function(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},i=Object.assign({},e),n=[],s=[],r=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?Mt/r:0;for(let d=0;d<r;d++){const r=o.setContext(t.getPointLabelContext(d));s[d]=r.padding;const u=t.getPointPosition(d,t.drawingArea+s[d],a),p=Xe(r.font),f=(l=t.ctx,h=p,c=et(c=t._pointLabels[d])?c:[c],{w:we(l,h.string,c),h:c.length*h.lineHeight});n[d]=f;const m=Vt(t.getIndexAngle(d)+a),g=Math.round(Ut(m));lo(i,e,m,ao(g,u.x,f.w,0,180),ao(g,u.y,f.h,90,270))}var l,h,c;t.setCenterPoint(e.l-i.l,i.r-e.r,e.t-i.t,i.b-e.b),t._pointLabelItems=function(t,e,i){const n=[],s=t._pointLabels.length,r=t.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:oo(r)/2,additionalAngle:o?Mt/s:0};let h;for(let r=0;r<s;r++){l.padding=i[r],l.size=e[r];const s=ho(t,r,l);n.push(s),"auto"===a&&(s.visible=co(s,h),s.visible&&(h=s))}return n}(t,n,s)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,n))}getIndexAngle(t){return Vt(t*(St/(this._pointLabels.length||1))+Nt(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(tt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(tt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return function(t,e,i){return qe(t,{label:i,index:e,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const n=this.getIndexAngle(t)-At+i;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:n,bottom:s}=this._pointLabelItems[t];return{left:e,top:i,right:n,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),po(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:n,border:s}=e,r=this._pointLabels.length;let o,a,l;if(e.pointLabels.display&&function(t,e){const{ctx:i,options:{pointLabels:n}}=t;for(let s=e-1;s>=0;s--){const e=t._pointLabelItems[s];if(!e.visible)continue;const r=n.setContext(t.getPointLabelContext(s));uo(i,r,e);const o=Xe(r.font),{x:a,y:l,textAlign:h}=e;Ne(i,t._pointLabels[s],a,l+o.lineHeight/2,o,{color:r.color,textAlign:h,textBaseline:"middle"})}}(this,r),n.display&&this.ticks.forEach(((t,e)=>{if(0!==e){a=this.getDistanceFromCenterForValue(t.value);const i=this.getContext(e),o=n.setContext(i),l=s.setContext(i);!function(t,e,i,n,s){const r=t.ctx,o=e.circular,{color:a,lineWidth:l}=e;!o&&!n||!a||!l||i<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(s.dash),r.lineDashOffset=s.dashOffset,r.beginPath(),po(t,i,o,n),r.closePath(),r.stroke(),r.restore())}(this,o,a,r,l)}})),i.display){for(t.save(),o=r-1;o>=0;o--){const n=i.setContext(this.getPointLabelContext(o)),{color:s,lineWidth:r}=n;r&&s&&(t.lineWidth=r,t.strokeStyle=s,t.setLineDash(n.borderDash),t.lineDashOffset=n.borderDashOffset,a=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(o,a),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let s,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((n,o)=>{if(0===o&&!e.reverse)return;const a=i.setContext(this.getContext(o)),l=Xe(a.font);if(s=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){t.font=l.string,r=t.measureText(n.label).width,t.fillStyle=a.backdropColor;const e=je(a.backdropPadding);t.fillRect(-r/2-e.left,-s-l.size/2-e.top,r+e.width,l.size+e.height)}Ne(t,n.label,0,-s,l,{color:a.color,strokeColor:a.textStrokeColor,strokeWidth:a.textStrokeWidth})})),t.restore()}drawTitle(){}}const mo={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},go=Object.keys(mo);function vo(t,e){return t-e}function _o(t,e){if(tt(e))return null;const i=t._adapter,{parser:n,round:s,isoWeekday:r}=t._parseOpts;let o=e;return"function"==typeof n&&(o=n(o)),nt(o)||(o="string"==typeof n?i.parse(o,n):i.parse(o)),null===o?null:(s&&(o="week"!==s||!kt(r)&&!0!==r?i.startOf(o,s):i.startOf(o,"isoWeek",r)),+o)}function xo(t,e,i,n){const s=go.length;for(let r=go.indexOf(t);r<s-1;++r){const t=mo[go[r]],s=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((i-e)/(s*t.size))<=n)return go[r]}return go[s-1]}function yo(t,e,i){if(i){if(i.length){const{lo:n,hi:s}=Xt(i,e);t[i[n]>=e?i[n]:i[s]]=!0}}else t[e]=!0}function bo(t,e,i){const n=[],s={},r=e.length;let o,a;for(o=0;o<r;++o)a=e[o],s[a]=o,n.push({value:a,major:!1});return 0!==r&&i?function(t,e,i,n){const s=t._adapter,r=+s.startOf(e[0].value,n),o=e[e.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,n))l=i[a],l>=0&&(e[l].major=!0);return e}(t,n,s,i):n}class Mo extends ls{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),n=this._adapter=new vn(t.adapters.date);n.init(e),ft(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:_o(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:n,max:s,minDefined:r,maxDefined:o}=this.getUserBounds();function a(t){r||isNaN(t.min)||(n=Math.min(n,t.min)),o||isNaN(t.max)||(s=Math.max(s,t.max))}r&&o||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),n=nt(n)&&!isNaN(n)?n:+e.startOf(Date.now(),i),s=nt(s)&&!isNaN(s)?s:+e.endOf(Date.now(),i)+1,this.min=Math.min(n,s-1),this.max=Math.max(n+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,n="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const s=this.min,r=function(t,e,i){let n=0,s=t.length;for(;n<s&&t[n]<e;)n++;for(;s>n&&t[s-1]>i;)s--;return n>0||s<t.length?t.slice(n,s):t}(n,s,this.max);return this._unit=e.unit||(i.autoSkip?xo(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(t,e,i,n,s){for(let r=go.length-1;r>=go.indexOf(i);r--){const i=go[r];if(mo[i].common&&t._adapter.diff(s,n,i)>=e-1)return i}return go[i?go.indexOf(i):0]}(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(t){for(let e=go.indexOf(t)+1,i=go.length;e<i;++e)if(mo[go[e]].common)return go[e]}(this._unit):void 0,this.initOffsets(n),t.reverse&&r.reverse(),bo(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t=[]){let e,i,n=0,s=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),n=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,i=this.getDecimalForValue(t[t.length-1]),s=1===t.length?i:(i-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=Wt(n,0,r),s=Wt(s,0,r),this._offsets={start:n,end:s,factor:1/(n+1+s)}}_generate(){const t=this._adapter,e=this.min,i=this.max,n=this.options,s=n.time,r=s.unit||xo(s.minUnit,e,i,this._getLabelCapacity(e)),o=rt(n.ticks.stepSize,1),a="week"===r&&s.isoWeekday,l=kt(a)||!0===a,h={};let c,d,u=e;if(l&&(u=+t.startOf(u,"isoWeek",a)),u=+t.startOf(u,l?"day":r),t.diff(i,e,r)>1e5*o)throw new Error(e+" and "+i+" are too far apart with stepSize of "+o+" "+r);const p="data"===n.ticks.source&&this.getDataTimestamps();for(c=u,d=0;c<i;c=+t.add(c,o,r),d++)yo(h,c,p);return c!==i&&"ticks"!==n.bounds&&1!==d||yo(h,c,p),Object.keys(h).sort(vo).map((t=>+t))}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,n=this._unit,s=e||i[n];return this._adapter.format(t,s)}_tickFormatFunction(t,e,i,n){const s=this.options,r=s.ticks.callback;if(r)return at(r,[t,e,i],this);const o=s.time.displayFormats,a=this._unit,l=this._majorUnit,h=a&&o[a],c=l&&o[l],d=i[e],u=l&&c&&d&&d.major;return this._adapter.format(t,n||(u?c:h))}generateTickLabels(t){let e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,n=Nt(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(n),r=Math.sin(n),o=this._resolveTickFontOptions(0).size;return{w:i*s+o*r,h:i*r+o*s}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,n=i[e.unit]||i.millisecond,s=this._tickFormatFunction(t,0,bo(this,[t],this._majorUnit),n),r=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,i=this._cache.data||[];if(i.length)return i;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(t=0,e=n.length;t<e;++t)i=i.concat(n[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const n=this.getLabels();for(e=0,i=n.length;e<i;++e)t.push(_o(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return $t(t.sort(vo))}}function So(t,e,i){let n,s,r,o,a=0,l=t.length-1;i?(e>=t[a].pos&&e<=t[l].pos&&({lo:a,hi:l}=Yt(t,"pos",e)),({pos:n,time:r}=t[a]),({pos:s,time:o}=t[l])):(e>=t[a].time&&e<=t[l].time&&({lo:a,hi:l}=Yt(t,"time",e)),({time:n,pos:r}=t[a]),({time:s,pos:o}=t[l]));const h=s-n;return h?r+(o-r)*(e-n)/h:r}var wo=Object.freeze({__proto__:null,CategoryScale:class extends ls{static id="category";static defaults={ticks:{callback:$r}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:i,label:n}of e)t[i]===n&&t.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(tt(t))return null;const i=this.getLabels();return((t,e)=>null===t?null:Wt(Math.round(t),0,e))(e=isFinite(e)&&i[e]===t?e:function(t,e,i,n){const s=t.indexOf(e);return-1===s?((t,e,i,n)=>("string"==typeof e?(i=t.push(e)-1,n.unshift({index:i,label:e})):isNaN(e)&&(i=null),i))(t,e,i,n):s!==t.lastIndexOf(e)?i:s}(i,t,rt(e,t),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),e||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,n=[];let s=this.getLabels();s=0===t&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=t;i<=e;i++)n.push({value:i});return n}getLabelForValue(t){return $r.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:to,LogarithmicScale:ro,RadialLinearScale:fo,TimeScale:Mo,TimeSeriesScale:class extends Mo{static id="timeseries";static defaults=Mo.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=So(e,this.min),this._tableRange=So(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,n=[],s=[];let r,o,a,l,h;for(r=0,o=t.length;r<o;++r)l=t[r],l>=e&&l<=i&&n.push(l);if(n.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(r=0,o=n.length;r<o;++r)h=n[r+1],a=n[r-1],l=n[r],Math.round((h+a)/2)!==l&&s.push({time:l,pos:r/(o-1)});return s}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return i.includes(t)&&i.length||i.splice(0,0,t),i.includes(e)&&1!==i.length||i.push(e),i.sort(((t,e)=>t-e))}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(So(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return So(this._table,i*this._tableRange+this._minPos,!0)}}});const To=[fn,er,Zr,wo];Us.register(...To);const Eo=Us;var Ao=i(840);class Co{constructor(t){this._characterIndex=0,this._finishedMessage=!0,this._lastUpdateTime=0,this._startTime=0,this._endTime=0,this._characterSpeed=[],this._startDelay=[],this._endDelay=[],this._textToDisplay=[],this._OnFinishCallback=[],this._createdSpanElem=[],this._htmlElement=t}update(t,e){if(0!=this._textToDisplay.length)if(0==this._finishedMessage){if(t-this._startTime>this._startDelay[0]&&t-this._lastUpdateTime>this._characterSpeed[0]){if("\n"==this._textToDisplay[0][this._characterIndex])this._htmlElement.innerHTML+="<br/>";else if("<"==this._textToDisplay[0][this._characterIndex]){if("span"==this._textToDisplay[0].slice(this._characterIndex+1,this._characterIndex+5)||"/span"==this._textToDisplay[0].slice(this._characterIndex+1,this._characterIndex+6)){var i=0;for(i=this._characterIndex+1;i<this._textToDisplay[0].length&&">"!=this._textToDisplay[0][i];i++);var n=this._textToDisplay[0].slice(this._characterIndex,i+1);if("span"==this._textToDisplay[0].slice(this._characterIndex+1,this._characterIndex+5)){var s=[];0==this._createdSpanElem.length?(this._htmlElement.innerHTML+=n,s=this._htmlElement.getElementsByTagName("span")):(this._createdSpanElem[this._createdSpanElem.length-1].innerHTML+=n,s=this._createdSpanElem[this._createdSpanElem.length-1].getElementsByTagName("span")),this._createdSpanElem.push(s[s.length-1])}else 0==this._createdSpanElem.length?this._htmlElement.innerHTML+=n:this._createdSpanElem[this._createdSpanElem.length-1].innerHTML+=n,this._createdSpanElem.pop();this._characterIndex=i}}else this._createdSpanElem.length>0?this._createdSpanElem[this._createdSpanElem.length-1].innerHTML+=this._textToDisplay[0][this._characterIndex]:this._htmlElement.innerHTML+=this._textToDisplay[0][this._characterIndex];this._characterIndex++,this._lastUpdateTime=t,this._characterIndex>=this._textToDisplay[0].length&&(this._endTime=t,this._finishedMessage=!0)}}else t-this._endTime>this._endDelay[0]&&(null!==this._OnFinishCallback[0]&&this._OnFinishCallback[0](),this._OnFinishCallback=this._OnFinishCallback.slice(1),this._textToDisplay=this._textToDisplay.slice(1),this._characterSpeed=this._characterSpeed.slice(1),this._startDelay=this._startDelay.slice(1),this._endDelay=this._endDelay.slice(1),this._characterIndex=0,0==this._textToDisplay.length?this._finishedMessage=!0:(this._htmlElement.innerHTML="",this._finishedMessage=!1),this._lastUpdateTime=t,this._startTime=t)}displayText(t,e,i,n,s,r){s&&(this._textToDisplay=[],this._characterSpeed=[],this._startDelay=[],this._endDelay=[],this._OnFinishCallback=[],this._characterIndex=0,this._htmlElement.innerHTML="",this._lastUpdateTime=Mx.currentTime,this._startTime=Mx.currentTime),this._textToDisplay.push(t),this._characterSpeed.push(e),this._startDelay.push(i),this._endDelay.push(n),this._OnFinishCallback.push(r),this._finishedMessage=!1}}class Po{constructor(t,e,i,n){this._isVisible=!1;let s=document.createElement("div");s.id=e,s.className="wideCellWithDesc",s.style.cursor="pointer",s.addEventListener("mousedown",(()=>{this.toggleVisibility()})),t.appendChild(s);let r=document.createElement("div");r.className="wideCellWithDescTitle",r.innerHTML=i,s.appendChild(r),this._arrowElem=document.createElement("img"),this._arrowElem.className="wideCellWithDescArrow",this._arrowElem.src="./images/ui/down-arrow.png",s.appendChild(this._arrowElem),this._cellDesc=document.createElement("div"),this._cellDesc.className="wideCellWithDescText",this._cellDesc.style.display="none",s.appendChild(this._cellDesc),this._typewriter=new Co(this._cellDesc),this._description=n}toggleVisibility(){this._isVisible=!this._isVisible,this._isVisible?(this._cellDesc.style.display="block",this._arrowElem.src="./images/ui/next.png",this._typewriter.displayText(this._description,.1,0,0,!0,null)):(this._cellDesc.innerHTML="",this._cellDesc.style.display="none",this._arrowElem.src="./images/ui/down-arrow.png")}update(){this._typewriter.update(Mx.currentTime,Mx.deltaTime)}}class Lo{constructor(t,e){this._tags=[];let i=document.createElement("div");i.id=e._id,i.className="wideCellGallery",t.appendChild(i);let n=document.createElement("div");n.className="wideCellGalleryLeftPanel",i.appendChild(n);let s=document.createElement("div");s.className="wideCellGalleryRightPanel",i.appendChild(s);let o=document.createElement("div");o.className="wideCellGalleryTitle",o.innerHTML=e._title,n.appendChild(o);let a=document.createElement("div");a.className="wideCellGalleryTagsList",n.appendChild(a);for(let t=0;t<e._tags.length;++t){let i=document.createElement("div");i.className="wideCellGalleryTag",i.innerHTML=e._tags[t],i.style.backgroundColor=e._tagColors[t],a.appendChild(i),this._tags.push(i)}let l=document.createElement("div");if(l.className="wideCellGalleryDescription",l.innerHTML=e._description,n.appendChild(l),this._gallery=new r(s,e._id,e._imagesPath,e._imageCount,e._videoFormatIndices,e._imageDurationMs),""!=e._btn1Link||""!=e._btn2Link){let t=document.createElement("div");t.className="cellButtonBorder",n.appendChild(t);let i=document.createElement("div");i.className="cellButton",i.addEventListener("mousedown",(()=>{window.open(e._btn2Link,"_blank")})),t.appendChild(i);let s=document.createElement("div");s.className="centerText",s.innerHTML=e._btn2Name,i.appendChild(s)}}update(){this._gallery.update()}updateColorTheme(){for(let t=0;t<this._tags.length;++t)"grayscaleTheme"==document.documentElement.className?this._tags[t].classList.add("grayscale"):this._tags[t].classList.remove("grayscale");this._gallery.updateColorTheme()}}const Ro="155",Do=1,Io=2,ko=3,Oo=100,No=0,Uo=1,Bo=2,Fo=0,zo=1,Ho=2,Vo=3,Go=4,Wo=5,jo=301,Xo=302,Yo=303,qo=306,Ko=1e3,Zo=1001,$o=1002,Jo=1003,Qo=1004,ta=1005,ea=1006,ia=1008,na=1009,sa=1012,ra=1014,oa=1015,aa=1016,la=1020,ha=1023,ca=1026,da=1027,ua=33776,pa=33777,fa=33778,ma=33779,ga=36492,va=2300,_a=2301,xa=2302,ya=2400,ba=2401,Ma=2402,Sa=3001,wa="srgb",Ta="srgb-linear",Ea="display-p3",Aa=7680,Ca=35044,Pa="300 es",La=1035,Ra=2e3,Da=2001;class Ia{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const ka=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const Oa=Math.PI/180,Na=180/Math.PI;function Ua(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(ka[255&t]+ka[t>>8&255]+ka[t>>16&255]+ka[t>>24&255]+"-"+ka[255&e]+ka[e>>8&255]+"-"+ka[e>>16&15|64]+ka[e>>24&255]+"-"+ka[63&i|128]+ka[i>>8&255]+"-"+ka[i>>16&255]+ka[i>>24&255]+ka[255&n]+ka[n>>8&255]+ka[n>>16&255]+ka[n>>24&255]).toLowerCase()}function Ba(t,e,i){return Math.max(e,Math.min(i,t))}function Fa(t,e){return(t%e+e)%e}function za(t,e,i){return(1-i)*t+i*e}function Ha(t){return 0==(t&t-1)&&0!==t}function Va(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ga(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Wa(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ja(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Xa=Oa,Ya=function(t){return t*Oa},qa=function(t){return t*Na};class Ka{constructor(t=0,e=0){Ka.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Ba(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Za{constructor(t,e,i,n,s,r,o,a,l){Za.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,l)}set(t,e,i,n,s,r,o,a,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=o,h[3]=e,h[4]=s,h[5]=a,h[6]=i,h[7]=r,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[3],a=i[6],l=i[1],h=i[4],c=i[7],d=i[2],u=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],_=n[4],x=n[7],y=n[2],b=n[5],M=n[8];return s[0]=r*f+o*v+a*y,s[3]=r*m+o*_+a*b,s[6]=r*g+o*x+a*M,s[1]=l*f+h*v+c*y,s[4]=l*m+h*_+c*b,s[7]=l*g+h*x+c*M,s[2]=d*f+u*v+p*y,s[5]=d*m+u*_+p*b,s[8]=d*g+u*x+p*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*r*h-e*o*l-i*s*h+i*o*a+n*s*l-n*r*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=h*r-o*l,d=o*a-h*s,u=l*s-r*a,p=e*c+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(n*l-h*i)*f,t[2]=(o*i-n*r)*f,t[3]=d*f,t[4]=(h*e-n*a)*f,t[5]=(n*s-o*e)*f,t[6]=u*f,t[7]=(i*a-l*e)*f,t[8]=(r*e-i*s)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,r,o){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*r+l*o)+r+t,-n*l,n*a,-n*(-l*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply($a.makeScale(t,e)),this}rotate(t){return this.premultiply($a.makeRotation(-t)),this}translate(t,e){return this.premultiply($a.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const $a=new Za;function Ja(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function Qa(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const tl={};function el(t){t in tl||(tl[t]=!0,console.warn(t))}function il(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function nl(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const sl=(new Za).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),rl=(new Za).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),ol={[Ta]:t=>t,[wa]:t=>t.convertSRGBToLinear(),[Ea]:function(t){return t.convertSRGBToLinear().applyMatrix3(rl)}},al={[Ta]:t=>t,[wa]:t=>t.convertLinearToSRGB(),[Ea]:function(t){return t.applyMatrix3(sl).convertLinearToSRGB()}},ll={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return Ta},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(!1===this.enabled||e===i||!e||!i)return t;const n=ol[e],s=al[i];if(void 0===n||void 0===s)throw new Error(`Unsupported color space conversion, "${e}" to "${i}".`);return s(n(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};let hl;class cl{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===hl&&(hl=Qa("canvas")),hl.width=t.width,hl.height=t.height;const i=hl.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=hl}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Qa("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let t=0;t<s.length;t++)s[t]=255*il(s[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*il(e[t]/255)):e[t]=il(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let dl=0;class ul{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:dl++}),this.uuid=Ua(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(pl(n[e].image)):t.push(pl(n[e]))}else t=pl(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function pl(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?cl.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let fl=0;class ml extends Ia{constructor(t=ml.DEFAULT_IMAGE,e=ml.DEFAULT_MAPPING,i=1001,n=1001,s=1006,r=1008,o=1023,a=1009,l=ml.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:fl++}),this.uuid=Ua(),this.name="",this.source=new ul(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Ka(0,0),this.repeat=new Ka(1,1),this.center=new Ka(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Za,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof h?this.colorSpace=h:(el("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===Sa?wa:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ko:t.x=t.x-Math.floor(t.x);break;case Zo:t.x=t.x<0?0:1;break;case $o:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Ko:t.y=t.y-Math.floor(t.y);break;case Zo:t.y=t.y<0?0:1;break;case $o:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return el("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===wa?Sa:3e3}set encoding(t){el("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Sa?wa:""}}ml.DEFAULT_IMAGE=null,ml.DEFAULT_MAPPING=300,ml.DEFAULT_ANISOTROPY=1;class gl{constructor(t=0,e=0,i=0,n=1){gl.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const r=.01,o=.1,a=t.elements,l=a[0],h=a[4],c=a[8],d=a[1],u=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(h-d)<r&&Math.abs(c-f)<r&&Math.abs(p-m)<r){if(Math.abs(h+d)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+u+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(u+1)/2,v=(g+1)/2,_=(h+d)/4,x=(c+f)/4,y=(p+m)/4;return t>a&&t>v?t<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(t),n=_/i,s=x/i):a>v?a<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=_/n,s=y/n):v<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=x/s,n=y/s),this.set(i,n,s,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(d-h)*(d-h));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(d-h)/v,this.w=Math.acos((l+u+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vl extends Ia{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new gl(0,0,t,e),this.scissorTest=!1,this.viewport=new gl(0,0,t,e);const n={width:t,height:e,depth:1};void 0!==i.encoding&&(el("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===Sa?wa:""),this.texture=new ml(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ea,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new ul(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class _l extends vl{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class xl extends ml{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Jo,this.minFilter=Jo,this.wrapR=Zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yl extends ml{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Jo,this.minFilter=Jo,this.wrapR=Zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bl{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,r,o){let a=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const d=s[r+0],u=s[r+1],p=s[r+2],f=s[r+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===o)return t[e+0]=d,t[e+1]=u,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==d||l!==u||h!==p){let t=1-o;const e=a*d+l*u+h*p+c*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,e*i);t=Math.sin(t*r)/s,o=Math.sin(o*r)/s}const s=o*i;if(a=a*t+d*s,l=l*t+u*s,h=h*t+p*s,c=c*t+f*s,t===1-o){const t=1/Math.sqrt(a*a+l*l+h*h+c*c);a*=t,l*=t,h*=t,c*=t}}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,s,r){const o=i[n],a=i[n+1],l=i[n+2],h=i[n+3],c=s[r],d=s[r+1],u=s[r+2],p=s[r+3];return t[e]=o*p+h*c+a*u-l*d,t[e+1]=a*p+h*d+l*c-o*u,t[e+2]=l*p+h*u+o*d-a*c,t[e+3]=h*p-o*c-a*d-l*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,n=t._y,s=t._z,r=t._order,o=Math.cos,a=Math.sin,l=o(i/2),h=o(n/2),c=o(s/2),d=a(i/2),u=a(n/2),p=a(s/2);switch(r){case"XYZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"YXZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"ZXY":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"ZYX":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"YZX":this._x=d*h*c+l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c-d*u*p;break;case"XZY":this._x=d*h*c-l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],o=e[5],a=e[9],l=e[2],h=e[6],c=e[10],d=i+o+c;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(h-a)*t,this._y=(s-l)*t,this._z=(r-n)*t}else if(i>o&&i>c){const t=2*Math.sqrt(1+i-o-c);this._w=(h-a)/t,this._x=.25*t,this._y=(n+r)/t,this._z=(s+l)/t}else if(o>c){const t=2*Math.sqrt(1+o-i-c);this._w=(s-l)/t,this._x=(n+r)/t,this._y=.25*t,this._z=(a+h)/t}else{const t=2*Math.sqrt(1+c-i-o);this._w=(r-n)/t,this._x=(s+l)/t,this._y=(a+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ba(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,r=t._w,o=e._x,a=e._y,l=e._z,h=e._w;return this._x=i*h+r*o+n*l-s*a,this._y=n*h+r*a+s*o-i*l,this._z=s*h+r*l+i*a-n*o,this._w=r*h-i*o-n*a-s*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),h=Math.atan2(l,o),c=Math.sin((1-e)*h)/l,d=Math.sin(e*h)/l;return this._w=r*c+this._w*d,this._x=i*c+this._x*d,this._y=n*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ml{constructor(t=0,e=0,i=0){Ml.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(wl.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(wl.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,l=a*e+r*n-o*i,h=a*i+o*e-s*n,c=a*n+s*i-r*e,d=-s*e-r*i-o*n;return this.x=l*a+d*-s+h*-o-c*-r,this.y=h*a+d*-r+c*-s-l*-o,this.z=c*a+d*-o+l*-r-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Sl.copy(this).projectOnVector(t),this.sub(Sl)}reflect(t){return this.sub(Sl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Ba(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Sl=new Ml,wl=new bl;class Tl{constructor(t=new Ml(1/0,1/0,1/0),e=new Ml(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Al.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Al.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Al.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),void 0!==t.boundingBox)null===t.boundingBox&&t.computeBoundingBox(),Cl.copy(t.boundingBox),Cl.applyMatrix4(t.matrixWorld),this.union(Cl);else{const i=t.geometry;if(void 0!==i)if(e&&void 0!==i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)Al.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(Al)}else null===i.boundingBox&&i.computeBoundingBox(),Cl.copy(i.boundingBox),Cl.applyMatrix4(t.matrixWorld),this.union(Cl)}const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Al),Al.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ol),Nl.subVectors(this.max,Ol),Pl.subVectors(t.a,Ol),Ll.subVectors(t.b,Ol),Rl.subVectors(t.c,Ol),Dl.subVectors(Ll,Pl),Il.subVectors(Rl,Ll),kl.subVectors(Pl,Rl);let e=[0,-Dl.z,Dl.y,0,-Il.z,Il.y,0,-kl.z,kl.y,Dl.z,0,-Dl.x,Il.z,0,-Il.x,kl.z,0,-kl.x,-Dl.y,Dl.x,0,-Il.y,Il.x,0,-kl.y,kl.x,0];return!!Fl(e,Pl,Ll,Rl,Nl)&&(e=[1,0,0,0,1,0,0,0,1],!!Fl(e,Pl,Ll,Rl,Nl)&&(Ul.crossVectors(Dl,Il),e=[Ul.x,Ul.y,Ul.z],Fl(e,Pl,Ll,Rl,Nl)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Al).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Al).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(El[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),El[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),El[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),El[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),El[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),El[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),El[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),El[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(El)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const El=[new Ml,new Ml,new Ml,new Ml,new Ml,new Ml,new Ml,new Ml],Al=new Ml,Cl=new Tl,Pl=new Ml,Ll=new Ml,Rl=new Ml,Dl=new Ml,Il=new Ml,kl=new Ml,Ol=new Ml,Nl=new Ml,Ul=new Ml,Bl=new Ml;function Fl(t,e,i,n,s){for(let r=0,o=t.length-3;r<=o;r+=3){Bl.fromArray(t,r);const o=s.x*Math.abs(Bl.x)+s.y*Math.abs(Bl.y)+s.z*Math.abs(Bl.z),a=e.dot(Bl),l=i.dot(Bl),h=n.dot(Bl);if(Math.max(-Math.max(a,l,h),Math.min(a,l,h))>o)return!1}return!0}const zl=new Tl,Hl=new Ml,Vl=new Ml;class Gl{constructor(t=new Ml,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):zl.setFromPoints(t).getCenter(i);let n=0;for(let e=0,s=t.length;e<s;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Hl.subVectors(t,this.center);const e=Hl.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(Hl,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Vl.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Hl.copy(t.center).add(Vl)),this.expandByPoint(Hl.copy(t.center).sub(Vl))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Wl=new Ml,jl=new Ml,Xl=new Ml,Yl=new Ml,ql=new Ml,Kl=new Ml,Zl=new Ml;class $l{constructor(t=new Ml,e=new Ml(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Wl)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Wl.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Wl.copy(this.origin).addScaledVector(this.direction,e),Wl.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){jl.copy(t).add(e).multiplyScalar(.5),Xl.copy(e).sub(t).normalize(),Yl.copy(this.origin).sub(jl);const s=.5*t.distanceTo(e),r=-this.direction.dot(Xl),o=Yl.dot(this.direction),a=-Yl.dot(Xl),l=Yl.lengthSq(),h=Math.abs(1-r*r);let c,d,u,p;if(h>0)if(c=r*a-o,d=r*o-a,p=s*h,c>=0)if(d>=-p)if(d<=p){const t=1/h;c*=t,d*=t,u=c*(c+r*d+2*o)+d*(r*c+d+2*a)+l}else d=s,c=Math.max(0,-(r*d+o)),u=-c*c+d*(d+2*a)+l;else d=-s,c=Math.max(0,-(r*d+o)),u=-c*c+d*(d+2*a)+l;else d<=-p?(c=Math.max(0,-(-r*s+o)),d=c>0?-s:Math.min(Math.max(-s,-a),s),u=-c*c+d*(d+2*a)+l):d<=p?(c=0,d=Math.min(Math.max(-s,-a),s),u=d*(d+2*a)+l):(c=Math.max(0,-(r*s+o)),d=c>0?s:Math.min(Math.max(-s,-a),s),u=-c*c+d*(d+2*a)+l);else d=r>0?-s:s,c=Math.max(0,-(r*d+o)),u=-c*c+d*(d+2*a)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,c),n&&n.copy(jl).addScaledVector(Xl,d),u}intersectSphere(t,e){Wl.subVectors(t.center,this.origin);const i=Wl.dot(this.direction),n=Wl.dot(Wl)-i*i,s=t.radius*t.radius;if(n>s)return null;const r=Math.sqrt(s-n),o=i-r,a=i+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,r,o,a;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(i=(t.min.x-d.x)*l,n=(t.max.x-d.x)*l):(i=(t.max.x-d.x)*l,n=(t.min.x-d.x)*l),h>=0?(s=(t.min.y-d.y)*h,r=(t.max.y-d.y)*h):(s=(t.max.y-d.y)*h,r=(t.min.y-d.y)*h),i>r||s>n?null:((s>i||isNaN(i))&&(i=s),(r<n||isNaN(n))&&(n=r),c>=0?(o=(t.min.z-d.z)*c,a=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,a=(t.min.z-d.z)*c),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Wl)}intersectTriangle(t,e,i,n,s){ql.subVectors(e,t),Kl.subVectors(i,t),Zl.crossVectors(ql,Kl);let r,o=this.direction.dot(Zl);if(o>0){if(n)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}Yl.subVectors(this.origin,t);const a=r*this.direction.dot(Kl.crossVectors(Yl,Kl));if(a<0)return null;const l=r*this.direction.dot(ql.cross(Yl));if(l<0)return null;if(a+l>o)return null;const h=-r*Yl.dot(Zl);return h<0?null:this.at(h/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Jl{constructor(t,e,i,n,s,r,o,a,l,h,c,d,u,p,f,m){Jl.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,l,h,c,d,u,p,f,m)}set(t,e,i,n,s,r,o,a,l,h,c,d,u,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=s,g[5]=r,g[9]=o,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jl).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Ql.setFromMatrixColumn(t,0).length(),s=1/Ql.setFromMatrixColumn(t,1).length(),r=1/Ql.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){const t=r*h,i=r*c,n=o*h,s=o*c;e[0]=a*h,e[4]=-a*c,e[8]=l,e[1]=i+n*l,e[5]=t-s*l,e[9]=-o*a,e[2]=s-t*l,e[6]=n+i*l,e[10]=r*a}else if("YXZ"===t.order){const t=a*h,i=a*c,n=l*h,s=l*c;e[0]=t+s*o,e[4]=n*o-i,e[8]=r*l,e[1]=r*c,e[5]=r*h,e[9]=-o,e[2]=i*o-n,e[6]=s+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*h,i=a*c,n=l*h,s=l*c;e[0]=t-s*o,e[4]=-r*c,e[8]=n+i*o,e[1]=i+n*o,e[5]=r*h,e[9]=s-t*o,e[2]=-r*l,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*h,i=r*c,n=o*h,s=o*c;e[0]=a*h,e[4]=n*l-i,e[8]=t*l+s,e[1]=a*c,e[5]=s*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,i=r*l,n=o*a,s=o*l;e[0]=a*h,e[4]=s-t*c,e[8]=n*c+i,e[1]=c,e[5]=r*h,e[9]=-o*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-s*c}else if("XZY"===t.order){const t=r*a,i=r*l,n=o*a,s=o*l;e[0]=a*h,e[4]=-c,e[8]=l*h,e[1]=t*c+s,e[5]=r*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=o*h,e[10]=s*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(eh,t,ih)}lookAt(t,e,i){const n=this.elements;return rh.subVectors(t,e),0===rh.lengthSq()&&(rh.z=1),rh.normalize(),nh.crossVectors(i,rh),0===nh.lengthSq()&&(1===Math.abs(i.z)?rh.x+=1e-4:rh.z+=1e-4,rh.normalize(),nh.crossVectors(i,rh)),nh.normalize(),sh.crossVectors(rh,nh),n[0]=nh.x,n[4]=sh.x,n[8]=rh.x,n[1]=nh.y,n[5]=sh.y,n[9]=rh.y,n[2]=nh.z,n[6]=sh.z,n[10]=rh.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[4],a=i[8],l=i[12],h=i[1],c=i[5],d=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],_=i[7],x=i[11],y=i[15],b=n[0],M=n[4],S=n[8],w=n[12],T=n[1],E=n[5],A=n[9],C=n[13],P=n[2],L=n[6],R=n[10],D=n[14],I=n[3],k=n[7],O=n[11],N=n[15];return s[0]=r*b+o*T+a*P+l*I,s[4]=r*M+o*E+a*L+l*k,s[8]=r*S+o*A+a*R+l*O,s[12]=r*w+o*C+a*D+l*N,s[1]=h*b+c*T+d*P+u*I,s[5]=h*M+c*E+d*L+u*k,s[9]=h*S+c*A+d*R+u*O,s[13]=h*w+c*C+d*D+u*N,s[2]=p*b+f*T+m*P+g*I,s[6]=p*M+f*E+m*L+g*k,s[10]=p*S+f*A+m*R+g*O,s[14]=p*w+f*C+m*D+g*N,s[3]=v*b+_*T+x*P+y*I,s[7]=v*M+_*E+x*L+y*k,s[11]=v*S+_*A+x*R+y*O,s[15]=v*w+_*C+x*D+y*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],o=t[5],a=t[9],l=t[13],h=t[2],c=t[6],d=t[10],u=t[14];return t[3]*(+s*a*c-n*l*c-s*o*d+i*l*d+n*o*u-i*a*u)+t[7]*(+e*a*u-e*l*d+s*r*d-n*r*u+n*l*h-s*a*h)+t[11]*(+e*l*c-e*o*u-s*r*c+i*r*u+s*o*h-i*l*h)+t[15]*(-n*o*h-e*a*c+e*o*d+n*r*c-i*r*d+i*a*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=t[9],d=t[10],u=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*d*l+f*a*u-o*m*u-c*a*g+o*d*g,_=p*d*l-h*m*l-p*a*u+r*m*u+h*a*g-r*d*g,x=h*f*l-p*c*l+p*o*u-r*f*u-h*o*g+r*c*g,y=p*c*a-h*f*a-p*o*d+r*f*d+h*o*m-r*c*m,b=e*v+i*_+n*x+s*y;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=v*M,t[1]=(f*d*s-c*m*s-f*n*u+i*m*u+c*n*g-i*d*g)*M,t[2]=(o*m*s-f*a*s+f*n*l-i*m*l-o*n*g+i*a*g)*M,t[3]=(c*a*s-o*d*s-c*n*l+i*d*l+o*n*u-i*a*u)*M,t[4]=_*M,t[5]=(h*m*s-p*d*s+p*n*u-e*m*u-h*n*g+e*d*g)*M,t[6]=(p*a*s-r*m*s-p*n*l+e*m*l+r*n*g-e*a*g)*M,t[7]=(r*d*s-h*a*s+h*n*l-e*d*l-r*n*u+e*a*u)*M,t[8]=x*M,t[9]=(p*c*s-h*f*s-p*i*u+e*f*u+h*i*g-e*c*g)*M,t[10]=(r*f*s-p*o*s+p*i*l-e*f*l-r*i*g+e*o*g)*M,t[11]=(h*o*s-r*c*s-h*i*l+e*c*l+r*i*u-e*o*u)*M,t[12]=y*M,t[13]=(h*f*n-p*c*n+p*i*d-e*f*d-h*i*m+e*c*m)*M,t[14]=(p*o*n-r*f*n-p*i*a+e*f*a+r*i*m-e*o*m)*M,t[15]=(r*c*n-h*o*n+h*i*a-e*c*a-r*i*d+e*o*d)*M,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,o=t.y,a=t.z,l=s*r,h=s*o;return this.set(l*r+i,l*o-n*a,l*a+n*o,0,l*o+n*a,h*o+i,h*a-n*r,0,l*a-n*o,h*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,r){return this.set(1,i,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,r=e._y,o=e._z,a=e._w,l=s+s,h=r+r,c=o+o,d=s*l,u=s*h,p=s*c,f=r*h,m=r*c,g=o*c,v=a*l,_=a*h,x=a*c,y=i.x,b=i.y,M=i.z;return n[0]=(1-(f+g))*y,n[1]=(u+x)*y,n[2]=(p-_)*y,n[3]=0,n[4]=(u-x)*b,n[5]=(1-(d+g))*b,n[6]=(m+v)*b,n[7]=0,n[8]=(p+_)*M,n[9]=(m-v)*M,n[10]=(1-(d+f))*M,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=Ql.set(n[0],n[1],n[2]).length();const r=Ql.set(n[4],n[5],n[6]).length(),o=Ql.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],th.copy(this);const a=1/s,l=1/r,h=1/o;return th.elements[0]*=a,th.elements[1]*=a,th.elements[2]*=a,th.elements[4]*=l,th.elements[5]*=l,th.elements[6]*=l,th.elements[8]*=h,th.elements[9]*=h,th.elements[10]*=h,e.setFromRotationMatrix(th),i.x=s,i.y=r,i.z=o,this}makePerspective(t,e,i,n,s,r,o=2e3){const a=this.elements,l=2*s/(e-t),h=2*s/(i-n),c=(e+t)/(e-t),d=(i+n)/(i-n);let u,p;if(o===Ra)u=-(r+s)/(r-s),p=-2*r*s/(r-s);else{if(o!==Da)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);u=-r/(r-s),p=-r*s/(r-s)}return a[0]=l,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=h,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,s,r,o=2e3){const a=this.elements,l=1/(e-t),h=1/(i-n),c=1/(r-s),d=(e+t)*l,u=(i+n)*h;let p,f;if(o===Ra)p=(r+s)*c,f=-2*c;else{if(o!==Da)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=s*c,f=-1*c}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Ql=new Ml,th=new Jl,eh=new Ml(0,0,0),ih=new Ml(1,1,1),nh=new Ml,sh=new Ml,rh=new Ml,oh=new Jl,ah=new bl;class lh{constructor(t=0,e=0,i=0,n=lh.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],r=n[4],o=n[8],a=n[1],l=n[5],h=n[9],c=n[2],d=n[6],u=n[10];switch(e){case"XYZ":this._y=Math.asin(Ba(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,u),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ba(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ba(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-Ba(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Ba(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-Ba(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return oh.makeRotationFromQuaternion(t),this.setFromRotationMatrix(oh,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ah.setFromEuler(this),this.setFromQuaternion(ah,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}lh.DEFAULT_ORDER="XYZ";class hh{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let ch=0;const dh=new Ml,uh=new bl,ph=new Jl,fh=new Ml,mh=new Ml,gh=new Ml,vh=new bl,_h=new Ml(1,0,0),xh=new Ml(0,1,0),yh=new Ml(0,0,1),bh={type:"added"},Mh={type:"removed"};class Sh extends Ia{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ch++}),this.uuid=Ua(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sh.DEFAULT_UP.clone();const t=new Ml,e=new lh,i=new bl,n=new Ml(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Jl},normalMatrix:{value:new Za}}),this.matrix=new Jl,this.matrixWorld=new Jl,this.matrixAutoUpdate=Sh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Sh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new hh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return uh.setFromAxisAngle(t,e),this.quaternion.multiply(uh),this}rotateOnWorldAxis(t,e){return uh.setFromAxisAngle(t,e),this.quaternion.premultiply(uh),this}rotateX(t){return this.rotateOnAxis(_h,t)}rotateY(t){return this.rotateOnAxis(xh,t)}rotateZ(t){return this.rotateOnAxis(yh,t)}translateOnAxis(t,e){return dh.copy(t).applyQuaternion(this.quaternion),this.position.add(dh.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_h,t)}translateY(t){return this.translateOnAxis(xh,t)}translateZ(t){return this.translateOnAxis(yh,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ph.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?fh.copy(t):fh.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),mh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ph.lookAt(mh,fh,this.up):ph.lookAt(fh,mh,this.up),this.quaternion.setFromRotationMatrix(ph),n&&(ph.extractRotation(n.matrixWorld),uh.setFromRotationMatrix(ph),this.quaternion.premultiply(uh.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(bh)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Mh)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Mh)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ph.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ph.multiply(t.parent.matrixWorld)),t.applyMatrix4(ph),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let n=0,s=this.children.length;n<s;n++){const s=this.children[n].getObjectsByProperty(t,e);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,t,gh),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mh,vh,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const n=e[i];!0!==n.matrixWorldAutoUpdate&&!0!==t||n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function s(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];s(t.shapes,n)}else s(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(s(t.materials,this.material[i]));n.material=e}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(s(t.animations,i))}}if(e){const e=r(t.geometries),n=r(t.materials),s=r(t.textures),o=r(t.images),a=r(t.shapes),l=r(t.skeletons),h=r(t.animations),c=r(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function r(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Sh.DEFAULT_UP=new Ml(0,1,0),Sh.DEFAULT_MATRIX_AUTO_UPDATE=!0,Sh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wh=new Ml,Th=new Ml,Eh=new Ml,Ah=new Ml,Ch=new Ml,Ph=new Ml,Lh=new Ml,Rh=new Ml,Dh=new Ml,Ih=new Ml;let kh=!1;class Oh{constructor(t=new Ml,e=new Ml,i=new Ml){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),wh.subVectors(t,e),n.cross(wh);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){wh.subVectors(n,e),Th.subVectors(i,e),Eh.subVectors(t,e);const r=wh.dot(wh),o=wh.dot(Th),a=wh.dot(Eh),l=Th.dot(Th),h=Th.dot(Eh),c=r*l-o*o;if(0===c)return s.set(-2,-1,-1);const d=1/c,u=(l*a-o*h)*d,p=(r*h-o*a)*d;return s.set(1-u-p,p,u)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Ah),Ah.x>=0&&Ah.y>=0&&Ah.x+Ah.y<=1}static getUV(t,e,i,n,s,r,o,a){return!1===kh&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),kh=!0),this.getInterpolation(t,e,i,n,s,r,o,a)}static getInterpolation(t,e,i,n,s,r,o,a){return this.getBarycoord(t,e,i,n,Ah),a.setScalar(0),a.addScaledVector(s,Ah.x),a.addScaledVector(r,Ah.y),a.addScaledVector(o,Ah.z),a}static isFrontFacing(t,e,i,n){return wh.subVectors(i,e),Th.subVectors(t,e),wh.cross(Th).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return wh.subVectors(this.c,this.b),Th.subVectors(this.a,this.b),.5*wh.cross(Th).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Oh.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Oh.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return!1===kh&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),kh=!0),Oh.getInterpolation(t,this.a,this.b,this.c,e,i,n,s)}getInterpolation(t,e,i,n,s){return Oh.getInterpolation(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return Oh.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Oh.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let r,o;Ch.subVectors(n,i),Ph.subVectors(s,i),Rh.subVectors(t,i);const a=Ch.dot(Rh),l=Ph.dot(Rh);if(a<=0&&l<=0)return e.copy(i);Dh.subVectors(t,n);const h=Ch.dot(Dh),c=Ph.dot(Dh);if(h>=0&&c<=h)return e.copy(n);const d=a*c-h*l;if(d<=0&&a>=0&&h<=0)return r=a/(a-h),e.copy(i).addScaledVector(Ch,r);Ih.subVectors(t,s);const u=Ch.dot(Ih),p=Ph.dot(Ih);if(p>=0&&u<=p)return e.copy(s);const f=u*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(i).addScaledVector(Ph,o);const m=h*p-u*c;if(m<=0&&c-h>=0&&u-p>=0)return Lh.subVectors(s,n),o=(c-h)/(c-h+(u-p)),e.copy(n).addScaledVector(Lh,o);const g=1/(m+f+d);return r=f*g,o=d*g,e.copy(i).addScaledVector(Ch,r).addScaledVector(Ph,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Nh=0;class Uh extends Ia{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Nh++}),this.uuid=Ua(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Oo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Aa,this.stencilZFail=Aa,this.stencilZPass=Aa,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=n(t.textures),s=n(t.images);e.length>0&&(i.textures=e),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}const Bh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fh={h:0,s:0,l:0},zh={h:0,s:0,l:0};function Hh(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class Vh{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=wa){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ll.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=ll.workingColorSpace){return this.r=t,this.g=e,this.b=i,ll.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=ll.workingColorSpace){if(t=Fa(t,1),e=Ba(e,0,1),i=Ba(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=Hh(s,n,t+1/3),this.g=Hh(s,n,t),this.b=Hh(s,n,t-1/3)}return ll.toWorkingColorSpace(this,n),this}setStyle(t,e=wa){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=n[1],s=i.length;if(3===s)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(6===s)return this.setHex(parseInt(i,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=wa){const i=Bh[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=il(t.r),this.g=il(t.g),this.b=il(t.b),this}copyLinearToSRGB(t){return this.r=nl(t.r),this.g=nl(t.g),this.b=nl(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=wa){return ll.fromWorkingColorSpace(Gh.copy(this),t),65536*Math.round(Ba(255*Gh.r,0,255))+256*Math.round(Ba(255*Gh.g,0,255))+Math.round(Ba(255*Gh.b,0,255))}getHexString(t=wa){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ll.workingColorSpace){ll.fromWorkingColorSpace(Gh.copy(this),e);const i=Gh.r,n=Gh.g,s=Gh.b,r=Math.max(i,n,s),o=Math.min(i,n,s);let a,l;const h=(o+r)/2;if(o===r)a=0,l=0;else{const t=r-o;switch(l=h<=.5?t/(r+o):t/(2-r-o),r){case i:a=(n-s)/t+(n<s?6:0);break;case n:a=(s-i)/t+2;break;case s:a=(i-n)/t+4}a/=6}return t.h=a,t.s=l,t.l=h,t}getRGB(t,e=ll.workingColorSpace){return ll.fromWorkingColorSpace(Gh.copy(this),e),t.r=Gh.r,t.g=Gh.g,t.b=Gh.b,t}getStyle(t=wa){ll.fromWorkingColorSpace(Gh.copy(this),t);const e=Gh.r,i=Gh.g,n=Gh.b;return t!==wa?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(t,e,i){return this.getHSL(Fh),Fh.h+=t,Fh.s+=e,Fh.l+=i,this.setHSL(Fh.h,Fh.s,Fh.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Fh),t.getHSL(zh);const i=za(Fh.h,zh.h,e),n=za(Fh.s,zh.s,e),s=za(Fh.l,zh.l,e);return this.setHSL(i,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,n=this.b,s=t.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gh=new Vh;Vh.NAMES=Bh;class Wh extends Uh{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=No,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const jh=new Ml,Xh=new Ka;class Yh{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=Ca,this.updateRange={offset:0,count:-1},this.gpuType=oa,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Xh.fromBufferAttribute(this,e),Xh.applyMatrix3(t),this.setXY(e,Xh.x,Xh.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)jh.fromBufferAttribute(this,e),jh.applyMatrix3(t),this.setXYZ(e,jh.x,jh.y,jh.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)jh.fromBufferAttribute(this,e),jh.applyMatrix4(t),this.setXYZ(e,jh.x,jh.y,jh.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)jh.fromBufferAttribute(this,e),jh.applyNormalMatrix(t),this.setXYZ(e,jh.x,jh.y,jh.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)jh.fromBufferAttribute(this,e),jh.transformDirection(t),this.setXYZ(e,jh.x,jh.y,jh.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=Wa(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ja(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Wa(e,this.array)),e}setX(t,e){return this.normalized&&(e=ja(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Wa(e,this.array)),e}setY(t,e){return this.normalized&&(e=ja(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Wa(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ja(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Wa(e,this.array)),e}setW(t,e){return this.normalized&&(e=ja(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array),n=ja(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array),n=ja(n,this.array),s=ja(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Ca&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}class qh extends Yh{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Kh extends Yh{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Zh extends Yh{constructor(t,e,i){super(new Float32Array(t),e,i)}}let $h=0;const Jh=new Jl,Qh=new Sh,tc=new Ml,ec=new Tl,ic=new Tl,nc=new Ml;class sc extends Ia{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$h++}),this.uuid=Ua(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ja(t)?Kh:qh)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Za).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Jh.makeRotationFromQuaternion(t),this.applyMatrix4(Jh),this}rotateX(t){return Jh.makeRotationX(t),this.applyMatrix4(Jh),this}rotateY(t){return Jh.makeRotationY(t),this.applyMatrix4(Jh),this}rotateZ(t){return Jh.makeRotationZ(t),this.applyMatrix4(Jh),this}translate(t,e,i){return Jh.makeTranslation(t,e,i),this.applyMatrix4(Jh),this}scale(t,e,i){return Jh.makeScale(t,e,i),this.applyMatrix4(Jh),this}lookAt(t){return Qh.lookAt(t),Qh.updateMatrix(),this.applyMatrix4(Qh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tc).negate(),this.translate(tc.x,tc.y,tc.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Zh(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Tl);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ml(-1/0,-1/0,-1/0),new Ml(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];ec.setFromBufferAttribute(i),this.morphTargetsRelative?(nc.addVectors(this.boundingBox.min,ec.min),this.boundingBox.expandByPoint(nc),nc.addVectors(this.boundingBox.max,ec.max),this.boundingBox.expandByPoint(nc)):(this.boundingBox.expandByPoint(ec.min),this.boundingBox.expandByPoint(ec.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Gl);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ml,1/0);if(t){const i=this.boundingSphere.center;if(ec.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];ic.setFromBufferAttribute(i),this.morphTargetsRelative?(nc.addVectors(ec.min,ic.min),ec.expandByPoint(nc),nc.addVectors(ec.max,ic.max),ec.expandByPoint(nc)):(ec.expandByPoint(ic.min),ec.expandByPoint(ic.max))}ec.getCenter(i);let n=0;for(let e=0,s=t.count;e<s;e++)nc.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(nc));if(e)for(let s=0,r=e.length;s<r;s++){const r=e[s],o=this.morphTargetsRelative;for(let e=0,s=r.count;e<s;e++)nc.fromBufferAttribute(r,e),o&&(tc.fromBufferAttribute(t,e),nc.add(tc)),n=Math.max(n,i.distanceToSquared(nc))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,s=e.normal.array,r=e.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Yh(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],h=[];for(let t=0;t<o;t++)l[t]=new Ml,h[t]=new Ml;const c=new Ml,d=new Ml,u=new Ml,p=new Ka,f=new Ka,m=new Ka,g=new Ml,v=new Ml;function _(t,e,i){c.fromArray(n,3*t),d.fromArray(n,3*e),u.fromArray(n,3*i),p.fromArray(r,2*t),f.fromArray(r,2*e),m.fromArray(r,2*i),d.sub(c),u.sub(c),f.sub(p),m.sub(p);const s=1/(f.x*m.y-m.x*f.y);isFinite(s)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(s),v.copy(u).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(s),l[t].add(g),l[e].add(g),l[i].add(g),h[t].add(v),h[e].add(v),h[i].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:i.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)_(i[t+0],i[t+1],i[t+2])}const y=new Ml,b=new Ml,M=new Ml,S=new Ml;function w(t){M.fromArray(s,3*t),S.copy(M);const e=l[t];y.copy(e),y.sub(M.multiplyScalar(M.dot(e))).normalize(),b.crossVectors(S,e);const i=b.dot(h[t])<0?-1:1;a[4*t]=y.x,a[4*t+1]=y.y,a[4*t+2]=y.z,a[4*t+3]=i}for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)w(i[t+0]),w(i[t+1]),w(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Yh(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Ml,s=new Ml,r=new Ml,o=new Ml,a=new Ml,l=new Ml,h=new Ml,c=new Ml;if(t)for(let d=0,u=t.count;d<u;d+=3){const u=t.getX(d+0),p=t.getX(d+1),f=t.getX(d+2);n.fromBufferAttribute(e,u),s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,f),h.subVectors(r,s),c.subVectors(n,s),h.cross(c),o.fromBufferAttribute(i,u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),o.add(h),a.add(h),l.add(h),i.setXYZ(u,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),h.subVectors(r,s),c.subVectors(n,s),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)nc.fromBufferAttribute(t,e),nc.normalize(),t.setXYZ(e,nc.x,nc.y,nc.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,s=t.normalized,r=new i.constructor(e.length*n);let o=0,a=0;for(let s=0,l=e.length;s<l;s++){o=t.isInterleavedBufferAttribute?e[s]*t.data.stride+t.offset:e[s]*n;for(let t=0;t<n;t++)r[a++]=i[o++]}return new Yh(r,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new sc,i=this.index.array,n=this.attributes;for(const s in n){const r=t(n[s],i);e.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],o=s[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);r.push(n)}e.morphAttributes[n]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,i=r.length;t<i;t++){const i=r[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let s=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];r.push(n.toJSON(t.data))}r.length>0&&(n[e]=r,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const s=t.morphAttributes;for(const t in s){const i=[],n=s[t];for(let t=0,s=n.length;t<s;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const rc=new Jl,oc=new $l,ac=new Gl,lc=new Ml,hc=new Ml,cc=new Ml,dc=new Ml,uc=new Ml,pc=new Ml,fc=new Ka,mc=new Ka,gc=new Ka,vc=new Ml,_c=new Ml,xc=new Ml,yc=new Ml,bc=new Ml;class Mc extends Sh{constructor(t=new sc,e=new Wh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,r=i.morphTargetsRelative;e.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){pc.set(0,0,0);for(let i=0,n=s.length;i<n;i++){const n=o[i],a=s[i];0!==n&&(uc.fromBufferAttribute(a,t),r?pc.addScaledVector(uc,n):pc.addScaledVector(uc.sub(e),n))}e.add(pc)}return e}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),ac.copy(i.boundingSphere),ac.applyMatrix4(s),oc.copy(t.ray).recast(t.near),!1===ac.containsPoint(oc.origin)){if(null===oc.intersectSphere(ac,lc))return;if(oc.origin.distanceToSquared(lc)>(t.far-t.near)**2)return}rc.copy(s).invert(),oc.copy(t.ray).applyMatrix4(rc),null!==i.boundingBox&&!1===oc.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,oc)}}_computeIntersections(t,e,i){let n;const s=this.geometry,r=this.material,o=s.index,a=s.attributes.position,l=s.attributes.uv,h=s.attributes.uv1,c=s.attributes.normal,d=s.groups,u=s.drawRange;if(null!==o)if(Array.isArray(r))for(let s=0,a=d.length;s<a;s++){const a=d[s],p=r[a.materialIndex];for(let s=Math.max(a.start,u.start),r=Math.min(o.count,Math.min(a.start+a.count,u.start+u.count));s<r;s+=3)n=Sc(this,p,t,i,l,h,c,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=a.materialIndex,e.push(n))}else for(let s=Math.max(0,u.start),a=Math.min(o.count,u.start+u.count);s<a;s+=3)n=Sc(this,r,t,i,l,h,c,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),e.push(n));else if(void 0!==a)if(Array.isArray(r))for(let s=0,o=d.length;s<o;s++){const o=d[s],p=r[o.materialIndex];for(let s=Math.max(o.start,u.start),r=Math.min(a.count,Math.min(o.start+o.count,u.start+u.count));s<r;s+=3)n=Sc(this,p,t,i,l,h,c,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=o.materialIndex,e.push(n))}else for(let s=Math.max(0,u.start),o=Math.min(a.count,u.start+u.count);s<o;s+=3)n=Sc(this,r,t,i,l,h,c,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),e.push(n))}}function Sc(t,e,i,n,s,r,o,a,l,h){t.getVertexPosition(a,hc),t.getVertexPosition(l,cc),t.getVertexPosition(h,dc);const c=function(t,e,i,n,s,r,o,a){let l;if(l=1===e.side?n.intersectTriangle(o,r,s,!0,a):n.intersectTriangle(s,r,o,0===e.side,a),null===l)return null;bc.copy(a),bc.applyMatrix4(t.matrixWorld);const h=i.ray.origin.distanceTo(bc);return h<i.near||h>i.far?null:{distance:h,point:bc.clone(),object:t}}(t,e,i,n,hc,cc,dc,yc);if(c){s&&(fc.fromBufferAttribute(s,a),mc.fromBufferAttribute(s,l),gc.fromBufferAttribute(s,h),c.uv=Oh.getInterpolation(yc,hc,cc,dc,fc,mc,gc,new Ka)),r&&(fc.fromBufferAttribute(r,a),mc.fromBufferAttribute(r,l),gc.fromBufferAttribute(r,h),c.uv1=Oh.getInterpolation(yc,hc,cc,dc,fc,mc,gc,new Ka),c.uv2=c.uv1),o&&(vc.fromBufferAttribute(o,a),_c.fromBufferAttribute(o,l),xc.fromBufferAttribute(o,h),c.normal=Oh.getInterpolation(yc,hc,cc,dc,vc,_c,xc,new Ml),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const t={a,b:l,c:h,normal:new Ml,materialIndex:0};Oh.getNormal(hc,cc,dc,t.normal),c.face=t}return c}class wc extends sc{constructor(t=1,e=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const o=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const a=[],l=[],h=[],c=[];let d=0,u=0;function p(t,e,i,n,s,r,p,f,m,g,v){const _=r/m,x=p/g,y=r/2,b=p/2,M=f/2,S=m+1,w=g+1;let T=0,E=0;const A=new Ml;for(let r=0;r<w;r++){const o=r*x-b;for(let a=0;a<S;a++){const d=a*_-y;A[t]=d*n,A[e]=o*s,A[i]=M,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=f>0?1:-1,h.push(A.x,A.y,A.z),c.push(a/m),c.push(1-r/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=d+e+S*t,n=d+e+S*(t+1),s=d+(e+1)+S*(t+1),r=d+(e+1)+S*t;a.push(i,n,r),a.push(n,s,r),E+=6}o.addGroup(u,E,v),u+=E,d+=T}p("z","y","x",-1,-1,i,e,t,r,s,0),p("z","y","x",1,-1,i,e,-t,r,s,1),p("x","z","y",1,1,t,i,e,n,r,2),p("x","z","y",1,-1,t,i,-e,n,r,3),p("x","y","z",1,-1,t,e,i,n,s,4),p("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new Zh(l,3)),this.setAttribute("normal",new Zh(h,3)),this.setAttribute("uv",new Zh(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wc(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Tc(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const s=t[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function Ec(t){const e={};for(let i=0;i<t.length;i++){const n=Tc(t[i]);for(const t in n)e[t]=n[t]}return e}function Ac(t){return null===t.getRenderTarget()?t.outputColorSpace:Ta}const Cc={clone:Tc,merge:Ec};class Pc extends Uh{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Tc(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Lc extends Sh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Jl,this.projectionMatrix=new Jl,this.projectionMatrixInverse=new Jl,this.coordinateSystem=Ra}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Rc extends Lc{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Na*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Oa*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Na*Math.atan(Math.tan(.5*Oa*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Oa*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,o=r.fullHeight;s+=r.offsetX*n/t,e-=r.offsetY*i/o,n*=r.width/t,i*=r.height/o}const o=this.filmOffset;0!==o&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Dc=-90;class Ic extends Sh{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const n=new Rc(Dc,1,t,e);n.layers=this.layers,this.add(n);const s=new Rc(Dc,1,t,e);s.layers=this.layers,this.add(s);const r=new Rc(Dc,1,t,e);r.layers=this.layers,this.add(r);const o=new Rc(Dc,1,t,e);o.layers=this.layers,this.add(o);const a=new Rc(Dc,1,t,e);a.layers=this.layers,this.add(a);const l=new Rc(Dc,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,n,s,r,o,a]=e;for(const t of e)this.remove(t);if(t===Ra)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Da)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,s,r,o,a,l]=this.children,h=t.getRenderTarget(),c=t.xr.enabled;t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,r),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class kc extends ml{constructor(t,e,i,n,s,r,o,a,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:jo,i,n,s,r,o,a,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Oc extends _l{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];void 0!==e.encoding&&(el("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===Sa?wa:""),this.texture=new kc(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:ea}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",s="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new wc(5,5,5),o=new Pc({name:"CubemapFromEquirect",uniforms:Tc(i),vertexShader:n,fragmentShader:s,side:1,blending:0});o.uniforms.tEquirect.value=e;const a=new Mc(r,o),l=e.minFilter;return e.minFilter===ia&&(e.minFilter=ea),new Ic(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,n);t.setRenderTarget(s)}}const Nc=new Ml,Uc=new Ml,Bc=new Za;class Fc{constructor(t=new Ml(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Nc.subVectors(i,e).cross(Uc.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(Nc),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(t.start).addScaledVector(i,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Bc.getNormalMatrix(t),n=this.coplanarPoint(Nc).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const zc=new Gl,Hc=new Ml;class Vc{constructor(t=new Fc,e=new Fc,i=new Fc,n=new Fc,s=new Fc,r=new Fc){this.planes=[t,e,i,n,s,r]}set(t,e,i,n,s,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(r),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=2e3){const i=this.planes,n=t.elements,s=n[0],r=n[1],o=n[2],a=n[3],l=n[4],h=n[5],c=n[6],d=n[7],u=n[8],p=n[9],f=n[10],m=n[11],g=n[12],v=n[13],_=n[14],x=n[15];if(i[0].setComponents(a-s,d-l,m-u,x-g).normalize(),i[1].setComponents(a+s,d+l,m+u,x+g).normalize(),i[2].setComponents(a+r,d+h,m+p,x+v).normalize(),i[3].setComponents(a-r,d-h,m-p,x-v).normalize(),i[4].setComponents(a-o,d-c,m-f,x-_).normalize(),e===Ra)i[5].setComponents(a+o,d+c,m+f,x+_).normalize();else{if(e!==Da)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(o,c,f,_).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),zc.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),zc.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(zc)}intersectsSprite(t){return zc.center.set(0,0,0),zc.radius=.7071067811865476,zc.applyMatrix4(t.matrixWorld),this.intersectsSphere(zc)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Hc.x=n.normal.x>0?t.max.x:t.min.x,Hc.y=n.normal.y>0?t.max.y:t.min.y,Hc.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Hc)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Gc(){let t=null,e=!1,i=null,n=null;function s(e,r){i(e,r),n=t.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Wc(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,s){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const r=n.get(e);void 0===r?n.set(e,function(e,n){const s=e.array,r=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(n,o),t.bufferData(n,s,r),e.onUploadCallback(),s instanceof Float32Array)a=t.FLOAT;else if(s instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=t.HALF_FLOAT}else a=t.UNSIGNED_SHORT;else if(s instanceof Int16Array)a=t.SHORT;else if(s instanceof Uint32Array)a=t.UNSIGNED_INT;else if(s instanceof Int32Array)a=t.INT;else if(s instanceof Int8Array)a=t.BYTE;else if(s instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version}}(e,s)):r.version<e.version&&(function(e,n,s){const r=n.array,o=n.updateRange;t.bindBuffer(s,e),-1===o.count?t.bufferSubData(s,0,r):(i?t.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count):t.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1),n.onUploadCallback()}(r.buffer,e,s),r.version=e.version)}}}class jc extends sc{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,r=e/2,o=Math.floor(i),a=Math.floor(n),l=o+1,h=a+1,c=t/o,d=e/a,u=[],p=[],f=[],m=[];for(let t=0;t<h;t++){const e=t*d-r;for(let i=0;i<l;i++){const n=i*c-s;p.push(n,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+l*t,n=e+l*(t+1),s=e+1+l*(t+1),r=e+1+l*t;u.push(i,n,r),u.push(n,s,r)}this.setIndex(u),this.setAttribute("position",new Zh(p,3)),this.setAttribute("normal",new Zh(f,3)),this.setAttribute("uv",new Zh(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new jc(t.width,t.height,t.widthSegments,t.heightSegments)}}const Xc={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Yc={common:{diffuse:{value:new Vh(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Za},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Za}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Za}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Za}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Za},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Za},normalScale:{value:new Ka(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Za},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Za}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Za}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Za}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vh(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vh(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0},uvTransform:{value:new Za}},sprite:{diffuse:{value:new Vh(16777215)},opacity:{value:1},center:{value:new Ka(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Za},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0}}},qc={basic:{uniforms:Ec([Yc.common,Yc.specularmap,Yc.envmap,Yc.aomap,Yc.lightmap,Yc.fog]),vertexShader:Xc.meshbasic_vert,fragmentShader:Xc.meshbasic_frag},lambert:{uniforms:Ec([Yc.common,Yc.specularmap,Yc.envmap,Yc.aomap,Yc.lightmap,Yc.emissivemap,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,Yc.fog,Yc.lights,{emissive:{value:new Vh(0)}}]),vertexShader:Xc.meshlambert_vert,fragmentShader:Xc.meshlambert_frag},phong:{uniforms:Ec([Yc.common,Yc.specularmap,Yc.envmap,Yc.aomap,Yc.lightmap,Yc.emissivemap,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,Yc.fog,Yc.lights,{emissive:{value:new Vh(0)},specular:{value:new Vh(1118481)},shininess:{value:30}}]),vertexShader:Xc.meshphong_vert,fragmentShader:Xc.meshphong_frag},standard:{uniforms:Ec([Yc.common,Yc.envmap,Yc.aomap,Yc.lightmap,Yc.emissivemap,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,Yc.roughnessmap,Yc.metalnessmap,Yc.fog,Yc.lights,{emissive:{value:new Vh(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xc.meshphysical_vert,fragmentShader:Xc.meshphysical_frag},toon:{uniforms:Ec([Yc.common,Yc.aomap,Yc.lightmap,Yc.emissivemap,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,Yc.gradientmap,Yc.fog,Yc.lights,{emissive:{value:new Vh(0)}}]),vertexShader:Xc.meshtoon_vert,fragmentShader:Xc.meshtoon_frag},matcap:{uniforms:Ec([Yc.common,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,Yc.fog,{matcap:{value:null}}]),vertexShader:Xc.meshmatcap_vert,fragmentShader:Xc.meshmatcap_frag},points:{uniforms:Ec([Yc.points,Yc.fog]),vertexShader:Xc.points_vert,fragmentShader:Xc.points_frag},dashed:{uniforms:Ec([Yc.common,Yc.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xc.linedashed_vert,fragmentShader:Xc.linedashed_frag},depth:{uniforms:Ec([Yc.common,Yc.displacementmap]),vertexShader:Xc.depth_vert,fragmentShader:Xc.depth_frag},normal:{uniforms:Ec([Yc.common,Yc.bumpmap,Yc.normalmap,Yc.displacementmap,{opacity:{value:1}}]),vertexShader:Xc.meshnormal_vert,fragmentShader:Xc.meshnormal_frag},sprite:{uniforms:Ec([Yc.sprite,Yc.fog]),vertexShader:Xc.sprite_vert,fragmentShader:Xc.sprite_frag},background:{uniforms:{uvTransform:{value:new Za},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Xc.background_vert,fragmentShader:Xc.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Xc.backgroundCube_vert,fragmentShader:Xc.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Xc.cube_vert,fragmentShader:Xc.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xc.equirect_vert,fragmentShader:Xc.equirect_frag},distanceRGBA:{uniforms:Ec([Yc.common,Yc.displacementmap,{referencePosition:{value:new Ml},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xc.distanceRGBA_vert,fragmentShader:Xc.distanceRGBA_frag},shadow:{uniforms:Ec([Yc.lights,Yc.fog,{color:{value:new Vh(0)},opacity:{value:1}}]),vertexShader:Xc.shadow_vert,fragmentShader:Xc.shadow_frag}};qc.physical={uniforms:Ec([qc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Za},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Za},clearcoatNormalScale:{value:new Ka(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Za},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Za},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Za},sheen:{value:0},sheenColor:{value:new Vh(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Za},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Za},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Za},transmissionSamplerSize:{value:new Ka},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Za},attenuationDistance:{value:0},attenuationColor:{value:new Vh(0)},specularColor:{value:new Vh(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Za},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Za},anisotropyVector:{value:new Ka},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Za}}]),vertexShader:Xc.meshphysical_vert,fragmentShader:Xc.meshphysical_frag};const Kc={r:0,b:0,g:0};function Zc(t,e,i,n,s,r,o){const a=new Vh(0);let l,h,c=!0===r?0:1,d=null,u=0,p=null;function f(e,i){e.getRGB(Kc,Ac(t)),n.buffers.color.setClear(Kc.r,Kc.g,Kc.b,i,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),c=e,f(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,f(a,c)},render:function(r,m){let g=!1,v=!0===m.isScene?m.background:null;switch(v&&v.isTexture&&(v=(m.backgroundBlurriness>0?i:e).get(v)),null===v?f(a,c):v&&v.isColor&&(f(v,1),g=!0),t.xr.getEnvironmentBlendMode()){case"opaque":g=!0;break;case"additive":n.buffers.color.setClear(0,0,0,1,o),g=!0;break;case"alpha-blend":n.buffers.color.setClear(0,0,0,0,o),g=!0}(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===qo)?(void 0===h&&(h=new Mc(new wc(1,1,1),new Pc({name:"BackgroundCubeMaterial",uniforms:Tc(qc.backgroundCube.uniforms),vertexShader:qc.backgroundCube.vertexShader,fragmentShader:qc.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=v,h.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,h.material.toneMapped=v.colorSpace!==wa,d===v&&u===v.version&&p===t.toneMapping||(h.material.needsUpdate=!0,d=v,u=v.version,p=t.toneMapping),h.layers.enableAll(),r.unshift(h,h.geometry,h.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new Mc(new jc(2,2),new Pc({name:"BackgroundMaterial",uniforms:Tc(qc.background.uniforms),vertexShader:qc.background.vertexShader,fragmentShader:qc.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=v.colorSpace!==wa,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&u===v.version&&p===t.toneMapping||(l.material.needsUpdate=!0,d=v,u=v.version,p=t.toneMapping),l.layers.enableAll(),r.unshift(l,l.geometry,l.material,0,0,null))}}}function $c(t,e,i,n){const s=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==r,a={},l=p(null);let h=l,c=!1;function d(e){return n.isWebGL2?t.bindVertexArray(e):r.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):r.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<s;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){g(t,0)}function g(i,s){const r=h.newAttributes,o=h.enabledAttributes,a=h.attributeDivisors;r[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==s&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),a[i]=s)}function v(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function _(e,i,n,s,r,o,a){!0===a?t.vertexAttribIPointer(e,i,n,r,o):t.vertexAttribPointer(e,i,n,s,r,o)}function x(){y(),c=!0,h!==l&&(h=l,d(h.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,u,x,y){let b=!1;if(o){const e=function(e,i,s){const o=!0===s.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[o];return void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():r.createVertexArrayOES()),h[o]=c),c}(x,u,l);h!==e&&(h=e,d(h.object)),b=function(t,e,i,n){const s=h.attributes,r=e.attributes;let o=0;const a=i.getAttributes();for(const e in a)if(a[e].location>=0){const i=s[e];let n=r[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;o++}return h.attributesNum!==o||h.index!==n}(s,x,u,y),b&&function(t,e,i,n){const s={},r=e.attributes;let o=0;const a=i.getAttributes();for(const e in a)if(a[e].location>=0){let i=r[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),s[e]=n,o++}h.attributes=s,h.attributesNum=o,h.index=n}(s,x,u,y)}else{const t=!0===l.wireframe;h.geometry===x.id&&h.program===u.id&&h.wireframe===t||(h.geometry=x.id,h.program=u.id,h.wireframe=t,b=!0)}null!==y&&i.update(y,t.ELEMENT_ARRAY_BUFFER),(b||c)&&(c=!1,function(s,r,o,a){if(!1===n.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,h=o.getAttributes(),c=r.defaultAttributeValues;for(const e in h){const r=h[e];if(r.location>=0){let o=l[e];if(void 0===o&&("instanceMatrix"===e&&s.instanceMatrix&&(o=s.instanceMatrix),"instanceColor"===e&&s.instanceColor&&(o=s.instanceColor)),void 0!==o){const e=o.normalized,l=o.itemSize,h=i.get(o);if(void 0===h)continue;const c=h.buffer,d=h.type,u=h.bytesPerElement,p=!0===n.isWebGL2&&(d===t.INT||d===t.UNSIGNED_INT||1013===o.gpuType);if(o.isInterleavedBufferAttribute){const i=o.data,n=i.stride,h=o.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)g(r.location+t,i.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)_(r.location+t,l/r.locationSize,d,e,n*u,(h+l/r.locationSize*t)*u,p)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)g(r.location+t,o.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)_(r.location+t,l/r.locationSize,d,e,l*u,l/r.locationSize*t*u,p)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(r.location,i);break;case 3:t.vertexAttrib3fv(r.location,i);break;case 4:t.vertexAttrib4fv(r.location,i);break;default:t.vertexAttrib1fv(r.location,i)}}}}v()}(s,l,u,x),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function Jc(t,e,i,n){const s=n.isWebGL2;let r;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.update(n,r,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,h;if(s)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](r,n,o,a),i.update(o,r,a)}}function Qc(t,e,i){let n;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let o=void 0!==i.precision?i.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=r||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),v=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),_=d>0,x=r||e.has("OES_texture_float");return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:d,maxTextureSize:u,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:_&&x,maxSamples:r?t.getParameter(t.MAX_SAMPLES):0}}function td(t){const e=this;let i=null,n=0,s=!1,r=!1;const o=new Fc,a=new Za,l={value:null,needsUpdate:!1};function h(t,i,n,s){const r=null!==t?t.length:0;let h=null;if(0!==r){if(h=l.value,!0!==s||null===h){const e=n+4*r,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==r;++e,i+=4)o.copy(t[e]).applyMatrix4(s,a),o.normal.toArray(h,i),h[i+3]=o.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=r,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==n||s;return s=e,n=t.length,i},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(t,e){i=h(t,e,0)},this.setState=function(o,a,c){const d=o.clippingPlanes,u=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!s||null===d||0===d.length||r&&!p)r?h(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0);else{const t=r?0:n,e=4*t;let s=f.clippingState||null;l.value=s,s=h(d,a,e,c);for(let t=0;t!==e;++t)s[t]=i[t];f.clippingState=s,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=t}}}function ed(t){let e=new WeakMap;function i(t,e){return e===Yo?t.mapping=jo:304===e&&(t.mapping=Xo),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping;if(r===Yo||304===r){if(e.has(s))return i(e.get(s).texture,s.mapping);{const r=s.image;if(r&&r.height>0){const o=new Oc(r.height/2);return o.fromEquirectangularTexture(t,s),e.set(s,o),s.addEventListener("dispose",n),i(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class id extends Lc{constructor(t=-1,e=1,i=1,n=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,r=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=t*this.view.offsetX,r=s+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const nd=[.125,.215,.35,.446,.526,.582],sd=new id,rd=new Vh;let od=null;const ad=(1+Math.sqrt(5))/2,ld=1/ad,hd=[new Ml(1,1,1),new Ml(-1,1,1),new Ml(1,1,-1),new Ml(-1,1,-1),new Ml(0,ad,ld),new Ml(0,ad,-ld),new Ml(ld,0,ad),new Ml(-ld,0,ad),new Ml(ad,ld,0),new Ml(-ad,ld,0)];class cd{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){od=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=fd(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=pd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(od),t.scissorTest=!1,ud(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===jo||t.mapping===Xo?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),od=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:ea,minFilter:ea,generateMipmaps:!1,type:aa,format:ha,colorSpace:Ta,depthBuffer:!1},n=dd(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=dd(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let s=t;const r=t-4+1+nd.length;for(let o=0;o<r;o++){const r=Math.pow(2,s);i.push(r);let a=1/r;o>t-4?a=nd[o-t+4-1]:0===o&&(a=0),n.push(a);const l=1/(r-2),h=-l,c=1+l,d=[h,h,c,h,c,c,h,h,c,c,h,c],u=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*u),_=new Float32Array(m*p*u),x=new Float32Array(g*p*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,f*p*t),_.set(d,m*p*t);const s=[t,t,t,t,t,t];x.set(s,g*p*t)}const y=new sc;y.setAttribute("position",new Yh(v,f)),y.setAttribute("uv",new Yh(_,m)),y.setAttribute("faceIndex",new Yh(x,g)),e.push(y),s>4&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(20),s=new Ml(0,1,0);return new Pc({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new Mc(this._lodPlanes[0],t);this._renderer.compile(e,sd)}_sceneToCubeUV(t,e,i,n){const s=new Rc(90,1,e,i),r=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,h=a.toneMapping;a.getClearColor(rd),a.toneMapping=Fo,a.autoClear=!1;const c=new Wh({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Mc(new wc,c);let u=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,u=!0):(c.color.copy(rd),u=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,r[e],0),s.lookAt(o[e],0,0)):1===i?(s.up.set(0,0,r[e]),s.lookAt(0,o[e],0)):(s.up.set(0,r[e],0),s.lookAt(0,0,o[e]));const l=this._cubeSize;ud(n,i*l,e>2?l:0,l,l),a.setRenderTarget(n),u&&a.render(d,s),a.render(t,s)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=h,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===jo||t.mapping===Xo;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=fd()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=pd());const s=n?this._cubemapMaterial:this._equirectMaterial,r=new Mc(this._lodPlanes[0],s);s.uniforms.envMap.value=t;const o=this._cubeSize;ud(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(r,sd)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=hd[(e-1)%hd.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,i,n,"latitudinal",s),this._halfBlur(r,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,r,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Mc(this._lodPlanes[n],l),c=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,p=s/u,f=isFinite(s)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===r,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=u,c.mipInt.value=v-i;const _=this._sizeLods[n];ud(e,3*_*(n>v-4?n-v+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(e),a.render(h,sd)}}function dd(t,e,i){const n=new _l(t,e,i);return n.texture.mapping=qo,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ud(t,e,i,n,s){t.viewport.set(e,i,n,s),t.scissor.set(e,i,n,s)}function pd(){return new Pc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function fd(){return new Pc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function md(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping,o=r===Yo||304===r,a=r===jo||r===Xo;if(o||a){if(s.isRenderTargetTexture&&!0===s.needsPMREMUpdate){s.needsPMREMUpdate=!1;let n=e.get(s);return null===i&&(i=new cd(t)),n=o?i.fromEquirectangular(s,n):i.fromCubemap(s,n),e.set(s,n),n.texture}if(e.has(s))return e.get(s).texture;{const r=s.image;if(o&&r&&r.height>0||a&&r&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(r)){null===i&&(i=new cd(t));const r=o?i.fromEquirectangular(s):i.fromCubemap(s);return e.set(s,r),s.addEventListener("dispose",n),r.texture}return null}}}return s},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function gd(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function vd(t,e,i,n){const s={},r=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const i=a.morphAttributes[t];for(let t=0,n=i.length;t<n;t++)e.remove(i[t])}a.removeEventListener("dispose",o),delete s[a.id];const l=r.get(a);l&&(e.remove(l),r.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,s=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],s=t[e+1],r=t[e+2];i.push(n,s,s,r,r,n)}}else{if(void 0===s)return;{const t=s.array;o=s.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,s=e+2;i.push(t,n,n,s,s,t)}}}const a=new(Ja(i)?Kh:qh)(i,1);a.version=o;const l=r.get(t);l&&e.remove(l),r.set(t,a)}return{get:function(t,e){return!0===s[e.id]||(e.addEventListener("dispose",o),s[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const s=i.morphAttributes;for(const i in s){const n=s[i];for(let i=0,s=n.length;i<s;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=r.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return r.get(t)}}}function _d(t,e,i,n){const s=n.isWebGL2;let r,o,a;this.setMode=function(t){r=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(r,n,o,e*a),i.update(n,r,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,d;if(s)c=t,d="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[d](r,l,o,n*a,h),i.update(l,r,h)}}function xd(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,s){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=s*(i/3);break;case t.LINES:e.lines+=s*(i/2);break;case t.LINE_STRIP:e.lines+=s*(i-1);break;case t.LINE_LOOP:e.lines+=s*i;break;case t.POINTS:e.points+=s*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function yd(t,e){return t[0]-e[0]}function bd(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Md(t,e,i){const n={},s=new Float32Array(8),r=new WeakMap,o=new gl,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,h,c){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const u=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,p=void 0!==u?u.length:0;let f=r.get(h);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const v=void 0!==h.morphAttributes.position,_=void 0!==h.morphAttributes.normal,x=void 0!==h.morphAttributes.color,y=h.morphAttributes.position||[],b=h.morphAttributes.normal||[],M=h.morphAttributes.color||[];let S=0;!0===v&&(S=1),!0===_&&(S=2),!0===x&&(S=3);let w=h.attributes.position.count*S,T=1;w>e.maxTextureSize&&(T=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const E=new Float32Array(w*T*4*p),A=new xl(E,w,T,p);A.type=oa,A.needsUpdate=!0;const C=4*S;for(let L=0;L<p;L++){const R=y[L],D=b[L],I=M[L],k=w*T*4*L;for(let O=0;O<R.count;O++){const N=O*C;!0===v&&(o.fromBufferAttribute(R,O),E[k+N+0]=o.x,E[k+N+1]=o.y,E[k+N+2]=o.z,E[k+N+3]=0),!0===_&&(o.fromBufferAttribute(D,O),E[k+N+4]=o.x,E[k+N+5]=o.y,E[k+N+6]=o.z,E[k+N+7]=0),!0===x&&(o.fromBufferAttribute(I,O),E[k+N+8]=o.x,E[k+N+9]=o.y,E[k+N+10]=o.z,E[k+N+11]=4===I.itemSize?o.w:1)}}function P(){A.dispose(),r.delete(h),h.removeEventListener("dispose",P)}f={count:p,texture:A,size:new Ka(w,T)},r.set(h,f),h.addEventListener("dispose",P)}let m=0;for(let U=0;U<d.length;U++)m+=d[U];const g=h.morphTargetsRelative?1:1-m;c.getUniforms().setValue(t,"morphTargetBaseInfluence",g),c.getUniforms().setValue(t,"morphTargetInfluences",d),c.getUniforms().setValue(t,"morphTargetsTexture",f.texture,i),c.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const B=void 0===d?0:d.length;let F=n[h.id];if(void 0===F||F.length!==B){F=[];for(let W=0;W<B;W++)F[W]=[W,0];n[h.id]=F}for(let j=0;j<B;j++){const X=F[j];X[0]=j,X[1]=d[j]}F.sort(bd);for(let Y=0;Y<8;Y++)Y<B&&F[Y][1]?(a[Y][0]=F[Y][0],a[Y][1]=F[Y][1]):(a[Y][0]=Number.MAX_SAFE_INTEGER,a[Y][1]=0);a.sort(yd);const z=h.morphAttributes.position,H=h.morphAttributes.normal;let V=0;for(let q=0;q<8;q++){const K=a[q],Z=K[0],$=K[1];Z!==Number.MAX_SAFE_INTEGER&&$?(z&&h.getAttribute("morphTarget"+q)!==z[Z]&&h.setAttribute("morphTarget"+q,z[Z]),H&&h.getAttribute("morphNormal"+q)!==H[Z]&&h.setAttribute("morphNormal"+q,H[Z]),s[q]=$,V+=$):(z&&!0===h.hasAttribute("morphTarget"+q)&&h.deleteAttribute("morphTarget"+q),H&&!0===h.hasAttribute("morphNormal"+q)&&h.deleteAttribute("morphNormal"+q),s[q]=0)}const G=h.morphTargetsRelative?1:1-V;c.getUniforms().setValue(t,"morphTargetBaseInfluence",G),c.getUniforms().setValue(t,"morphTargetInfluences",s)}}}}function Sd(t,e,i,n){let s=new WeakMap;function r(t){const e=t.target;e.removeEventListener("dispose",r),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=n.render.frame,l=o.geometry,h=e.get(o,l);if(s.get(h)!==a&&(e.update(h),s.set(h,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",r)&&o.addEventListener("dispose",r),s.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),s.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;s.get(t)!==a&&(t.update(),s.set(t,a))}return h},dispose:function(){s=new WeakMap}}}const wd=new ml,Td=new xl,Ed=new yl,Ad=new kc,Cd=[],Pd=[],Ld=new Float32Array(16),Rd=new Float32Array(9),Dd=new Float32Array(4);function Id(t,e,i){const n=t[0];if(n<=0||n>0)return t;const s=e*i;let r=Cd[s];if(void 0===r&&(r=new Float32Array(s),Cd[s]=r),0!==e){n.toArray(r,0);for(let n=1,s=0;n!==e;++n)s+=i,t[n].toArray(r,s)}return r}function kd(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Od(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Nd(t,e){let i=Pd[e];void 0===i&&(i=new Int32Array(e),Pd[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Ud(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Bd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(kd(i,e))return;t.uniform2fv(this.addr,e),Od(i,e)}}function Fd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(kd(i,e))return;t.uniform3fv(this.addr,e),Od(i,e)}}function zd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(kd(i,e))return;t.uniform4fv(this.addr,e),Od(i,e)}}function Hd(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(kd(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Od(i,e)}else{if(kd(i,n))return;Dd.set(n),t.uniformMatrix2fv(this.addr,!1,Dd),Od(i,n)}}function Vd(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(kd(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Od(i,e)}else{if(kd(i,n))return;Rd.set(n),t.uniformMatrix3fv(this.addr,!1,Rd),Od(i,n)}}function Gd(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(kd(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Od(i,e)}else{if(kd(i,n))return;Ld.set(n),t.uniformMatrix4fv(this.addr,!1,Ld),Od(i,n)}}function Wd(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function jd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(kd(i,e))return;t.uniform2iv(this.addr,e),Od(i,e)}}function Xd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(kd(i,e))return;t.uniform3iv(this.addr,e),Od(i,e)}}function Yd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(kd(i,e))return;t.uniform4iv(this.addr,e),Od(i,e)}}function qd(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Kd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(kd(i,e))return;t.uniform2uiv(this.addr,e),Od(i,e)}}function Zd(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(kd(i,e))return;t.uniform3uiv(this.addr,e),Od(i,e)}}function $d(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(kd(i,e))return;t.uniform4uiv(this.addr,e),Od(i,e)}}function Jd(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture2D(e||wd,s)}function Qd(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||Ed,s)}function tu(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||Ad,s)}function eu(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||Td,s)}function iu(t,e){t.uniform1fv(this.addr,e)}function nu(t,e){const i=Id(e,this.size,2);t.uniform2fv(this.addr,i)}function su(t,e){const i=Id(e,this.size,3);t.uniform3fv(this.addr,i)}function ru(t,e){const i=Id(e,this.size,4);t.uniform4fv(this.addr,i)}function ou(t,e){const i=Id(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function au(t,e){const i=Id(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function lu(t,e){const i=Id(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function hu(t,e){t.uniform1iv(this.addr,e)}function cu(t,e){t.uniform2iv(this.addr,e)}function du(t,e){t.uniform3iv(this.addr,e)}function uu(t,e){t.uniform4iv(this.addr,e)}function pu(t,e){t.uniform1uiv(this.addr,e)}function fu(t,e){t.uniform2uiv(this.addr,e)}function mu(t,e){t.uniform3uiv(this.addr,e)}function gu(t,e){t.uniform4uiv(this.addr,e)}function vu(t,e,i){const n=this.cache,s=e.length,r=Nd(i,s);kd(n,r)||(t.uniform1iv(this.addr,r),Od(n,r));for(let t=0;t!==s;++t)i.setTexture2D(e[t]||wd,r[t])}function _u(t,e,i){const n=this.cache,s=e.length,r=Nd(i,s);kd(n,r)||(t.uniform1iv(this.addr,r),Od(n,r));for(let t=0;t!==s;++t)i.setTexture3D(e[t]||Ed,r[t])}function xu(t,e,i){const n=this.cache,s=e.length,r=Nd(i,s);kd(n,r)||(t.uniform1iv(this.addr,r),Od(n,r));for(let t=0;t!==s;++t)i.setTextureCube(e[t]||Ad,r[t])}function yu(t,e,i){const n=this.cache,s=e.length,r=Nd(i,s);kd(n,r)||(t.uniform1iv(this.addr,r),Od(n,r));for(let t=0;t!==s;++t)i.setTexture2DArray(e[t]||Td,r[t])}class bu{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Ud;case 35664:return Bd;case 35665:return Fd;case 35666:return zd;case 35674:return Hd;case 35675:return Vd;case 35676:return Gd;case 5124:case 35670:return Wd;case 35667:case 35671:return jd;case 35668:case 35672:return Xd;case 35669:case 35673:return Yd;case 5125:return qd;case 36294:return Kd;case 36295:return Zd;case 36296:return $d;case 35678:case 36198:case 36298:case 36306:case 35682:return Jd;case 35679:case 36299:case 36307:return Qd;case 35680:case 36300:case 36308:case 36293:return tu;case 36289:case 36303:case 36311:case 36292:return eu}}(e.type)}}class Mu{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return iu;case 35664:return nu;case 35665:return su;case 35666:return ru;case 35674:return ou;case 35675:return au;case 35676:return lu;case 5124:case 35670:return hu;case 35667:case 35671:return cu;case 35668:case 35672:return du;case 35669:case 35673:return uu;case 5125:return pu;case 36294:return fu;case 36295:return mu;case 36296:return gu;case 35678:case 36198:case 36298:case 36306:case 35682:return vu;case 35679:case 36299:case 36307:return _u;case 35680:case 36300:case 36308:case 36293:return xu;case 36289:case 36303:case 36311:case 36292:return yu}}(e.type)}}class Su{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(t,e[r.id],i)}}}const wu=/(\w+)(\])?(\[|\.)?/g;function Tu(t,e){t.seq.push(e),t.map[e.id]=e}function Eu(t,e,i){const n=t.name,s=n.length;for(wu.lastIndex=0;;){const r=wu.exec(n),o=wu.lastIndex;let a=r[1];const l="]"===r[2],h=r[3];if(l&&(a|=0),void 0===h||"["===h&&o+2===s){Tu(i,void 0===h?new bu(a,t,e):new Mu(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new Su(a),Tu(i,t)),i=t}}}class Au{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);Eu(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const s=this.map[e];void 0!==s&&s.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let s=0,r=e.length;s!==r;++s){const r=e[s],o=i[r.id];!1!==o.needsUpdate&&r.setValue(t,o.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,s=t.length;n!==s;++n){const s=t[n];s.id in e&&i.push(s)}return i}}function Cu(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}let Pu=0;function Lu(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),s=t.getShaderInfoLog(e).trim();if(n&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const n=parseInt(r[1]);return i.toUpperCase()+"\n\n"+s+"\n\n"+function(t,e){const i=t.split("\n"),n=[],s=Math.max(e-6,0),r=Math.min(e+6,i.length);for(let t=s;t<r;t++){const s=t+1;n.push(`${s===e?">":" "} ${s}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return s}function Ru(t,e){const i=function(t){switch(t){case Ta:return["Linear","( value )"];case wa:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Du(t,e){let i;switch(e){case zo:i="Linear";break;case Ho:i="Reinhard";break;case Vo:i="OptimizedCineon";break;case Go:i="ACESFilmic";break;case Wo:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Iu(t){return""!==t}function ku(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ou(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Nu=/^[ \t]*#include +<([\w\d./]+)>/gm;function Uu(t){return t.replace(Nu,Fu)}const Bu=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Fu(t,e){let i=Xc[e];if(void 0===i){const t=Bu.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=Xc[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Uu(i)}const zu=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Hu(t){return t.replace(zu,Vu)}function Vu(t,e,i,n){let s="";for(let t=parseInt(e);t<parseInt(i);t++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return s}function Gu(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Wu(t,e,i,n){const s=t.getContext(),r=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===Do?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===Io?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ko&&(e="SHADOWMAP_TYPE_VSM"),e}(i),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case jo:case Xo:e="ENVMAP_TYPE_CUBE";break;case qo:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),c=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===Xo&&(e="ENVMAP_MODE_REFRACTION"),e}(i),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case No:e="ENVMAP_BLENDING_MULTIPLY";break;case Uo:e="ENVMAP_BLENDING_MIX";break;case Bo:e="ENVMAP_BLENDING_ADD"}return e}(i),u=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Iu).join("\n")}(i),f=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(r),m=s.createProgram();let g,v,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Iu).join("\n"),g.length>0&&(g+="\n"),v=[p,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Iu).join("\n"),v.length>0&&(v+="\n")):(g=[Gu(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Iu).join("\n"),v=[p,Gu(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",i.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Fo?"#define TONE_MAPPING":"",i.toneMapping!==Fo?Xc.tonemapping_pars_fragment:"",i.toneMapping!==Fo?Du("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Xc.colorspace_pars_fragment,Ru("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Iu).join("\n")),o=Uu(o),o=ku(o,i),o=Ou(o,i),a=Uu(a),a=ku(a,i),a=Ou(a,i),o=Hu(o),a=Hu(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===Pa?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Pa?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const x=_+g+o,y=_+v+a,b=Cu(s,s.VERTEX_SHADER,x),M=Cu(s,s.FRAGMENT_SHADER,y);if(s.attachShader(m,b),s.attachShader(m,M),void 0!==i.index0AttributeName?s.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),t.debug.checkShaderErrors){const e=s.getProgramInfoLog(m).trim(),i=s.getShaderInfoLog(b).trim(),n=s.getShaderInfoLog(M).trim();let r=!0,o=!0;if(!1===s.getProgramParameter(m,s.LINK_STATUS))if(r=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(s,m,b,M);else{const t=Lu(s,b,"vertex"),i=Lu(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,s.VALIDATE_STATUS)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==i&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:i,prefix:g},fragmentShader:{log:n,prefix:v}})}let S,w;return s.deleteShader(b),s.deleteShader(M),this.getUniforms=function(){return void 0===S&&(S=new Au(s,m)),S},this.getAttributes=function(){return void 0===w&&(w=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const n=t.getActiveAttrib(e,s),r=n.name;let o=1;n.type===t.FLOAT_MAT2&&(o=2),n.type===t.FLOAT_MAT3&&(o=3),n.type===t.FLOAT_MAT4&&(o=4),i[r]={type:n.type,location:t.getAttribLocation(e,r),locationSize:o}}return i}(s,m)),w},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Pu++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=M,this}let ju=0;class Xu{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),r=this._getShaderCacheForMaterial(t);return!1===r.has(n)&&(r.add(n),n.usedTimes++),!1===r.has(s)&&(r.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new Yu(t),e.set(t,i)),i}}class Yu{constructor(t){this.id=ju++,this.code=t,this.usedTimes=0}}function qu(t,e,i,n,s,r,o){const a=new hh,l=new Xu,h=[],c=s.isWebGL2,d=s.logarithmicDepthBuffer,u=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return 0===t?"uv":`uv${t}`}return{getParameters:function(r,a,h,g,v){const _=g.fog,x=v.geometry,y=r.isMeshStandardMaterial?g.environment:null,b=(r.isMeshStandardMaterial?i:e).get(r.envMap||y),M=b&&b.mapping===qo?b.image.height:null,S=f[r.type];null!==r.precision&&(p=s.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead."));const w=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==w?w.length:0;let E,A,C,P,L=0;if(void 0!==x.morphAttributes.position&&(L=1),void 0!==x.morphAttributes.normal&&(L=2),void 0!==x.morphAttributes.color&&(L=3),S){const t=qc[S];E=t.vertexShader,A=t.fragmentShader}else E=r.vertexShader,A=r.fragmentShader,l.update(r),C=l.getVertexShaderID(r),P=l.getFragmentShaderID(r);const R=t.getRenderTarget(),D=!0===v.isInstancedMesh,I=!!r.map,k=!!r.matcap,O=!!b,N=!!r.aoMap,U=!!r.lightMap,B=!!r.bumpMap,F=!!r.normalMap,z=!!r.displacementMap,H=!!r.emissiveMap,V=!!r.metalnessMap,G=!!r.roughnessMap,W=r.anisotropy>0,j=r.clearcoat>0,X=r.iridescence>0,Y=r.sheen>0,q=r.transmission>0,K=W&&!!r.anisotropyMap,Z=j&&!!r.clearcoatMap,$=j&&!!r.clearcoatNormalMap,J=j&&!!r.clearcoatRoughnessMap,Q=X&&!!r.iridescenceMap,tt=X&&!!r.iridescenceThicknessMap,et=Y&&!!r.sheenColorMap,it=Y&&!!r.sheenRoughnessMap,nt=!!r.specularMap,st=!!r.specularColorMap,rt=!!r.specularIntensityMap,ot=q&&!!r.transmissionMap,at=q&&!!r.thicknessMap,lt=!!r.gradientMap,ht=!!r.alphaMap,ct=r.alphaTest>0,dt=!!r.alphaHash,ut=!!r.extensions,pt=!!x.attributes.uv1,ft=!!x.attributes.uv2,mt=!!x.attributes.uv3;let gt=Fo;return r.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(gt=t.toneMapping)),{isWebGL2:c,shaderID:S,shaderType:r.type,shaderName:r.name,vertexShader:E,fragmentShader:A,defines:r.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:D,instancingColor:D&&null!==v.instanceColor,supportsVertexTextures:u,outputColorSpace:null===R?t.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Ta,map:I,matcap:k,envMap:O,envMapMode:O&&b.mapping,envMapCubeUVHeight:M,aoMap:N,lightMap:U,bumpMap:B,normalMap:F,displacementMap:u&&z,emissiveMap:H,normalMapObjectSpace:F&&1===r.normalMapType,normalMapTangentSpace:F&&0===r.normalMapType,metalnessMap:V,roughnessMap:G,anisotropy:W,anisotropyMap:K,clearcoat:j,clearcoatMap:Z,clearcoatNormalMap:$,clearcoatRoughnessMap:J,iridescence:X,iridescenceMap:Q,iridescenceThicknessMap:tt,sheen:Y,sheenColorMap:et,sheenRoughnessMap:it,specularMap:nt,specularColorMap:st,specularIntensityMap:rt,transmission:q,transmissionMap:ot,thicknessMap:at,gradientMap:lt,opaque:!1===r.transparent&&1===r.blending,alphaMap:ht,alphaTest:ct,alphaHash:dt,combine:r.combine,mapUv:I&&m(r.map.channel),aoMapUv:N&&m(r.aoMap.channel),lightMapUv:U&&m(r.lightMap.channel),bumpMapUv:B&&m(r.bumpMap.channel),normalMapUv:F&&m(r.normalMap.channel),displacementMapUv:z&&m(r.displacementMap.channel),emissiveMapUv:H&&m(r.emissiveMap.channel),metalnessMapUv:V&&m(r.metalnessMap.channel),roughnessMapUv:G&&m(r.roughnessMap.channel),anisotropyMapUv:K&&m(r.anisotropyMap.channel),clearcoatMapUv:Z&&m(r.clearcoatMap.channel),clearcoatNormalMapUv:$&&m(r.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:J&&m(r.clearcoatRoughnessMap.channel),iridescenceMapUv:Q&&m(r.iridescenceMap.channel),iridescenceThicknessMapUv:tt&&m(r.iridescenceThicknessMap.channel),sheenColorMapUv:et&&m(r.sheenColorMap.channel),sheenRoughnessMapUv:it&&m(r.sheenRoughnessMap.channel),specularMapUv:nt&&m(r.specularMap.channel),specularColorMapUv:st&&m(r.specularColorMap.channel),specularIntensityMapUv:rt&&m(r.specularIntensityMap.channel),transmissionMapUv:ot&&m(r.transmissionMap.channel),thicknessMapUv:at&&m(r.thicknessMap.channel),alphaMapUv:ht&&m(r.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(F||W),vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,vertexUv1s:pt,vertexUv2s:ft,vertexUv3s:mt,pointsUvs:!0===v.isPoints&&!!x.attributes.uv&&(I||ht),fog:!!_,useFog:!0===r.fog,fogExp2:_&&_.isFogExp2,flatShading:!0===r.flatShading,sizeAttenuation:!0===r.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:L,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,useLegacyLights:t._useLegacyLights,premultipliedAlpha:r.premultipliedAlpha,doubleSided:2===r.side,flipSided:1===r.side,useDepthPacking:r.depthPacking>=0,depthPacking:r.depthPacking||0,index0AttributeName:r.index0AttributeName,extensionDerivatives:ut&&!0===r.extensions.derivatives,extensionFragDepth:ut&&!0===r.extensions.fragDepth,extensionDrawBuffers:ut&&!0===r.extensions.drawBuffers,extensionShaderTextureLOD:ut&&!0===r.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.matcap&&a.enable(4),e.envMap&&a.enable(5),e.normalMapObjectSpace&&a.enable(6),e.normalMapTangentSpace&&a.enable(7),e.clearcoat&&a.enable(8),e.iridescence&&a.enable(9),e.alphaTest&&a.enable(10),e.vertexColors&&a.enable(11),e.vertexAlphas&&a.enable(12),e.vertexUv1s&&a.enable(13),e.vertexUv2s&&a.enable(14),e.vertexUv3s&&a.enable(15),e.vertexTangents&&a.enable(16),e.anisotropy&&a.enable(17),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.skinning&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.morphColors&&a.enable(7),e.premultipliedAlpha&&a.enable(8),e.shadowMapEnabled&&a.enable(9),e.useLegacyLights&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.transmission&&a.enable(15),e.sheen&&a.enable(16),e.opaque&&a.enable(17),e.pointsUvs&&a.enable(18),t.push(a.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=qc[e];i=Cc.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Wu(t,i,e,r),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:h,dispose:function(){l.dispose()}}}function Ku(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Zu(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function $u(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ju(){const t=[];let e=0;const i=[],n=[],s=[];function r(i,n,s,r,o,a){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:s,groupOrder:r,renderOrder:i.renderOrder,z:o,group:a},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=s,l.groupOrder=r,l.renderOrder=i.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:i,transmissive:n,transparent:s,init:function(){e=0,i.length=0,n.length=0,s.length=0},push:function(t,e,o,a,l,h){const c=r(t,e,o,a,l,h);o.transmission>0?n.push(c):!0===o.transparent?s.push(c):i.push(c)},unshift:function(t,e,o,a,l,h){const c=r(t,e,o,a,l,h);o.transmission>0?n.unshift(c):!0===o.transparent?s.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Zu),n.length>1&&n.sort(e||$u),s.length>1&&s.sort(e||$u)}}}function Qu(){let t=new WeakMap;return{get:function(e,i){const n=t.get(e);let s;return void 0===n?(s=new Ju,t.set(e,[s])):i>=n.length?(s=new Ju,n.push(s)):s=n[i],s},dispose:function(){t=new WeakMap}}}function tp(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Ml,color:new Vh};break;case"SpotLight":i={position:new Ml,direction:new Ml,color:new Vh,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Ml,color:new Vh,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Ml,skyColor:new Vh,groundColor:new Vh};break;case"RectAreaLight":i={color:new Vh,position:new Ml,halfWidth:new Ml,halfHeight:new Ml}}return t[e.id]=i,i}}}let ep=0;function ip(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function np(t,e){const i=new tp,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ka};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ka,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let t=0;t<9;t++)s.probe.push(new Ml);const r=new Ml,o=new Jl,a=new Jl;return{setup:function(r,o){let a=0,l=0,h=0;for(let t=0;t<9;t++)s.probe[t].set(0,0,0);let c=0,d=0,u=0,p=0,f=0,m=0,g=0,v=0,_=0,x=0;r.sort(ip);const y=!0===o?Math.PI:1;for(let t=0,e=r.length;t<e;t++){const e=r[t],o=e.color,b=e.intensity,M=e.distance,S=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*b*y,l+=o.g*b*y,h+=o.b*b*y;else if(e.isLightProbe)for(let t=0;t<9;t++)s.probe[t].addScaledVector(e.sh.coefficients[t],b);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,s.directionalShadow[c]=i,s.directionalShadowMap[c]=S,s.directionalShadowMatrix[c]=e.shadow.matrix,m++}s.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(b*y),t.distance=M,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,s.spot[u]=t;const r=e.shadow;if(e.map&&(s.spotLightMap[_]=e.map,_++,r.updateMatrices(e),e.castShadow&&x++),s.spotLightMatrix[u]=r.matrix,e.castShadow){const t=n.get(e);t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,s.spotShadow[u]=t,s.spotShadowMap[u]=S,v++}u++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(b),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),s.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,s.pointShadow[d]=i,s.pointShadowMap[d]=S,s.pointShadowMatrix[d]=e.shadow.matrix,g++}s.point[d]=t,d++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(b*y),t.groundColor.copy(e.groundColor).multiplyScalar(b*y),s.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(s.rectAreaLTC1=Yc.LTC_FLOAT_1,s.rectAreaLTC2=Yc.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Yc.LTC_HALF_1,s.rectAreaLTC2=Yc.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=a,s.ambient[1]=l,s.ambient[2]=h;const b=s.hash;b.directionalLength===c&&b.pointLength===d&&b.spotLength===u&&b.rectAreaLength===p&&b.hemiLength===f&&b.numDirectionalShadows===m&&b.numPointShadows===g&&b.numSpotShadows===v&&b.numSpotMaps===_||(s.directional.length=c,s.spot.length=u,s.rectArea.length=p,s.point.length=d,s.hemi.length=f,s.directionalShadow.length=m,s.directionalShadowMap.length=m,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=v,s.spotShadowMap.length=v,s.directionalShadowMatrix.length=m,s.pointShadowMatrix.length=g,s.spotLightMatrix.length=v+_-x,s.spotLightMap.length=_,s.numSpotLightShadowsWithMaps=x,b.directionalLength=c,b.pointLength=d,b.spotLength=u,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=v,b.numSpotMaps=_,s.version=ep++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0;const d=e.matrixWorldInverse;for(let e=0,u=t.length;e<u;e++){const u=t[e];if(u.isDirectionalLight){const t=s.directional[i];t.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(d),i++}else if(u.isSpotLight){const t=s.spot[l];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),t.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const t=s.rectArea[h];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),a.identity(),o.copy(u.matrixWorld),o.premultiply(d),a.extractRotation(o),t.halfWidth.set(.5*u.width,0,0),t.halfHeight.set(0,.5*u.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),h++}else if(u.isPointLight){const t=s.point[n];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),n++}else if(u.isHemisphereLight){const t=s.hemi[c];t.direction.setFromMatrixPosition(u.matrixWorld),t.direction.transformDirection(d),c++}}},state:s}}function sp(t,e){const i=new np(t,e),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){s.push(t)}}}function rp(t,e){let i=new WeakMap;return{get:function(n,s=0){const r=i.get(n);let o;return void 0===r?(o=new sp(t,e),i.set(n,[o])):s>=r.length?(o=new sp(t,e),r.push(o)):o=r[s],o},dispose:function(){i=new WeakMap}}}class op extends Uh{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class ap extends Uh{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function lp(t,e,i){let n=new Vc;const s=new Ka,r=new Ka,o=new gl,a=new op({depthPacking:3201}),l=new ap,h={},c=i.maxTextureSize,d={0:1,1:0,2:2},u=new Pc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ka},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=u.clone();p.defines.HORIZONTAL_PASS=1;const f=new sc;f.setAttribute("position",new Yh(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Mc(f,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Do;let v=this.type;function _(i,n){const r=e.update(m);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new _l(s.x,s.y)),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,u,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,p,m,null)}function x(e,i,n,s){let r=null;const o=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)r=o;else if(r=!0===n.isPointLight?l:a,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){const t=r.uuid,e=i.uuid;let n=h[t];void 0===n&&(n={},h[t]=n);let s=n[e];void 0===s&&(s=r.clone(),n[e]=s),r=s}return r.visible=i.visible,r.wireframe=i.wireframe,r.side=s===ko?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],r.alphaMap=i.alphaMap,r.alphaTest=i.alphaTest,r.map=i.map,r.clipShadows=i.clipShadows,r.clippingPlanes=i.clippingPlanes,r.clipIntersection=i.clipIntersection,r.displacementMap=i.displacementMap,r.displacementScale=i.displacementScale,r.displacementBias=i.displacementBias,r.wireframeLinewidth=i.wireframeLinewidth,r.linewidth=i.linewidth,!0===n.isPointLight&&!0===r.isMeshDistanceMaterial&&(t.properties.get(r).light=n),r}function y(i,s,r,o,a){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===ko)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);const n=e.update(i),s=i.material;if(Array.isArray(s)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=s[h.materialIndex];if(c&&c.visible){const e=x(i,c,o,a);t.renderBufferDirect(r,null,n,e,i,h)}}}else if(s.visible){const e=x(i,s,o,a);t.renderBufferDirect(r,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)y(l[t],s,r,o,a)}this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),u=t.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);const p=v!==ko&&this.type===ko,f=v===ko&&this.type!==ko;for(let l=0,h=e.length;l<h;l++){const h=e[l],d=h.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;s.copy(d.mapSize);const m=d.getFrameExtents();if(s.multiply(m),r.copy(d.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/m.x),s.x=r.x*m.x,d.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/m.y),s.y=r.y*m.y,d.mapSize.y=r.y)),null===d.map||!0===p||!0===f){const t=this.type!==ko?{minFilter:Jo,magFilter:Jo}:{};null!==d.map&&d.map.dispose(),d.map=new _l(s.x,s.y,t),d.map.texture.name=h.name+".shadowMap",d.camera.updateProjectionMatrix()}t.setRenderTarget(d.map),t.clear();const g=d.getViewportCount();for(let t=0;t<g;t++){const e=d.getViewport(t);o.set(r.x*e.x,r.y*e.y,r.x*e.z,r.y*e.w),u.viewport(o),d.updateMatrices(h,t),n=d.getFrustum(),y(i,a,d.camera,h,this.type)}!0!==d.isPointLightShadow&&this.type===ko&&_(d,a),d.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(l,h,d)}}function hp(t,e,i){const n=i.isWebGL2,s=new function(){let e=!1;const i=new gl;let n=null;const s=new gl(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,o,a){!0===a&&(e*=o,n*=o,r*=o),i.set(e,n,r,o),!1===s.equals(i)&&(t.clearColor(e,n,r,o),s.copy(i))},reset:function(){e=!1,n=null,s.set(-1,0,0,0)}}},r=new function(){let e=!1,i=null,n=null,s=null;return{setTest:function(e){e?z(t.DEPTH_TEST):H(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}n=e}},setLocked:function(t){e=t},setClear:function(e){s!==e&&(t.clearDepth(e),s=e)},reset:function(){e=!1,i=null,n=null,s=null}}},o=new function(){let e=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,h=null;return{setTest:function(i){e||(i?z(t.STENCIL_TEST):H(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&s===i&&r===o||(t.stencilFunc(e,i,o),n=e,s=i,r=o)},setOp:function(e,i,n){o===e&&a===i&&l===n||(t.stencilOp(e,i,n),o=e,a=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,h=null}}},a=new WeakMap,l=new WeakMap;let h={},c={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,_=null,x=null,y=null,b=null,M=!1,S=null,w=null,T=null,E=null,A=null;const C=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,L=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(R)[1]),P=L>=1):-1!==R.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),P=L>=2);let D=null,I={};const k=t.getParameter(t.SCISSOR_BOX),O=t.getParameter(t.VIEWPORT),N=(new gl).fromArray(k),U=(new gl).fromArray(O);function B(e,i,s,r){const o=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<s;a++)!n||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(i+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o):t.texImage3D(i,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,o);return a}const F={};function z(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function H(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}F[t.TEXTURE_2D]=B(t.TEXTURE_2D,t.TEXTURE_2D,1),F[t.TEXTURE_CUBE_MAP]=B(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(F[t.TEXTURE_2D_ARRAY]=B(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),F[t.TEXTURE_3D]=B(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),s.setClear(0,0,0,1),r.setClear(1),o.setClear(0),z(t.DEPTH_TEST),r.setFunc(3),j(!1),X(1),z(t.CULL_FACE),W(0);const V={[Oo]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(n)V[103]=t.MIN,V[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(V[103]=t.MIN_EXT,V[104]=t.MAX_EXT)}const G={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA};function W(e,i,n,s,r,o,a,l){if(0!==e){if(!1===f&&(z(t.BLEND),f=!0),5===e)r=r||i,o=o||n,a=a||s,i===g&&r===x||(t.blendEquationSeparate(V[i],V[r]),g=i,x=r),n===v&&s===_&&o===y&&a===b||(t.blendFuncSeparate(G[n],G[s],G[o],G[a]),v=n,_=s,y=o,b=a),m=e,M=!1;else if(e!==m||l!==M){if(g===Oo&&x===Oo||(t.blendEquation(t.FUNC_ADD),g=Oo,x=Oo),l)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,_=null,y=null,b=null,m=e,M=l}}else!0===f&&(H(t.BLEND),f=!1)}function j(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function X(e){0!==e?(z(t.CULL_FACE),e!==w&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):H(t.CULL_FACE),w=e}function Y(e,i,n){e?(z(t.POLYGON_OFFSET_FILL),E===i&&A===n||(t.polygonOffset(i,n),E=i,A=n)):H(t.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:r,stencil:o},enable:z,disable:H,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,n&&(e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,s){let r=u,o=!1;if(n)if(r=d.get(s),void 0===r&&(r=[],d.set(s,r)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(r.length!==e.length||r[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)r[i]=t.COLOR_ATTACHMENT0+i;r.length=e.length,o=!0}}else r[0]!==t.COLOR_ATTACHMENT0&&(r[0]=t.COLOR_ATTACHMENT0,o=!0);else r[0]!==t.BACK&&(r[0]=t.BACK,o=!0);o&&(i.isWebGL2?t.drawBuffers(r):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:W,setMaterial:function(e,i){2===e.side?H(t.CULL_FACE):z(t.CULL_FACE);let n=1===e.side;i&&(n=!n),j(n),1===e.blending&&!1===e.transparent?W(0):W(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),s.setMask(e.colorWrite);const a=e.stencilWrite;o.setTest(a),a&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Y(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(t.SAMPLE_ALPHA_TO_COVERAGE):H(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:j,setCullFace:X,setLineWidth:function(e){e!==T&&(P&&t.lineWidth(e),T=e)},setPolygonOffset:Y,setScissorTest:function(e){e?z(t.SCISSOR_TEST):H(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+C-1),D!==e&&(t.activeTexture(e),D=e)},bindTexture:function(e,i,n){void 0===n&&(n=null===D?t.TEXTURE0+C-1:D);let s=I[n];void 0===s&&(s={type:void 0,texture:void 0},I[n]=s),s.type===e&&s.texture===i||(D!==n&&(t.activeTexture(n),D=n),t.bindTexture(e,i||F[e]),s.type=e,s.texture=i)},unbindTexture:function(){const e=I[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let n=l.get(i);void 0===n&&(n=new WeakMap,l.set(i,n));let s=n.get(e);void 0===s&&(s=t.getUniformBlockIndex(i,e.name),n.set(e,s))},uniformBlockBinding:function(e,i){const n=l.get(i).get(e);a.get(i)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),a.set(i,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===N.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===U.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),U.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===n&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},D=null,I={},c={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,_=null,x=null,y=null,b=null,M=!1,S=null,w=null,T=null,E=null,A=null,N.set(0,0,t.canvas.width,t.canvas.height),U.set(0,0,t.canvas.width,t.canvas.height),s.reset(),r.reset(),o.reset()}}}function cp(t,e,i,n,s,r,o){const a=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,c=s.maxTextureSize,d=s.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function _(t,e){return v?new OffscreenCanvas(t,e):Qa("canvas")}function x(t,e,i,n){let s=1;if((t.width>n||t.height>n)&&(s=n/Math.max(t.width,t.height)),s<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Ga:Math.floor,r=n(s*t.width),o=n(s*t.height);void 0===m&&(m=_(r,o));const a=i?_(r,o):m;return a.width=r,a.height=o,a.getContext("2d").drawImage(t,0,0,r,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+r+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return Ha(t.width)&&Ha(t.height)}function b(t,e){return t.generateMipmaps&&e&&t.minFilter!==Jo&&t.minFilter!==ea}function M(e){t.generateMipmap(e)}function S(i,n,s,r,o=!1){if(!1===a)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return n===t.RED&&(s===t.FLOAT&&(l=t.R32F),s===t.HALF_FLOAT&&(l=t.R16F),s===t.UNSIGNED_BYTE&&(l=t.R8)),n===t.RED_INTEGER&&(s===t.UNSIGNED_BYTE&&(l=t.R8UI),s===t.UNSIGNED_SHORT&&(l=t.R16UI),s===t.UNSIGNED_INT&&(l=t.R32UI),s===t.BYTE&&(l=t.R8I),s===t.SHORT&&(l=t.R16I),s===t.INT&&(l=t.R32I)),n===t.RG&&(s===t.FLOAT&&(l=t.RG32F),s===t.HALF_FLOAT&&(l=t.RG16F),s===t.UNSIGNED_BYTE&&(l=t.RG8)),n===t.RGBA&&(s===t.FLOAT&&(l=t.RGBA32F),s===t.HALF_FLOAT&&(l=t.RGBA16F),s===t.UNSIGNED_BYTE&&(l=r===wa&&!1===o?t.SRGB8_ALPHA8:t.RGBA8),s===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),s===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function w(t,e,i){return!0===b(t,i)||t.isFramebufferTexture&&t.minFilter!==Jo&&t.minFilter!==ea?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function T(e){return e===Jo||e===Qo||e===ta?t.NEAREST:t.LINEAR}function E(t){const e=t.target;e.removeEventListener("dispose",E),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,s=g.get(i);if(s){const n=s[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&C(t),0===Object.keys(s).length&&g.delete(i)}n.remove(t)}(e),e.isVideoTexture&&f.delete(e)}function A(e){const i=e.target;i.removeEventListener("dispose",A),function(e){const i=e.texture,s=n.get(e),r=n.get(i);if(void 0!==r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(s.__webglFramebuffer[e]))for(let i=0;i<s.__webglFramebuffer[e].length;i++)t.deleteFramebuffer(s.__webglFramebuffer[e][i]);else t.deleteFramebuffer(s.__webglFramebuffer[e]);s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer[e])}else{if(Array.isArray(s.__webglFramebuffer))for(let e=0;e<s.__webglFramebuffer.length;e++)t.deleteFramebuffer(s.__webglFramebuffer[e]);else t.deleteFramebuffer(s.__webglFramebuffer);if(s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&t.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer)for(let e=0;e<s.__webglColorRenderbuffer.length;e++)s.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(s.__webglColorRenderbuffer[e]);s.__webglDepthRenderbuffer&&t.deleteRenderbuffer(s.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function C(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const s=e.source;delete g.get(s)[i.__cacheKey],o.memory.textures--}let P=0;function L(e,s){const r=n.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void N(r,e,s);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(t.TEXTURE_2D,r.__webglTexture,t.TEXTURE0+s)}const R={[Ko]:t.REPEAT,[Zo]:t.CLAMP_TO_EDGE,[$o]:t.MIRRORED_REPEAT},D={[Jo]:t.NEAREST,[Qo]:t.NEAREST_MIPMAP_NEAREST,[ta]:t.NEAREST_MIPMAP_LINEAR,[ea]:t.LINEAR,1007:t.LINEAR_MIPMAP_NEAREST,[ia]:t.LINEAR_MIPMAP_LINEAR},I={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function k(i,r,o){if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,R[r.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,R[r.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,R[r.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,D[r.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,D[r.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),r.wrapS===Zo&&r.wrapT===Zo||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,t.TEXTURE_MAG_FILTER,T(r.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,T(r.minFilter)),r.minFilter!==Jo&&r.minFilter!==ea&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,I[r.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(r.magFilter===Jo)return;if(r.minFilter!==ta&&r.minFilter!==ia)return;if(r.type===oa&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&r.type===aa&&!1===e.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||n.get(r).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy)}}function O(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",E));const s=i.source;let r=g.get(s);void 0===r&&(r={},g.set(s,r));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===r[a]&&(r[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),r[a].usedTimes++;const s=r[e.__cacheKey];void 0!==s&&(r[e.__cacheKey].usedTimes--,0===s.usedTimes&&C(i)),e.__cacheKey=a,e.__webglTexture=r[a].texture}return n}function N(e,s,o){let l=t.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=t.TEXTURE_3D);const h=O(e,s),d=s.source;i.bindTexture(l,e.__webglTexture,t.TEXTURE0+o);const u=n.get(d);if(d.version!==u.__version||!0===h){i.activeTexture(t.TEXTURE0+o),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,s.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,s.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=function(t){return!a&&(t.wrapS!==Zo||t.wrapT!==Zo||t.minFilter!==Jo&&t.minFilter!==ea)}(s)&&!1===y(s.image);let n=x(s.image,e,!1,c);n=V(s,n);const p=y(n)||a,f=r.convert(s.format,s.colorSpace);let m,g=r.convert(s.type),v=S(s.internalFormat,f,g,s.colorSpace);k(l,s,p);const _=s.mipmaps,T=a&&!0!==s.isVideoTexture,E=void 0===u.__version||!0===h,A=w(s,n,p);if(s.isDepthTexture)v=t.DEPTH_COMPONENT,a?v=s.type===oa?t.DEPTH_COMPONENT32F:s.type===ra?t.DEPTH_COMPONENT24:s.type===la?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:s.type===oa&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===ca&&v===t.DEPTH_COMPONENT&&s.type!==sa&&s.type!==ra&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=ra,g=r.convert(s.type)),s.format===da&&v===t.DEPTH_COMPONENT&&(v=t.DEPTH_STENCIL,s.type!==la&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=la,g=r.convert(s.type))),E&&(T?i.texStorage2D(t.TEXTURE_2D,1,v,n.width,n.height):i.texImage2D(t.TEXTURE_2D,0,v,n.width,n.height,0,f,g,null));else if(s.isDataTexture)if(_.length>0&&p){T&&E&&i.texStorage2D(t.TEXTURE_2D,A,v,_[0].width,_[0].height);for(let e=0,n=_.length;e<n;e++)m=_[e],T?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,v,m.width,m.height,0,f,g,m.data);s.generateMipmaps=!1}else T?(E&&i.texStorage2D(t.TEXTURE_2D,A,v,n.width,n.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,f,g,n.data)):i.texImage2D(t.TEXTURE_2D,0,v,n.width,n.height,0,f,g,n.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){T&&E&&i.texStorage3D(t.TEXTURE_2D_ARRAY,A,v,_[0].width,_[0].height,n.depth);for(let e=0,r=_.length;e<r;e++)m=_[e],s.format!==ha?null!==f?T?i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,m.width,m.height,n.depth,f,m.data,0,0):i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,v,m.width,m.height,n.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,m.width,m.height,n.depth,f,g,m.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,v,m.width,m.height,n.depth,0,f,g,m.data)}else{T&&E&&i.texStorage2D(t.TEXTURE_2D,A,v,_[0].width,_[0].height);for(let e=0,n=_.length;e<n;e++)m=_[e],s.format!==ha?null!==f?T?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,m.data):i.compressedTexImage2D(t.TEXTURE_2D,e,v,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,v,m.width,m.height,0,f,g,m.data)}else if(s.isDataArrayTexture)T?(E&&i.texStorage3D(t.TEXTURE_2D_ARRAY,A,v,n.width,n.height,n.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,n.width,n.height,n.depth,f,g,n.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,v,n.width,n.height,n.depth,0,f,g,n.data);else if(s.isData3DTexture)T?(E&&i.texStorage3D(t.TEXTURE_3D,A,v,n.width,n.height,n.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,n.width,n.height,n.depth,f,g,n.data)):i.texImage3D(t.TEXTURE_3D,0,v,n.width,n.height,n.depth,0,f,g,n.data);else if(s.isFramebufferTexture){if(E)if(T)i.texStorage2D(t.TEXTURE_2D,A,v,n.width,n.height);else{let e=n.width,s=n.height;for(let n=0;n<A;n++)i.texImage2D(t.TEXTURE_2D,n,v,e,s,0,f,g,null),e>>=1,s>>=1}}else if(_.length>0&&p){T&&E&&i.texStorage2D(t.TEXTURE_2D,A,v,_[0].width,_[0].height);for(let e=0,n=_.length;e<n;e++)m=_[e],T?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,g,m):i.texImage2D(t.TEXTURE_2D,e,v,f,g,m);s.generateMipmaps=!1}else T?(E&&i.texStorage2D(t.TEXTURE_2D,A,v,n.width,n.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,g,n)):i.texImage2D(t.TEXTURE_2D,0,v,f,g,n);b(s,p)&&M(l),u.__version=d.version,s.onUpdate&&s.onUpdate(s)}e.__version=s.version}function U(e,s,o,a,l,h){const c=r.convert(o.format,o.colorSpace),d=r.convert(o.type),p=S(o.internalFormat,c,d,o.colorSpace);if(!n.get(s).__hasExternalTextures){const e=Math.max(1,s.width>>h),n=Math.max(1,s.height>>h);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,h,p,e,n,s.depth,0,c,d,null):i.texImage2D(l,h,p,e,n,0,c,d,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),H(s)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,0,z(s)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,h),i.bindFramebuffer(t.FRAMEBUFFER,null)}function B(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let s=t.DEPTH_COMPONENT16;if(n||H(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===oa?s=t.DEPTH_COMPONENT32F:e.type===ra&&(s=t.DEPTH_COMPONENT24));const n=z(i);H(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,s,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,s,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,s,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const s=z(i);n&&!1===H(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):H(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let s=0;s<e.length;s++){const o=e[s],a=r.convert(o.format,o.colorSpace),l=r.convert(o.type),h=S(o.internalFormat,a,l,o.colorSpace),c=z(i);n&&!1===H(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,c,h,i.width,i.height):H(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,c,h,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,h,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function F(e){const s=n.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!s.__autoAllocateDepthBuffer){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),L(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture,o=z(s);if(s.depthTexture.format===ca)H(s)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(s.depthTexture.format!==da)throw new Error("Unknown depthTexture format");H(s)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(s.__webglFramebuffer,e)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=t.createRenderbuffer(),B(s.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=t.createRenderbuffer(),B(s.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function z(t){return Math.min(d,t.samples)}function H(t){const i=n.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function V(t,i){const n=t.colorSpace,s=t.format,r=t.type;return!0===t.isCompressedTexture||t.format===La||n!==Ta&&""!==n&&(n===wa?!1===a?!0===e.has("EXT_sRGB")&&s===ha?(t.format=La,t.minFilter=ea,t.generateMipmaps=!1):i=cl.sRGBToLinear(i):s===ha&&r===na||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),i}this.allocateTextureUnit=function(){const t=P;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),P+=1,t},this.resetTextureUnits=function(){P=0},this.setTexture2D=L,this.setTexture2DArray=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?N(r,e,s):i.bindTexture(t.TEXTURE_2D_ARRAY,r.__webglTexture,t.TEXTURE0+s)},this.setTexture3D=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?N(r,e,s):i.bindTexture(t.TEXTURE_3D,r.__webglTexture,t.TEXTURE0+s)},this.setTextureCube=function(e,s){const o=n.get(e);e.version>0&&o.__version!==e.version?function(e,s,o){if(6!==s.image.length)return;const l=O(e,s),c=s.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const d=n.get(c);if(c.version!==d.__version||!0===l){i.activeTexture(t.TEXTURE0+o),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,s.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,s.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=s.isCompressedTexture||s.image[0].isCompressedTexture,n=s.image[0]&&s.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=e||n?n?s.image[t].image:s.image[t]:x(s.image[t],!1,!0,h),u[t]=V(s,u[t]);const p=u[0],f=y(p)||a,m=r.convert(s.format,s.colorSpace),g=r.convert(s.type),v=S(s.internalFormat,m,g,s.colorSpace),_=a&&!0!==s.isVideoTexture,T=void 0===d.__version||!0===l;let E,A=w(s,p,f);if(k(t.TEXTURE_CUBE_MAP,s,f),e){_&&T&&i.texStorage2D(t.TEXTURE_CUBE_MAP,A,v,p.width,p.height);for(let e=0;e<6;e++){E=u[e].mipmaps;for(let n=0;n<E.length;n++){const r=E[n];s.format!==ha?null!==m?_?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r.width,r.height,m,r.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,v,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r.width,r.height,m,g,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,v,r.width,r.height,0,m,g,r.data)}}}else{E=s.mipmaps,_&&T&&(E.length>0&&A++,i.texStorage2D(t.TEXTURE_CUBE_MAP,A,v,u[0].width,u[0].height));for(let e=0;e<6;e++)if(n){_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,u[e].width,u[e].height,m,g,u[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,v,u[e].width,u[e].height,0,m,g,u[e].data);for(let n=0;n<E.length;n++){const s=E[n].image[e].image;_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,s.width,s.height,m,g,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,v,s.width,s.height,0,m,g,s.data)}}else{_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,m,g,u[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,v,m,g,u[e]);for(let n=0;n<E.length;n++){const s=E[n];_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,m,g,s.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,v,m,g,s.image[e])}}}b(s,f)&&M(t.TEXTURE_CUBE_MAP),d.__version=c.version,s.onUpdate&&s.onUpdate(s)}e.__version=s.version}(o,e,s):i.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+s)},this.rebindTextures=function(e,i,s){const r=n.get(e);void 0!==i&&U(r.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==s&&F(e)},this.setupRenderTarget=function(e){const l=e.texture,h=n.get(e),c=n.get(l);e.addEventListener("dispose",A),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,o.memory.textures++);const d=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultipleRenderTargets,p=y(e)||a;if(d){h.__webglFramebuffer=[];for(let e=0;e<6;e++)if(a&&l.mipmaps&&l.mipmaps.length>0){h.__webglFramebuffer[e]=[];for(let i=0;i<l.mipmaps.length;i++)h.__webglFramebuffer[e][i]=t.createFramebuffer()}else h.__webglFramebuffer[e]=t.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){h.__webglFramebuffer=[];for(let e=0;e<l.mipmaps.length;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else h.__webglFramebuffer=t.createFramebuffer();if(u)if(s.drawBuffers){const i=e.texture;for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);void 0===s.__webglTexture&&(s.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&e.samples>0&&!1===H(e)){const n=u?l:[l];h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){const s=n[i];h.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,h.__webglColorRenderbuffer[i]);const o=r.convert(s.format,s.colorSpace),a=r.convert(s.type),l=S(s.internalFormat,o,a,s.colorSpace,!0===e.isXRRenderTarget),c=z(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,c,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,h.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),B(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(d){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),k(t.TEXTURE_CUBE_MAP,l,p);for(let i=0;i<6;i++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)U(h.__webglFramebuffer[i][n],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else U(h.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);b(l,p)&&M(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(u){const s=e.texture;for(let r=0,o=s.length;r<o;r++){const o=s[r],a=n.get(o);i.bindTexture(t.TEXTURE_2D,a.__webglTexture),k(t.TEXTURE_2D,o,p),U(h.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),b(o,p)&&M(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,c.__webglTexture),k(n,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)U(h.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,n,i);else U(h.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,n,0);b(l,p)&&M(n),i.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(e){const s=y(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=r.length;o<a;o++){const a=r[o];if(b(a,s)){const s=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,r=n.get(a).__webglTexture;i.bindTexture(s,r),M(s),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===H(e)){const s=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],r=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const l=[],h=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=n.get(e),d=!0===e.isWebGLMultipleRenderTargets;if(d)for(let e=0;e<s.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let i=0;i<s.length;i++){l.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&l.push(h);const u=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===u&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),d&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c.__webglColorRenderbuffer[i]),!0===u&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[h]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[h])),d){const e=n.get(s[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,r,o,0,0,r,o,a,t.NEAREST),p&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),d)for(let e=0;e<s.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,c.__webglColorRenderbuffer[e]);const r=n.get(s[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,r,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=U,this.useMultisampledRTT=H}function dp(t,e,i){const n=i.isWebGL2;return{convert:function(i,s=""){let r;if(i===na)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===sa)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(i===ra)return t.UNSIGNED_INT;if(i===oa)return t.FLOAT;if(i===aa)return n?t.HALF_FLOAT:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===ha)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===ca)return t.DEPTH_COMPONENT;if(i===da)return t.DEPTH_STENCIL;if(i===La)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(1028===i)return t.RED;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===ua||i===pa||i===fa||i===ma)if(s===wa){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===ua)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===pa)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===fa)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===ma)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===ua)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===pa)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===fa)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ma)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(35840===i)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(37492===i)return s===wa?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(37496===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(37808===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return s===wa?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===ga){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(i===ga)return s===wa?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===i||36284===i||36285===i||36286===i){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===ga)return r.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===la?n?t.UNSIGNED_INT_24_8:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}class up extends Rc{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class pp extends Sh{constructor(){super(),this.isGroup=!0,this.type="Group"}}const fp={type:"move"};class mp{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new pp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new pp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ml,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ml),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new pp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ml,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ml),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){r=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i),s=this._getHandJoint(l,n);null!==t&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=t.radius),s.visible=null!==t}const n=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],o=n.position.distanceTo(s.position),a=.02,h=.005;l.inputState.pinching&&o>a+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==s&&(n=s),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(fp)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==r),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new pp;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class gp extends ml{constructor(t,e,i,n,s,r,o,a,l,h){if((h=void 0!==h?h:ca)!==ca&&h!==da)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===ca&&(i=ra),void 0===i&&h===da&&(i=la),super(null,n,s,r,o,a,h,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:Jo,this.minFilter=void 0!==a?a:Jo,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class vp extends Ia{constructor(t,e){super();const i=this;let n=null,s=1,r=null,o="local-floor",a=1,l=null,h=null,c=null,d=null,u=null,p=null;const f=e.getContextAttributes();let m=null,g=null;const v=[],_=[],x=new Rc;x.layers.enable(1),x.viewport=new gl;const y=new Rc;y.layers.enable(2),y.viewport=new gl;const b=[x,y],M=new up;M.layers.enable(1),M.layers.enable(2);let S=null,w=null;function T(t){const e=_.indexOf(t.inputSource);if(-1===e)return;const i=v[e];void 0!==i&&(i.update(t.inputSource,t.frame,l||r),i.dispatchEvent({type:t.type,data:t.inputSource}))}function E(){n.removeEventListener("select",T),n.removeEventListener("selectstart",T),n.removeEventListener("selectend",T),n.removeEventListener("squeeze",T),n.removeEventListener("squeezestart",T),n.removeEventListener("squeezeend",T),n.removeEventListener("end",E),n.removeEventListener("inputsourceschange",A);for(let t=0;t<v.length;t++){const e=_[t];null!==e&&(_[t]=null,v[t].disconnect(e))}S=null,w=null,t.setRenderTarget(m),u=null,d=null,c=null,n=null,g=null,D.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function A(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=_.indexOf(i);n>=0&&(_[n]=null,v[n].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=_.indexOf(i);if(-1===n){for(let t=0;t<v.length;t++){if(t>=_.length){_.push(i),n=t;break}if(null===_[t]){_[t]=i,n=t;break}}if(-1===n)break}const s=v[n];s&&s.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new mp,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new mp,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new mp,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||r},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==d?d:u},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(h){if(n=h,null!==n){if(m=t.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",E),n.addEventListener("inputsourceschange",A),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:s};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),g=new _l(u.framebufferWidth,u.framebufferHeight,{format:ha,type:na,colorSpace:t.outputColorSpace,stencilBuffer:f.stencil})}else{let i=null,r=null,o=null;f.depth&&(o=f.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=f.stencil?da:ca,r=f.stencil?la:ra);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:s};c=new XRWebGLBinding(n,e),d=c.createProjectionLayer(a),n.updateRenderState({layers:[d]}),g=new _l(d.textureWidth,d.textureHeight,{format:ha,type:na,depthTexture:new gp(d.textureWidth,d.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,colorSpace:t.outputColorSpace,samples:f.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,r=await n.requestReferenceSpace(o),D.setContext(n),D.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};const C=new Ml,P=new Ml;function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;M.near=y.near=x.near=t.near,M.far=y.far=x.far=t.far,S===M.near&&w===M.far||(n.updateRenderState({depthNear:M.near,depthFar:M.far}),S=M.near,w=M.far);const e=t.parent,i=M.cameras;L(M,e);for(let t=0;t<i.length;t++)L(i[t],e);2===i.length?function(t,e,i){C.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(i.matrixWorld);const n=C.distanceTo(P),s=e.projectionMatrix.elements,r=i.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],h=(s[9]-1)/s[5],c=(s[8]-1)/s[0],d=(r[8]+1)/r[0],u=o*c,p=o*d,f=n/(-c+d),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,_=u-m,x=p+(n-m),y=l*a/v*g,b=h*a/v*g;t.projectionMatrix.makePerspective(_,x,y,b,g,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(M,x,y):M.projectionMatrix.copy(x.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0);const n=t.children;for(let t=0,e=n.length;t<e;t++)n[t].updateMatrixWorld(!0);t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Na*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,M,e)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==d||null!==u)return a},this.setFoveation=function(t){a=t,null!==d&&(d.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let R=null;const D=new Gc;D.setAnimationLoop((function(e,n){if(h=n.getViewerPose(l||r),p=n,null!==h){const e=h.views;null!==u&&(t.setRenderTargetFramebuffer(g,u.framebuffer),t.setRenderTarget(g));let i=!1;e.length!==M.cameras.length&&(M.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const s=e[n];let r=null;if(null!==u)r=u.getViewport(s);else{const e=c.getViewSubImage(d,s);r=e.viewport,0===n&&(t.setRenderTargetTextures(g,e.colorTexture,d.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let o=b[n];void 0===o&&(o=new Rc,o.layers.enable(n),o.viewport=new gl,b[n]=o),o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(s.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(r.x,r.y,r.width,r.height),0===n&&(M.matrix.copy(o.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===i&&M.cameras.push(o)}}for(let t=0;t<v.length;t++){const e=_[t],i=v[t];null!==e&&void 0!==i&&i.update(e,n,l||r)}R&&R(e,n),n.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:n}),p=null})),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}}function _p(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function n(n,s){n.opacity.value=s.opacity,s.color&&n.diffuse.value.copy(s.color),s.emissive&&n.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(n.map.value=s.map,i(s.map,n.mapTransform)),s.alphaMap&&(n.alphaMap.value=s.alphaMap,i(s.alphaMap,n.alphaMapTransform)),s.bumpMap&&(n.bumpMap.value=s.bumpMap,i(s.bumpMap,n.bumpMapTransform),n.bumpScale.value=s.bumpScale,1===s.side&&(n.bumpScale.value*=-1)),s.normalMap&&(n.normalMap.value=s.normalMap,i(s.normalMap,n.normalMapTransform),n.normalScale.value.copy(s.normalScale),1===s.side&&n.normalScale.value.negate()),s.displacementMap&&(n.displacementMap.value=s.displacementMap,i(s.displacementMap,n.displacementMapTransform),n.displacementScale.value=s.displacementScale,n.displacementBias.value=s.displacementBias),s.emissiveMap&&(n.emissiveMap.value=s.emissiveMap,i(s.emissiveMap,n.emissiveMapTransform)),s.specularMap&&(n.specularMap.value=s.specularMap,i(s.specularMap,n.specularMapTransform)),s.alphaTest>0&&(n.alphaTest.value=s.alphaTest);const r=e.get(s).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=s.reflectivity,n.ior.value=s.ior,n.refractionRatio.value=s.refractionRatio),s.lightMap){n.lightMap.value=s.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=s.lightMapIntensity*e,i(s.lightMap,n.lightMapTransform)}s.aoMap&&(n.aoMap.value=s.aoMap,n.aoMapIntensity.value=s.aoMapIntensity,i(s.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,Ac(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,s,r,o,a){s.isMeshBasicMaterial||s.isMeshLambertMaterial?n(t,s):s.isMeshToonMaterial?(n(t,s),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,s)):s.isMeshPhongMaterial?(n(t,s),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,s)):s.isMeshStandardMaterial?(n(t,s),function(t,n){t.metalness.value=n.metalness,n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap,i(n.metalnessMap,t.metalnessMapTransform)),t.roughness.value=n.roughness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap,i(n.roughnessMap,t.roughnessMapTransform));e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}(t,s),s.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,s,a)):s.isMeshMatcapMaterial?(n(t,s),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,s)):s.isMeshDepthMaterial?n(t,s):s.isMeshDistanceMaterial?(n(t,s),function(t,i){const n=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(n.matrixWorld),t.nearDistance.value=n.shadow.camera.near,t.farDistance.value=n.shadow.camera.far}(t,s)):s.isMeshNormalMaterial?n(t,s):s.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,s),s.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,s)):s.isPointsMaterial?function(t,e,n,s){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*s,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s,r,o):s.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s):s.isShadowMaterial?(t.color.value.copy(s.color),t.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function xp(t,e,i,n){let s={},r={},o=[];const a=i.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,i){const n=t.value;if(void 0===i[e]){if("number"==typeof n)i[e]=n;else{const t=Array.isArray(n)?n:[n],s=[];for(let e=0;e<t.length;e++)s.push(t[e].clone());i[e]=s}return!0}if("number"==typeof n){if(i[e]!==n)return i[e]=n,!0}else{const t=Array.isArray(i[e])?i[e]:[i[e]],s=Array.isArray(n)?n:[n];for(let e=0;e<t.length;e++){const i=t[e];if(!1===i.equals(s[e]))return i.copy(s[e]),!0}}return!1}function h(t){const e={boundary:0,storage:0};return"number"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function c(e){const i=e.target;i.removeEventListener("dispose",c);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),t.deleteBuffer(s[i.id]),delete s[i.id],delete r[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,d){let u=s[i.id];void 0===u&&(function(t){const e=t.uniforms;let i=0;let n=0;for(let t=0,s=e.length;t<s;t++){const s=e[t],r={boundary:0,storage:0},o=Array.isArray(s.value)?s.value:[s.value];for(let t=0,e=o.length;t<e;t++){const e=h(o[t]);r.boundary+=e.boundary,r.storage+=e.storage}s.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=i,t>0&&(n=i%16,0!==n&&16-n-r.boundary<0&&(i+=16-n,s.__offset=i)),i+=r.storage}n=i%16,n>0&&(i+=16-n),t.__size=i,t.__cache={}}(i),u=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const n=t.createBuffer(),s=e.__size,r=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,s,r),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,n),n}(i),s[i.id]=u,i.addEventListener("dispose",c));const p=d.program;n.updateUBOMapping(i,p);const f=e.render.frame;r[i.id]!==f&&(function(e){const i=s[e.id],n=e.uniforms,r=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=n.length;e<i;e++){const i=n[e];if(!0===l(i,e,r)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let s=0;for(let r=0;r<n.length;r++){const o=n[r],a=h(o);"number"==typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+s,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=o.elements[0],i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=o.elements[0],i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=o.elements[0]):(o.toArray(i.__data,s),s+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),r[i.id]=f)},dispose:function(){for(const e in s)t.deleteBuffer(s[e]);o=[],s={},r={}}}}function yp(){const t=Qa("canvas");return t.style.display="block",t}class bp{constructor(t={}){const{canvas:e=yp(),context:i=null,depth:n=!0,stencil:s=!0,alpha:r=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:c=!1}=t;let d;this.isWebGLRenderer=!0,d=null!==i?i.getContextAttributes().alpha:r;const u=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=wa,this._useLegacyLights=!1,this.toneMapping=Fo,this.toneMappingExposure=1;const _=this;let x=!1,y=0,b=0,M=null,S=-1,w=null;const T=new gl,E=new gl;let A=null;const C=new Vh(0);let P=0,L=e.width,R=e.height,D=1,I=null,k=null;const O=new gl(0,0,L,R),N=new gl(0,0,L,R);let U=!1;const B=new Vc;let F=!1,z=!1,H=null;const V=new Jl,G=new Ka,W=new Ml,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===M?D:1}let Y,q,K,Z,$,J,Q,tt,et,it,nt,st,rt,ot,at,lt,ht,ct,dt,ut,pt,ft,mt,gt,vt=i;function _t(t,i){for(let n=0;n<t.length;n++){const s=t[n],r=e.getContext(s,i);if(null!==r)return r}return null}try{const t={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Ro}`),e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",Mt,!1),e.addEventListener("webglcontextcreationerror",St,!1),null===vt){const e=["webgl2","webgl","experimental-webgl"];if(!0===_.isWebGL1Renderer&&e.shift(),vt=_t(e,t),null===vt)throw _t(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&vt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===vt.getShaderPrecisionFormat&&(vt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function xt(){Y=new gd(vt),q=new Qc(vt,Y,t),Y.init(q),ft=new dp(vt,Y,q),K=new hp(vt,Y,q),Z=new xd(vt),$=new Ku,J=new cp(vt,Y,K,$,q,ft,Z),Q=new ed(_),tt=new md(_),et=new Wc(vt,q),mt=new $c(vt,Y,et,q),it=new vd(vt,et,Z,mt),nt=new Sd(vt,it,et,Z),dt=new Md(vt,q,J),lt=new td($),st=new qu(_,Q,tt,Y,q,mt,lt),rt=new _p(_,$),ot=new Qu,at=new rp(Y,q),ct=new Zc(_,Q,tt,K,nt,d,a),ht=new lp(_,nt,q),gt=new xp(vt,Z,q,K),ut=new Jc(vt,Y,Z,q),pt=new _d(vt,Y,Z,q),Z.programs=st.programs,_.capabilities=q,_.extensions=Y,_.properties=$,_.renderLists=ot,_.shadowMap=ht,_.state=K,_.info=Z}xt();const yt=new vp(_,vt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Mt(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=Z.autoReset,e=ht.enabled,i=ht.autoUpdate,n=ht.needsUpdate,s=ht.type;xt(),Z.autoReset=t,ht.enabled=e,ht.autoUpdate=i,ht.needsUpdate=n,ht.type=s}function St(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function wt(t){const e=t.target;e.removeEventListener("dispose",wt),function(t){(function(t){const e=$.get(t).programs;void 0!==e&&(e.forEach((function(t){st.releaseProgram(t)})),t.isShaderMaterial&&st.releaseShaderCache(t))})(t),$.remove(t)}(e)}this.xr=yt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=Y.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Y.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(L,R,!1))},this.getSize=function(t){return t.set(L,R)},this.setSize=function(t,i,n=!0){yt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=t,R=i,e.width=Math.floor(t*D),e.height=Math.floor(i*D),!0===n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(L*D,R*D).floor()},this.setDrawingBufferSize=function(t,i,n){L=t,R=i,D=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(T)},this.getViewport=function(t){return t.copy(O)},this.setViewport=function(t,e,i,n){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,i,n),K.viewport(T.copy(O).multiplyScalar(D).floor())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,i,n){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,i,n),K.scissor(E.copy(N).multiplyScalar(D).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){K.setScissorTest(U=t)},this.setOpaqueSort=function(t){I=t},this.setTransparentSort=function(t){k=t},this.getClearColor=function(t){return t.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;if(t){let t=!1;if(null!==M){const e=M.texture.format;t=1033===e||1031===e||1029===e}if(t){const t=M.texture.type,e=t===na||t===ra||t===sa||t===la||1017===t||1018===t,i=ct.getClearColor(),n=ct.getClearAlpha(),s=i.r,r=i.g,o=i.b;e?(u[0]=s,u[1]=r,u[2]=o,u[3]=n,vt.clearBufferuiv(vt.COLOR,0,u)):(p[0]=s,p[1]=r,p[2]=o,p[3]=n,vt.clearBufferiv(vt.COLOR,0,p))}else n|=vt.COLOR_BUFFER_BIT}e&&(n|=vt.DEPTH_BUFFER_BIT),i&&(n|=vt.STENCIL_BUFFER_BIT),vt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",Mt,!1),e.removeEventListener("webglcontextcreationerror",St,!1),ot.dispose(),at.dispose(),$.dispose(),Q.dispose(),tt.dispose(),nt.dispose(),mt.dispose(),gt.dispose(),st.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",Et),yt.removeEventListener("sessionend",At),H&&(H.dispose(),H=null),Ct.stop()},this.renderBufferDirect=function(t,e,i,n,s,r){null===e&&(e=j);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=function(t,e,i,n,s){!0!==e.isScene&&(e=j),J.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===M?_.outputColorSpace:!0===M.isXRRenderTarget?M.texture.colorSpace:Ta,l=(n.isMeshStandardMaterial?tt:Q).get(n.envMap||o),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!i.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),d=!!i.morphAttributes.position,u=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let f=Fo;n.toneMapped&&(null!==M&&!0!==M.isXRRenderTarget||(f=_.toneMapping));const g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==g?g.length:0,x=$.get(n),y=m.state.lights;if(!0===F&&(!0===z||t!==w)){const e=t===w&&n.id===S;lt.setState(n,t,e)}let b=!1;n.version===x.__version?x.needsLights&&x.lightsStateVersion!==y.state.version||x.outputColorSpace!==a||s.isInstancedMesh&&!1===x.instancing?b=!0:s.isInstancedMesh||!0!==x.instancing?s.isSkinnedMesh&&!1===x.skinning?b=!0:s.isSkinnedMesh||!0!==x.skinning?s.isInstancedMesh&&!0===x.instancingColor&&null===s.instanceColor||s.isInstancedMesh&&!1===x.instancingColor&&null!==s.instanceColor||x.envMap!==l||!0===n.fog&&x.fog!==r?b=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===lt.numPlanes&&x.numIntersection===lt.numIntersection?(x.vertexAlphas!==h||x.vertexTangents!==c||x.morphTargets!==d||x.morphNormals!==u||x.morphColors!==p||x.toneMapping!==f||!0===q.isWebGL2&&x.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,x.__version=n.version);let T=x.currentProgram;!0===b&&(T=It(n,e,s));let E=!1,A=!1,C=!1;const P=T.getUniforms(),L=x.uniforms;if(K.useProgram(T.program)&&(E=!0,A=!0,C=!0),n.id!==S&&(S=n.id,A=!0),E||w!==t){if(P.setValue(vt,"projectionMatrix",t.projectionMatrix),q.logarithmicDepthBuffer&&P.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,A=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=P.map.cameraPosition;void 0!==e&&e.setValue(vt,W.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&P.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||s.isSkinnedMesh)&&P.setValue(vt,"viewMatrix",t.matrixWorldInverse)}if(s.isSkinnedMesh){P.setOptional(vt,s,"bindMatrix"),P.setOptional(vt,s,"bindMatrixInverse");const t=s.skeleton;t&&(q.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(vt,"boneTexture",t.boneTexture,J),P.setValue(vt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const I=i.morphAttributes;var k,O;if((void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===q.isWebGL2)&&dt.update(s,i,T),(A||x.receiveShadow!==s.receiveShadow)&&(x.receiveShadow=s.receiveShadow,P.setValue(vt,"receiveShadow",s.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(L.envMap.value=l,L.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),A&&(P.setValue(vt,"toneMappingExposure",_.toneMappingExposure),x.needsLights&&(O=C,(k=L).ambientLightColor.needsUpdate=O,k.lightProbe.needsUpdate=O,k.directionalLights.needsUpdate=O,k.directionalLightShadows.needsUpdate=O,k.pointLights.needsUpdate=O,k.pointLightShadows.needsUpdate=O,k.spotLights.needsUpdate=O,k.spotLightShadows.needsUpdate=O,k.rectAreaLights.needsUpdate=O,k.hemisphereLights.needsUpdate=O),r&&!0===n.fog&&rt.refreshFogUniforms(L,r),rt.refreshMaterialUniforms(L,n,D,R,H),Au.upload(vt,x.uniformsList,L,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Au.upload(vt,x.uniformsList,L,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&P.setValue(vt,"center",s.center),P.setValue(vt,"modelViewMatrix",s.modelViewMatrix),P.setValue(vt,"normalMatrix",s.normalMatrix),P.setValue(vt,"modelMatrix",s.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(q.isWebGL2){const i=t[e];gt.update(i,T),gt.bind(i,T)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return T}(t,e,i,n,s);K.setMaterial(n,o);let l=i.index,h=1;if(!0===n.wireframe){if(l=it.getWireframeAttribute(i),void 0===l)return;h=2}const c=i.drawRange,d=i.attributes.position;let u=c.start*h,p=(c.start+c.count)*h;null!==r&&(u=Math.max(u,r.start*h),p=Math.min(p,(r.start+r.count)*h)),null!==l?(u=Math.max(u,0),p=Math.min(p,l.count)):null!=d&&(u=Math.max(u,0),p=Math.min(p,d.count));const f=p-u;if(f<0||f===1/0)return;let g;mt.setup(s,n,a,i,l);let v=ut;if(null!==l&&(g=et.get(l),v=pt,v.setIndex(g)),s.isMesh)!0===n.wireframe?(K.setLineWidth(n.wireframeLinewidth*X()),v.setMode(vt.LINES)):v.setMode(vt.TRIANGLES);else if(s.isLine){let t=n.linewidth;void 0===t&&(t=1),K.setLineWidth(t*X()),s.isLineSegments?v.setMode(vt.LINES):s.isLineLoop?v.setMode(vt.LINE_LOOP):v.setMode(vt.LINE_STRIP)}else s.isPoints?v.setMode(vt.POINTS):s.isSprite&&v.setMode(vt.TRIANGLES);if(s.isInstancedMesh)v.renderInstances(u,f,s.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);v.renderInstances(u,f,e)}else v.render(u,f)},this.compile=function(t,e){function i(t,e,i){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,It(t,e,i),t.side=0,t.needsUpdate=!0,It(t,e,i),t.side=2):It(t,e,i)}m=at.get(t),m.init(),v.push(m),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))})),m.setupLights(_._useLegacyLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let s=0;s<n.length;s++)i(n[s],t,e);else i(n,t,e)})),v.pop(),m=null};let Tt=null;function Et(){Ct.stop()}function At(){Ct.start()}const Ct=new Gc;function Pt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=nt.update(t),s=t.material;s.visible&&f.push(t,e,s,i,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||B.intersectsObject(t))){const e=nt.update(t),s=t.material;if(n&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)),W.applyMatrix4(t.matrixWorld).applyMatrix4(V)),Array.isArray(s)){const n=e.groups;for(let r=0,o=n.length;r<o;r++){const o=n[r],a=s[o.materialIndex];a&&a.visible&&f.push(t,e,a,i,W.z,o)}}else s.visible&&f.push(t,e,s,i,W.z,null)}const s=t.children;for(let t=0,r=s.length;t<r;t++)Pt(s[t],e,i,n)}function Lt(t,e,i,n){const s=t.opaque,r=t.transmissive,o=t.transparent;m.setupLightsView(i),!0===F&&lt.setGlobalState(_.clippingPlanes,i),r.length>0&&function(t,e,i,n){const s=q.isWebGL2;null===H&&(H=new _l(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?aa:na,minFilter:ia,samples:s?4:0})),_.getDrawingBufferSize(G),s?H.setSize(G.x,G.y):H.setSize(Ga(G.x),Ga(G.y));const r=_.getRenderTarget();_.setRenderTarget(H),_.getClearColor(C),P=_.getClearAlpha(),P<1&&_.setClearColor(16777215,.5),_.clear();const o=_.toneMapping;_.toneMapping=Fo,Rt(t,i,n),J.updateMultisampleRenderTarget(H),J.updateRenderTargetMipmap(H);let a=!1;for(let t=0,s=e.length;t<s;t++){const s=e[t],r=s.object,o=s.geometry,l=s.material,h=s.group;if(2===l.side&&r.layers.test(n.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Dt(r,i,n,o,l,h),l.side=t,l.needsUpdate=!0,a=!0}}!0===a&&(J.updateMultisampleRenderTarget(H),J.updateRenderTargetMipmap(H)),_.setRenderTarget(r),_.setClearColor(C,P),_.toneMapping=o}(s,r,e,i),n&&K.viewport(T.copy(n)),s.length>0&&Rt(s,e,i),r.length>0&&Rt(r,e,i),o.length>0&&Rt(o,e,i),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Rt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let s=0,r=t.length;s<r;s++){const r=t[s],o=r.object,a=r.geometry,l=null===n?r.material:n,h=r.group;o.layers.test(i.layers)&&Dt(o,e,i,a,l,h)}}function Dt(t,e,i,n,s,r){t.onBeforeRender(_,e,i,n,s,r),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),s.onBeforeRender(_,e,i,n,t,r),!0===s.transparent&&2===s.side&&!1===s.forceSinglePass?(s.side=1,s.needsUpdate=!0,_.renderBufferDirect(i,e,n,s,t,r),s.side=0,s.needsUpdate=!0,_.renderBufferDirect(i,e,n,s,t,r),s.side=2):_.renderBufferDirect(i,e,n,s,t,r),t.onAfterRender(_,e,i,n,s,r)}function It(t,e,i){!0!==e.isScene&&(e=j);const n=$.get(t),s=m.state.lights,r=m.state.shadowsArray,o=s.state.version,a=st.getParameters(t,s.state,r,e,i),l=st.getProgramCacheKey(a);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",wt),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===o)return kt(t,a),c}else a.uniforms=st.getUniforms(t),t.onBuild(i,a,_),t.onBeforeCompile(a,_),c=st.acquireProgram(a,l),h.set(l,c),n.uniforms=a.uniforms;const d=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(d.clippingPlanes=lt.uniform),kt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(d.ambientLightColor.value=s.state.ambient,d.lightProbe.value=s.state.probe,d.directionalLights.value=s.state.directional,d.directionalLightShadows.value=s.state.directionalShadow,d.spotLights.value=s.state.spot,d.spotLightShadows.value=s.state.spotShadow,d.rectAreaLights.value=s.state.rectArea,d.ltc_1.value=s.state.rectAreaLTC1,d.ltc_2.value=s.state.rectAreaLTC2,d.pointLights.value=s.state.point,d.pointLightShadows.value=s.state.pointShadow,d.hemisphereLights.value=s.state.hemi,d.directionalShadowMap.value=s.state.directionalShadowMap,d.directionalShadowMatrix.value=s.state.directionalShadowMatrix,d.spotShadowMap.value=s.state.spotShadowMap,d.spotLightMatrix.value=s.state.spotLightMatrix,d.spotLightMap.value=s.state.spotLightMap,d.pointShadowMap.value=s.state.pointShadowMap,d.pointShadowMatrix.value=s.state.pointShadowMatrix);const u=c.getUniforms(),p=Au.seqWithValue(u.seq,d);return n.currentProgram=c,n.uniformsList=p,c}function kt(t,e){const i=$.get(t);i.outputColorSpace=e.outputColorSpace,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Ct.setAnimationLoop((function(t){Tt&&Tt(t)})),"undefined"!=typeof self&&Ct.setContext(self),this.setAnimationLoop=function(t){Tt=t,yt.setAnimationLoop(t),null===t?Ct.stop():Ct.start()},yt.addEventListener("sessionstart",Et),yt.addEventListener("sessionend",At),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===yt.enabled&&!0===yt.isPresenting&&(!0===yt.cameraAutoUpdate&&yt.updateCamera(e),e=yt.getCamera()),!0===t.isScene&&t.onBeforeRender(_,t,e,M),m=at.get(t,v.length),m.init(),v.push(m),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(V),z=this.localClippingEnabled,F=lt.init(this.clippingPlanes,z),f=ot.get(t,g.length),f.init(),g.push(f),Pt(t,e,0,_.sortObjects),f.finish(),!0===_.sortObjects&&f.sort(I,k),this.info.render.frame++,!0===F&&lt.beginShadows();const i=m.state.shadowsArray;if(ht.render(i,t,e),!0===F&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ct.render(f,t),m.setupLights(_._useLegacyLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Lt(f,t,n,n.viewport)}}else Lt(f,t,e);null!==M&&(J.updateMultisampleRenderTarget(M),J.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(_,t,e),mt.resetDefaultState(),S=-1,w=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,i){$.get(t.texture).__webglTexture=e,$.get(t.depthTexture).__webglTexture=i;const n=$.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=$.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){M=t,y=e,b=i;let n=!0,s=null,r=!1,o=!1;if(t){const a=$.get(t);void 0!==a.__useDefaultFramebuffer?(K.bindFramebuffer(vt.FRAMEBUFFER,null),n=!1):void 0===a.__webglFramebuffer?J.setupRenderTarget(t):a.__hasExternalTextures&&J.rebindTextures(t,$.get(t.texture).__webglTexture,$.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const h=$.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(s=Array.isArray(h[e])?h[e][i]:h[e],r=!0):s=q.isWebGL2&&t.samples>0&&!1===J.useMultisampledRTT(t)?$.get(t).__webglMultisampledFramebuffer:Array.isArray(h)?h[i]:h,T.copy(t.viewport),E.copy(t.scissor),A=t.scissorTest}else T.copy(O).multiplyScalar(D).floor(),E.copy(N).multiplyScalar(D).floor(),A=U;if(K.bindFramebuffer(vt.FRAMEBUFFER,s)&&q.drawBuffers&&n&&K.drawBuffers(t,s),K.viewport(T),K.scissor(E),K.setScissorTest(A),r){const n=$.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(o){const n=$.get(t.texture),s=e||0;vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,s)}S=-1},this.readRenderTargetPixels=function(t,e,i,n,s,r,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){K.bindFramebuffer(vt.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==ha&&ft.convert(a)!==vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===aa&&(Y.has("EXT_color_buffer_half_float")||q.isWebGL2&&Y.has("EXT_color_buffer_float"));if(!(l===na||ft.convert(l)===vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_TYPE)||l===oa&&(q.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-s&&vt.readPixels(e,i,n,s,ft.convert(a),ft.convert(l),r)}finally{const t=null!==M?$.get(M).__webglFramebuffer:null;K.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),s=Math.floor(e.image.width*n),r=Math.floor(e.image.height*n);J.setTexture2D(e,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,i,0,0,t.x,t.y,s,r),K.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const s=e.image.width,r=e.image.height,o=ft.convert(i.format),a=ft.convert(i.type);J.setTexture2D(i,0),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,i.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,s,r,o,a,e.image.data):e.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):vt.texSubImage2D(vt.TEXTURE_2D,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&vt.generateMipmap(vt.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,s=0){if(_.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const r=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=ft.convert(n.format),h=ft.convert(n.type);let c;if(n.isData3DTexture)J.setTexture3D(n,0),c=vt.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(n,0),c=vt.TEXTURE_2D_ARRAY}vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,n.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,n.unpackAlignment);const d=vt.getParameter(vt.UNPACK_ROW_LENGTH),u=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),p=vt.getParameter(vt.UNPACK_SKIP_PIXELS),f=vt.getParameter(vt.UNPACK_SKIP_ROWS),m=vt.getParameter(vt.UNPACK_SKIP_IMAGES),g=i.isCompressedTexture?i.mipmaps[0]:i.image;vt.pixelStorei(vt.UNPACK_ROW_LENGTH,g.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,g.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,t.min.x),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,t.min.y),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?vt.texSubImage3D(c,s,e.x,e.y,e.z,r,o,a,l,h,g.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),vt.compressedTexSubImage3D(c,s,e.x,e.y,e.z,r,o,a,l,g.data)):vt.texSubImage3D(c,s,e.x,e.y,e.z,r,o,a,l,h,g),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,d),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,u),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,p),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,f),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,m),0===s&&n.generateMipmaps&&vt.generateMipmap(c),K.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?J.setTextureCube(t,0):t.isData3DTexture?J.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?J.setTexture2DArray(t,0):J.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){y=0,b=0,M=null,K.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ra}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===wa?Sa:3e3}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===Sa?wa:Ta}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}(class extends bp{}).prototype.isWebGL1Renderer=!0;class Mp extends Sh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class Sp{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Ca,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ua()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ua()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ua()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const wp=new Ml;class Tp{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)wp.fromBufferAttribute(this,e),wp.applyMatrix4(t),this.setXYZ(e,wp.x,wp.y,wp.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)wp.fromBufferAttribute(this,e),wp.applyNormalMatrix(t),this.setXYZ(e,wp.x,wp.y,wp.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)wp.fromBufferAttribute(this,e),wp.transformDirection(t),this.setXYZ(e,wp.x,wp.y,wp.z);return this}setX(t,e){return this.normalized&&(e=ja(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ja(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ja(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ja(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Wa(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Wa(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Wa(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Wa(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array),n=ja(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ja(e,this.array),i=ja(i,this.array),n=ja(n,this.array),s=ja(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new Yh(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Tp(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Ep=new Ml,Ap=new gl,Cp=new gl,Pp=new Ml,Lp=new Jl,Rp=new Ml,Dp=new Gl,Ip=new Jl,kp=new $l;class Op extends Mc{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Jl,this.bindMatrixInverse=new Jl,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Tl),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)Rp.fromBufferAttribute(e,t),this.applyBoneTransform(t,Rp),this.boundingBox.expandByPoint(Rp)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Gl),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)Rp.fromBufferAttribute(e,t),this.applyBoneTransform(t,Rp),this.boundingSphere.expandByPoint(Rp)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),Dp.copy(this.boundingSphere),Dp.applyMatrix4(n),!1!==t.ray.intersectsSphere(Dp)&&(Ip.copy(n).invert(),kp.copy(t.ray).applyMatrix4(Ip),null!==this.boundingBox&&!1===kp.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,kp)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new gl,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,n=this.geometry;Ap.fromBufferAttribute(n.attributes.skinIndex,t),Cp.fromBufferAttribute(n.attributes.skinWeight,t),Ep.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Cp.getComponent(t);if(0!==n){const s=Ap.getComponent(t);Lp.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),e.addScaledVector(Pp.copy(Ep).applyMatrix4(Lp),n)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class Np extends Sh{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Up extends ml{constructor(t=null,e=1,i=1,n,s,r,o,a,l=1003,h=1003,c,d){super(null,r,o,a,l,h,n,s,c,d),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Bp=new Jl,Fp=new Jl;class zp{constructor(t=[],e=[]){this.uuid=Ua(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Jl)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Jl;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=t.length;n<s;n++){const s=t[n]?t[n].matrixWorld:Fp;Bp.multiplyMatrices(s,e[n]),Bp.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new zp(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Va(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Up(e,t,t,ha,oa);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let s=e[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Np),this.bones.push(s),this.boneInverses.push((new Jl).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,s=e.length;n<s;n++){const s=e[n];t.bones.push(s.uuid);const r=i[n];t.boneInverses.push(r.toArray())}return t}}class Hp extends Yh{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Vp=new Jl,Gp=new Jl,Wp=[],jp=new Tl,Xp=new Jl,Yp=new Mc,qp=new Gl;class Kp extends Mc{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Hp(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,Xp)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Tl),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Vp),jp.copy(t.boundingBox).applyMatrix4(Vp),this.boundingBox.union(jp)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Gl),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Vp),qp.copy(t.boundingSphere).applyMatrix4(Vp),this.boundingSphere.union(qp)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Yp.geometry=this.geometry,Yp.material=this.material,void 0!==Yp.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),qp.copy(this.boundingSphere),qp.applyMatrix4(i),!1!==t.ray.intersectsSphere(qp)))for(let s=0;s<n;s++){this.getMatrixAt(s,Vp),Gp.multiplyMatrices(i,Vp),Yp.matrixWorld=Gp,Yp.raycast(t,Wp);for(let t=0,i=Wp.length;t<i;t++){const i=Wp[t];i.instanceId=s,i.object=this,e.push(i)}Wp.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Hp(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Zp extends Uh{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vh(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const $p=new Ml,Jp=new Ml,Qp=new Jl,tf=new $l,ef=new Gl;class nf extends Sh{constructor(t=new sc,e=new Zp){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)$p.fromBufferAttribute(e,t-1),Jp.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=$p.distanceTo(Jp);t.setAttribute("lineDistance",new Zh(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ef.copy(i.boundingSphere),ef.applyMatrix4(n),ef.radius+=s,!1===t.ray.intersectsSphere(ef))return;Qp.copy(n).invert(),tf.copy(t.ray).applyMatrix4(Qp);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Ml,h=new Ml,c=new Ml,d=new Ml,u=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p)for(let i=Math.max(0,r.start),n=Math.min(p.count,r.start+r.count)-1;i<n;i+=u){const n=p.getX(i),s=p.getX(i+1);if(l.fromBufferAttribute(f,n),h.fromBufferAttribute(f,s),tf.distanceSqToSegment(l,h,d,c)>a)continue;d.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(d);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,r.start),n=Math.min(f.count,r.start+r.count)-1;i<n;i+=u){if(l.fromBufferAttribute(f,i),h.fromBufferAttribute(f,i+1),tf.distanceSqToSegment(l,h,d,c)>a)continue;d.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(d);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const sf=new Ml,rf=new Ml;class of extends nf{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)sf.fromBufferAttribute(e,t),rf.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+sf.distanceTo(rf);t.setAttribute("lineDistance",new Zh(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class af extends nf{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class lf extends Uh{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Vh(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const hf=new Jl,cf=new $l,df=new Gl,uf=new Ml;class pf extends Sh{constructor(t=new sc,e=new lf){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),df.copy(i.boundingSphere),df.applyMatrix4(n),df.radius+=s,!1===t.ray.intersectsSphere(df))return;hf.copy(n).invert(),cf.copy(t.ray).applyMatrix4(hf);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=i.index,h=i.attributes.position;if(null!==l)for(let i=Math.max(0,r.start),s=Math.min(l.count,r.start+r.count);i<s;i++){const s=l.getX(i);uf.fromBufferAttribute(h,s),ff(uf,s,a,n,t,e,this)}else for(let i=Math.max(0,r.start),s=Math.min(h.count,r.start+r.count);i<s;i++)uf.fromBufferAttribute(h,i),ff(uf,i,a,n,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function ff(t,e,i,n,s,r,o){const a=cf.distanceSqToPoint(t);if(a<i){const i=new Ml;cf.closestPointToPoint(t,i),i.applyMatrix4(n);const l=s.ray.origin.distanceTo(i);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}class mf{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=t;r++)i=this.getPoint(r/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let r;r=e||t*i[s-1];let o,a=0,l=s-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-r,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(s-1);const h=i[n];return(n+(r-h)/(i[n+1]-h))/(s-1)}getTangent(t,e){const i=1e-4;let n=t-i,s=t+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=e||(r.isVector2?new Ka:new Ml);return a.copy(o).sub(r).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Ml,n=[],s=[],r=[],o=new Ml,a=new Jl;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Ml)}s[0]=new Ml,r[0]=new Ml;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),d=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),d<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let e=1;e<=t;e++){if(s[e]=s[e-1].clone(),r[e]=r[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Ba(n[e-1].dot(n[e]),-1,1));s[e].applyMatrix4(a.makeRotationAxis(o,t))}r[e].crossVectors(n[e],s[e])}if(!0===e){let e=Math.acos(Ba(s[0].dot(s[t]),-1,1));e/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(e=-e);for(let i=1;i<=t;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class gf extends Uh{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Vh(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class vf extends gf{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ka(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ba(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Vh(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Vh(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Vh(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class _f extends Uh{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vh(16777215),this.specular=new Vh(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=No,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class xf extends Uh{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class yf extends Uh{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vh(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vh(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=No,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class bf extends Uh{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Vh(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ka(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}function Mf(t,e,i){return wf(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)}function Sf(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function wf(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Tf(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function Ef(t,e,i){const n=t.length,s=new t.constructor(n);for(let r=0,o=0;o!==n;++r){const n=i[r]*e;for(let i=0;i!==e;++i)s[o++]=t[n+i]}return s}function Af(t,e,i,n){let s=1,r=t[0];for(;void 0!==r&&void 0===r[n];)r=t[s++];if(void 0===r)return;let o=r[n];if(void 0!==o)if(Array.isArray(o))do{o=r[n],void 0!==o&&(e.push(r.time),i.push.apply(i,o)),r=t[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[n],void 0!==o&&(e.push(r.time),o.toArray(i,i.length)),r=t[s++]}while(void 0!==r);else do{o=r[n],void 0!==o&&(e.push(r.time),i.push(o)),r=t[s++]}while(void 0!==r)}class Cf{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let r;i:{n:if(!(t<n)){for(let r=i+2;;){if(void 0===n){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}r=e.length;break i}if(t>=s)break t;{const o=e[1];t<o&&(i=2,s=o);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===r)break;if(n=s,s=e[--i-1],t>=s)break e}r=i,i=0}}for(;i<r;){const n=i+r>>>1;t<e[n]?r=n:i=n+1}if(n=e[i],s=e[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let t=0;t!==n;++t)e[t]=i[s+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Pf extends Cf{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ya,endingEnd:ya}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,r=t+1,o=n[s],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case ba:s=t,o=2*e-i;break;case Ma:s=n.length-2,o=e+n[s]-n[s+1];break;default:s=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case ba:r=t,a=2*i-e;break;case Ma:r=1,a=i+n[1]-n[0];break;default:r=t-1,a=e}const l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-i),this._offsetPrev=s*h,this._offsetNext=r*h}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,_=(-1-u)*m+(1.5+u)*f+.5*p,x=u*m-u*f;for(let t=0;t!==o;++t)s[t]=g*r[h+t]+v*r[l+t]+_*r[a+t]+x*r[c+t];return s}}class Lf extends Cf{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==o;++t)s[t]=r[l+t]*c+r[a+t]*h;return s}}class Rf extends Cf{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Df{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Sf(e,this.TimeBufferType),this.values=Sf(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Sf(t.times,Array),values:Sf(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Rf(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Lf(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Pf(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case va:e=this.InterpolantFactoryMethodDiscrete;break;case _a:e=this.InterpolantFactoryMethodLinear;break;case xa:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return va;case this.InterpolantFactoryMethodLinear:return _a;case this.InterpolantFactoryMethodSmooth:return xa}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<t;)++s;for(;-1!==r&&i[r]>e;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const t=this.getValueSize();this.times=Mf(i,s,r),this.values=Mf(this.values,s*t,r*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let e=0;e!==s;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==r&&r>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,r),t=!1;break}r=n}if(void 0!==n&&wf(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Mf(this.times),e=Mf(this.values),i=this.getValueSize(),n=this.getInterpolation()===xa,s=t.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)s=!0;else{const t=o*i,n=t-i,r=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[r+o]){s=!0;break}}}if(s){if(o!==r){t[r]=t[o];const n=o*i,s=r*i;for(let t=0;t!==i;++t)e[s+t]=e[n+t]}++r}}if(s>0){t[r]=t[s];for(let t=s*i,n=r*i,o=0;o!==i;++o)e[n+o]=e[t+o];++r}return r!==t.length?(this.times=Mf(t,0,r),this.values=Mf(e,0,r*i)):(this.times=t,this.values=e),this}clone(){const t=Mf(this.times,0),e=Mf(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Df.prototype.TimeBufferType=Float32Array,Df.prototype.ValueBufferType=Float32Array,Df.prototype.DefaultInterpolation=_a;class If extends Df{}If.prototype.ValueTypeName="bool",If.prototype.ValueBufferType=Array,If.prototype.DefaultInterpolation=va,If.prototype.InterpolantFactoryMethodLinear=void 0,If.prototype.InterpolantFactoryMethodSmooth=void 0;class kf extends Df{}kf.prototype.ValueTypeName="color";class Of extends Df{}Of.prototype.ValueTypeName="number";class Nf extends Cf{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let l=t*o;for(let t=l+o;l!==t;l+=4)bl.slerpFlat(s,0,r,l-o,r,l,a);return s}}class Uf extends Df{InterpolantFactoryMethodLinear(t){return new Nf(this.times,this.values,this.getValueSize(),t)}}Uf.prototype.ValueTypeName="quaternion",Uf.prototype.DefaultInterpolation=_a,Uf.prototype.InterpolantFactoryMethodSmooth=void 0;class Bf extends Df{}Bf.prototype.ValueTypeName="string",Bf.prototype.ValueBufferType=Array,Bf.prototype.DefaultInterpolation=va,Bf.prototype.InterpolantFactoryMethodLinear=void 0,Bf.prototype.InterpolantFactoryMethodSmooth=void 0;class Ff extends Df{}Ff.prototype.ValueTypeName="vector";class zf{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Ua(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,s=i.length;t!==s;++t)e.push(Hf(i[t]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Df.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,r=[];for(let t=0;t<s;t++){let o=[],a=[];o.push((t+s-1)%s,t,(t+1)%s),a.push(0,1,0);const l=Tf(o);o=Ef(o,1,l),a=Ef(a,1,l),n||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new Of(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,r)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.name.match(s);if(r&&r.length>1){const t=r[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const r=[];for(const t in n)r.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return r}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,s){if(0!==i.length){const r=[],o=[];Af(i,r,o,n),0!==r.length&&s.push(new t(e,r,o))}},n=[],s=t.name||"default",r=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const s=l[t].keys;if(s&&0!==s.length)if(s[0].morphTargets){const t={};let e;for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let i=0;i<s[e].morphTargets.length;i++)t[s[e].morphTargets[i]]=-1;for(const i in t){const t=[],r=[];for(let n=0;n!==s[e].morphTargets.length;++n){const n=s[e];t.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new Of(".morphTargetInfluence["+i+"]",t,r))}a=t.length*r}else{const r=".bones["+e[t].name+"]";i(Ff,r+".position",s,"pos",n),i(Uf,r+".quaternion",s,"rot",n),i(Ff,r+".scale",s,"scl",n)}}return 0===n.length?null:new this(s,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Hf(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Of;case"vector":case"vector2":case"vector3":case"vector4":return Ff;case"color":return kf;case"quaternion":return Uf;case"bool":case"boolean":return If;case"string":return Bf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Af(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Vf={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Gf{constructor(t,e,i){const n=this;let s,r=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==n.onStart&&n.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const Wf=new Gf;class jf{constructor(t){this.manager=void 0!==t?t:Wf,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,s){i.load(t,n,e,s)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}jf.DEFAULT_MATERIAL_NAME="__DEFAULT";const Xf={};class Yf extends Error{constructor(t,e){super(t),this.response=e}}class qf extends jf{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Vf.get(t);if(void 0!==s)return this.manager.itemStart(t),setTimeout((()=>{e&&e(s),this.manager.itemEnd(t)}),0),s;if(void 0!==Xf[t])return void Xf[t].push({onLoad:e,onProgress:i,onError:n});Xf[t]=[],Xf[t].push({onLoad:e,onProgress:i,onError:n});const r=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(r).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=Xf[t],n=e.body.getReader(),s=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),r=s?parseInt(s):0,o=0!==r;let a=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:s})=>{if(n)t.close();else{a+=s.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:r});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(s),e()}}))}()}});return new Response(l)}throw new Yf(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{Vf.add(t,e);const i=Xf[t];delete Xf[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=Xf[t];if(void 0===i)throw this.manager.itemError(t),e;delete Xf[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Kf extends jf{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=Vf.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const o=Qa("img");function a(){h(),Vf.add(t,this),e&&e(this),s.manager.itemEnd(t)}function l(e){h(),n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)}function h(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class Zf extends jf{constructor(t){super(t)}load(t,e,i,n){const s=new ml,r=new Kf(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,(function(t){s.image=t,s.needsUpdate=!0,void 0!==e&&e(s)}),i,n),s}}class $f extends Sh{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Vh(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}const Jf=new Jl,Qf=new Ml,tm=new Ml;class em{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ka(512,512),this.map=null,this.mapPass=null,this.matrix=new Jl,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vc,this._frameExtents=new Ka(1,1),this._viewportCount=1,this._viewports=[new gl(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Qf.setFromMatrixPosition(t.matrixWorld),e.position.copy(Qf),tm.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(tm),e.updateMatrixWorld(),Jf.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jf),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Jf)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class im extends em{constructor(){super(new Rc(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*Na*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;i===e.fov&&n===e.aspect&&s===e.far||(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class nm extends $f{constructor(t,e,i=0,n=Math.PI/3,s=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sh.DEFAULT_UP),this.updateMatrix(),this.target=new Sh,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.map=null,this.shadow=new im}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const sm=new Jl,rm=new Ml,om=new Ml;class am extends em{constructor(){super(new Rc(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ka(4,2),this._viewportCount=6,this._viewports=[new gl(2,1,1,1),new gl(0,1,1,1),new gl(3,1,1,1),new gl(1,1,1,1),new gl(3,0,1,1),new gl(1,0,1,1)],this._cubeDirections=[new Ml(1,0,0),new Ml(-1,0,0),new Ml(0,0,1),new Ml(0,0,-1),new Ml(0,1,0),new Ml(0,-1,0)],this._cubeUps=[new Ml(0,1,0),new Ml(0,1,0),new Ml(0,1,0),new Ml(0,1,0),new Ml(0,0,1),new Ml(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),rm.setFromMatrixPosition(t.matrixWorld),i.position.copy(rm),om.copy(i.position),om.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(om),i.updateMatrixWorld(),n.makeTranslation(-rm.x,-rm.y,-rm.z),sm.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sm)}}class lm extends $f{constructor(t,e,i=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new am}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class hm extends em{constructor(){super(new id(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class cm extends $f{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sh.DEFAULT_UP),this.updateMatrix(),this.target=new Sh,this.shadow=new hm}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class dm extends $f{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class um{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class pm extends jf{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=Vf.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){Vf.add(t,i),e&&e(i),s.manager.itemEnd(t)})).catch((function(e){n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)})),s.manager.itemStart(t)}}class fm{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=mm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=mm();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function mm(){return("undefined"==typeof performance?Date:performance).now()}class gm{constructor(t,e,i){let n,s,r;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let r=this.cumulativeWeight;if(0===r){for(let t=0;t!==n;++t)i[s+t]=i[t];r=e}else{r+=e;const t=e/r;this._mixBufferRegion(i,s,0,t,n)}this.cumulativeWeight=r}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-s,e)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,s=e+e;t!==s;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,s=n;t!==s;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){bl.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const r=this._workIndex*s;bl.multiplyQuaternionsFlat(t,r,t,e,t,i),bl.slerpFlat(t,e,t,e,t,r,n)}_lerp(t,e,i,n,s){const r=1-n;for(let o=0;o!==s;++o){const s=e+o;t[s]=t[s]*r+t[i+o]*n}}_lerpAdditive(t,e,i,n,s){for(let r=0;r!==s;++r){const s=e+r;t[s]=t[s]+t[i+r]*n}}}const vm="\\[\\]\\.:\\/",_m=new RegExp("["+vm+"]","g"),xm="[^"+vm+"]",ym="[^"+vm.replace("\\.","")+"]",bm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",xm)+/(WCOD+)?/.source.replace("WCOD",ym)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",xm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",xm)+"$"),Mm=["material","materials","bones","map"];class Sm{constructor(t,e,i){this.path=e,this.parsedPath=i||Sm.parseTrackName(e),this.node=Sm.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Sm.Composite(t,e,i):new Sm(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_m,"")}static parseTrackName(t){const e=bm.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Mm.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e||s.uuid===e)return s;const r=i(s.children);if(r)return r}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Sm.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const r=t[n];if(void 0===r){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[s]&&(s=t.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Sm.Composite=class{constructor(t,e,i){const n=i||Sm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Sm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Sm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Sm.prototype.GetterByBindingType=[Sm.prototype._getValue_direct,Sm.prototype._getValue_array,Sm.prototype._getValue_arrayElement,Sm.prototype._getValue_toArray],Sm.prototype.SetterByBindingTypeAndVersioning=[[Sm.prototype._setValue_direct,Sm.prototype._setValue_direct_setNeedsUpdate,Sm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Sm.prototype._setValue_array,Sm.prototype._setValue_array_setNeedsUpdate,Sm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Sm.prototype._setValue_arrayElement,Sm.prototype._setValue_arrayElement_setNeedsUpdate,Sm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Sm.prototype._setValue_fromArray,Sm.prototype._setValue_fromArray_setNeedsUpdate,Sm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wm{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,r=s.length,o=new Array(r),a={endingStart:ya,endingEnd:ya};for(let t=0;t!==r;++t){const e=s[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,s=n/i,r=i/n;t.warp(1,s,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,r=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,a[1]=s+i,l[0]=t/r,l[1]=e/r,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const s=this._startTime;if(null!==s){const n=(t-s)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);const r=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(r),e[i].accumulateAdditive(o);else for(let i=0,s=t.length;i!==s;++i)t[i].evaluate(r),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const r=2202===i;if(0===t)return-1===s?n:r&&1==(1&s)?e-n:n;if(2200===i){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,s+=Math.abs(i);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&1==(1&s))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=ba,n.endingEnd=ba):(n.endingStart=t?this.zeroSlopeAtStart?ba:ya:Ma,n.endingEnd=e?this.zeroSlopeAtEnd?ba:ya:Ma)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=s,a[0]=e,o[1]=s+t,a[1]=i,this}}const Tm=new Float32Array(1);class Em extends Ia{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,r=t._propertyBindings,o=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let h=l[a];void 0===h&&(h={},l[a]=h);for(let t=0;t!==s;++t){const s=n[t],l=s.name;let c=h[l];if(void 0!==c)++c.referenceCount,r[t]=c;else{if(c=r[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,a,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new gm(Sm.create(i,l,n),s.ValueTypeName,s.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,a,l),r[t]=c}o[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let r=s[e];if(void 0===r)r={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=r;else{const e=r.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),r.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,l=a[a.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,a[h]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete r[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[e];void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,o=r[n],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[s],0===Object.keys(o).length&&delete r[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Lf(new Float32Array(2),new Float32Array(2),1,Tm),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let r="string"==typeof t?zf.findByName(n,t):t;const o=null!==r?r.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==r?r.blendMode:2500),void 0!==a){const t=a.actionByRoot[s];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===r&&(r=l._clip)}if(null===r)return null;const h=new wm(this,r,e,i);return this._bindAction(h,l),this._addInactiveAction(h,o,s),h}existingAction(t,e){const i=e||this._root,n=i.uuid,s="string"==typeof t?zf.findByName(i,t):t,r=s?s.uuid:t,o=this._actionsByClip[r];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),r=this._accuIndex^=1;for(let o=0;o!==i;++o)e[o]._update(n,t,s,r);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(r);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const t=s.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const s=n._cacheIndex,r=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,e[s]=r,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Am{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Ba(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ro}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ro);const Cm={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class Pm{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Lm=new id(-1,1,1,-1,0,1),Rm=new sc;Rm.setAttribute("position",new Zh([-1,3,0,-1,-1,0,3,-1,0],3)),Rm.setAttribute("uv",new Zh([0,2,0,0,2,0],2));class Dm{constructor(t){this._mesh=new Mc(Rm,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Lm)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Im extends Pm{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Pc?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Cc.clone(t.uniforms),this.material=new Pc({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Dm(this.material)}render(t,e,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class km extends Pm{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,i){const n=t.getContext(),s=t.state;let r,o;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,o=1):(r=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class Om extends Pm{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class Nm{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===e){const i=t.getSize(new Ka);this._width=i.width,this._height=i.height,(e=new _l(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:aa})).texture.name="EffectComposer.rt1"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Im(Cm),this.copyPass.material.blending=0,this.clock=new fm}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let i=!1;for(let e=0,n=this.passes.length;e<n;e++){const n=this.passes[e];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),n.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),n.needsSwap){if(i){const e=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),i.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==km&&(n instanceof km?i=!0:n instanceof Om&&(i=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new Ka);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(i,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Um extends Pm{constructor(t,e,i,n,s){super(),this.scene=t,this.camera=e,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Vh}render(t,e,i){const n=t.autoClear;let s,r;t.autoClear=!1,void 0!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),s=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,s),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=r),t.autoClear=n}}const Bm={uniforms:{tDiffuse:{value:null},resolution:{value:new Ka(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\tprecision highp float;\n\n\tuniform sampler2D tDiffuse;\n\n\tuniform vec2 resolution;\n\n\tvarying vec2 vUv;\n\n\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t//----------------------------------------------------------------------------------\n\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n\t// SDK Version: v3.00\n\t// Email:       gameworks@nvidia.com\n\t// Site:        http://developer.nvidia.com/\n\t//\n\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t//\n\t// Redistribution and use in source and binary forms, with or without\n\t// modification, are permitted provided that the following conditions\n\t// are met:\n\t//  * Redistributions of source code must retain the above copyright\n\t//    notice, this list of conditions and the following disclaimer.\n\t//  * Redistributions in binary form must reproduce the above copyright\n\t//    notice, this list of conditions and the following disclaimer in the\n\t//    documentation and/or other materials provided with the distribution.\n\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\n\t//    contributors may be used to endorse or promote products derived\n\t//    from this software without specific prior written permission.\n\t//\n\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\n\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t//\n\t//----------------------------------------------------------------------------------\n\n\t#ifndef FXAA_DISCARD\n\t\t\t//\n\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t//\n\t\t\t// 1 = Use discard on pixels which don't need AA.\n\t\t\t//     For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t// 0 = Return unchanged color on pixels which don't need AA.\n\t\t\t//\n\t\t\t#define FXAA_DISCARD 0\n\t#endif\n\n\t/*--------------------------------------------------------------------------*/\n\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\n\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\n\t/*--------------------------------------------------------------------------*/\n\n\t#define NUM_SAMPLES 5\n\n\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\n\tfloat contrast( vec4 a, vec4 b ) {\n\t\t\tvec4 diff = abs( a - b );\n\t\t\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\n\t}\n\n\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\tFXAA3 QUALITY - PC\n\n\t============================================================================*/\n\n\t/*--------------------------------------------------------------------------*/\n\tvec4 FxaaPixelShader(\n\t\t\tvec2 posM,\n\t\t\tsampler2D tex,\n\t\t\tvec2 fxaaQualityRcpFrame,\n\t\t\tfloat fxaaQualityEdgeThreshold,\n\t\t\tfloat fxaaQualityinvEdgeThreshold\n\t) {\n\t\t\tvec4 rgbaM = FxaaTexTop(tex, posM);\n\t\t\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\t// . S .\n\t\t\t// W M E\n\t\t\t// . N .\n\n\t\t\tbool earlyExit = max( max( max(\n\t\t\t\t\tcontrast( rgbaM, rgbaN ),\n\t\t\t\t\tcontrast( rgbaM, rgbaS ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaE ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaW ) )\n\t\t\t\t\t< fxaaQualityEdgeThreshold;\n\t\t\t// . 0 .\n\t\t\t// 0 0 0\n\t\t\t// . 0 .\n\n\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\tif(earlyExit) FxaaDiscard;\n\t\t\t#else\n\t\t\t\t\tif(earlyExit) return rgbaM;\n\t\t\t#endif\n\n\t\t\tfloat contrastN = contrast( rgbaM, rgbaN );\n\t\t\tfloat contrastS = contrast( rgbaM, rgbaS );\n\t\t\tfloat contrastE = contrast( rgbaM, rgbaE );\n\t\t\tfloat contrastW = contrast( rgbaM, rgbaW );\n\n\t\t\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\n\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\tbool horzSpan = relativeVContrast > 0.;\n\t\t\t// . 1 .\n\t\t\t// 0 0 0\n\t\t\t// . 1 .\n\n\t\t\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\n\t\t\tif( abs( relativeVContrast ) < .3 ) {\n\t\t\t\t\t// locate the edge\n\t\t\t\t\tvec2 dirToEdge;\n\t\t\t\t\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\n\t\t\t\t\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\n\t\t\t\t\t// . 2 .      . 1 .\n\t\t\t\t\t// 1 0 2  ~=  0 0 1\n\t\t\t\t\t// . 1 .      . 0 .\n\n\t\t\t\t\t// tap 2 pixels and see which ones are \"outside\" the edge, to\n\t\t\t\t\t// determine if the edge is vertical or horizontal\n\n\t\t\t\t\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\n\t\t\t\t\t// . 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 H\n\n\t\t\t\t\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\n\t\t\t\t\t// V 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 .\n\n\t\t\t\t\trelativeVContrast = matchAlongV - matchAlongH;\n\t\t\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\t\t\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\n\t\t\t\t\t\t\t// 1 1 .\n\t\t\t\t\t\t\t// 0 0 1\n\t\t\t\t\t\t\t// . 0 1\n\n\t\t\t\t\t\t\t// do a simple blur\n\t\t\t\t\t\t\treturn mix(\n\t\t\t\t\t\t\t\t\trgbaM,\n\t\t\t\t\t\t\t\t\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\n\t\t\t\t\t\t\t\t\t.4\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\thorzSpan = relativeVContrast > 0.;\n\t\t\t}\n\n\t\t\tif(!horzSpan) rgbaN = rgbaW;\n\t\t\tif(!horzSpan) rgbaS = rgbaE;\n\t\t\t// . 0 .      1\n\t\t\t// 1 0 1  ->  0\n\t\t\t// . 0 .      1\n\n\t\t\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\n\t\t\tif(!pairN) rgbaN = rgbaS;\n\n\t\t\tvec2 offNP;\n\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\n\t\t\tbool doneN = false;\n\t\t\tbool doneP = false;\n\n\t\t\tfloat nDist = 0.;\n\t\t\tfloat pDist = 0.;\n\n\t\t\tvec2 posN = posM;\n\t\t\tvec2 posP = posM;\n\n\t\t\tint iterationsUsed = 0;\n\t\t\tint iterationsUsedN = 0;\n\t\t\tint iterationsUsedP = 0;\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\n\t\t\t\t\titerationsUsed = i;\n\n\t\t\t\t\tfloat increment = float(i + 1);\n\n\t\t\t\t\tif(!doneN) {\n\t\t\t\t\t\t\tnDist += increment;\n\t\t\t\t\t\t\tposN = posM + offNP * nDist;\n\t\t\t\t\t\t\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\n\t\t\t\t\t\t\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\n\t\t\t\t\t\t\titerationsUsedN = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!doneP) {\n\t\t\t\t\t\t\tpDist += increment;\n\t\t\t\t\t\t\tposP = posM - offNP * pDist;\n\t\t\t\t\t\t\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\n\t\t\t\t\t\t\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\n\t\t\t\t\t\t\titerationsUsedP = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(doneN || doneP) break;\n\t\t\t}\n\n\n\t\t\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\n\n\t\t\tfloat dist = min(\n\t\t\t\t\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\n\t\t\t\t\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\n\t\t\t);\n\n\t\t\t// hacky way of reduces blurriness of mostly diagonal edges\n\t\t\t// but reduces AA quality\n\t\t\tdist = pow(dist, .5);\n\n\t\t\tdist = 1. - dist;\n\n\t\t\treturn mix(\n\t\t\t\t\trgbaM,\n\t\t\t\t\trgbaN,\n\t\t\t\t\tdist * .5\n\t\t\t);\n\t}\n\n\tvoid main() {\n\t\t\tconst float edgeDetectionQuality = .2;\n\t\t\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\n\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\t\tvUv,\n\t\t\t\t\ttDiffuse,\n\t\t\t\t\tresolution,\n\t\t\t\t\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\n\t\t\t\t\tinvEdgeDetectionQuality\n\t\t\t);\n\n\t}\n\t"},Fm={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}"},zm={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Vh(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class Hm extends Pm{constructor(t,e,i,n){super(),this.strength=void 0!==e?e:1,this.radius=i,this.threshold=n,this.resolution=void 0!==t?new Ka(t.x,t.y):new Ka(256,256),this.clearColor=new Vh(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new _l(s,r,{type:aa}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const e=new _l(s,r,{type:aa});e.texture.name="UnrealBloomPass.h"+t,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const i=new _l(s,r,{type:aa});i.texture.name="UnrealBloomPass.v"+t,i.texture.generateMipmaps=!1,this.renderTargetsVertical.push(i),s=Math.round(s/2),r=Math.round(r/2)}const o=zm;this.highPassUniforms=Cc.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Pc({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];const a=[3,5,7,9,11];s=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(a[t])),this.separableBlurMaterials[t].uniforms.invSize.value=new Ka(1/s,1/r),s=Math.round(s/2),r=Math.round(r/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Ml(1,1,1),new Ml(1,1,1),new Ml(1,1,1),new Ml(1,1,1),new Ml(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const l=Cm;this.copyUniforms=Cc.clone(l.uniforms),this.blendMaterial=new Pc({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Vh,this.oldClearAlpha=1,this.basic=new Wh,this.fsQuad=new Dm(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,e){let i=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(i,n);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(i,n),this.renderTargetsVertical[t].setSize(i,n),this.separableBlurMaterials[t].uniforms.invSize.value=new Ka(1/i,1/n),i=Math.round(i/2),n=Math.round(n/2)}render(t,e,i,n,s){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const r=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),s&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[e].uniforms.direction.value=Hm.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=Hm.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=r}getSeperableBlurMaterial(t){const e=[];for(let i=0;i<t;i++)e.push(.39894*Math.exp(-.5*i*i/(t*t))/t);return new Pc({defines:{KERNEL_RADIUS:t},uniforms:{colorTexture:{value:null},invSize:{value:new Ka(.5,.5)},direction:{value:new Ka(.5,.5)},gaussianCoefficients:{value:e}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new Pc({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}Hm.BlurDirectionX=new Ka(1,0),Hm.BlurDirectionY=new Ka(0,1);const Vm={defines:{USE_3DTEXTURE:1},uniforms:{lut3d:{value:null},lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\n\t\tuniform float lutSize;\n\t\t#if USE_3DTEXTURE\n\t\tprecision highp sampler3D;\n\t\tuniform sampler3D lut3d;\n\t\t#else\n\t\tuniform sampler2D lut;\n\n\t\tvec3 lutLookup( sampler2D tex, float size, vec3 rgb ) {\n\n\t\t\tfloat sliceHeight = 1.0 / size;\n\t\t\tfloat yPixelHeight = 1.0 / ( size * size );\n\n\t\t\t// Get the slices on either side of the sample\n\t\t\tfloat slice = rgb.b * size;\n\t\t\tfloat interp = fract( slice );\n\t\t\tfloat slice0 = slice - interp;\n\t\t\tfloat centeredInterp = interp - 0.5;\n\n\t\t\tfloat slice1 = slice0 + sign( centeredInterp );\n\n\t\t\t// Pull y sample in by half a pixel in each direction to avoid color\n\t\t\t// bleeding from adjacent slices.\n\t\t\tfloat greenOffset = clamp( rgb.g * sliceHeight, yPixelHeight * 0.5, sliceHeight - yPixelHeight * 0.5 );\n\n\t\t\tvec2 uv0 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice0 * sliceHeight + greenOffset\n\t\t\t);\n\t\t\tvec2 uv1 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice1 * sliceHeight + greenOffset\n\t\t\t);\n\n\t\t\tvec3 sample0 = texture2D( tex, uv0 ).rgb;\n\t\t\tvec3 sample1 = texture2D( tex, uv1 ).rgb;\n\n\t\t\treturn mix( sample0, sample1, abs( centeredInterp ) );\n\n\t\t}\n\t\t#endif\n\n\t\tvarying vec2 vUv;\n\t\tuniform float intensity;\n\t\tuniform sampler2D tDiffuse;\n\t\tvoid main() {\n\n\t\t\tvec4 val = texture2D( tDiffuse, vUv );\n\t\t\tvec4 lutVal;\n\n\t\t\t// pull the sample in by half a pixel so the sample begins\n\t\t\t// at the center of the edge pixels.\n\t\t\tfloat pixelWidth = 1.0 / lutSize;\n\t\t\tfloat halfPixelWidth = 0.5 / lutSize;\n\t\t\tvec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );\n\n\t\t\t#if USE_3DTEXTURE\n\n\t\t\tlutVal = vec4( texture( lut3d, uvw ).rgb, val.a );\n\n\t\t\t#else\n\n\t\t\tlutVal = vec4( lutLookup( lut, lutSize, uvw ), val.a );\n\n\t\t\t#endif\n\n\t\t\tgl_FragColor = vec4( mix( val, lutVal, intensity ) );\n\n\t\t}\n\n\t"};class Gm extends Im{set lut(t){const e=this.material;if(t!==this.lut&&(e.uniforms.lut3d.value=null,e.uniforms.lut.value=null,t)){const i=t.isData3DTexture?1:0;i!==e.defines.USE_3DTEXTURE&&(e.defines.USE_3DTEXTURE=i,e.needsUpdate=!0),e.uniforms.lutSize.value=t.image.width,t.isData3DTexture?e.uniforms.lut3d.value=t:e.uniforms.lut.value=t}}get lut(){return this.material.uniforms.lut.value||this.material.uniforms.lut3d.value}set intensity(t){this.material.uniforms.intensity.value=t}get intensity(){return this.material.uniforms.intensity.value}constructor(t={}){super(Vm),this.lut=t.lut||null,this.intensity="intensity"in t?t.intensity:1}}class Wm extends jf{load(t,e,i,n){const s=new qf(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(t,(i=>{try{e(this.parse(i))}catch(e){n?n(e):console.error(e),this.manager.itemError(t)}}),i,n)}parse(t){t=t.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let e=null,i=null;const n=new Ml(0,0,0),s=new Ml(1,1,1),r=t.split(/[\n\r]+/g);let o=null,a=0;for(let t=0,l=r.length;t<l;t++){const l=r[t].trim(),h=l.split(/\s/g);switch(h[0]){case"TITLE":e=l.substring(7,l.length-1);break;case"LUT_3D_SIZE":const t=h[1];i=parseFloat(t),o=new Uint8Array(i*i*i*4);break;case"DOMAIN_MIN":n.x=parseFloat(h[1]),n.y=parseFloat(h[2]),n.z=parseFloat(h[3]);break;case"DOMAIN_MAX":s.x=parseFloat(h[1]),s.y=parseFloat(h[2]),s.z=parseFloat(h[3]);break;default:const r=parseFloat(h[0]),c=parseFloat(h[1]),d=parseFloat(h[2]);if(r>1||r<0||c>1||c<0||d>1||d<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");o[a+0]=255*r,o[a+1]=255*c,o[a+2]=255*d,o[a+3]=255,a+=4}}const l=new Up;l.image.data=o,l.image.width=i,l.image.height=i*i,l.type=na,l.magFilter=ea,l.minFilter=ea,l.wrapS=Zo,l.wrapT=Zo,l.generateMipmaps=!1,l.needsUpdate=!0;const h=new yl;return h.image.data=o,h.image.width=i,h.image.height=i,h.image.depth=i,h.type=na,h.magFilter=ea,h.minFilter=ea,h.wrapS=Zo,h.wrapT=Zo,h.wrapR=Zo,h.generateMipmaps=!1,h.needsUpdate=!0,{title:e,size:i,domainMin:n,domainMax:s,texture:l,texture3D:h}}}const jm={type:"change"},Xm={type:"start"},Ym={type:"end"},qm=new $l,Km=new Fc,Zm=Math.cos(70*Xa);class $m extends Ia{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ml,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",X),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",X),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(jm),i.update(),s=n.NONE},this.update=function(){const e=new Ml,c=(new bl).setFromUnitVectors(t.up,new Ml(0,1,0)),d=c.clone().invert(),u=new Ml,p=new bl,f=new Ml,m=2*Math.PI;return function(){const g=i.object.position;e.copy(g).sub(i.target),e.applyQuaternion(c),o.setFromVector3(e),i.autoRotate&&s===n.NONE&&T(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(o.theta+=a.theta*i.dampingFactor,o.phi+=a.phi*i.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let v=i.minAzimuthAngle,_=i.maxAzimuthAngle;isFinite(v)&&isFinite(_)&&(v<-Math.PI?v+=m:v>Math.PI&&(v-=m),_<-Math.PI?_+=m:_>Math.PI&&(_-=m),o.theta=v<=_?Math.max(v,Math.min(_,o.theta)):o.theta>(v+_)/2?Math.max(v,o.theta):Math.min(_,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),i.zoomToCursor&&b||i.object.isOrthographicCamera?o.radius=I(o.radius):o.radius=I(o.radius*l),e.setFromSpherical(o),e.applyQuaternion(d),g.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(a.theta*=1-i.dampingFactor,a.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(a.set(0,0,0),h.set(0,0,0));let M=!1;if(i.zoomToCursor&&b){let n=null;if(i.object.isPerspectiveCamera){const t=e.length();n=I(t*l);const s=t-n;i.object.position.addScaledVector(x,s),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const t=new Ml(y.x,y.y,0);t.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),M=!0;const s=new Ml(y.x,y.y,0);s.unproject(i.object),i.object.position.sub(s).add(t),i.object.updateMatrixWorld(),n=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(n).add(i.object.position):(qm.origin.copy(i.object.position),qm.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(qm.direction))<Zm?t.lookAt(i.target):(Km.setFromNormalAndCoplanarPoint(i.object.up,i.target),qm.intersectPlane(Km,i.target))))}else i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),M=!0);return l=1,b=!1,!!(M||u.distanceToSquared(i.object.position)>r||8*(1-p.dot(i.object.quaternion))>r||f.distanceToSquared(i.target)>0)&&(i.dispatchEvent(jm),u.copy(i.object.position),p.copy(i.object.quaternion),f.copy(i.target),M=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Y),i.domElement.removeEventListener("pointerdown",V),i.domElement.removeEventListener("pointercancel",W),i.domElement.removeEventListener("wheel",j),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",W),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",X),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const r=1e-6,o=new Am,a=new Am;let l=1;const h=new Ml,c=new Ka,d=new Ka,u=new Ka,p=new Ka,f=new Ka,m=new Ka,g=new Ka,v=new Ka,_=new Ka,x=new Ml,y=new Ka;let b=!1;const M=[],S={};function w(){return Math.pow(.95,i.zoomSpeed)}function T(t){a.theta-=t}function E(t){a.phi-=t}const A=function(){const t=new Ml;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),h.add(t)}}(),C=function(){const t=new Ml;return function(e,n){!0===i.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),P=function(){const t=new Ml;return function(e,n){const s=i.domElement;if(i.object.isPerspectiveCamera){const r=i.object.position;t.copy(r).sub(i.target);let o=t.length();o*=Math.tan(i.object.fov/2*Math.PI/180),A(2*e*o/s.clientHeight,i.object.matrix),C(2*n*o/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(A(e*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),C(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function L(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(e){if(!i.zoomToCursor)return;b=!0;const n=i.domElement.getBoundingClientRect(),s=e.clientX-n.left,r=e.clientY-n.top,o=n.width,a=n.height;y.x=s/o*2-1,y.y=-r/a*2+1,x.set(y.x,y.y,1).unproject(t).sub(t.position).normalize()}function I(t){return Math.max(i.minDistance,Math.min(i.maxDistance,t))}function k(t){c.set(t.clientX,t.clientY)}function O(t){p.set(t.clientX,t.clientY)}function N(){if(1===M.length)c.set(M[0].pageX,M[0].pageY);else{const t=.5*(M[0].pageX+M[1].pageX),e=.5*(M[0].pageY+M[1].pageY);c.set(t,e)}}function U(){if(1===M.length)p.set(M[0].pageX,M[0].pageY);else{const t=.5*(M[0].pageX+M[1].pageX),e=.5*(M[0].pageY+M[1].pageY);p.set(t,e)}}function B(){const t=M[0].pageX-M[1].pageX,e=M[0].pageY-M[1].pageY,i=Math.sqrt(t*t+e*e);g.set(0,i)}function F(t){if(1==M.length)d.set(t.pageX,t.pageY);else{const e=K(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);d.set(i,n)}u.subVectors(d,c).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*u.x/e.clientHeight),E(2*Math.PI*u.y/e.clientHeight),c.copy(d)}function z(t){if(1===M.length)f.set(t.pageX,t.pageY);else{const e=K(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);f.set(i,n)}m.subVectors(f,p).multiplyScalar(i.panSpeed),P(m.x,m.y),p.copy(f)}function H(t){const e=K(t),n=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(n*n+s*s);v.set(0,r),_.set(0,Math.pow(v.y/g.y,i.zoomSpeed)),L(_.y),g.copy(v)}function V(t){!1!==i.enabled&&(0===M.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",G),i.domElement.addEventListener("pointerup",W)),function(t){M.push(t)}(t),"touch"===t.pointerType?function(t){switch(q(t),M.length){case 1:switch(i.touches.ONE){case 0:if(!1===i.enableRotate)return;N(),s=n.TOUCH_ROTATE;break;case 1:if(!1===i.enablePan)return;U(),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(i.touches.TWO){case 2:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&B(),i.enablePan&&U(),s=n.TOUCH_DOLLY_PAN;break;case 3:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&B(),i.enableRotate&&N(),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(Xm)}(t):function(t){let e;switch(t.button){case 0:e=i.mouseButtons.LEFT;break;case 1:e=i.mouseButtons.MIDDLE;break;case 2:e=i.mouseButtons.RIGHT;break;default:e=-1}switch(e){case 1:if(!1===i.enableZoom)return;!function(t){D(t),g.set(t.clientX,t.clientY)}(t),s=n.DOLLY;break;case 0:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;O(t),s=n.PAN}else{if(!1===i.enableRotate)return;k(t),s=n.ROTATE}break;case 2:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;k(t),s=n.ROTATE}else{if(!1===i.enablePan)return;O(t),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(Xm)}(t))}function G(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(q(t),s){case n.TOUCH_ROTATE:if(!1===i.enableRotate)return;F(t),i.update();break;case n.TOUCH_PAN:if(!1===i.enablePan)return;z(t),i.update();break;case n.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&H(t),i.enablePan&&z(t)}(t),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&H(t),i.enableRotate&&F(t)}(t),i.update();break;default:s=n.NONE}}(t):function(t){switch(s){case n.ROTATE:if(!1===i.enableRotate)return;!function(t){d.set(t.clientX,t.clientY),u.subVectors(d,c).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*u.x/e.clientHeight),E(2*Math.PI*u.y/e.clientHeight),c.copy(d),i.update()}(t);break;case n.DOLLY:if(!1===i.enableZoom)return;!function(t){v.set(t.clientX,t.clientY),_.subVectors(v,g),_.y>0?L(w()):_.y<0&&R(w()),g.copy(v),i.update()}(t);break;case n.PAN:if(!1===i.enablePan)return;!function(t){f.set(t.clientX,t.clientY),m.subVectors(f,p).multiplyScalar(i.panSpeed),P(m.x,m.y),p.copy(f),i.update()}(t)}}(t))}function W(t){!function(t){delete S[t.pointerId];for(let e=0;e<M.length;e++)if(M[e].pointerId==t.pointerId)return void M.splice(e,1)}(t),0===M.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",W)),i.dispatchEvent(Ym),s=n.NONE}function j(t){!1!==i.enabled&&!1!==i.enableZoom&&s===n.NONE&&(t.preventDefault(),i.dispatchEvent(Xm),function(t){D(t),t.deltaY<0?R(w()):t.deltaY>0&&L(w()),i.update()}(t),i.dispatchEvent(Ym))}function X(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?E(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?E(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?T(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?T(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function Y(t){!1!==i.enabled&&t.preventDefault()}function q(t){let e=S[t.pointerId];void 0===e&&(e=new Ka,S[t.pointerId]=e),e.set(t.pageX,t.pageY)}function K(t){const e=t.pointerId===M[0].pointerId?M[1]:M[0];return S[e.pointerId]}i.domElement.addEventListener("contextmenu",Y),i.domElement.addEventListener("pointerdown",V),i.domElement.addEventListener("pointercancel",W),i.domElement.addEventListener("wheel",j,{passive:!1}),this.update()}}const Jm={name:"ChromaticAberrationsShader",uniforms:{tDiffuse:{value:null},u_rgbSplitLength:{value:.05},u_redChannelOut:{value:!1}},vertexShader:"\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() \n        {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\t#include <common>\n\n\t\tuniform sampler2D tDiffuse;\n        uniform float u_rgbSplitLength;\n        // uniform float u_rgbSplitDistFromCenter;\n        uniform float u_rgbSplitBlurSize;\n        uniform bool u_redChannelOut;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() \n        {\n            vec2 splitDir = (vUv - vec2(0.5)) * 2.0;\n            float splitLength = u_rgbSplitLength * length(splitDir);\n            splitDir = normalize(splitDir);\n            vec2 splitValue = splitLength * splitDir;\n        \n            float splitDirection = -1.0;\n            if(u_redChannelOut)\n                splitDirection *= -1.0;\n\n            vec3 rgbSplitColor = vec3(\n                texture2D(tDiffuse, vUv - splitDirection * splitValue * 0.1).r, \n                texture2D(tDiffuse, vUv).g, \n                texture2D(tDiffuse, vUv + splitDirection * splitValue * 0.1).b\n            );\n            vec3 colorOut = pow(rgbSplitColor, vec3(1.0 / 2.2));\n\t\t\tgl_FragColor =  vec4( colorOut, 1.0 );\n\t\t}\n    "},Qm=new Ml(1,0,0),tg=new Ml(0,1,0),eg={"Bourbon 64.CUBE":null,"Chemical 168.CUBE":null,"Remy 24.CUBE":null};class ig{get controls(){return this._controls}get scene(){return this._scene}get camera(){return this._camera}get renderer(){return this._renderer}get effect(){return this._renderer}get cameraForward(){return this._cameraForward}get cameraRight(){return this._cameraRight}get cameraUp(){return this._cameraUp}constructor(t){this._scene=new Mp,this._cameraForward=new Ml,this._cameraRight=new Ml,this._cameraUp=new Ml,this._directionalLightBasePosition=new Ml(10,10,10),this.isMobile=!1,this.usePostProcessing=!0,this._canvas=t,this._renderer=new bp({canvas:t,powerPreference:"high-performance"}),this._renderer.shadowMap.enabled=!1,this._renderer.toneMapping=Fo,this._scene=new Mp,this._ambientLight=new dm(16777215,.5),this._directionalLight=new cm(16777215,1),this._directionalLight.position.copy(this._directionalLightBasePosition),this.scene.add(this._ambientLight),this.scene.add(this._directionalLight);let e=window.innerWidth/window.innerHeight;this._camera=new Rc(40,e,.01,100),this._effectComposer=new Nm(this._renderer),this._renderPass=new Um(this._scene,this._camera),this._fxaaPass=new Im(Bm),this._bloomPass=new Hm(new Ka,0,0,1),this._chromaticAberrationsPass=new Im(Jm),this._lutPass=new Gm({lut:eg["Bourbon 64.CUBE"],intensity:0}),this._vignettePass=new Im(Fm),this._effectComposer.addPass(this._renderPass),this._effectComposer.addPass(this._fxaaPass),this._effectComposer.addPass(this._bloomPass),this._effectComposer.addPass(this._chromaticAberrationsPass),this._effectComposer.addPass(this._lutPass),this._effectComposer.addPass(this._vignettePass),this._controls=new $m(this.camera,this.renderer.domElement),this.onResize=this.onResize.bind(this),window.addEventListener("resize",this.onResize,!1),this.onResize(),this.resetCamera(),Object.keys(eg).forEach((t=>{(new Wm).load("luts/"+t,(e=>{eg[t]=e}))})),this.refreshCameraVectors()}resetCamera(){this._camera.position.set(0,0,10),this._camera.lookAt(0,0,0),this._controls.position0.set(0,0,10),this._controls.target.set(0,0,0)}update(t){var e,i,n;this.refreshCameraVectors(),null===(e=this._controls)||void 0===e||e.update(),this.usePostProcessing&&!this.isMobile?null===(i=this._effectComposer)||void 0===i||i.render(t):null===(n=this._renderer)||void 0===n||n.render(this._scene,this._camera)}applySceneConfig(t){this._scene.background=new Vh(t._backgroundColor),this._controls.minDistance=t._minZoom,this._controls.maxDistance=t._maxZoom,this._ambientLight.intensity=t._ambientIntensity,this._ambientLight.color.setStyle(t._lightColor.getStyle()),this._directionalLight.intensity=t._directionalIntensity,this._directionalLight.color.setStyle(t._lightColor.getStyle())}applyPostProcessing(t){this._bloomPass.strength=t._bloomStrength,this._bloomPass.threshold=t._bloomThreshold,this._bloomPass.radius=t._bloomRadius,this._vignettePass.uniforms.offset.value=t._vignetteOffset,this._vignettePass.uniforms.darkness.value=t._vignetteDarkness,this._chromaticAberrationsPass.uniforms.u_rgbSplitLength.value=t._chromaAberrationLength,this._chromaticAberrationsPass.uniforms.u_redChannelOut.value=t._chromaAberrationRedOut,this._lutPass.intensity=t._lutIntensity,this._lutPass.lut=eg[t._lutName].texture}onResize(){var t,e,i,n;let s=.89*window.innerWidth,r=.9*window.innerHeight;null===(t=this._renderer)||void 0===t||t.setSize(s,r),null===(e=this._renderer)||void 0===e||e.setPixelRatio(Math.min(window.devicePixelRatio,2)),this._camera.aspect=s/r,this._camera.updateProjectionMatrix(),null===(i=this._effectComposer)||void 0===i||i.setSize(s,r),null===(n=this._effectComposer)||void 0===n||n.setPixelRatio(Math.min(window.devicePixelRatio,2)),void 0!==this._fxaaPass&&(this._fxaaPass.material.uniforms.resolution.value.x=1/(s*window.devicePixelRatio),this._fxaaPass.material.uniforms.resolution.value.y=1/(r*window.devicePixelRatio)),void 0!==this._bloomPass&&this._bloomPass.resolution.set(s,r)}refreshCameraVectors(){var t,e,i;null===(t=this._camera)||void 0===t||t.getWorldDirection(this._cameraForward),this._cameraRight.copy(Qm),null===(e=this._camera)||void 0===e||e.localToWorld(this._cameraRight),this._cameraUp.copy(tg),null===(i=this._camera)||void 0===i||i.localToWorld(this._cameraUp)}setDirLightAngle(t){let e=this._directionalLightBasePosition.clone();e.applyAxisAngle(tg,t),this._directionalLight.position.copy(e)}}const ng={_backgroundColor:new Vh(7829367),_minZoom:1,_maxZoom:20,_litLighting:!0,_ambientIntensity:.5,_directionalIntensity:5,_lightColor:new Vh(16777215)},sg={_backgroundColor:new Vh(7829367),_minZoom:1,_maxZoom:10,_litLighting:!0,_ambientIntensity:2.5,_directionalIntensity:5,_lightColor:new Vh(16777215)},rg={_backgroundColor:new Vh(7829367),_minZoom:1,_maxZoom:10,_litLighting:!1,_ambientIntensity:0,_directionalIntensity:0,_lightColor:new Vh(16777215)},og={_backgroundColor:new Vh(7829367),_minZoom:1,_maxZoom:10,_litLighting:!0,_ambientIntensity:1.5,_directionalIntensity:5,_lightColor:new Vh(16777215)},ag={_bloomRadius:.8,_bloomStrength:.25,_bloomThreshold:.9,_chromaAberrationLength:0,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Chemical 168.CUBE",_lutIntensity:.5},lg={Ori:{path:"models/Ori.glb",anim:[],scale:1,cameraPos:new Ml(0,0,7),sceneConfig:ng,postProcessing:{_bloomRadius:.8,_bloomStrength:.25,_bloomThreshold:.5,_chromaAberrationLength:.05,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Bourbon 64.CUBE",_lutIntensity:0},animations:{firstAnimation:"Default",Death:{speed:1,looping:!1},Default:{speed:1,looping:!1},Idle:{speed:.1,looping:!0},SecondJump:{speed:.1,looping:!0},Walk:{speed:.1,looping:!0}},totalBytes:3367424,artist:""},MechaGirl:{path:"models/MechaGirl.glb",anim:[],scale:1,cameraPos:new Ml(-.77,2.11,4.15),sceneConfig:rg,postProcessing:ag,totalBytes:8175088,artist:"Please credit <a href='https://www.artstation.com/artwork/qAzZky'>Alfredo Candelaresi</a> for the original concept"},OniGurl:{path:"models/OniGurl.glb",anim:[],scale:1,cameraPos:new Ml(-1.096256754139416,2.24,3.96),sceneConfig:rg,postProcessing:ag,totalBytes:4903116,artist:"Please credit <a href='https://www.youtube.com/c/shionmgr'>Shion Mgr</a> for the original concept"},Enri:{path:"models/Enri.glb",anim:[],scale:1,cameraPos:new Ml(-.84,2.4,4.09),sceneConfig:og,postProcessing:{_bloomRadius:.5,_bloomStrength:.25,_bloomThreshold:1,_chromaAberrationLength:0,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Remy 24.CUBE",_lutIntensity:.35},totalBytes:5024536,artist:"Please credit <a href='https://twitter.com/nama41228652'>Nama</a> for the original concept"},Jorogumo:{path:"models/Jorogumo.glb",anim:[],scale:1,cameraPos:new Ml(1,2,7),sceneConfig:ng,postProcessing:{_bloomRadius:.5,_bloomStrength:.15,_bloomThreshold:1,_chromaAberrationLength:0,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Remy 24.CUBE",_lutIntensity:.35},animations:{firstAnimation:"Default",Default:{speed:1,looping:!1},Idle:{speed:.1,looping:!0},KillPlayer:{speed:.075,looping:!0},JumpWindow:{speed:.075,looping:!0},Running:{speed:.075,looping:!0},Scream:{speed:.075,looping:!0}},totalBytes:12483440,artist:""},MechSpider:{path:"models/MechSpider.glb",anim:[],scale:1,cameraPos:new Ml(-.28,2.4,8.45),sceneConfig:ng,postProcessing:{_bloomRadius:.8,_bloomStrength:.5,_bloomThreshold:.75,_chromaAberrationLength:.05,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!1,_lutName:"Bourbon 64.CUBE",_lutIntensity:0},totalBytes:3868788,artist:"Please credit <a href='https://www.artstation.com/artwork/D5y5mR'>Christoph Stryczek</a> for the original concept"},GodEater:{path:"models/GodEaterChainsaw.glb",anim:[],scale:1,cameraPos:new Ml(-2.08,-.7,1.83),sceneConfig:sg,postProcessing:{_bloomRadius:.5,_bloomStrength:.35,_bloomThreshold:.75,_chromaAberrationLength:0,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Chemical 168.CUBE",_lutIntensity:1},totalBytes:7452644,artist:""},AnchorSword:{path:"models/AnchorSword.glb",anim:[],scale:1,cameraPos:new Ml(0,0,7),sceneConfig:ng,postProcessing:{_bloomRadius:.8,_bloomStrength:.25,_bloomThreshold:.5,_chromaAberrationLength:.05,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Chemical 168.CUBE",_lutIntensity:.85},totalBytes:3713600,artist:"Please credit <a href='https://www.artstation.com/artwork/48WzV8'>Baldi Konijin</a> for the original concept"},FantasyBow:{path:"models/FantasyBow.glb",anim:[],scale:1,cameraPos:new Ml(0,0,10),sceneConfig:ng,postProcessing:{_bloomRadius:.5,_bloomStrength:.35,_bloomThreshold:.75,_chromaAberrationLength:0,_vignetteOffset:1,_vignetteDarkness:1,_chromaAberrationRedOut:!0,_lutName:"Bourbon 64.CUBE",_lutIntensity:.65},totalBytes:603952,artist:""}};function hg(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const n=i.count-2,s=[];if(2===e)for(let t=1;t<=n;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=t.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class cg extends jf{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new gg(t)})),this.register((function(t){return new wg(t)})),this.register((function(t){return new Tg(t)})),this.register((function(t){return new Eg(t)})),this.register((function(t){return new _g(t)})),this.register((function(t){return new xg(t)})),this.register((function(t){return new yg(t)})),this.register((function(t){return new bg(t)})),this.register((function(t){return new mg(t)})),this.register((function(t){return new Mg(t)})),this.register((function(t){return new vg(t)})),this.register((function(t){return new Sg(t)})),this.register((function(t){return new pg(t)})),this.register((function(t){return new Ag(t)})),this.register((function(t){return new Cg(t)}))}load(t,e,i,n){const s=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:um.extractUrlBase(t),this.manager.itemStart(t);const o=function(e){n?n(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},a=new qf(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){try{s.parse(i,r,(function(i){e(i),s.manager.itemEnd(t)}),o)}catch(t){o(t)}}),i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,n){let s;const r={},o={},a=new TextDecoder;if("string"==typeof t)s=JSON.parse(t);else if(t instanceof ArrayBuffer)if(a.decode(new Uint8Array(t,0,4))===Pg){try{r[ug.KHR_BINARY_GLTF]=new Lg(t)}catch(t){return void(n&&n(t))}s=JSON.parse(r[ug.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(t));else s=t;if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Jg(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);o[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let t=0;t<s.extensionsUsed.length;++t){const e=s.extensionsUsed[t],i=s.extensionsRequired||[];switch(e){case ug.KHR_MATERIALS_UNLIT:r[e]=new fg;break;case ug.KHR_DRACO_MESH_COMPRESSION:r[e]=new Rg(s,this.dracoLoader);break;case ug.KHR_TEXTURE_TRANSFORM:r[e]=new Dg;break;case ug.KHR_MESH_QUANTIZATION:r[e]=new Ig;break;default:i.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(i,n)}parseAsync(t,e){const i=this;return new Promise((function(n,s){i.parse(t,e,n,s)}))}}function dg(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const ug={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class pg{constructor(t){this.parser=t,this.name=ug.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let n=e.cache.get(i);if(n)return n;const s=e.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let o;const a=new Vh(16777215);void 0!==r.color&&a.fromArray(r.color);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new cm(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new lm(a),o.distance=l;break;case"spot":o=new nm(a),o.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,Xg(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=e.createUniqueName(r.name||"light_"+t),n=Promise.resolve(o),e.cache.add(i,n),n}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(t){return i._getNodeRef(e.cache,s,t)}))}}class fg{constructor(){this.name=ug.KHR_MATERIALS_UNLIT}getMaterialType(){return Wh}extendParams(t,e,i){const n=[];t.color=new Vh(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(t,"map",s.baseColorTexture,wa))}return Promise.all(n)}}class mg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(e.emissiveIntensity=n),Promise.resolve()}}class gg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Ka(t,t)}return Promise.all(s)}}class vg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(e.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(e,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(e.iridescenceIOR=r.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(e,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class _g{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new Vh(0,0,0),e.sheenRoughness=0,e.sheen=1;const r=n.extensions[this.name];return void 0!==r.sheenColorFactor&&e.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(e.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(e,"sheenColorMap",r.sheenColorTexture,wa)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(e,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class xg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class yg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return e.attenuationColor=new Vh(o[0],o[1],o[2]),Promise.all(s)}}class bg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class Mg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return e.specularColor=new Vh(o[0],o[1],o[2]),void 0!==r.specularColorTexture&&s.push(i.assignTexture(e,"specularColorMap",r.specularColorTexture,wa)),Promise.all(s)}}class Sg{constructor(t){this.parser=t,this.name=ug.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?vf:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(e.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(e.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(e,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class wg{constructor(t){this.parser=t,this.name=ug.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s.source,r)}}class Tg{constructor(t){this.parser=t,this.name=ug.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Eg{constructor(t){this.parser=t,this.name=ug.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Ag{constructor(t){this.name=ug.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,r=t.count,o=t.byteStride,a=new Uint8Array(e,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,t.mode,t.filter).then((function(t){return t.buffer})):s.ready.then((function(){const e=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(e),r,o,a,t.mode,t.filter),e}))}))}return null}}class Cg{constructor(t){this.name=ug.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=e.meshes[i.mesh];for(const t of n.primitives)if(t.mode!==Ug.TRIANGLES&&t.mode!==Ug.TRIANGLE_STRIP&&t.mode!==Ug.TRIANGLE_FAN&&void 0!==t.mode)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const t in s)r.push(this.parser.getDependency("accessor",s[t]).then((e=>(o[t]=e,o[t]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then((t=>{const e=t.pop(),i=e.isGroup?e.children:[e],n=t[0].count,s=[];for(const t of i){const e=new Jl,i=new Ml,r=new bl,a=new Ml(1,1,1),l=new Kp(t.geometry,t.material,n);for(let t=0;t<n;t++)o.TRANSLATION&&i.fromBufferAttribute(o.TRANSLATION,t),o.ROTATION&&r.fromBufferAttribute(o.ROTATION,t),o.SCALE&&a.fromBufferAttribute(o.SCALE,t),l.setMatrixAt(t,e.compose(i,r,a));for(const e in o)"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&t.geometry.setAttribute(e,o[e]);Sh.prototype.copy.call(l,t),this.parser.assignFinalMaterial(l),s.push(l)}return e.isGroup?(e.clear(),e.add(...s),e):s[0]})))}}const Pg="glTF";class Lg{constructor(t){this.name=ug.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Pg)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(t,12);let r=0;for(;r<n;){const e=s.getUint32(r,!0);r+=4;const n=s.getUint32(r,!0);if(r+=4,1313821514===n){const n=new Uint8Array(t,12+r,e);this.content=i.decode(n)}else if(5130562===n){const i=12+r;this.body=t.slice(i,i+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Rg{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ug.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},a={},l={};for(const t in r){const e=Vg[t]||t.toLowerCase();o[e]=r[t]}for(const e in t.attributes){const n=Vg[e]||e.toLowerCase();if(void 0!==r[e]){const s=i.accessors[t.attributes[e]],r=Bg[s.componentType];l[n]=r.name,a[n]=!0===s.normalized}}return e.getDependency("bufferView",s).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)}),o,l)}))}))}}class Dg{constructor(){this.name=ug.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class Ig{constructor(){this.name=ug.KHR_MESH_QUANTIZATION}}class kg extends Cf{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[s+t];return e}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=n-e,c=(i-e)/h,d=c*c,u=d*c,p=t*l,f=p-l,m=-2*u+3*d,g=u-d,v=1-m,_=g-d+c;for(let t=0;t!==o;t++){const e=r[f+t+o],i=r[f+t+a]*h,n=r[p+t+o],l=r[p+t]*h;s[t]=v*e+_*i+m*n+g*l}return s}}const Og=new bl;class Ng extends kg{interpolate_(t,e,i,n){const s=super.interpolate_(t,e,i,n);return Og.fromArray(s).normalize().toArray(s),s}}const Ug={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Bg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Fg={9728:Jo,9729:ea,9984:Qo,9985:1007,9986:ta,9987:ia},zg={33071:Zo,33648:$o,10497:Ko},Hg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Vg={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gg={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Wg={CUBICSPLINE:void 0,LINEAR:_a,STEP:va};function jg(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function Xg(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Yg(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function qg(t){let e;const i=t.extensions&&t.extensions[ug.KHR_DRACO_MESH_COMPRESSION];if(e=i?"draco:"+i.bufferView+":"+i.indices+":"+Kg(i.attributes):t.indices+":"+Kg(t.attributes)+":"+t.mode,void 0!==t.targets)for(let i=0,n=t.targets.length;i<n;i++)e+=":"+Kg(t.targets[i]);return e}function Kg(t){let e="";const i=Object.keys(t).sort();for(let n=0,s=i.length;n<s;n++)e+=i[n]+":"+t[i[n]]+";";return e}function Zg(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const $g=new Jl;class Jg{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new dg,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||n&&s<98?this.textureLoader=new Zf(this.options.manager):this.textureLoader=new pm(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new qf(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};jg(s,r,n),Xg(r,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(r)}))).then((function(){t(r)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),s=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())s(n,e.children[i])};return s(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const s=t(e[n]);s&&i.push(s)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":n=this.loadCamera(e);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)})),!n)throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[ug.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,s){i.load(um.resolveURL(e.uri,n.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(t){const e=this,i=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse){const t=Hg[n.type],e=Bg[n.componentType],i=!0===n.normalized,s=new e(n.count*t);return Promise.resolve(new Yh(s,t,i))}const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],r=Hg[n.type],o=Bg[n.componentType],a=o.BYTES_PER_ELEMENT,l=a*r,h=n.byteOffset||0,c=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;let u,p;if(c&&c!==l){const t=Math.floor(h/c),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let l=e.cache.get(i);l||(u=new o(s,t*c,n.count*c/a),l=new Sp(u,c/a),e.cache.add(i,l)),p=new Tp(l,r,h%c/a,d)}else u=null===s?new o(n.count*r):new o(s,h,n.count*r),p=new Yh(u,r,d);if(void 0!==n.sparse){const e=Hg.SCALAR,i=Bg[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,h=new i(t[1],a,n.sparse.count*e),c=new o(t[2],l,n.sparse.count*r);null!==s&&(p=new Yh(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(p.setX(e,c[t*r]),r>=2&&p.setY(e,c[t*r+1]),r>=3&&p.setZ(e,c[t*r+2]),r>=4&&p.setW(e,c[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,s=e.images[n];let r=this.textureLoader;if(s.uri){const t=i.manager.getHandler(s.uri);null!==t&&(r=t)}return this.loadTextureImage(t,n,r)}loadTextureImage(t,e,i){const n=this,s=this.json,r=s.textures[t],o=s.images[e],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,i).then((function(e){e.flipY=!1,e.name=r.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);const i=(s.samplers||{})[r.sampler]||{};return e.magFilter=Fg[i.magFilter]||ea,e.minFilter=Fg[i.minFilter]||ia,e.wrapS=zg[i.wrapS]||Ko,e.wrapT=zg[i.wrapT]||Ko,n.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){const i=this.json,n=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const s=i.images[t],r=self.URL||self.webkitURL;let o=s.uri||"",a=!1;if(void 0!==s.bufferView)o=this.getDependency("bufferView",s.bufferView).then((function(t){a=!0;const e=new Blob([t],{type:s.mimeType});return o=r.createObjectURL(e),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(t){return new Promise((function(i,s){let r=i;!0===e.isImageBitmapLoader&&(r=function(t){const e=new ml(t);e.needsUpdate=!0,i(e)}),e.load(um.resolveURL(t,n.path),r,void 0,s)}))})).then((function(t){var e;return!0===a&&r.revokeObjectURL(o),t.userData.mimeType=s.mimeType||((e=s.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),t}));return this.sourceCache[t]=l,l}assignTexture(t,e,i,n){const s=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[ug.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[ug.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=s.associations.get(r);r=s.extensions[ug.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),s.associations.set(r,e)}}return void 0!==n&&(r.colorSpace=n),t[e]=r,r}))}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const n=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,r=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new lf,Uh.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new Zp,Uh.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(n||s||r){let t="ClonedMaterial:"+i.uuid+":";n&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),r&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),r&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}t.material=i}getMaterialType(){return gf}loadMaterial(t){const e=this,i=this.json,n=this.extensions,s=i.materials[t];let r;const o={},a=[];if((s.extensions||{})[ug.KHR_MATERIALS_UNLIT]){const t=n[ug.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),a.push(t.extendParams(o,s,e))}else{const i=s.pbrMetallicRoughness||{};if(o.color=new Vh(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==i.baseColorTexture&&a.push(e.assignTexture(o,"map",i.baseColorTexture,wa)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(a.push(e.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),a.push(e.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===s.doubleSided&&(o.side=2);const l=s.alphaMode||"OPAQUE";if("BLEND"===l?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===l&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==Wh&&(a.push(e.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Ka(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&r!==Wh&&(a.push(e.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==Wh&&(o.emissive=(new Vh).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&r!==Wh&&a.push(e.assignTexture(o,"emissiveMap",s.emissiveTexture,wa)),Promise.all(a).then((function(){const i=new r(o);return s.name&&(i.name=s.name),Xg(i,s),e.associations.set(i,{materials:t}),s.extensions&&jg(n,i,s),i}))}createUniqueName(t){const e=Sm.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,n=this.primitiveCache;function s(t){return i[ug.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(i){return Qg(i,t,e)}))}const r=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],a=qg(o),l=n[a];if(l)r.push(l.promise);else{let t;t=o.extensions&&o.extensions[ug.KHR_DRACO_MESH_COMPRESSION]?s(o):Qg(new sc,o,e),n[a]={primitive:o,promise:t},r.push(t)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,n=this.extensions,s=i.meshes[t],r=s.primitives,o=[];for(let t=0,e=r.length;t<e;t++){const e=void 0===r[t].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new gf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),a.DefaultMaterial):this.getDependency("material",r[t].material);o.push(e)}var a;return o.push(e.loadGeometries(r)),Promise.all(o).then((function(i){const o=i.slice(0,i.length-1),a=i[i.length-1],l=[];for(let i=0,h=a.length;i<h;i++){const h=a[i],c=r[i];let d;const u=o[i];if(c.mode===Ug.TRIANGLES||c.mode===Ug.TRIANGLE_STRIP||c.mode===Ug.TRIANGLE_FAN||void 0===c.mode)d=!0===s.isSkinnedMesh?new Op(h,u):new Mc(h,u),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),c.mode===Ug.TRIANGLE_STRIP?d.geometry=hg(d.geometry,1):c.mode===Ug.TRIANGLE_FAN&&(d.geometry=hg(d.geometry,2));else if(c.mode===Ug.LINES)d=new of(h,u);else if(c.mode===Ug.LINE_STRIP)d=new nf(h,u);else if(c.mode===Ug.LINE_LOOP)d=new af(h,u);else{if(c.mode!==Ug.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new pf(h,u)}Object.keys(d.geometry.morphAttributes).length>0&&Yg(d,s),d.name=e.createUniqueName(s.name||"mesh_"+t),Xg(d,s),c.extensions&&jg(n,d,c),e.assignFinalMaterial(d),l.push(d)}for(let i=0,n=l.length;i<n;i++)e.associations.set(l[i],{meshes:t,primitives:i});if(1===l.length)return s.extensions&&jg(n,l[0],s),l[0];const h=new pp;s.extensions&&jg(n,h,s),e.associations.set(h,{meshes:t});for(let t=0,e=l.length;t<e;t++)h.add(l[t]);return h}))}loadCamera(t){let e;const i=this.json.cameras[t],n=i[i.type];if(n)return"perspective"===i.type?e=new Rc(qa(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(e=new id(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Xg(e,i),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],i=[];for(let t=0,n=e.joints.length;t<n;t++)i.push(this._loadNodeShallow(e.joints[t]));return void 0!==e.inverseBindMatrices?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(t){const i=t.pop(),n=t,s=[],r=[];for(let t=0,o=n.length;t<o;t++){const o=n[t];if(o){s.push(o);const e=new Jl;null!==i&&e.fromArray(i.array,16*t),r.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}return new zp(s,r)}))}loadAnimation(t){const e=this.json,i=this,n=e.animations[t],s=n.name?n.name:"animation_"+t,r=[],o=[],a=[],l=[],h=[];for(let t=0,e=n.channels.length;t<e;t++){const e=n.channels[t],i=n.samplers[e.sampler],s=e.target,c=s.node,d=void 0!==n.parameters?n.parameters[i.input]:i.input,u=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(r.push(this.getDependency("node",c)),o.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",u)),l.push(i),h.push(s))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(h)]).then((function(t){const e=t[0],n=t[1],r=t[2],o=t[3],a=t[4],l=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],h=n[t],c=r[t],d=o[t],u=a[t];if(void 0===s)continue;s.updateMatrix&&s.updateMatrix();const p=i._createAnimationTracks(s,h,c,d,u);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new zf(s,void 0,l)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this,i=this.json.nodes[t],n=e._loadNodeShallow(t),s=[],r=i.children||[];for(let t=0,i=r.length;t<i;t++)s.push(e.getDependency("node",r[t]));const o=void 0===i.skin?Promise.resolve(null):e.getDependency("skin",i.skin);return Promise.all([n,Promise.all(s),o]).then((function(t){const e=t[0],i=t[1],n=t[2];null!==n&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(n,$g)}));for(let t=0,n=i.length;t<n;t++)e.add(i[t]);return e}))}_loadNodeShallow(t){const e=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const s=e.nodes[t],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then((function(t){return n._getNodeRef(n.cameraCache,s.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){o.push(t)})),this.nodeCache[t]=Promise.all(o).then((function(e){let o;if(o=!0===s.isBone?new Np:e.length>1?new pp:1===e.length?e[0]:new Sh,o!==e[0])for(let t=0,i=e.length;t<i;t++)o.add(e[t]);if(s.name&&(o.userData.name=s.name,o.name=r),Xg(o,s),s.extensions&&jg(i,o,s),void 0!==s.matrix){const t=new Jl;t.fromArray(s.matrix),o.applyMatrix4(t)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],n=this,s=new pp;i.name&&(s.name=n.createUniqueName(i.name)),Xg(s,i),i.extensions&&jg(e,s,i);const r=i.nodes||[],o=[];for(let t=0,e=r.length;t<e;t++)o.push(n.getDependency("node",r[t]));return Promise.all(o).then((function(t){for(let e=0,i=t.length;e<i;e++)s.add(t[e]);return n.associations=(t=>{const e=new Map;for(const[t,i]of n.associations)(t instanceof Uh||t instanceof ml)&&e.set(t,i);return t.traverse((t=>{const i=n.associations.get(t);null!=i&&e.set(t,i)})),e})(s),s}))}_createAnimationTracks(t,e,i,n,s){const r=[],o=t.name?t.name:t.uuid,a=[];let l;switch(Gg[s.path]===Gg.weights?t.traverse((function(t){t.morphTargetInfluences&&a.push(t.name?t.name:t.uuid)})):a.push(o),Gg[s.path]){case Gg.weights:l=Of;break;case Gg.rotation:l=Uf;break;case Gg.position:case Gg.scale:l=Ff;break;default:l=1===i.itemSize?Of:Ff}const h=void 0!==n.interpolation?Wg[n.interpolation]:_a,c=this._getArrayFromAccessor(i);for(let t=0,i=a.length;t<i;t++){const i=new l(a[t]+"."+Gg[s.path],e.array,c,h);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(i),r.push(i)}return r}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=Zg(e.constructor),i=new Float32Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=e[n]*t;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof Uf?Ng:kg)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Qg(t,e,i){const n=e.attributes,s=[];function r(e,n){return i.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in n){const i=Vg[e]||e.toLowerCase();i in t.attributes||s.push(r(n[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(n)}return Xg(t,e),function(t,e,i){const n=e.attributes,s=new Tl;if(void 0===n.POSITION)return;{const t=i.json.accessors[n.POSITION],e=t.min,r=t.max;if(void 0===e||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new Ml(e[0],e[1],e[2]),new Ml(r[0],r[1],r[2])),t.normalized){const e=Zg(Bg[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const r=e.targets;if(void 0!==r){const t=new Ml,e=new Ml;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(e.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const t=Zg(Bg[n.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const o=new Gl;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=o}(t,e,i),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,i){let n=!1,s=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(s=!0),void 0!==i.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(t);const o=[],a=[],l=[];for(let h=0,c=e.length;h<c;h++){const c=e[h];if(n){const e=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):t.attributes.position;o.push(e)}if(s){const e=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):t.attributes.normal;a.push(e)}if(r){const e=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const i=e[0],o=e[1],a=e[2];return n&&(t.morphAttributes.position=i),s&&(t.morphAttributes.normal=o),r&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,i):t}))}var tv=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(tv(""))}catch(hx){tv=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var ev=Uint8Array,iv=Uint16Array,nv=Uint32Array,sv=new ev([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rv=new ev([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ov=new ev([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),av=function(t,e){for(var i=new iv(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var s=new nv(i[30]);for(n=1;n<30;++n)for(var r=i[n];r<i[n+1];++r)s[r]=r-i[n]<<5|n;return[i,s]},lv=av(sv,2),hv=lv[0],cv=lv[1];hv[28]=258,cv[258]=28;for(var dv=av(rv,0),uv=dv[0],pv=(dv[1],new iv(32768)),fv=0;fv<32768;++fv){var mv=(43690&fv)>>>1|(21845&fv)<<1;mv=(61680&(mv=(52428&mv)>>>2|(13107&mv)<<2))>>>4|(3855&mv)<<4,pv[fv]=((65280&mv)>>>8|(255&mv)<<8)>>>1}var gv=function(t,e,i){for(var n=t.length,s=0,r=new iv(e);s<n;++s)++r[t[s]-1];var o,a=new iv(e);for(s=0;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;if(i){o=new iv(1<<e);var l=15-e;for(s=0;s<n;++s)if(t[s])for(var h=s<<4|t[s],c=e-t[s],d=a[t[s]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)o[pv[d]>>>l]=h}else for(o=new iv(n),s=0;s<n;++s)t[s]&&(o[s]=pv[a[t[s]-1]++]>>>15-t[s]);return o},vv=new ev(288);for(fv=0;fv<144;++fv)vv[fv]=8;for(fv=144;fv<256;++fv)vv[fv]=9;for(fv=256;fv<280;++fv)vv[fv]=7;for(fv=280;fv<288;++fv)vv[fv]=8;var _v=new ev(32);for(fv=0;fv<32;++fv)_v[fv]=5;var xv=gv(vv,9,1),yv=gv(_v,5,1),bv=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Mv=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},Sv=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},wv=function(t,e,i){var n=t.length;if(!n||i&&!i.l&&n<5)return e||new ev(0);var s=!e||i,r=!i||i.i;i||(i={}),e||(e=new ev(3*n));var o,a=function(t){var i=e.length;if(t>i){var n=new ev(Math.max(2*i,t));n.set(e),e=n}},l=i.f||0,h=i.p||0,c=i.b||0,d=i.l,u=i.d,p=i.m,f=i.n,m=8*n;do{if(!d){i.f=l=Mv(t,h,1);var g=Mv(t,h+1,3);if(h+=3,!g){var v=t[(o=h,(C=(o/8|0)+(7&o&&1)+4)-4)]|t[C-3]<<8,_=C+v;if(_>n){if(r)throw"unexpected EOF";break}s&&a(c+v),e.set(t.subarray(C,_),c),i.b=c+=v,i.p=h=8*_;continue}if(1==g)d=xv,u=yv,p=9,f=5;else{if(2!=g)throw"invalid block type";var x=Mv(t,h,31)+257,y=Mv(t,h+10,15)+4,b=x+Mv(t,h+5,31)+1;h+=14;for(var M=new ev(b),S=new ev(19),w=0;w<y;++w)S[ov[w]]=Mv(t,h+3*w,7);h+=3*y;var T=bv(S),E=(1<<T)-1,A=gv(S,T,1);for(w=0;w<b;){var C,P=A[Mv(t,h,E)];if(h+=15&P,(C=P>>>4)<16)M[w++]=C;else{var L=0,R=0;for(16==C?(R=3+Mv(t,h,3),h+=2,L=M[w-1]):17==C?(R=3+Mv(t,h,7),h+=3):18==C&&(R=11+Mv(t,h,127),h+=7);R--;)M[w++]=L}}var D=M.subarray(0,x),I=M.subarray(x);p=bv(D),f=bv(I),d=gv(D,p,1),u=gv(I,f,1)}if(h>m){if(r)throw"unexpected EOF";break}}s&&a(c+131072);for(var k=(1<<p)-1,O=(1<<f)-1,N=h;;N=h){var U=(L=d[Sv(t,h)&k])>>>4;if((h+=15&L)>m){if(r)throw"unexpected EOF";break}if(!L)throw"invalid length/literal";if(U<256)e[c++]=U;else{if(256==U){N=h,d=null;break}var B=U-254;if(U>264){var F=sv[w=U-257];B=Mv(t,h,(1<<F)-1)+hv[w],h+=F}var z=u[Sv(t,h)&O],H=z>>>4;if(!z)throw"invalid distance";if(h+=15&z,I=uv[H],H>3&&(F=rv[H],I+=Sv(t,h)&(1<<F)-1,h+=F),h>m){if(r)throw"unexpected EOF";break}s&&a(c+131072);for(var V=c+B;c<V;c+=4)e[c]=e[c-I],e[c+1]=e[c+1-I],e[c+2]=e[c+2-I],e[c+3]=e[c+3-I];c=V}}i.l=d,i.p=N,i.b=c,d&&(l=1,i.m=p,i.d=u,i.n=f)}while(!l);return c==e.length?e:function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var n=new(t instanceof iv?iv:t instanceof nv?nv:ev)(i-e);return n.set(t.subarray(e,i)),n}(e,0,c)},Tv=new ev(0);var Ev="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ev.decode(Tv,{stream:!0})}catch(hx){}function Av(t,e,i){const n=i.length-t-1;if(e>=i[n])return n-1;if(e<=i[t])return t;let s=t,r=n,o=Math.floor((s+r)/2);for(;e<i[o]||e>=i[o+1];)e<i[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function Cv(t,e){let i=1;for(let e=2;e<=t;++e)i*=e;let n=1;for(let t=2;t<=e;++t)n*=t;for(let i=2;i<=t-e;++i)n*=i;return i/n}class Pv extends mf{constructor(t,e,i,n,s){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(let t=0;t<i.length;++t){const e=i[t];this.controlPoints[t]=new gl(e.x,e.y,e.z,e.w)}}getPoint(t,e=new Ml){const i=e,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(t,e,i,n){const s=Av(t,n,e),r=function(t,e,i,n){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=i;++a){r[a]=e-n[t+1-a],o[a]=n[t+a]-e;let i=0;for(let t=0;t<a;++t){const e=o[t+1],n=r[a-t],l=s[t]/(e+n);s[t]=i+e*l,i=n*l}s[a]=i}return s}(s,n,t,e),o=new gl(0,0,0,0);for(let e=0;e<=t;++e){const n=i[s-t+e],a=r[e],l=n.w*a;o.x+=n.x*l,o.y+=n.y*l,o.z+=n.z*l,o.w+=n.w*a}return o}(this.degree,this.knots,this.controlPoints,n);return 1!==s.w&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(t,e=new Ml){const i=e,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=function(t,e,i,n,s){const r=function(t,e,i,n,s){const r=s<t?s:t,o=[],a=Av(t,n,e),l=function(t,e,i,n,s){const r=[];for(let t=0;t<=i;++t)r[t]=0;const o=[];for(let t=0;t<=n;++t)o[t]=r.slice(0);const a=[];for(let t=0;t<=i;++t)a[t]=r.slice(0);a[0][0]=1;const l=r.slice(0),h=r.slice(0);for(let n=1;n<=i;++n){l[n]=e-s[t+1-n],h[n]=s[t+n]-e;let i=0;for(let t=0;t<n;++t){const e=h[t+1],s=l[n-t];a[n][t]=e+s;const r=a[t][n-1]/a[n][t];a[t][n]=i+e*r,i=s*r}a[n][n]=i}for(let t=0;t<=i;++t)o[0][t]=a[t][i];for(let t=0;t<=i;++t){let e=0,s=1;const l=[];for(let t=0;t<=i;++t)l[t]=r.slice(0);l[0][0]=1;for(let r=1;r<=n;++r){let n=0;const h=t-r,c=i-r;t>=r&&(l[s][0]=l[e][0]/a[c+1][h],n=l[s][0]*a[h][c]);const d=t-1<=c?r-1:i-t;for(let t=h>=-1?1:-h;t<=d;++t)l[s][t]=(l[e][t]-l[e][t-1])/a[c+1][h+t],n+=l[s][t]*a[h+t][c];t<=c&&(l[s][r]=-l[e][r-1]/a[c+1][t],n+=l[s][r]*a[t][c]),o[r][t]=n;const u=e;e=s,s=u}}let c=i;for(let t=1;t<=n;++t){for(let e=0;e<=i;++e)o[t][e]*=c;c*=i-t}return o}(a,n,t,r,e),h=[];for(let t=0;t<i.length;++t){const e=i[t].clone(),n=e.w;e.x*=n,e.y*=n,e.z*=n,h[t]=e}for(let e=0;e<=r;++e){const i=h[a-t].clone().multiplyScalar(l[e][0]);for(let n=1;n<=t;++n)i.add(h[a-t+n].clone().multiplyScalar(l[e][n]));o[e]=i}for(let t=r+1;t<=s+1;++t)o[t]=new gl(0,0,0);return o}(t,e,i,n,s);return function(t){const e=t.length,i=[],n=[];for(let s=0;s<e;++s){const e=t[s];i[s]=new Ml(e.x,e.y,e.z),n[s]=e.w}const s=[];for(let t=0;t<e;++t){const e=i[t].clone();for(let i=1;i<=t;++i)e.sub(s[t-i].clone().multiplyScalar(Cv(t,i)*n[i]));s[t]=e.divideScalar(n[0])}return s}(r)}(this.degree,this.knots,this.controlPoints,n,1);return i.copy(s[1]).normalize(),i}}let Lv,Rv,Dv;class Iv extends jf{constructor(t){super(t)}load(t,e,i,n){const s=this,r=""===s.path?um.extractUrlBase(t):s.path,o=new qf(this.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(i){try{e(s.parse(i,r))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),i,n)}parse(t,e){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=21&&e===Zv(t,0,21)}(t))Lv=(new Bv).parse(t);else{const e=Zv(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function n(e){const n=t[e-1];return t=t.slice(i+e),i++,n}for(let t=0;t<e.length;++t)if(n(1)===e[t])return!1;return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(Hv(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Hv(e));Lv=(new Uv).parse(e)}const i=new Zf(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new kv(i,this.manager).parse(Lv)}}class kv{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Rv=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),i=this.parseMaterials(e),n=this.parseDeformers(),s=(new Ov).parse(n);return this.parseScene(n,s,i),Dv}parseConnections(){const t=new Map;return"Connections"in Lv&&Lv.Connections.connections.forEach((function(e){const i=e[0],n=e[1],s=e[2];t.has(i)||t.set(i,{parents:[],children:[]});const r={ID:n,relationship:s};t.get(i).parents.push(r),t.has(n)||t.set(n,{parents:[],children:[]});const o={ID:i,relationship:s};t.get(n).children.push(o)})),t}parseImages(){const t={},e={};if("Video"in Lv.Objects){const i=Lv.Objects.Video;for(const n in i){const s=i[n];if(t[parseInt(n)]=s.RelativeFilename||s.Filename,"Content"in s){const t=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,r="string"==typeof s.Content&&""!==s.Content;if(t||r){const t=this.parseImage(i[n]);e[s.RelativeFilename||s.Filename]=t}}}}for(const i in t){const n=t[i];void 0!==e[n]?t[i]=e[n]:t[i]=t[i].split("\\").pop()}return t}parseImage(t){const e=t.Content,i=t.RelativeFilename||t.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(n){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof e)return"data:"+s+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:s}))}}parseTextures(t){const e=new Map;if("Texture"in Lv.Objects){const i=Lv.Objects.Texture;for(const n in i){const s=this.parseTexture(i[n],t);e.set(parseInt(n),s)}}return e}parseTexture(t,e){const i=this.loadTexture(t,e);i.ID=t.id,i.name=t.attrName;const n=t.WrapModeU,s=t.WrapModeV,r=void 0!==n?n.value:0,o=void 0!==s?s.value:0;if(i.wrapS=0===r?Ko:Zo,i.wrapT=0===o?Ko:Zo,"Scaling"in t){const e=t.Scaling.value;i.repeat.x=e[0],i.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;i.offset.x=e[0],i.offset.y=e[1]}return i}loadTexture(t,e){let i;const n=this.textureLoader.path,s=Rv.get(t.id).children;let r;void 0!==s&&s.length>0&&void 0!==e[s[0].ID]&&(i=e[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));const o=t.FileName.slice(-3).toLowerCase();if("tga"===o){const e=this.manager.getHandler(".tga");null===e?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),r=new ml):(e.setPath(this.textureLoader.path),r=e.load(i))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),r=new ml):r=this.textureLoader.load(i);return this.textureLoader.setPath(n),r}parseMaterials(t){const e=new Map;if("Material"in Lv.Objects){const i=Lv.Objects.Material;for(const n in i){const s=this.parseMaterial(i[n],t);null!==s&&e.set(parseInt(n),s)}}return e}parseMaterial(t,e){const i=t.id,n=t.attrName;let s=t.ShadingModel;if("object"==typeof s&&(s=s.value),!Rv.has(i))return null;const r=this.parseParameters(t,e,i);let o;switch(s.toLowerCase()){case"phong":o=new _f;break;case"lambert":o=new yf;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),o=new _f}return o.setValues(r),o.name=n,o}parseParameters(t,e,i){const n={};t.BumpFactor&&(n.bumpScale=t.BumpFactor.value),t.Diffuse?n.color=(new Vh).fromArray(t.Diffuse.value).convertSRGBToLinear():!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(n.color=(new Vh).fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(n.displacementScale=t.DisplacementFactor.value),t.Emissive?n.emissive=(new Vh).fromArray(t.Emissive.value).convertSRGBToLinear():!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(n.emissive=(new Vh).fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(n.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(n.opacity=parseFloat(t.Opacity.value)),n.opacity<1&&(n.transparent=!0),t.ReflectionFactor&&(n.reflectivity=t.ReflectionFactor.value),t.Shininess&&(n.shininess=t.Shininess.value),t.Specular?n.specular=(new Vh).fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&"Color"===t.SpecularColor.type&&(n.specular=(new Vh).fromArray(t.SpecularColor.value).convertSRGBToLinear());const s=this;return Rv.get(i).children.forEach((function(t){const i=t.relationship;switch(i){case"Bump":n.bumpMap=s.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(e,t.ID),void 0!==n.map&&(n.map.colorSpace=wa);break;case"DisplacementColor":n.displacementMap=s.getTexture(e,t.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(e,t.ID),void 0!==n.emissiveMap&&(n.emissiveMap.colorSpace=wa);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(e,t.ID);break;case"ReflectionColor":n.envMap=s.getTexture(e,t.ID),void 0!==n.envMap&&(n.envMap.mapping=Yo,n.envMap.colorSpace=wa);break;case"SpecularColor":n.specularMap=s.getTexture(e,t.ID),void 0!==n.specularMap&&(n.specularMap.colorSpace=wa);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(e,t.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",i)}})),n}getTexture(t,e){return"LayeredTexture"in Lv.Objects&&e in Lv.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Rv.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in Lv.Objects){const i=Lv.Objects.Deformer;for(const n in i){const s=i[n],r=Rv.get(parseInt(n));if("Skin"===s.attrType){const e=this.parseSkeleton(r,i);e.ID=n,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=r.parents[0].ID,t[n]=e}else if("BlendShape"===s.attrType){const t={id:n};t.rawTargets=this.parseMorphTargets(r,i),t.id=n,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[n]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const i=[];return t.children.forEach((function(t){const n=e[t.ID];if("Cluster"!==n.attrType)return;const s={ID:t.ID,indices:[],weights:[],transformLink:(new Jl).fromArray(n.TransformLink.a)};"Indexes"in n&&(s.indices=n.Indexes.a,s.weights=n.Weights.a),i.push(s)})),{rawBones:i,bones:[]}}parseMorphTargets(t,e){const i=[];for(let n=0;n<t.children.length;n++){const s=t.children[n],r=e[s.ID],o={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if("BlendShapeChannel"!==r.attrType)return;o.geoID=Rv.get(parseInt(s.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,i.push(o)}return i}parseScene(t,e,i){Dv=new pp;const n=this.parseModels(t.skeletons,e,i),s=Lv.Objects.Model,r=this;n.forEach((function(t){const e=s[t.ID];r.setLookAtProperties(t,e),Rv.get(t.ID).parents.forEach((function(e){const i=n.get(e.ID);void 0!==i&&i.add(t)})),null===t.parent&&Dv.add(t)})),this.bindSkeleton(t.skeletons,e,n),this.createAmbientLight(),Dv.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=Yv(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const o=(new Nv).parse();1===Dv.children.length&&Dv.children[0].isGroup&&(Dv.children[0].animations=o,Dv=Dv.children[0]),Dv.animations=o}parseModels(t,e,i){const n=new Map,s=Lv.Objects.Model;for(const r in s){const o=parseInt(r),a=s[r],l=Rv.get(o);let h=this.buildSkeleton(l,t,o,a.attrName);if(!h){switch(a.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,e,i);break;case"NurbsCurve":h=this.createCurve(l,e);break;case"LimbNode":case"Root":h=new Np;break;default:h=new pp}h.name=a.attrName?Sm.sanitizeNodeName(a.attrName):"",h.ID=o}this.getTransformData(h,a),n.set(o,h)}return n}buildSkeleton(t,e,i,n){let s=null;return t.parents.forEach((function(t){for(const r in e){const o=e[r];o.rawBones.forEach((function(e,r){if(e.ID===t.ID){const t=s;s=new Np,s.matrixWorld.copy(e.transformLink),s.name=n?Sm.sanitizeNodeName(n):"",s.ID=i,o.bones[r]=s,null!==t&&s.add(t)}}))}})),s}createCamera(t){let e,i;if(t.children.forEach((function(t){const e=Lv.Objects.NodeAttribute[t.ID];void 0!==e&&(i=e)})),void 0===i)e=new Sh;else{let t=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(t=1);let n=1;void 0!==i.NearPlane&&(n=i.NearPlane.value/1e3);let s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);let r=window.innerWidth,o=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(r=i.AspectWidth.value,o=i.AspectHeight.value);const a=r/o;let l=45;void 0!==i.FieldOfView&&(l=i.FieldOfView.value);const h=i.FocalLength?i.FocalLength.value:null;switch(t){case 0:e=new Rc(l,a,n,s),null!==h&&e.setFocalLength(h);break;case 1:e=new id(-r/2,r/2,o/2,-o/2,n,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),e=new Sh}}return e}createLight(t){let e,i;if(t.children.forEach((function(t){const e=Lv.Objects.NodeAttribute[t.ID];void 0!==e&&(i=e)})),void 0===i)e=new Sh;else{let t;t=void 0===i.LightType?0:i.LightType.value;let n=16777215;void 0!==i.Color&&(n=(new Vh).fromArray(i.Color.value).convertSRGBToLinear());let s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);let r=0;void 0!==i.FarAttenuationEnd&&(r=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);const o=1;switch(t){case 0:e=new lm(n,s,r,o);break;case 1:e=new cm(n,s);break;case 2:let t=Math.PI/3;void 0!==i.InnerAngle&&(t=Ya(i.InnerAngle.value));let a=0;void 0!==i.OuterAngle&&(a=Ya(i.OuterAngle.value),a=Math.max(a,1)),e=new nm(n,s,r,t,a,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),e=new lm(n,s)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,i){let n,s=null,r=null;const o=[];return t.children.forEach((function(t){e.has(t.ID)&&(s=e.get(t.ID)),i.has(t.ID)&&o.push(i.get(t.ID))})),o.length>1?r=o:o.length>0?r=o[0]:(r=new _f({name:jf.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(r)),"color"in s.attributes&&o.forEach((function(t){t.vertexColors=!0})),s.FBX_Deformer?(n=new Op(s,r),n.normalizeSkinWeights()):n=new Mc(s,r),n}createCurve(t,e){const i=t.children.reduce((function(t,i){return e.has(i.ID)&&(t=e.get(i.ID)),t}),null),n=new Zp({name:jf.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new nf(i,n)}getTransformData(t,e){const i={};"InheritType"in e&&(i.inheritType=parseInt(e.InheritType.value)),i.eulerOrder="RotationOrder"in e?qv(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(i.translation=e.Lcl_Translation.value),"PreRotation"in e&&(i.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(i.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(i.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(i.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(i.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(i.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(i.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(i.rotationPivot=e.RotationPivot.value),t.userData.transformData=i}setLookAtProperties(t,e){"LookAtProperty"in e&&Rv.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){const i=Lv.Objects.Model[e.ID];if("Lcl_Translation"in i){const e=i.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),Dv.add(t.target)):t.lookAt((new Ml).fromArray(e))}}}))}bindSkeleton(t,e,i){const n=this.parsePoseNodes();for(const s in t){const r=t[s];Rv.get(parseInt(r.ID)).parents.forEach((function(t){if(e.has(t.ID)){const e=t.ID;Rv.get(e).parents.forEach((function(t){i.has(t.ID)&&i.get(t.ID).bind(new zp(r.bones),n[t.ID])}))}}))}}parsePoseNodes(){const t={};if("Pose"in Lv.Objects){const e=Lv.Objects.Pose;for(const i in e)if("BindPose"===e[i].attrType&&e[i].NbPoseNodes>0){const n=e[i].PoseNode;Array.isArray(n)?n.forEach((function(e){t[e.Node]=(new Jl).fromArray(e.Matrix.a)})):t[n.Node]=(new Jl).fromArray(n.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Lv&&"AmbientColor"in Lv.GlobalSettings){const t=Lv.GlobalSettings.AmbientColor.value,e=t[0],i=t[1],n=t[2];if(0!==e||0!==i||0!==n){const t=new Vh(e,i,n).convertSRGBToLinear();Dv.add(new dm(t,1))}}}}class Ov{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in Lv.Objects){const i=Lv.Objects.Geometry;for(const n in i){const s=Rv.get(parseInt(n)),r=this.parseGeometry(s,i[n],t);e.set(parseInt(n),r)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}parseGeometry(t,e,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,i){const n=i.skeletons,s=[],r=t.parents.map((function(t){return Lv.Objects.Model[t.ID]}));if(0===r.length)return;const o=t.children.reduce((function(t,e){return void 0!==n[e.ID]&&(t=n[e.ID]),t}),null);t.children.forEach((function(t){void 0!==i.morphTargets[t.ID]&&s.push(i.morphTargets[t.ID])}));const a=r[0],l={};"RotationOrder"in a&&(l.eulerOrder=qv(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const h=Yv(l);return this.genGeometry(e,o,s,h)}genGeometry(t,e,i,n){const s=new sc;t.attrName&&(s.name=t.attrName);const r=this.parseGeoNode(t,e),o=this.genBuffers(r),a=new Zh(o.vertex,3);if(a.applyMatrix4(n),s.setAttribute("position",a),o.colors.length>0&&s.setAttribute("color",new Zh(o.colors,3)),e&&(s.setAttribute("skinIndex",new qh(o.weightsIndices,4)),s.setAttribute("skinWeight",new Zh(o.vertexWeights,4)),s.FBX_Deformer=e),o.normal.length>0){const t=(new Za).getNormalMatrix(n),e=new Zh(o.normal,3);e.applyNormalMatrix(t),s.setAttribute("normal",e)}if(o.uvs.forEach((function(t,e){const i=0===e?"uv":`uv${e}`;s.setAttribute(i,new Zh(o.uvs[e],2))})),r.material&&"AllSame"!==r.material.mappingType){let t=o.materialIndex[0],e=0;if(o.materialIndex.forEach((function(i,n){i!==t&&(s.addGroup(e,n-e,t),t=i,e=n)})),s.groups.length>0){const e=s.groups[s.groups.length-1],i=e.start+e.count;i!==o.materialIndex.length&&s.addGroup(i,o.materialIndex.length-i,t)}0===s.groups.length&&s.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(s,t,i,n),s}parseGeoNode(t,e){const i={};if(i.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],i.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return i.weightTable={},null!==e&&(i.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(n,s){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:e,weight:t.weights[s]})}))}))),i}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,s=!1,r=[],o=[],a=[],l=[],h=[],c=[];const d=this;return t.vertexIndices.forEach((function(u,p){let f,m=!1;u<0&&(u^=-1,m=!0);let g=[],v=[];if(r.push(3*u,3*u+1,3*u+2),t.color){const e=Wv(p,i,u,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[u]&&t.weightTable[u].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(i,n){let s=i,r=g[n];e.forEach((function(e,i,n){if(s>e){n[i]=s,s=e;const o=t[i];t[i]=r,r=o}}))})),g=t,v=e}for(;v.length<4;)v.push(0),g.push(0);for(let t=0;t<4;++t)h.push(v[t]),c.push(g[t])}if(t.normal){const e=Wv(p,i,u,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(f=Wv(p,i,u,t.material)[0],f<0&&(d.negativeMaterialIndices=!0,f=0)),t.uv&&t.uv.forEach((function(t,e){const n=Wv(p,i,u,t);void 0===l[e]&&(l[e]=[]),l[e].push(n[0]),l[e].push(n[1])})),n++,m&&(n>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),d.genFace(e,t,r,f,o,a,l,h,c,n),i++,n=0,r=[],o=[],a=[],l=[],h=[],c=[])})),e}genFace(t,e,i,n,s,r,o,a,l,h){for(let c=2;c<h;c++)t.vertex.push(e.vertexPositions[i[0]]),t.vertex.push(e.vertexPositions[i[1]]),t.vertex.push(e.vertexPositions[i[2]]),t.vertex.push(e.vertexPositions[i[3*(c-1)]]),t.vertex.push(e.vertexPositions[i[3*(c-1)+1]]),t.vertex.push(e.vertexPositions[i[3*(c-1)+2]]),t.vertex.push(e.vertexPositions[i[3*c]]),t.vertex.push(e.vertexPositions[i[3*c+1]]),t.vertex.push(e.vertexPositions[i[3*c+2]]),e.skeleton&&(t.vertexWeights.push(a[0]),t.vertexWeights.push(a[1]),t.vertexWeights.push(a[2]),t.vertexWeights.push(a[3]),t.vertexWeights.push(a[4*(c-1)]),t.vertexWeights.push(a[4*(c-1)+1]),t.vertexWeights.push(a[4*(c-1)+2]),t.vertexWeights.push(a[4*(c-1)+3]),t.vertexWeights.push(a[4*c]),t.vertexWeights.push(a[4*c+1]),t.vertexWeights.push(a[4*c+2]),t.vertexWeights.push(a[4*c+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(c-1)]),t.weightsIndices.push(l[4*(c-1)+1]),t.weightsIndices.push(l[4*(c-1)+2]),t.weightsIndices.push(l[4*(c-1)+3]),t.weightsIndices.push(l[4*c]),t.weightsIndices.push(l[4*c+1]),t.weightsIndices.push(l[4*c+2]),t.weightsIndices.push(l[4*c+3])),e.color&&(t.colors.push(r[0]),t.colors.push(r[1]),t.colors.push(r[2]),t.colors.push(r[3*(c-1)]),t.colors.push(r[3*(c-1)+1]),t.colors.push(r[3*(c-1)+2]),t.colors.push(r[3*c]),t.colors.push(r[3*c+1]),t.colors.push(r[3*c+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(n),t.materialIndex.push(n),t.materialIndex.push(n)),e.normal&&(t.normal.push(s[0]),t.normal.push(s[1]),t.normal.push(s[2]),t.normal.push(s[3*(c-1)]),t.normal.push(s[3*(c-1)+1]),t.normal.push(s[3*(c-1)+2]),t.normal.push(s[3*c]),t.normal.push(s[3*c+1]),t.normal.push(s[3*c+2])),e.uv&&e.uv.forEach((function(e,i){void 0===t.uvs[i]&&(t.uvs[i]=[]),t.uvs[i].push(o[i][0]),t.uvs[i].push(o[i][1]),t.uvs[i].push(o[i][2*(c-1)]),t.uvs[i].push(o[i][2*(c-1)+1]),t.uvs[i].push(o[i][2*c]),t.uvs[i].push(o[i][2*c+1])}))}addMorphTargets(t,e,i,n){if(0===i.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const s=this;i.forEach((function(i){i.rawTargets.forEach((function(i){const r=Lv.Objects.Geometry[i.geoID];void 0!==r&&s.genMorphGeometry(t,e,r,n,i.name)}))}))}genMorphGeometry(t,e,i,n,s){const r=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==i.Vertices?i.Vertices.a:[],a=void 0!==i.Indexes?i.Indexes.a:[],l=3*t.attributes.position.count,h=new Float32Array(l);for(let t=0;t<a.length;t++){const e=3*a[t];h[e]=o[3*t],h[e+1]=o[3*t+1],h[e+2]=o[3*t+2]}const c={vertexIndices:r,vertexPositions:h},d=this.genBuffers(c),u=new Zh(d.vertex,3);u.name=s||i.attrName,u.applyMatrix4(n),t.morphAttributes.position.push(u)}parseNormals(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.Normals.a;let s=[];return"IndexToDirect"===i&&("NormalIndex"in t?s=t.NormalIndex.a:"NormalsIndex"in t&&(s=t.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:e,referenceType:i}}parseUVs(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.UV.a;let s=[];return"IndexToDirect"===i&&(s=t.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:e,referenceType:i}}parseVertexColors(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.Colors.a;let s=[];"IndexToDirect"===i&&(s=t.ColorIndex.a);for(let t=0,e=new Vh;t<n.length;t+=4)e.fromArray(n,t).convertSRGBToLinear().toArray(n,t);return{dataSize:4,buffer:n,indices:s,mappingType:e,referenceType:i}}parseMaterialIndices(t){const e=t.MappingInformationType,i=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=t.Materials.a,s=[];for(let t=0;t<n.length;++t)s.push(t);return{dataSize:1,buffer:n,indices:s,mappingType:e,referenceType:i}}parseNurbsGeometry(t){const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new sc;const i=e-1,n=t.KnotVector.a,s=[],r=t.Points.a;for(let t=0,e=r.length;t<e;t+=4)s.push((new gl).fromArray(r,t));let o,a;if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){o=i,a=n.length-1-o;for(let t=0;t<i;++t)s.push(s[t])}const l=new Pv(i,n,s,o,a).getPoints(12*s.length);return(new sc).setFromPoints(l)}}class Nv{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const i in e){const n=e[i],s=this.addClip(n);t.push(s)}return t}parseClips(){if(void 0===Lv.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=Lv.Objects.AnimationCurveNode,e=new Map;for(const i in t){const n=t[i];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const t={id:n.id,attr:n.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=Lv.Objects.AnimationCurve;for(const i in e){const n={id:e[i].id,times:e[i].KeyTime.a.map(Vv),values:e[i].KeyValueFloat.a},s=Rv.get(n.id);if(void 0!==s){const e=s.parents[0].ID,i=s.parents[0].relationship;i.match(/X/)?t.get(e).curves.x=n:i.match(/Y/)?t.get(e).curves.y=n:i.match(/Z/)?t.get(e).curves.z=n:i.match(/DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=n)}}}parseAnimationLayers(t){const e=Lv.Objects.AnimationLayer,i=new Map;for(const n in e){const e=[],s=Rv.get(parseInt(n));void 0!==s&&(s.children.forEach((function(i,n){if(t.has(i.ID)){const s=t.get(i.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===e[n]){const t=Rv.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const s=Lv.Objects.Model[t.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",i);const r={modelName:s.attrName?Sm.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Dv.traverse((function(t){t.ID===s.id&&(r.transform=t.matrix,t.userData.transformData&&(r.eulerOrder=t.userData.transformData.eulerOrder))})),r.transform||(r.transform=new Jl),"PreRotation"in s&&(r.preRotation=s.PreRotation.value),"PostRotation"in s&&(r.postRotation=s.PostRotation.value),e[n]=r}}e[n]&&(e[n][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===e[n]){const t=Rv.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,s=Rv.get(t).parents[0].ID,r=Rv.get(s).parents[0].ID,o=Rv.get(r).parents[0].ID,a=Lv.Objects.Model[o],l={modelName:a.attrName?Sm.sanitizeNodeName(a.attrName):"",morphName:Lv.Objects.Deformer[t].attrName};e[n]=l}e[n][s.attr]=s}}})),i.set(parseInt(n),e))}return i}parseAnimStacks(t){const e=Lv.Objects.AnimationStack,i={};for(const n in e){const s=Rv.get(parseInt(n)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=t.get(s[0].ID);i[n]={name:e[n].attrName,layer:r}}return i}addClip(t){let e=[];const i=this;return t.layer.forEach((function(t){e=e.concat(i.generateTracks(t))})),new zf(t.name,-1,e)}generateTracks(t){const e=[];let i=new Ml,n=new bl,s=new Ml;if(t.transform&&t.transform.decompose(i,n,s),i=i.toArray(),n=(new lh).setFromQuaternion(n,t.eulerOrder).toArray(),s=s.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.T.curves,i,"position");void 0!==n&&e.push(n)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const i=this.generateRotationTrack(t.modelName,t.R.curves,n,t.preRotation,t.postRotation,t.eulerOrder);void 0!==i&&e.push(i)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const i=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");void 0!==i&&e.push(i)}if(void 0!==t.DeformPercent){const i=this.generateMorphTrack(t);void 0!==i&&e.push(i)}return e}generateVectorTrack(t,e,i,n){const s=this.getTimesForAllAxes(e),r=this.getKeyframeTrackValues(s,e,i);return new Ff(t+"."+n,s,r)}generateRotationTrack(t,e,i,n,s,r){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(Ya)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(Ya)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(Ya));const o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,i);void 0!==n&&((n=n.map(Ya)).push(r),n=(new lh).fromArray(n),n=(new bl).setFromEuler(n)),void 0!==s&&((s=s.map(Ya)).push(r),s=(new lh).fromArray(s),s=(new bl).setFromEuler(s).invert());const l=new bl,h=new lh,c=[];for(let t=0;t<a.length;t+=3)h.set(a[t],a[t+1],a[t+2],r),l.setFromEuler(h),void 0!==n&&l.premultiply(n),void 0!==s&&l.multiply(s),l.toArray(c,t/3*4);return new Uf(t+".quaternion",o,c)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,i=e.values.map((function(t){return t/100})),n=Dv.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Of(t.modelName+".morphTargetInfluences["+n+"]",e.times,i)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,i=e[0];for(let n=1;n<e.length;n++){const s=e[n];s!==i&&(e[t]=s,i=s,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,i){const n=i,s=[];let r=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(r=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==r){const t=e.x.values[r];s.push(t),n[0]=t}else s.push(n[0]);if(-1!==o){const t=e.y.values[o];s.push(t),n[1]=t}else s.push(n[1]);if(-1!==a){const t=e.z.values[a];s.push(t),n[2]=t}else s.push(n[2])})),s}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const i=t.values[e-1],n=t.values[e]-i,s=Math.abs(n);if(s>=180){const r=s/180,o=n/r;let a=i+o;const l=t.times[e-1],h=(t.times[e]-l)/r;let c=l+h;const d=[],u=[];for(;c<t.times[e];)d.push(c),c+=h,u.push(a),a+=o;t.times=$v(t.times,e,d),t.values=$v(t.values,e,u)}}}}class Uv{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new zv,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,i=t.split(/[\r\n]+/);return i.forEach((function(t,n){const s=t.match(/^[\s\t]*;/),r=t.match(/^[\s\t]*$/);if(s||r)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,i[++n]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const i=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),s={name:i},r=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,s):i in o?("PoseNode"===i?o.PoseNode.push(s):void 0!==o[i].id&&(o[i]={},o[i][o[i].id]=o[i]),""!==r.id&&(o[i][r.id]=s)):"number"==typeof r.id?(o[i]={},o[i][r.id]=s):"Properties70"!==i&&(o[i]="PoseNode"===i?[s]:s),"number"==typeof r.id&&(s.id=r.id),""!==r.name&&(s.attrName=r.name),""!==r.type&&(s.attrType=r.type),this.pushStack(s)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let i="",n="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:i,type:n}}parseNodeProperty(t,e,i){let n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),s=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===s&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if("Properties70"!==r.name){if("C"===n){const t=s.split(",").slice(1),e=parseInt(t[0]),i=parseInt(t[1]);let o=s.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),n="connections",s=[e,i],function(t,e){for(let i=0,n=t.length,s=e.length;i<s;i++,n++)t[n]=e[i]}(s,o),void 0===r[n]&&(r[n]=[])}"Node"===n&&(r.id=s),n in r&&Array.isArray(r[n])?r[n].push(s):"a"!==n?r[n]=s:r.a=s,this.setCurrentProp(r,n),"a"===n&&","!==s.slice(-1)&&(r.a=Kv(s))}else this.parseNodeSpecialProperty(t,n,s)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=Kv(e.a))}parseNodeSpecialProperty(t,e,i){const n=i.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),s=n[0],r=n[1],o=n[2],a=n[3];let l=n[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Kv(l)}this.getPrevNode()[s]={type:r,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),s)}}class Bv{parse(t){const e=new Fv(t);e.skip(23);const i=e.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new zv;for(;!this.endOfContent(e);){const t=this.parseNode(e,i);null!==t&&n.add(t.name,t)}return n}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const i={},n=e>=7500?t.getUint64():t.getUint32(),s=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const r=t.getUint8(),o=t.getString(r);if(0===n)return null;const a=[];for(let e=0;e<s;e++)a.push(this.parseProperty(t));const l=a.length>0?a[0]:"",h=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(i.singleProperty=1===s&&t.getOffset()===n;n>t.getOffset();){const n=this.parseNode(t,e);null!==n&&this.parseSubNode(o,i,n)}return i.propertyList=a,"number"==typeof l&&(i.id=l),""!==h&&(i.attrName=h),""!==c&&(i.attrType=c),""!==o&&(i.name=o),i}parseSubNode(t,e,i){if(!0===i.singleProperty){const t=i.propertyList[0];Array.isArray(t)?(e[i.name]=i,i.a=t):e[i.name]=t}else if("Connections"===t&&"C"===i.name){const t=[];i.propertyList.forEach((function(e,i){0!==i&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===i.name)Object.keys(i).forEach((function(t){e[t]=i[t]}));else if("Properties70"===t&&"P"===i.name){let t=i.propertyList[0],n=i.propertyList[1];const s=i.propertyList[2],r=i.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),o="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],e[t]={type:n,type2:s,flag:r,value:o}}else void 0===e[i.name]?"number"==typeof i.id?(e[i.name]={},e[i.name][i.id]=i):e[i.name]=i:"PoseNode"===i.name?(Array.isArray(e[i.name])||(e[i.name]=[e[i.name]]),e[i.name].push(i)):void 0===e[i.name][i.id]&&(e[i.name][i.id]=i)}parseProperty(t){const e=t.getString(1);let i;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return i=t.getUint32(),t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=t.getUint32(),s=t.getUint32(),r=t.getUint32();if(0===s)switch(e){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}const o=function(t,e){return wv((function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"}(t),t.subarray(2,-4)),e)}(new Uint8Array(t.getArrayBuffer(r))),a=new Fv(o.buffer);switch(e){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class Fv{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(t){const e=[];for(let i=0;i<t;i++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let i=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,e,n)),this._textDecoder.decode(i)}}class zv{add(t,e){this[t]=e}}function Hv(t){const e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Vv(t){return t/46186158e3}const Gv=[];function Wv(t,e,i,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=t;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(s=n.indices[s]);const r=s*n.dataSize,o=r+n.dataSize;return function(t,e,i,n){for(let s=i,r=0;s<n;s++,r++)t[r]=e[s];return t}(Gv,n.buffer,r,o)}const jv=new lh,Xv=new Ml;function Yv(t){const e=new Jl,i=new Jl,n=new Jl,s=new Jl,r=new Jl,o=new Jl,a=new Jl,l=new Jl,h=new Jl,c=new Jl,d=new Jl,u=new Jl,p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Xv.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(Ya);e.push(t.eulerOrder||lh.DEFAULT_ORDER),i.makeRotationFromEuler(jv.fromArray(e))}if(t.rotation){const e=t.rotation.map(Ya);e.push(t.eulerOrder||lh.DEFAULT_ORDER),n.makeRotationFromEuler(jv.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(Ya);e.push(t.eulerOrder||lh.DEFAULT_ORDER),s.makeRotationFromEuler(jv.fromArray(e)),s.invert()}t.scale&&r.scale(Xv.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Xv.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Xv.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(Xv.fromArray(t.rotationOffset)),t.rotationPivot&&h.setPosition(Xv.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(d.copy(t.parentMatrix),c.copy(t.parentMatrixWorld));const f=i.clone().multiply(n).multiply(s),m=new Jl;m.extractRotation(c);const g=new Jl;g.copyPosition(c);const v=g.clone().invert().multiply(c),_=m.clone().invert().multiply(v),x=r,y=new Jl;if(0===p)y.copy(m).multiply(f).multiply(_).multiply(x);else if(1===p)y.copy(m).multiply(_).multiply(f).multiply(x);else{const t=(new Jl).scale((new Ml).setFromMatrixScale(d)).clone().invert(),e=_.clone().multiply(t);y.copy(m).multiply(f).multiply(e).multiply(x)}const b=h.clone().invert(),M=o.clone().invert();let S=e.clone().multiply(l).multiply(h).multiply(i).multiply(n).multiply(s).multiply(b).multiply(a).multiply(o).multiply(r).multiply(M);const w=(new Jl).copyPosition(S),T=c.clone().multiply(w);return u.copyPosition(T),S=u.clone().multiply(y),S.premultiply(c.invert()),S}function qv(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Kv(t){return t.split(",").map((function(t){return parseFloat(t)}))}function Zv(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=t.byteLength),(new TextDecoder).decode(new Uint8Array(t,e,i))}function $v(t,e,i){return t.slice(0,e).concat(i).concat(t.slice(e))}class Jv{constructor(){this._pool=new Map;const t=new Gf;this._glbLoader=new cg(t),this._fbxLoader=new Iv(t)}loadModel(t,e,i){if(this._pool.has(t))e(this._pool.get(t));else{let n=t.includes(".fbx");(n?this._fbxLoader:this._glbLoader).load(t,(i=>{let s={model:n?i:i.scene,animations:i.animations};s.model.traverse((t=>{(t instanceof Mc||t instanceof Op)&&t.material.metalness>.5&&(t.material.metalness=.5)})),this._pool.set(t,s),e(s)}),(t=>{i(t.loaded)}))}}}function Qv(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),s=Math.round(t.g),r=Math.round(t.b),o=t.a,a=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===i?"rgb("+n+","+s+","+r+")":"CSS_RGBA"===i?"rgba("+n+","+s+","+r+","+o+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+s+","+r+"]":"RGBA_ARRAY"===i?"["+n+","+s+","+r+","+o+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+s+",b:"+r+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+s+",b:"+r+",a:"+o+"}":"HSV_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+",a:"+o+"}":"unknown format"}var t_=Array.prototype.forEach,e_=Array.prototype.slice,i_={BREAK:{},extend:function(t){return this.each(e_.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(e_.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=e_.call(arguments);return function(){for(var e=e_.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(t_&&t.forEach&&t.forEach===t_)t.forEach(e,i);else if(t.length===t.length+0){var n,s=void 0;for(s=0,n=t.length;s<n;s++)if(s in t&&e.call(i,t[s],s)===this.BREAK)return}else for(var r in t)if(e.call(i,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var s=this,r=arguments,o=i||!n;clearTimeout(n),n=setTimeout((function(){n=null,i||t.apply(s,r)}),e),o&&t.apply(s,r)}},toArray:function(t){return t.toArray?t.toArray():e_.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},n_=[{litmus:i_.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Qv},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Qv},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Qv},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Qv}}},{litmus:i_.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:i_.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:i_.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(i_.isNumber(t.r)&&i_.isNumber(t.g)&&i_.isNumber(t.b)&&i_.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(i_.isNumber(t.r)&&i_.isNumber(t.g)&&i_.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(i_.isNumber(t.h)&&i_.isNumber(t.s)&&i_.isNumber(t.v)&&i_.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(i_.isNumber(t.h)&&i_.isNumber(t.s)&&i_.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],s_=void 0,r_=void 0,o_=function(){r_=!1;var t=arguments.length>1?i_.toArray(arguments):arguments[0];return i_.each(n_,(function(e){if(e.litmus(t))return i_.each(e.conversions,(function(e,i){if(s_=e.read(t),!1===r_&&!1!==s_)return r_=s_,s_.conversionName=i,s_.conversion=e,i_.BREAK})),i_.BREAK})),r_},a_=void 0,l_={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,s=t/60-Math.floor(t/60),r=i*(1-e),o=i*(1-s*e),a=i*(1-(1-s)*e),l=[[i,a,r],[o,i,r],[r,i,a],[r,o,i],[a,r,i],[i,r,o]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),s=Math.max(t,e,i),r=s-n,o=void 0;return 0===s?{h:NaN,s:0,v:0}:(o=t===s?(e-i)/r:e===s?2+(i-t)/r:4+(t-e)/r,(o/=6)<0&&(o+=1),{h:360*o,s:r/s,v:s/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(a_=8*e)|t&~(255<<a_)}},h_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c_=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d_=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u_=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in s)return s.value;var o=s.get;return void 0!==o?o.call(n):void 0},p_=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},f_=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},m_=function(){function t(){if(c_(this,t),this.__state=o_.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return d_(t,[{key:"toString",value:function(){return Qv(this)}},{key:"toHexString",value:function(){return Qv(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function g_(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||m_.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(m_.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function v_(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||m_.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(m_.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}m_.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=l_.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");i_.extend(t.__state,l_.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},m_.recalculateHSV=function(t){var e=l_.rgb_to_hsv(t.r,t.g,t.b);i_.extend(t.__state,{s:e.s,v:e.v}),i_.isNaN(e.h)?i_.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},m_.COMPONENTS=["r","g","b","h","s","v","hex","a"],g_(m_.prototype,"r",2),g_(m_.prototype,"g",1),g_(m_.prototype,"b",0),v_(m_.prototype,"h"),v_(m_.prototype,"s"),v_(m_.prototype,"v"),Object.defineProperty(m_.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(m_.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=l_.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var __=function(){function t(e,i){c_(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return d_(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),x_={};i_.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){i_.each(t,(function(t){x_[t]=e}))}));var y_=/(\d+(\.\d+)?)px/;function b_(t){if("0"===t||i_.isUndefined(t))return 0;var e=t.match(y_);return i_.isNull(e)?0:parseFloat(e[1])}var M_={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,s=e;i_.isUndefined(s)&&(s=!0),i_.isUndefined(n)&&(n=!0),t.style.position="absolute",s&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var s=i||{},r=x_[e];if(!r)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(r);switch(r){case"MouseEvents":var a=s.x||s.clientX||0,l=s.y||s.clientY||0;o.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=o.initKeyboardEvent||o.initKeyEvent;i_.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break;default:o.initEvent(e,s.bubbles||!1,s.cancelable||!0)}i_.defaults(o,n),t.dispatchEvent(o)},bind:function(t,e,i,n){var s=n||!1;return t.addEventListener?t.addEventListener(e,i,s):t.attachEvent&&t.attachEvent("on"+e,i),M_},unbind:function(t,e,i,n){var s=n||!1;return t.removeEventListener?t.removeEventListener(e,i,s):t.detachEvent&&t.detachEvent("on"+e,i),M_},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return M_},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return M_},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return b_(e["border-left-width"])+b_(e["border-right-width"])+b_(e["padding-left"])+b_(e["padding-right"])+b_(e.width)},getHeight:function(t){var e=getComputedStyle(t);return b_(e["border-top-width"])+b_(e["border-bottom-width"])+b_(e["padding-top"])+b_(e["padding-bottom"])+b_(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},S_=function(t){function e(t,i){c_(this,e);var n=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),M_.bind(n.__checkbox,"change",(function(){s.setValue(!s.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return p_(e,t),d_(e,[{key:"setValue",value:function(t){var i=u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(__),w_=function(t){function e(t,i,n){c_(this,e);var s=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n,o=s;if(s.__select=document.createElement("select"),i_.isArray(r)){var a={};i_.each(r,(function(t){a[t]=t})),r=a}return i_.each(r,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),o.__select.appendChild(i)})),s.updateDisplay(),M_.bind(s.__select,"change",(function(){var t=this.options[this.selectedIndex].value;o.setValue(t)})),s.domElement.appendChild(s.__select),s}return p_(e,t),d_(e,[{key:"setValue",value:function(t){var i=u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return M_.isActive(this.__select)?this:(this.__select.value=this.getValue(),u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(__),T_=function(t){function e(t,i){c_(this,e);var n=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n;function r(){s.setValue(s.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),M_.bind(n.__input,"keyup",r),M_.bind(n.__input,"change",r),M_.bind(n.__input,"blur",(function(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())})),M_.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return p_(e,t),d_(e,[{key:"updateDisplay",value:function(){return M_.isActive(this.__input)||(this.__input.value=this.getValue()),u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(__);function E_(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var A_=function(t){function e(t,i,n){c_(this,e);var s=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n||{};return s.__min=r.min,s.__max=r.max,s.__step=r.step,i_.isUndefined(s.__step)?0===s.initialValue?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=E_(s.__impliedStep),s}return p_(e,t),d_(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=E_(t),this}}]),e}(__),C_=function(t){function e(t,i,n){c_(this,e);var s=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));s.__truncationSuspended=!1;var r=s,o=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(t){var e=o-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),o=t.clientY}function h(){M_.unbind(window,"mousemove",l),M_.unbind(window,"mouseup",h),a()}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),M_.bind(s.__input,"change",(function(){var t=parseFloat(r.__input.value);i_.isNaN(t)||r.setValue(t)})),M_.bind(s.__input,"blur",(function(){a()})),M_.bind(s.__input,"mousedown",(function(t){M_.bind(window,"mousemove",l),M_.bind(window,"mouseup",h),o=t.clientY})),M_.bind(s.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return p_(e,t),d_(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(A_);function P_(t,e,i,n,s){return n+(t-e)/(i-e)*(s-n)}var L_=function(t){function e(t,i,n,s,r){c_(this,e);var o=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:s,step:r})),a=o;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(P_(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function h(){M_.unbind(window,"mousemove",l),M_.unbind(window,"mouseup",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(t){var e=t.touches[0].clientX,i=a.__background.getBoundingClientRect();a.setValue(P_(e,i.left,i.right,a.__min,a.__max))}function d(){M_.unbind(window,"touchmove",c),M_.unbind(window,"touchend",d),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),M_.bind(o.__background,"mousedown",(function(t){document.activeElement.blur(),M_.bind(window,"mousemove",l),M_.bind(window,"mouseup",h),l(t)})),M_.bind(o.__background,"touchstart",(function(t){1===t.touches.length&&(M_.bind(window,"touchmove",c),M_.bind(window,"touchend",d),c(t))})),M_.addClass(o.__background,"slider"),M_.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return p_(e,t),d_(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",u_(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(A_),R_=function(t){function e(t,i,n){c_(this,e);var s=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=s;return s.__button=document.createElement("div"),s.__button.innerHTML=void 0===n?"Fire":n,M_.bind(s.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),M_.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return p_(e,t),d_(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(__),D_=function(t){function e(t,i){c_(this,e);var n=f_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new m_(n.getValue()),n.__temp=new m_(0);var s=n;n.domElement=document.createElement("div"),M_.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",M_.bind(n.__input,"keydown",(function(t){13===t.keyCode&&d.call(this)})),M_.bind(n.__input,"blur",d),M_.bind(n.__selector,"mousedown",(function(){M_.addClass(this,"drag").bind(window,"mouseup",(function(){M_.removeClass(s.__selector,"drag")}))})),M_.bind(n.__selector,"touchstart",(function(){M_.addClass(this,"drag").bind(window,"touchend",(function(){M_.removeClass(s.__selector,"drag")}))}));var r,o=document.createElement("div");function a(t){p(t),M_.bind(window,"mousemove",p),M_.bind(window,"touchmove",p),M_.bind(window,"mouseup",h),M_.bind(window,"touchend",h)}function l(t){f(t),M_.bind(window,"mousemove",f),M_.bind(window,"touchmove",f),M_.bind(window,"mouseup",c),M_.bind(window,"touchend",c)}function h(){M_.unbind(window,"mousemove",p),M_.unbind(window,"touchmove",p),M_.unbind(window,"mouseup",h),M_.unbind(window,"touchend",h),u()}function c(){M_.unbind(window,"mousemove",f),M_.unbind(window,"touchmove",f),M_.unbind(window,"mouseup",c),M_.unbind(window,"touchend",c),u()}function d(){var t=o_(this.value);!1!==t?(s.__color.__state=t,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function u(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=s.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,r=i.clientY,o=(n-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),o>1?o=1:o<0&&(o=0),s.__color.v=a,s.__color.s=o,s.setValue(s.__color.toOriginal()),!1}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=s.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),s.__color.h=360*i,s.setValue(s.__color.toOriginal()),!1}return i_.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i_.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i_.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i_.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i_.extend(o.style,{width:"100%",height:"100%",background:"none"}),k_(o,"top","rgba(0,0,0,0)","#000"),i_.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=n.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i_.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),M_.bind(n.__saturation_field,"mousedown",a),M_.bind(n.__saturation_field,"touchstart",a),M_.bind(n.__field_knob,"mousedown",a),M_.bind(n.__field_knob,"touchstart",a),M_.bind(n.__hue_field,"mousedown",l),M_.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(o),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return p_(e,t),d_(e,[{key:"updateDisplay",value:function(){var t=o_(this.getValue());if(!1!==t){var e=!1;i_.each(m_.COMPONENTS,(function(i){if(!i_.isUndefined(t[i])&&!i_.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&i_.extend(this.__color.__state,t)}i_.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;i_.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,k_(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),i_.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(__),I_=["-moz-","-o-","-webkit-","-ms-",""];function k_(t,e,i,n){t.style.background="",i_.each(I_,(function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "}))}var O_=function(t,e){var i=t[e];return i_.isArray(arguments[2])||i_.isObject(arguments[2])?new w_(t,e,arguments[2]):i_.isNumber(i)?i_.isNumber(arguments[2])&&i_.isNumber(arguments[3])?i_.isNumber(arguments[4])?new L_(t,e,arguments[2],arguments[3],arguments[4]):new L_(t,e,arguments[2],arguments[3]):i_.isNumber(arguments[4])?new C_(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new C_(t,e,{min:arguments[2],max:arguments[3]}):i_.isString(i)?new T_(t,e):i_.isFunction(i)?new R_(t,e,""):i_.isBoolean(i)?new S_(t,e):null},N_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},U_=function(){function t(){c_(this,t),this.backgroundElement=document.createElement("div"),i_.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),M_.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),i_.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;M_.bind(this.backgroundElement,"click",(function(){e.hide()}))}return d_(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),i_.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",M_.unbind(t.domElement,"webkitTransitionEnd",e),M_.unbind(t.domElement,"transitionend",e),M_.unbind(t.domElement,"oTransitionEnd",e)};M_.bind(this.domElement,"webkitTransitionEnd",e),M_.bind(this.domElement,"transitionend",e),M_.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-M_.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-M_.getHeight(this.domElement)/2+"px"}}]),t}();!function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var s=i.getElementsByTagName("head")[0];try{s.appendChild(n)}catch(t){}}(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var B_="Default",F_=function(){try{return!!window.localStorage}catch(t){return!1}}(),z_=void 0,H_=!0,V_=void 0,G_=!1,W_=[],j_=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M_.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=i_.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=i_.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),i_.isUndefined(n.load)?n.load={preset:B_}:n.preset&&(n.load.preset=n.preset),i_.isUndefined(n.parent)&&n.hideable&&W_.push(this),n.resizable=i_.isUndefined(n.parent)&&n.resizable,n.autoPlace&&i_.isUndefined(n.scrollable)&&(n.scrollable=!0);var s,r=F_&&"true"===localStorage.getItem($_(0,"isLocal")),o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,ex(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?M_.addClass(i.__ul,t.CLASS_CLOSED):M_.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return r},set:function(t){F_&&(r=t,t?M_.bind(window,"unload",o):M_.unbind(window,"unload",o),localStorage.setItem($_(0,"isLocal"),t))}}}),i_.isUndefined(n.parent)){if(this.closed=n.closed||!1,M_.addClass(this.domElement,t.CLASS_MAIN),M_.makeSelectable(this.domElement,!1),F_&&r){i.useLocalStorage=!0;var l=localStorage.getItem($_(0,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,M_.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(M_.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(M_.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),M_.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var h=document.createTextNode(n.name);M_.addClass(h,"controller-name"),a=X_(i,h),M_.addClass(this.__ul,t.CLASS_CLOSED),M_.addClass(a,"title"),M_.bind(a,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(i_.isUndefined(n.parent)&&(H_&&(V_=document.createElement("div"),M_.addClass(V_,"dg"),M_.addClass(V_,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(V_),H_=!1),V_.appendChild(this.domElement),M_.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||ex(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},M_.bind(window,"resize",this.__resizeHandler),M_.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),M_.bind(this.__ul,"transitionend",this.__resizeHandler),M_.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&tx(this),o=function(){F_&&"true"===localStorage.getItem($_(0,"isLocal"))&&localStorage.setItem($_(0,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=o,n.parent||((s=i.getRoot()).width+=1,i_.defer((function(){s.width-=1})))};function X_(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function Y_(t){M_.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&M_.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function q_(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function K_(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var s=i.__rememberedObjectIndecesToControllers[n];if(void 0===s&&(s={},i.__rememberedObjectIndecesToControllers[n]=s),s[e.property]=e,i.load&&i.load.remembered){var r=i.load.remembered,o=void 0;if(r[t.preset])o=r[t.preset];else{if(!r[B_])return;o=r[B_]}if(o[n]&&void 0!==o[n][e.property]){var a=o[n][e.property];e.initialValue=a,e.setValue(a)}}}}function Z_(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var s=void 0;if(n.color)s=new D_(e,i);else{var r=[e,i].concat(n.factoryArgs);s=O_.apply(t,r)}n.before instanceof __&&(n.before=n.before.__li),K_(t,s),M_.addClass(s.domElement,"c");var o=document.createElement("span");M_.addClass(o,"property-name"),o.innerHTML=s.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(s.domElement);var l=X_(t,a,n.before);return M_.addClass(l,j_.CLASS_CONTROLLER_ROW),s instanceof D_?M_.addClass(l,"color"):M_.addClass(l,h_(s.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,i_.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),Z_(t,i.object,i.property,{before:n,factoryArgs:[i_.toArray(arguments)]})}if(i_.isArray(e)||i_.isObject(e)){var s=i.__li.nextElementSibling;return i.remove(),Z_(t,i.object,i.property,{before:s,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof L_){var n=new C_(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});i_.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],s=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return s.apply(n,t),e.apply(i,t)}})),M_.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof C_){var s=function(e){if(i_.isNumber(i.__min)&&i_.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,s=i.__gui.__listening.indexOf(i)>-1;i.remove();var r=Z_(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return r.name(n),s&&r.listen(),r}return e};i.min=i_.compose(s,i.min),i.max=i_.compose(s,i.max)}else i instanceof S_?(M_.bind(e,"click",(function(){M_.fakeEvent(i.__checkbox,"click")})),M_.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof R_?(M_.bind(e,"click",(function(){M_.fakeEvent(i.__button,"click")})),M_.bind(e,"mouseover",(function(){M_.addClass(i.__button,"hover")})),M_.bind(e,"mouseout",(function(){M_.removeClass(i.__button,"hover")}))):i instanceof D_&&(M_.addClass(e,"color"),i.updateDisplay=i_.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=i_.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&q_(t.getRoot(),!0),e}),i.setValue)}(t,l,s),t.__controllers.push(s),s}function $_(t,e){return document.location.href+"."+e}function J_(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Q_(t,e){e.style.display=t.useLocalStorage?"block":"none"}function tx(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){M_.removeClass(t.__closeButton,j_.CLASS_DRAG),M_.unbind(window,"mousemove",i),M_.unbind(window,"mouseup",n)}function s(s){return s.preventDefault(),e=s.clientX,M_.addClass(t.__closeButton,j_.CLASS_DRAG),M_.bind(window,"mousemove",i),M_.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),i_.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),M_.bind(t.__resize_handle,"mousedown",s),M_.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function ex(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function ix(t,e){var i={};return i_.each(t.__rememberedObjects,(function(n,s){var r={},o=t.__rememberedObjectIndecesToControllers[s];i_.each(o,(function(t,i){r[i]=e?t.initialValue:t.getValue()})),i[s]=r})),i}function nx(t){0!==t.length&&N_.call(window,(function(){nx(t)})),i_.each(t,(function(t){t.updateDisplay()}))}j_.toggleHide=function(){G_=!G_,i_.each(W_,(function(t){t.domElement.style.display=G_?"none":""}))},j_.CLASS_AUTO_PLACE="a",j_.CLASS_AUTO_PLACE_CONTAINER="ac",j_.CLASS_MAIN="main",j_.CLASS_CONTROLLER_ROW="cr",j_.CLASS_TOO_TALL="taller-than-window",j_.CLASS_CLOSED="closed",j_.CLASS_CLOSE_BUTTON="close-button",j_.CLASS_CLOSE_TOP="close-top",j_.CLASS_CLOSE_BOTTOM="close-bottom",j_.CLASS_DRAG="drag",j_.DEFAULT_WIDTH=245,j_.TEXT_CLOSED="Close Controls",j_.TEXT_OPEN="Open Controls",j_._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||j_.toggleHide()},M_.bind(window,"keydown",j_._keydownHandler,!1),i_.extend(j_.prototype,{add:function(t,e){return Z_(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Z_(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;i_.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&V_.removeChild(this.domElement);var t=this;i_.each(this.__folders,(function(e){t.removeFolder(e)})),M_.unbind(window,"keydown",j_._keydownHandler,!1),Y_(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new j_(e);this.__folders[t]=i;var n=X_(this,i.domElement);return M_.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Y_(t);var e=this;i_.each(t.__folders,(function(e){t.removeFolder(e)})),i_.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=M_.getOffset(t.__ul).top,i=0;i_.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=M_.getHeight(e))})),window.innerHeight-e-20<i?(M_.addClass(t.domElement,j_.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(M_.removeClass(t.domElement,j_.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&i_.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:i_.debounce((function(){this.onResize()}),50),remember:function(){if(i_.isUndefined(z_)&&((z_=new U_).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;i_.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");M_.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),M_.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",M_.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",M_.addClass(n,"button"),M_.addClass(n,"save");var s=document.createElement("span");s.innerHTML="New",M_.addClass(s,"button"),M_.addClass(s,"save-as");var r=document.createElement("span");r.innerHTML="Revert",M_.addClass(r,"button"),M_.addClass(r,"revert");var o=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?i_.each(t.load.remembered,(function(e,i){J_(t,i,i===t.preset)})):J_(t,B_,!1),M_.bind(o,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(o),e.appendChild(i),e.appendChild(n),e.appendChild(s),e.appendChild(r),F_){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem($_(0,"isLocal"))&&l.setAttribute("checked","checked"),Q_(t,a),M_.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,Q_(t,a)}))}var h=document.getElementById("dg-new-constructor");M_.bind(h,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||z_.hide()})),M_.bind(i,"click",(function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),z_.show(),h.focus(),h.select()})),M_.bind(n,"click",(function(){t.save()})),M_.bind(s,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),M_.bind(r,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&ex(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=ix(this)),t.folders={},i_.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ix(this),q_(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[B_]=ix(this,!0)),this.load.remembered[t]=ix(this),this.preset=t,J_(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){i_.each(this.__controllers,(function(e){this.getRoot().load.remembered?K_(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),i_.each(this.__folders,(function(t){t.revert(t)})),t||q_(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&nx(this.__listening)},updateDisplay:function(){i_.each(this.__controllers,(function(t){t.updateDisplay()})),i_.each(this.__folders,(function(t){t.updateDisplay()}))}});var sx=j_;sx.prototype.addThreeColor=function(t,e,i){var n={};return n[e]=t[e].getStyle(),this.addColor(n,e).onChange((i=>{t[e].setStyle(i)}))},sx.prototype.addThreeUniformColor=function(t,e,i,n){return this.addThreeColor(t.uniforms[e],"value",n).name(i||e)};class rx{constructor(){this._folders=new Map,this._gui=new sx({width:350})}despawn(){return t=this,e=void 0,n=function*(){},new((i=void 0)||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}));var t,e,i,n}applyGameConfig(t){t.debug.debugUI,this.hideUI()}hideUI(){this._gui.domElement.style.display="none"}addFolder(t,e){if(!this._folders.has(t)){let i,n=this._folders.get(e);i=void 0===n?this._gui.addFolder(t):n.addFolder(t),this._folders.set(t,i)}}addText(t,e,i,n,s){let r=this._folders.get(t),o=void 0!==r?r:this._gui,a=`${t}_${i}_${n}`;return null==o||o.add(e,i).name(n).onChange((t=>{void 0!==s&&s(t)})).listen(),a}addSlider(t,e,i,n,s,r,o){let a=this._folders.get(t),l=void 0!==a?a:this._gui,h=`${t}_${i}_${r}`;return null==l||l.add(e,i,n,s).name(r).onChange((t=>{void 0!==o&&o(t)})).listen(),h}addCheckbox(t,e,i,n,s){let r=this._folders.get(t),o=void 0!==r?r:this._gui,a=`${t}_${i}_${n}`;return null==o||o.add(e,i).name(n).onChange((t=>{void 0!==s&&s(t)})).listen(),a}addColorPicker(t,e,i,n,s){let r=this._folders.get(t),o=void 0!==r?r:this._gui,a=`${t}_${i}_${n}`;return null==o||o.addThreeColor(e,i,a).name(n).onChange((t=>{void 0!==s&&s(t)})).listen(),a}addButton(t,e,i,n){let s=this._folders.get(t),r=void 0!==s?s:this._gui,o=`${t}_${i}_${n}`;return null==r||r.add(e,i).name(n),o}addDropdown(t,e,i,n,s,r){let o=this._folders.get(t),a=void 0!==o?o:this._gui,l=`${t}_${i}_${s}`;return null==a||a.add(e,i,n).name(s).onChange((t=>{void 0!==r&&r(t)})).listen(),l}removeProperty(t,e){let i=this._folders.get(t),n=void 0!==i?i:this._gui;if(void 0!==n)for(let t=0;t<n.__controllers.length;t++)n.__controllers[t].property==e&&n.remove(n.__controllers[t])}removeFolder(t){let e=this._folders.get(t);void 0!==e&&(e.parent.removeFolder(e),this._folders.delete(t))}}class ox{constructor(t,e,i){this._currentSelected=0,this._names=[],this._spawnedButtons=[],this._callback=i,this._parent=document.createElement("div"),this._parent.className="buttonsWithSelectionParent",this._parent.style.display="none",t.appendChild(this._parent);let n=document.createElement("div");n.className="buttonsWithSelectionTitle",n.innerHTML=e,this._parent.appendChild(n)}init(t,e=0){this.clear(),this._names=t,this._currentSelected=e,this._parent.style.display="block";for(let i=0;i<t.length;i++){let n=document.createElement("div");n.className=i==e?"buttonsWithSelectionSelected":"buttonsWithSelection",n.innerHTML=t[i],this._parent.appendChild(n),this._spawnedButtons.push(n);let s=i;n.onclick=()=>{this.changeSelectedButton(s)},n.addEventListener("mouseenter",(()=>{n.style.cursor="pointer"})),n.addEventListener("mouseleave",(()=>{n.style.cursor="default"}))}}clear(){this._names=[],this._currentSelected=0,this._parent.style.display="none";for(let t=0;t<this._spawnedButtons.length;++t)this._parent.removeChild(this._spawnedButtons[t]);this._spawnedButtons=[]}changeSelectedButton(t){this._spawnedButtons[this._currentSelected].className="buttonsWithSelection",this._currentSelected=t,this._spawnedButtons[this._currentSelected].className="buttonsWithSelectionSelected",this._callback(this._names[t])}}class ax{constructor(){this._originalMat=[]}registerModel(t){this.clearCache(),this._model=t,t.traverse((t=>{(t instanceof Mc||t instanceof Op)&&this._originalMat.push(t.material)}))}clearCache(){this.resetOriginalMat(),this._originalMat=[],this._model=void 0}applyMaterial(t){void 0!==this._model&&this._model.traverse((e=>{(e instanceof Mc||e instanceof Op)&&(e.material=t)}))}resetOriginalMat(){var t;let e=0;null===(t=this._model)||void 0===t||t.traverse((t=>{(t instanceof Mc||t instanceof Op)&&(t.material=this._originalMat[e],++e)}))}}class lx{constructor(t,e,i,n,s,r){this._currentValue=0,this._minValue=0,this._maxValue=0,this._mouseX=0,this._changeSlider=!1,this._minValue=i,this._maxValue=n,this._currentValue=s,this._callback=r;let o=document.createElement("div");o.className="horizontalSliderParent",t.appendChild(o);let a=document.createElement("div");a.className="horizontalSliderTitle",a.innerHTML=e,o.appendChild(a);let l=document.createElement("div");l.className="horizontalSliderBtn",o.appendChild(l),this._textDiv=document.createElement("div"),this._textDiv.className="horizontalSliderText",this._textDiv.innerHTML=""+this._currentValue,l.appendChild(this._textDiv),l.addEventListener("mouseenter",(()=>{l.style.cursor="pointer"})),l.addEventListener("mouseleave",(()=>{l.style.cursor="default"})),l.addEventListener("mousedown",(t=>{this._changeSlider=!0,this._mouseX=t.clientX})),window.addEventListener("mouseup",(()=>{this._changeSlider=!1})),window.addEventListener("mousemove",(t=>{this.calculateSliderValue(t.clientX)}))}resetValue(){this._currentValue=0,this._textDiv.innerHTML="0",this._callback(this._currentValue)}calculateSliderValue(t){if(!this._changeSlider)return;let e=t-this._mouseX;this._currentValue+=e,this._currentValue<this._minValue&&(this._currentValue=this._maxValue-(this._minValue-this._currentValue)),this._currentValue>this._maxValue&&(this._currentValue=this._minValue+(this._currentValue-this._maxValue)),this._textDiv.innerHTML=""+Math.floor(this._currentValue),this._callback(this._currentValue),this._mouseX=t}}function hx(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))}const cx=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function dx(t){return t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const ux="undefined"==typeof window,px=(()=>{if(ux)return;const{userAgent:t,platform:e,maxTouchPoints:i}=window.navigator,n=/(iphone|ipod|ipad)/i.test(t),s="iPad"===e||"MacIntel"===e&&i>0&&!window.MSStream;return{isIpad:s,isMobile:/android/i.test(t)||n||s,isSafari12:/Version\/12.+Safari/.test(t)}})();class fx extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}const mx=[],gx=[];function vx(t,e){if(t===e)return 0;const i=t;t.length>e.length&&(t=e,e=i);let n=t.length,s=e.length;for(;n>0&&t.charCodeAt(~-n)===e.charCodeAt(~-s);)n--,s--;let r,o=0;for(;o<n&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,s-=o,0===n)return s;let a,l,h=0,c=0,d=0;for(;c<n;)gx[c]=t.charCodeAt(o+c),mx[c]=++c;for(;d<s;)for(r=e.charCodeAt(o+d),a=d++,h=d,c=0;c<n;c++)l=r===gx[c]?a:a+1,a=mx[c],h=mx[c]=a>h?l>h?h+1:l:l>a?a+1:l;return h}function _x(t){return null!=t}const xx=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:i={},glContext:n,failIfMajorPerformanceCaveat:s=!1,benchmarksURL:r="https://unpkg.com/detect-gpu@5.0.37/dist/benchmarks"}={})=>hx(void 0,void 0,void 0,(function*(){const o={};if(ux)return{tier:0,type:"SSR"};const{isIpad:a=!!(null==px?void 0:px.isIpad),isMobile:l=!!(null==px?void 0:px.isMobile),screenSize:h=window.screen,loadBenchmarks:c=(t=>hx(void 0,void 0,void 0,(function*(){const e=yield fetch(`${r}/${t}`).then((t=>t.json()));if(parseInt(e.shift().split(".")[0],10)<4)throw new fx("Detect GPU benchmark data is out of date. Please update to version 4x");return e})))}=i;let{renderer:d}=i;const u=(t,e,i,n,s)=>({device:s,fps:n,gpu:i,isMobile:l,tier:t,type:e});let p,f="";if(d)d=dx(d),p=[d];else{const t=n||function(t,e=!1){const i={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:e,powerPreference:"high-performance",stencil:!1};t&&delete i.powerPreference;const n=window.document.createElement("canvas"),s=n.getContext("webgl",i)||n.getContext("experimental-webgl",i);return null!=s?s:void 0}(null==px?void 0:px.isSafari12,s);if(!t)return u(0,"WEBGL_UNSUPPORTED");const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&(d=t.getParameter(e.UNMASKED_RENDERER_WEBGL)),!d)return u(1,"FALLBACK");f=d,d=dx(d),p=function(t,e,i){return"apple gpu"===e?function(t,e,i){if(!i)return[e];const n=function(t){const e=t.createShader(35633),i=t.createShader(35632),n=t.createProgram();if(!(i&&e&&n))return;t.shaderSource(e,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),t.shaderSource(i,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),t.compileShader(e),t.compileShader(i),t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.detachShader(n,e),t.detachShader(n,i),t.deleteShader(e),t.deleteShader(i),t.useProgram(n);const s=t.createBuffer();t.bindBuffer(34962,s),t.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const r=t.getAttribLocation(n,"aPosition");t.vertexAttribPointer(r,3,5126,!1,0,0),t.enableVertexAttribArray(r),t.clearColor(1,1,1,1),t.clear(16384),t.viewport(0,0,1,1),t.drawArrays(4,0,3);const o=new Uint8Array(4);return t.readPixels(0,0,1,1,6408,5121,o),t.deleteProgram(n),t.deleteBuffer(s),o.join("")}(t),s="801621810",r="8016218135",o="80162181161",a=(null==px?void 0:px.isIpad)?[["a7",o,12],["a8",r,15],["a8x",r,15],["a9",r,15],["a9x",r,15],["a10",r,15],["a10x",r,15],["a12",s,15],["a12x",s,15],["a12z",s,15],["a14",s,15],["m1",s,15]]:[["a7",o,12],["a8",r,12],["a9",r,15],["a10",r,15],["a11",s,15],["a12",s,15],["a13",s,15],["a14",s,15]];let l;return"80162181255"===n?l=a.filter((([,,t])=>t>=14)):(l=a.filter((([,t])=>t===n)),l.length||(l=a)),l.map((([t])=>`apple ${t} gpu`))}(t,e,i):[e]}(t,d,l)}const m=(yield Promise.all(p.map((function(t){var e;return hx(this,void 0,void 0,(function*(){const i=(t=>{const e=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce"];for(const i of e)if(t.includes(i))return i})(t);if(!i)return;const n=`${l?"m":"d"}-${i}${a?"-ipad":""}.json`,s=o[n]=null!==(e=o[n])&&void 0!==e?e:c(n);let r;try{r=yield s}catch(i){if(i instanceof fx)throw i;return}const d=function(t){var e;const i=(t=t.replace(/\([^)]+\)/,"")).match(/\d+/)||t.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(e=null==i?void 0:i.join("").replace(/\W|amd/g,""))&&void 0!==e?e:""}(t);let u=r.filter((([,t])=>t===d));u.length||(u=r.filter((([e])=>e.includes(t))));const p=u.length;if(0===p)return;const f=t.split(/[.,()\[\]/\s]/g).sort().filter(((t,e,i)=>0===e||t!==i[e-1])).join(" ");let m,[g,,,,v]=p>1?u.map((t=>[t,vx(f,t[2])])).sort((([,t],[,e])=>t-e))[0][0]:u[0],_=Number.MAX_VALUE;const{devicePixelRatio:x}=window,y=h.width*x*h.height*x;for(const t of v){const[e,i]=t,n=e*i,s=Math.abs(y-n);s<_&&(_=s,m=t)}if(!m)return;const[,,b,M]=m;return[_,b,g,M]}))})))).filter(_x).sort((([t=Number.MAX_VALUE,e],[i=Number.MAX_VALUE,n])=>t===i?e-n:t-i));if(!m.length){const t=cx.find((t=>d.includes(t)));return t?u(0,"BLOCKLISTED",t):u(1,"FALLBACK",`${d} (${f})`)}const[,g,v,_]=m[0];if(-1===g)return u(0,"BLOCKLISTED",v,g,_);const x=l?t:e;let y=0;for(let t=0;t<x.length;t++)g>=x[t]&&(y=t);return u(y,"BENCHMARK",v,g,_)}));class yx{constructor(){this._currentAnimations=new Map,this._currentModelName="",this._previousAnim="",this._lightSettings=void 0,this._isMobile=!1,this._debugPostSettings={_bloomRadius:.05,_bloomStrength:1,_bloomThreshold:1,_chromaAberrationLength:.05,_chromaAberrationRedOut:!1,_vignetteOffset:1,_vignetteDarkness:1,_lutName:"Bourbon 64.CUBE",_lutIntensity:0},this._debugSceneConfig={_backgroundColor:new Vh(16777215),_directionalIntensity:3,_litLighting:!0,_maxZoom:10,_minZoom:.1,_ambientIntensity:1,_lightColor:new Vh(16777215)},this._panel=document.createElement("div"),this._panel.id="threeModelViewParent",this._panel.style.display="none",document.body.appendChild(this._panel);let t=document.createElement("div");t.id="threeModelView",t.className="fullwidth",this._panel.appendChild(t);let e=document.createElement("canvas");e.className="fullres",t.appendChild(e),this._panel.onclick=()=>{this.hideView()},t.onclick=t=>{t.stopPropagation()},this._cameraManager=new ig(e),this._objectLoader=new Jv,this._materialCache=new ax,this.onModelLoaded=this.onModelLoaded.bind(this),this.onModelProgress=this.onModelProgress.bind(this),bx&&this.createDebugUI(),this.checkStats(t)}checkStats(t){return e=this,i=void 0,s=function*(){let e=yield xx();this._isMobile=1==e.isMobile,this._cameraManager.isMobile=this._isMobile,this.createSettingsPanel(t)},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}l((s=s.apply(e,i||[])).next())}));var e,i,n,s}activateView(t,e){if(yx.isDownloadingModel)return;yx.isDownloadingModel=!0;let i=lg[t];this._currentModelName=t,this._currentProgressBar=e,this._cameraManager.applySceneConfig(i.sceneConfig),this._cameraManager.applyPostProcessing(i.postProcessing),this._debugPostSettings._bloomRadius=i.postProcessing._bloomRadius,this._debugPostSettings._bloomStrength=i.postProcessing._bloomStrength,this._debugPostSettings._bloomThreshold=i.postProcessing._bloomThreshold,this._debugPostSettings._chromaAberrationLength=i.postProcessing._chromaAberrationLength,this._debugPostSettings._chromaAberrationRedOut=i.postProcessing._chromaAberrationRedOut,this._debugPostSettings._vignetteDarkness=i.postProcessing._vignetteDarkness,this._debugPostSettings._vignetteOffset=i.postProcessing._vignetteOffset,this._debugPostSettings._lutName=i.postProcessing._lutName,this._debugPostSettings._lutIntensity=i.postProcessing._lutIntensity,this._debugSceneConfig._ambientIntensity=i.sceneConfig._ambientIntensity,this._debugSceneConfig._backgroundColor=i.sceneConfig._backgroundColor,this._debugSceneConfig._directionalIntensity=i.sceneConfig._directionalIntensity,this._debugSceneConfig._lightColor=i.sceneConfig._lightColor,this._debugSceneConfig._minZoom=i.sceneConfig._minZoom,this._debugSceneConfig._maxZoom=i.sceneConfig._maxZoom,this._cameraManager.resetCamera(),this._objectLoader.loadModel(i.path,this.onModelLoaded,this.onModelProgress),""==lg[t].artist?this._artistCredits.style.display="none":(this._artistCredits.style.display="block",this._artistCredits.innerHTML=lg[t].artist),Ax.setActive(!1)}hideView(){this._panel.style.display="none",void 0!==this._currentModel&&(this._cameraManager.scene.remove(this._currentModel),this._currentModel=void 0),Ax.setActive(!0)}update(t){"block"==this._panel.style.display&&(this._cameraManager.update(t),void 0!==this._animMixer&&this._animMixer.update(t))}onModelLoaded(t){this._panel.style.display="block",this._currentModel=t.model;let e=lg[this._currentModelName].scale;this._currentModel.scale.set(e,e,e),this._currentModel.updateMatrixWorld(),this._cameraManager.scene.add(this._currentModel);var i=(new Tl).setFromObject(this._currentModel);let n=new Ml;i.getCenter(n),this._cameraManager.controls.target=n,this._cameraManager.camera.position.copy(lg[this._currentModelName].cameraPos),this._materialCache.registerModel(this._currentModel),this._meshSettings.changeSelectedButton(0),this._lightSettings&&this._lightSettings.resetValue(),this.findModelAnimations(t),this.findModelStatistics(),yx.isDownloadingModel=!1}onModelProgress(t){let e=t/lg[this._currentModelName].totalBytes;void 0!==this._currentProgressBar&&(this._currentProgressBar.style.width=100*e+"%")}findModelAnimations(t){this._poseSettings.clear(),this._currentAnimations.clear(),this._animMixer=void 0,this._previousAnim="";let e=[],i=lg[this._currentModelName].animations,n=0;for(let i=0;i<t.animations.length;++i)e.push(t.animations[i].name);if(e.length>1){this._animMixer=new Em(this._currentModel);for(let s=0;s<e.length;++s){let r=this._animMixer.clipAction(t.animations[s]);void 0!==i&&(void 0!==i.firstAnimation&&e[s]==i.firstAnimation&&(n=s),void 0!==i[e[s]]&&(r.setLoop(i[e[s]].looping?2201:2200,100),r.clampWhenFinished=!0,r.timeScale=i[e[s]].speed)),this._currentAnimations.set(e[s],r)}this._poseSettings.init(e,n),this.onPoseChanged(e[n])}}findModelStatistics(){let t=0,e=0;this._currentModel.traverseVisible((i=>{if(i instanceof Mc||i instanceof Op){const n=i.geometry;t+=n.attributes.position.count,null!==n.index?e+=n.index.count/3:e+=n.attributes.position.count/3}})),this._trisCounter.innerHTML=`Vertices: ${this.prettyPrintNumber(t)}<br>Triangles: ${this.prettyPrintNumber(e)}`}prettyPrintNumber(t){let e=Math.floor(t),i="";return e>1e3&&(i=" K",e/=1e3),e>1e3&&(i=" M",e/=1e3),parseFloat(e.toFixed(2))+i}createDebugUI(){this.onDebugUIChanged=this.onDebugUIChanged.bind(this),this._gui=new rx,this._gui.addSlider("",this._debugPostSettings,"_bloomRadius",0,1,"Bloom Radius",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_bloomStrength",0,3,"Bloom Strength",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_bloomThreshold",0,1,"Bloom Threshold",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_chromaAberrationLength",0,.25,"CHA Length",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_vignetteOffset",0,1,"Vignette Offset",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_vignetteDarkness",0,1,"Vignette Darkness",this.onDebugUIChanged),this._gui.addCheckbox("",this._debugPostSettings,"_chromaAberrationRedOut","Red Out",this.onDebugUIChanged),this._gui.addSlider("",this._debugSceneConfig,"_ambientIntensity",0,3,"Ambient",this.onDebugUIChanged),this._gui.addSlider("",this._debugSceneConfig,"_directionalIntensity",0,10,"Directional",this.onDebugUIChanged),this._gui.addColorPicker("",this._debugSceneConfig,"_lightColor","LightColor",(t=>{this._debugSceneConfig._lightColor.setStyle(t),this.onDebugUIChanged()})),this._gui.addSlider("",this._debugSceneConfig,"_minZoom",0,3,"MinZoom",this.onDebugUIChanged),this._gui.addSlider("",this._debugSceneConfig,"_maxZoom",0,10,"MaxZoom",this.onDebugUIChanged);let t=Object.keys(eg);this._gui.addDropdown("",this._debugPostSettings,"_lutName",t,"Lut",this.onDebugUIChanged),this._gui.addSlider("",this._debugPostSettings,"_lutIntensity",0,1,"Lut Intensity",this.onDebugUIChanged)}createSettingsPanel(t){this.onPoseChanged=this.onPoseChanged.bind(this),this.onModelSettingChanged=this.onModelSettingChanged.bind(this),this.onLightSliderChanged=this.onLightSliderChanged.bind(this);let e,i=document.createElement("div");i.id="threeViewSettingsParent",t.appendChild(i),this._trisCounter=document.createElement("div"),this._trisCounter.className="threeViewTrisCounter",i.appendChild(this._trisCounter),this._isMobile||(this._lightSettings=new lx(i,"Light Angle",0,360,0,this.onLightSliderChanged)),this._poseSettings=new ox(i,"Mesh Poses",this.onPoseChanged),this._meshSettings=new ox(i,"Mesh Rendering",this.onModelSettingChanged),e=this._isMobile?["Shaded","Base Color","Base Color + Wireframe","Wireframe","NormalMap","Matcap"]:["Final Render","No Post-Processing","Base Color","Base Color + Wireframe","Wireframe","NormalMap","Matcap"],this._meshSettings.init(e,0);let n=document.createElement("div");n.className="closeBtn",n.innerHTML="X",t.appendChild(n),n.onclick=()=>{this.hideView()},n.addEventListener("mouseenter",(()=>{n.style.cursor="pointer"})),n.addEventListener("mouseleave",(()=>{n.style.cursor="default"}));let s=document.createElement("div");s.id="modelDownloadBtn",s.innerHTML="Download",i.appendChild(s),s.onclick=()=>{this.downloadModel()},s.addEventListener("mouseenter",(()=>{s.style.cursor="pointer"})),s.addEventListener("mouseleave",(()=>{s.style.cursor="default"})),this._artistCredits=document.createElement("div"),this._artistCredits.id="artistCredits",t.appendChild(this._artistCredits)}onModelSettingChanged(t){var e,i,n,s,r;if(this._materialCache.resetOriginalMat(),this._cameraManager.usePostProcessing=!1,"Final Render"==t)this._cameraManager.usePostProcessing=!0;else if("No Post-Processing"==t||"Shaded"==t);else if("Base Color + Wireframe"==t)null===(e=this._currentModel)||void 0===e||e.traverse((t=>{(t instanceof Mc||t instanceof Op)&&(t.material=t.material.clone(),t.material.wireframe=!0)}));else if("Wireframe"==t){let t=new Wh({color:0,wireframe:!0});null===(i=this._currentModel)||void 0===i||i.traverse((e=>{(e instanceof Mc||e instanceof Op)&&(e.material=t)}))}else"Base Color"==t?null===(n=this._currentModel)||void 0===n||n.traverse((t=>{if(t instanceof Mc||t instanceof Op){let e=t.material.color,i=t.material.map;null!=i&&null!=i||(i=t.material.emissiveMap),"Outline"!=t.material.name&&"outline"!=t.material.name||(e=new Vh(0)),t.material=new Wh({color:e,map:i})}})):"NormalMap"==t?null===(s=this._currentModel)||void 0===s||s.traverse((t=>{(t instanceof Mc||t instanceof Op)&&(t.material=new xf({normalMap:t.material.normalMap}))})):"Matcap"==t&&(null===(r=this._currentModel)||void 0===r||r.traverse((t=>{(t instanceof Mc||t instanceof Op)&&(t.material=new bf({color:16777215}))})))}onPoseChanged(t){if(""!=this._previousAnim){let t=this._currentAnimations.get(this._previousAnim);void 0!==t&&t.fadeOut(3).stop()}let e=this._currentAnimations.get(t);void 0!==e&&e.fadeIn(3).play(),this._previousAnim=t}onLightSliderChanged(t){this._cameraManager.setDirLightAngle(t*(Math.PI/180))}onDebugUIChanged(){this._cameraManager.applyPostProcessing(this._debugPostSettings),this._cameraManager.applySceneConfig(this._debugSceneConfig)}downloadModel(){const t=document.createElement("a");t.href=lg[this._currentModelName].path,t.download=this._currentModelName+".glb",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}yx.isDownloadingModel=!1;const bx=!1,Mx={currentTime:0,deltaTime:0},Sx={value:!1},wx={value:window.innerWidth/window.innerHeight<1},Tx=new class{constructor(){this._icons=[],this.createElements()}createElements(){const t=document.createElement("div");t.id="homePanelParent",t.className="fullwidth",document.body.appendChild(t),this._banner=document.createElement("img"),this._banner.id="banner",t.appendChild(this._banner),this.updateBanner();let e=document.createElement("div");e.id="homePanelTitleParent",t.appendChild(e);let i=document.createElement("div");i.id="homePanelTitle",i.innerHTML="Ionu&#x021b; Opria",e.appendChild(i);let n=document.createElement("div");n.id="homePanelSubtitle",n.innerHTML="Game Programmer",e.appendChild(n);let s=document.createElement("div");s.id="linksParent",e.appendChild(s),this.createCellLink(s,"./images/icons/linkedin.jpg","https://www.linkedin.com/in/ionut-opria-6164b5150/"),this.createCellLink(s,"./images/icons/github.jpg","https://github.com/OpriaIonut"),this.createCellLink(s,"./images/icons/itch.jpg","https://kirirato.itch.io"),this.createCellLink(s,"./images/icons/artstation.jpg","https://www.artstation.com/kirirato16"),this.createCellLink(s,"./images/icons/twitter.jpg","https://twitter.com/Kirirato"),this.createCellLink(s,"./images/icons/CV3.jpg","CV");let r=document.createElement("div");r.innerHTML="Contact: ionutopriaofficial@gmail.com",r.id="homePanelContact",e.appendChild(r)}createCellLink(t,e,i){let n=document.createElement("img");n.className="homePageReferalLink",n.src=e,"CV"==i?n.addEventListener("mousedown",(()=>{this.downloadFile("CV Ionut Opria.pdf","CV Ionut Opria.pdf")})):n.addEventListener("mousedown",(()=>{window.open(i,"_blank")})),n.style.cursor="pointer",t.appendChild(n),this._icons.push(n)}downloadFile(t,e){const i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}updateBanner(){this._banner.src=b[document.documentElement.className];for(let t=0;t<this._icons.length;++t)"grayscaleTheme"==document.documentElement.className?this._icons[t].classList.add("grayscale"):this._icons[t].classList.remove("grayscale")}},Ex=document.createElement("div");Ex.id="pageParent",document.body.appendChild(Ex);const Ax=new class{constructor(t,e){this._innerPos={x:0,y:0},this._outerPos={x:0,y:0},this._lastMousePos={x:0,y:0},this._innerSpeed=t,this._outerSpeed=e,this._innerElem=document.createElement("div"),this._innerElem.id="mouseMoveInner",document.body.appendChild(this._innerElem),this._outerElem=document.createElement("div"),this._outerElem.id="mouseMoveOuter",document.body.appendChild(this._outerElem),this.onMouseMove=this.onMouseMove.bind(this),window.addEventListener("mousemove",this.onMouseMove)}update(){this._innerElem.style.display=wx.value?"none":"block",this._outerElem.style.display=wx.value?"none":"block",this._innerPos.x=e(this._innerPos.x,this._lastMousePos.x,this._innerSpeed*Mx.deltaTime),this._innerPos.y=e(this._innerPos.y,this._lastMousePos.y,this._innerSpeed*Mx.deltaTime),this._outerPos.x=e(this._outerPos.x,this._lastMousePos.x,this._outerSpeed*Mx.deltaTime),this._outerPos.y=e(this._outerPos.y,this._lastMousePos.y,this._outerSpeed*Mx.deltaTime),this._innerElem.style.top=`${this._innerPos.y}px`,this._innerElem.style.left=`${this._innerPos.x}px`,this._outerElem.style.top=`${this._outerPos.y}px`,this._outerElem.style.left=`${this._outerPos.x}px`}onMouseMove(t){this._lastMousePos.x=t.clientX,this._lastMousePos.y=t.clientY}setActive(t){this._innerElem.style.display=t?"block":"none",this._outerElem.style.display=t?"block":"none"}}(.75,.4),Cx=(new class{constructor(){this._buttons=[];let e=document.createElement("div");e.id="colorThemeBtnParent",document.body.appendChild(e);let i=Object.keys(t);for(let n=0;n<i.length;++n){let s=document.createElement("div");s.className="colorThemeBtn",s.style.backgroundColor=t[i[n]],s.onclick=()=>{i[n]!=document.documentElement.className&&(document.documentElement.className=i[n],Tx.updateBanner(),Cx.updateColorTheme(),Px.updateChartColors(),Rx.updateColorTheme(),Dx.updateColorTheme(),Ix.updateColorTheme(),kx.updateColorTheme(),this.setActiveBorder())},e.appendChild(s),this._buttons.push(s)}this.setActiveBorder()}setActiveBorder(){let e=Object.keys(t);for(let t=0;t<e.length;++t)this._buttons[t].style.border="",e[t]==document.documentElement.className&&(this._buttons[t].style.border="3px solid #fff")}},new class{constructor(t){this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="aboutMeParent",e.className="fullwidth",t.appendChild(e);let i=document.createElement("div");i.className="sectionTitle",i.innerHTML="About Me",e.appendChild(i);let n=document.createElement("div");n.id="aboutMeDescription",n.innerHTML="\n        Hello and thank you for checking out my portfolio!<br><br>\n        My name is Ionu&#x021b; Opria and I'm from Romania. I'm a versatile Software Developer with 4 years of experience in building Unity and web-based applications. During my career I developed various types of applications and aquired a wide variety of skills, ranging from <b>engine programming, graphics programming, network programming, web development</b> using <b>Three.js</b>, <b>Unity development</b> for <b>games & VR applications</b>.<br><br>\n        I've always been curios about how games work underneath the surface, which is what got me into programming (and 3D modelling later on). I'm passionate about building games, learning how complex mechanics should be implemented properly, what optimizations are required to ship successful games and how I can best contribute to the projects I'm working on.<br><br>\n        I love the process of learning new things, improving my skills as much as I can and I don't shy away from difficult problems, because in my opinion, the harder the problem, the more things there are to be learned.<br><br>\n        <b>Hobbies:</b> 3D modelling, cosplaying, learning Japanese, going to rock concerts & mountain hikes, volunteering, playing games and generally trying new experiences.<br>\n        <b>Languages:</b> Romanian, English, very basic Japanese.",e.appendChild(n);let s=document.createElement("div");s.className="separator",e.appendChild(s)}updateColorTheme(){void 0!==this._aboutMePhoto&&("grayscaleTheme"==document.documentElement.className?this._aboutMePhoto.classList.add("grayscale"):this._aboutMePhoto.classList.remove("grayscale"))}}(Ex)),Px=new class{constructor(t){this._useHighCharts=!0,this._charts=[],this._highCharts=[],this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="skillCharts",e.className="fullwidth",t.appendChild(e);let i=document.createElement("div");i.className="sectionTitle",i.innerHTML="Skills",e.appendChild(i),this._useHighCharts?this.createHighChart(e,{_chartType:"column",_title:"Languages",_categories:["C#","C++","Typescript","GLSL","Java","SQL","Python"],_chartID:"languageChart",_units:" years",_dataSets:[{name:"Professional",color:a.backgroundColor,data:[3,.4,2,2,0,.2,0]},{name:"School",color:a.backgroundColor,data:[.5,4,0,0,1,1,.5]},{name:"Hobby",color:l.backgroundColor,data:[5,3,.6,.6,.3,0,0]}]}):this.createChart(e,{_chartType:"bar",_labels:["C++","C#","Typescript","Python","Java","SQL","GLSL"],_chartID:"languageChart",_units:" years",_dataSets:[{_label:"Professional",_colorTheme:a,_data:[.6,2,2,0,0,0,2]},{_label:"Hobby",_colorTheme:l,_data:[5,7,.6,.3,.4,.6,.7]}]}),this._useHighCharts?this.createHighChart(e,{_chartType:"column",_title:"Software",_categories:["Unity","Blender","Substance Painter","Three.js","Android Studio","Unreal Engine"],_chartID:"softwareChart",_units:" years",_dataSets:[{name:"Professional",color:a.backgroundColor,data:[3,0,0,2,0,0]},{name:"School",color:a.backgroundColor,data:[0,0,0,0,1,0]},{name:"Hobby",color:l.backgroundColor,data:[5,8,4,.6,.3,.7]}]}):this.createChart(e,{_chartType:"bar",_labels:["Unity","Blender","Substance Painter","Three.js","Android Studio","Unreal Engine"],_chartID:"softwareChart",_units:" years",_dataSets:[{_label:"Professional",_colorTheme:a,_data:[2,0,0,0,2,0]},{_label:"Hobby",_colorTheme:l,_data:[7,.2,6,3,.6,.6]}]}),this.updateChartColors()}createHighChart(t,e){let i=document.createElement("div");i.id=e._chartID,window.innerWidth/window.innerHeight>2.5&&(i.style.width="35vw"),t.appendChild(i);let n=Ao.chart(i,{chart:{type:e._chartType,backgroundColor:"rgba(0, 0, 0, 0)"},title:{text:e._title,align:"left",style:{color:"aliceblue",fontSize:wx.value?"4.0vw":"2vw"}},xAxis:{categories:e._categories,labels:{rotation:0,style:{color:"aliceblue",fontSize:wx.value?"1.75vw":"0.75vw"}}},yAxis:{min:0,title:{text:""},stackLabels:{enabled:!0,style:{fontSize:wx.value?"2.5vw":"1vw"}},labels:{style:{color:"aliceblue",fontSize:wx.value?"1.75vw":"0.75vw"},formatter:function(){return this.value+e._units}}},legend:{align:"left",x:0,verticalAlign:"top",y:0,floating:!1,backgroundColor:"rgba(0, 0, 0, 0.0)",shadow:!1,itemStyle:{color:"aliceblue",fontSize:wx.value?"3.0vw":"1vw"}},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}"+e._units+"<br/>Total: {point.stackTotal}"+e._units,style:{fontSize:wx.value?"2.0vw":"1vw"}},plotOptions:{series:{marker:{radius:2}},column:{stacking:"normal",dataLabels:{enabled:!0,style:{fontSize:wx.value?"2.0vw":"0.75vw"}}}},series:e._dataSets});this._highCharts.push(n)}createChart(t,e){let i={labels:e._labels,datasets:[]};for(let t=0;t<e._dataSets.length;t++)i.datasets.push(Object.assign({label:e._dataSets[t]._label,data:e._dataSets[t]._data},e._dataSets[t]._colorTheme));let n=document.createElement("div");n.className="skillChartItem",n.id=e._chartID,t.appendChild(n);let s=document.createElement("canvas");n.appendChild(s),this._charts.push(new Eo(s,{type:e._chartType,data:i,options:{animation:{duration:2e3},scales:{y:{max:e._maxScale,beginAtZero:!0,ticks:{color:"#ffffff",callback:function(t,i,n){return t+e._units}},grid:{color:"rgba(100, 100, 100, 0.5)"}},x:{ticks:{color:"#ffffff"},grid:{color:"rgba(100, 100, 100, 0.5)"}}},elements:{line:{borderWidth:3}},color:"#ffffff"}}))}updateChartColors(){let t=a,e=l,i=u;switch(document.documentElement.className){case"greenTheme":t=d,e=h,i=u;break;case"orangeTheme":t=d,e=l,i=p;break;case"purpleTheme":t=h,e=c,i=u;break;case"grayscaleTheme":t=f,e=m,i=g}if(this._useHighCharts)for(let n=0;n<this._highCharts.length;++n)this._highCharts[n].series[0].update({color:t.backgroundColor,type:"column"}),this._highCharts[n].series[1].update({color:e.backgroundColor,type:"column"}),this._highCharts[n].series[2].update({color:i.backgroundColor,type:"column"});else for(let i=0;i<this._charts.length;++i)this._charts[i].data.datasets[0].backgroundColor=t.backgroundColor,this._charts[i].data.datasets[1].backgroundColor=e.backgroundColor,this._charts[i].update()}}(Ex),Lx=new class{constructor(t){this._skills=[],this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="specialSkillsPanel",e.className="fullwidth",t.appendChild(e);const i=document.createElement("div");i.id="specialSkillsProgramming",e.appendChild(i);let n=document.createElement("div");n.className="subtitle",n.innerHTML="Programming Skills",i.appendChild(n),this._skills.push(new Po(i,"","Procedural Generation","Built a 3D engine that procedurally generates planets directly in the browser and supports a wide array of unique planets to be generated from a single seed.\nWorked on a procedural volumetric terrain system that is also able to generate underground caves.")),this._skills.push(new Po(i,"","Shader Development","Built complex shaders in GLSL, HLSL & Unity ShaderLab, shaders which include: standard mesh shaders, VFX, PBR lighting, atmosphere simulation, post processing shaders, compute shaders, etc.")),this._skills.push(new Po(i,"","Graphics Programming","Worked with OpenGL, SFML, SDL2, Sokol & WebGL on a couple of projects and learned a lot of principles related to graphics programming (how rendering pipelines work, object instancing, dynamic mesh generation, volumetric terrain, shaders, etc.)")),this._skills.push(new Po(i,"","VR Development","Built a couple of VR applications on Occulus Quest 2 using the Unity BNG framework.\nDeveloped a hand gesture & motion recognition system for a game prototype, both for Unity & Unreal Engine.")),this._skills.push(new Po(i,"","Network Programming","Contributed to a couple of multi-user applications (VR, Android, WebGL, Desktop). APIs that I worked with: Photon 2, Colyseus, Unity Networking.")),this._skills.push(new Po(i,"","Backend Connection & Setup","Have knowledge about how a backend should work, how you can set it up to receive/send calls to/from it & query information from a database.\nPlayed a big part in deploying the backend & the servers required for a game prototype.")),this._skills.push(new Po(i,"","Multithreaded Programming","Worked on a couple of projects that made use of multithreading and learned about the rules & best practices that you need to follow when implementing a multithreaded app.\nBuilt a worker system in C++ which is responsible for building resources in a separate thread & returns them in the main thread.")),this._skills.push(new Po(i,"","Android, Desktop, WebGL & VR Deployment","Deployed multiple applications to the mentioned platforms and have knowledge about what are the hurdles that you have to get through in each of the platforms mentioned.")),this._skills.push(new Po(i,"","Optimizations","Spent a lot of time learning how to properly optimize aplications (how textures should be packed, how to combine assets in asset bundles, what settings you should use for each platform, how to profile an app for efficiency, memory management, pre-loading resources, etc.)")),this._skills.push(new Po(i,"","Web Development","Made this site from scratch using Node.js, Typescript & Three.js for the 3D Visualizer.\nBuild a couple of websites that each made use of Three.js to achieve interesting & unique experiences directly in the browser."));const s=document.createElement("div");s.id="specialSkillsArt",e.appendChild(s);let r=document.createElement("div");r.className="subtitle",r.innerHTML="3D Skills",s.appendChild(r),this._skills.push(new Po(s,"","3D Modelling","Know how to create 3D models from a given reference sheet. My main specialization is in making Humanoid characters, but also have some experience in weapons & game props.")),this._skills.push(new Po(s,"","Sculpting","Know the basics of how to use sculpting tools to achieve high level detail.")),this._skills.push(new Po(s,"","Retopology","Retopologized a lot of high-poly sculptures and know how to properly construct the geometry flow to help the texturing/animation process.")),this._skills.push(new Po(s,"","UV Unwrapping","Have experience in UV Unwrapping different kinds of models & making sure the UV layouts are properly defined to achieve the maximum resolution in the most important areas.")),this._skills.push(new Po(s,"","Texturing","Have experience in texturing 3D models in Blender & Substance Painter, using smart materials, generators, filters & hand painting.")),this._skills.push(new Po(s,"","Rigging","Have experience in creating standardized rigs for characters & how to define constraints to help in the animation process (Inverse Kinematics).")),this._skills.push(new Po(s,"","Game Ready Pipeline","Have a deep understanding of what optimization steps a model needs to go through to achieve maximum performance in games (how to pack textures in different color channels, LODs, optimize geometry, single material channels, drawing calls, etc.)"));let o=document.createElement("div");o.className="separator",o.style.marginTop="2vw",e.appendChild(o)}update(){for(let t=0;t<this._skills.length;++t)this._skills[t].update()}}(Ex),Rx=new class{constructor(t){this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="workProjectsPanel",e.className="fullwidth",t.appendChild(e);let i=document.createElement("div");i.className="sectionTitle",i.innerHTML="Professional Projects",e.appendChild(i);let n={_id:"planetquestCell",_title:"Planet Quest",_description:"<br>\n            PlanetQuest is a Blockchain game in which you can explore procedurally generated planets directly in your browser. I was one of the first persons that joined the team and played a big role during the entire development of the project.<br><br>\n            Key contributions: <br>\n            <div class='bulletPointList'>\n                <b>&#149;</b> Developed a 3D engine that is able to procedurally generate planets directly in the browser. <br>\n                <b>&#149;</b> Played a big role in the gameplay aspect of the project, by developing a lot of the core gameplay mechanics. <br>\n                <b>&#149;</b> Played a big role in each of the product launches. <br> \n                <b>&#149;</b> Helped out in building a procedural volumetric terrain system that is also able to generate underground caves. <br>\n                <b>&#149;</b> Currently helping out on the engine development side, by creating the tools that are required to run the game in the most optimal manner.\n            </div>",_tags:["WebGL","Typescript","C++","Procedural","Custom Engine"],_tagColors:[v,v,v,x,_],_btn1Link:"",_btn2Link:"https://planetquest.io",_imagesPath:"images/gallery/planetquest/",_imageCount:7,_videoFormatIndices:[5,6],_imageDurationMs:5e3,_downloadPath:"",_downloadName:"",_btn1Name:"More Details",_btn2Name:"Project Link"},s={_id:"recogneoCell",_title:"Recogneo",_description:"<br>\n            Recogneo is a library that is able to generate datasets for AI training in a matter of minutes, process which would take weeks if done manually. You can generate thousands or even milions of images in the environment that you want to train your AI model in, while also generating annotations for the Yolo & Coco-based models.<br><br>\n            Key contributions:<br>\n            <div class='bulletPointList'>\n                <b>&#149;</b> Developed the image generation logic. <br>\n                <b>&#149;</b> Implemented image processing algorithms using compute shaders, to generate the desired results in a very optimal manner. <br>\n                <b>&#149;</b> Developed the logic for automatically generating the annotations for the datasets. <br>\n                <b>&#149;</b> Trained a couple of AI models in different environments to test the accuracy of the datasets generated. <br>\n            </div>\n            ",_tags:["Unity","C#","AI Training","Image Processing","Compute Shaders"],_tagColors:[_,v,y,y,y],_btn1Link:"",_btn2Link:"",_imagesPath:"images/gallery/recogneo/",_imageCount:5,_videoFormatIndices:[3,4],_imageDurationMs:5e3,_downloadPath:"",_downloadName:"",_btn1Name:"More Details",_btn2Name:"Project Link"};wx.value?(this._pqGalery=new o(e,1,n),this._recogneoGalery=new o(e,1,s)):(this._pqGalery=new Lo(e,n),this._recogneoGalery=new Lo(e,s));let r=document.createElement("div");r.className="separator",e.appendChild(r)}update(){this._pqGalery.update(),this._recogneoGalery.update()}updateColorTheme(){this._pqGalery.updateColorTheme(),this._recogneoGalery.updateColorTheme()}}(Ex),Dx=new class{constructor(t){this._galleries=[],this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="gameProjectsPanel",e.className="fullwidth",t.appendChild(e);let i=document.createElement("div");i.className="sectionTitle",i.innerHTML="Personal Projects",e.appendChild(i),this._galleries.push(new o(e,2,{_id:"jorogumosCradleCell",_title:"Jorogumo's Cradle",_description:"\n                Short first-person horror game that I built as a passion project, in order to learn Unreal Engine and launch my first ever steam game.<br>\n                <br>\n                The game is a short, 30 min experience in which you have to explore a wild forest and build tools to defend yourself against a humanoid spider-like creature.<br>\n                <br>\n                The enemy has multiple attack patterns that it utilizes to get into your cabin, which is the only thing keeping it at bay. You need to react to it's attack patterns and find ways to stop it from breaking through. This includes: building torches to burn the spider webs, navigating labyrinth-like structures, setting up a blockade inside the cabin, shooting the monster down with a slingshot, etc.\n            ",_tags:["Unreal Engine","Blueprints","First-Person","Horror","Steam Release","Enemy AI"],_tagColors:[_,v,x,x,y,y],_btn1Link:"https://store.steampowered.com/app/2914870/Jorogumos_Cradle/",_btn2Link:"",_imagesPath:"images/gallery/jorogumos-cradle/",_imageCount:8,_videoFormatIndices:[0],_imageDurationMs:5e3,_imgExtension:"jpg",_downloadPath:"",_downloadName:"",_btn1Name:"More Details",_btn2Name:""})),this._galleries.push(new o(e,2,{_id:"serenityGardenCell",_title:"Serenity Garden",_description:"Tower defense game that I build as part of my Bachelor's Degree assessment.<br><br>\n            The game has the following features:<br>\n            <div class='bulletPointList'>\n                <b>&#149;</b> Construct & upgrade 6 different types of turrets<br>\n                <b>&#149;</b> Control a playable character that shoots enemies & can empower the turrets<br>\n                <b>&#149;</b> Play 30 different PvE levels on 6 different maps<br>\n                <b>&#149;</b> Buy permanent upgrades for your turrets<br>\n                <b>&#149;</b> Play a co-op boss-fight arena mode with a friend on 3 different difficulties<br>\n                <b>&#149;</b> Windows & Android executables<br>\n                <b>&#149;</b> Multi-platform co-op (Android devices can match with Windows devices)\n            </div>",_tags:["Unity","Photon 2","C#","Tower Defense","Multi-user","Multi-platform"],_tagColors:[_,_,v,x,y,y],_btn1Link:"https://kirirato.itch.io/serenity-garden",_btn2Link:"",_imagesPath:"images/gallery/serenity-garden/",_imageCount:7,_videoFormatIndices:[0],_imageDurationMs:5e3,_downloadPath:"https://drive.google.com/file/d/1ZznBIv_GS-IxAVjlkC9eRUwwSig6ISaT/view?usp=sharing",_downloadName:"Serenity Garden TD.rar",_btn1Name:"More Details",_btn2Name:"Download"})),this._galleries.push(new o(e,2,{_id:"chickenInvadersCell",_title:"Chicken Invaders DX",_description:"Replica of the initial Chicken Invaders DX game, which contains the following:<br>\n            <div class='bulletPointList'>\n                <b>&#149;</b> 10 playable levels that repeat endlessly<br>\n                <b>&#149;</b> Local leaderboard system<br>\n                <b>&#149;</b> Weapon utility with 8 different levels, each having a different attack pattern<br>\n                <b>&#149;</b> Rocket that fries all chickens and skips the level<br>\n                <b>&#149;</b> Assistant spaceship that helps with shooting enemies<br>\n                <br>\n                Main Contributions:<br>\n                <b>&#149;</b> Implemented asteroid belt and waves 4-5<br>\n                <b>&#149;</b> Created the spritesheets for all non-ui elements in the game (spaceship, chickens, weapons, asteroids, etc.)<br>\n                <b>&#149;</b> Optimized resource loading using multithreaded programming\n                </div>",_tags:["C++","SFML","Bullet Hell","Endless","Leaderboard"],_tagColors:[v,v,x,y,y],_btn1Link:"https://kirirato.itch.io/chicken-invaders-dx",_btn2Link:"",_imagesPath:"images/gallery/chicken-invaders/",_imageCount:6,_videoFormatIndices:[0],_imageDurationMs:5e3,_downloadPath:"https://drive.google.com/file/d/12X9nBBK_FJtfkDELjQtOVL-uhzYNnnev/view?usp=sharing",_downloadName:"Chicken Invaders DX.rar",_btn1Name:"More Details",_btn2Name:"Download"})),this._galleries.push(new o(e,2,{_id:"legeithielUnaelianCell",_title:"Legeithiel Unaelian",_description:"Bullet-hell game that I built during my time at the University of Lincoln UK<br><br>\n                It contains the following:<br>\n            <div class='bulletPointList'>\n                <b>&#149;</b> 3 playable levels<br>\n                <b>&#149;</b> 3 types of powerups (increased movement speed, double damage, faster fire rate)<br>\n                <b>&#149;</b> Pause menu from which you can tweak sound settings<br>\n                <b>&#149;</b> Leaderboard system stored locally<br>\n                <b>&#149;</b> Controller support\n            </div>",_tags:["Unity","C#","Bullet Hell","Leaderboard","Controller Support"],_tagColors:[_,v,x,y,y],_btn1Link:"https://kirirato.itch.io/legeithiel-unaelian",_btn2Link:"",_imagesPath:"images/gallery/legeithiel-unaelian/",_imageCount:5,_videoFormatIndices:[0],_imageDurationMs:5e3,_imgExtension:"png",_downloadPath:"https://drive.google.com/file/d/1yx7KNyS5YnUH3r_LGqOQwMHjVEFkOKgw/view?usp=sharing",_downloadName:"Legeithiel Unaelian.rar",_btn1Name:"More Details",_btn2Name:"Download"}));let n=document.createElement("div");n.className="middleCenterBtnBorder",e.appendChild(n);let s=document.createElement("div");s.className="middleCenterBtn",s.addEventListener("mousedown",(()=>{window.open("https://kirirato.itch.io","_blank")})),n.appendChild(s);let r=document.createElement("div");r.className="centerText",r.innerHTML="More Games",s.appendChild(r);let a=document.createElement("div");a.className="separator",a.style.marginTop="2vw",e.appendChild(a)}update(){for(let t=0;t<this._galleries.length;++t)this._galleries[t].update()}updateColorTheme(){for(let t=0;t<this._galleries.length;++t)this._galleries[t].updateColorTheme()}}(Ex),Ix=new class{constructor(t){this._cells=[],this.createElements(t)}createElements(t){const e=document.createElement("div");e.id="artProjectsPanel",e.className="fullwidth",t.appendChild(e);let i=document.createElement("div");i.className="sectionTitle",i.innerHTML="3D Models",i.style.paddingBottom="2vw",e.appendChild(i);const n=wx.value?2:4;this._cells.push(new s(e,n,"Ori","images/models/Ori.jpg")),this._cells.push(new s(e,n,"MechaGirl","images/models/MechaGirl.jpg")),this._cells.push(new s(e,n,"OniGurl","images/models/OniGurl.jpg")),this._cells.push(new s(e,n,"Jorogumo","images/models/Jorogumo.jpg")),this._cells.push(new s(e,n,"MechSpider","images/models/MechSpider.jpg")),this._cells.push(new s(e,n,"GodEater","images/models/GodEaterChainsaw.jpg")),this._cells.push(new s(e,n,"AnchorSword","images/models/AnchorSword.jpg")),this._cells.push(new s(e,n,"FantasyBow","images/models/FantasyBow.jpg"));let r=document.createElement("div");r.id="renderGalleryParent",document.body.appendChild(r);let o=document.createElement("div");o.className="middleCenterBtnBorder",o.style.marginTop="2vw",o.style.marginBottom="1vw",e.appendChild(o);let a=document.createElement("div");a.className="middleCenterBtn",a.addEventListener("mousedown",(()=>{window.open("https://sketchfab.com/kirirato","_blank")})),o.appendChild(a);let l=document.createElement("div");l.className="centerText",l.innerHTML="More Models",a.appendChild(l)}updateColorTheme(){for(let t=0;t<this._cells.length;++t)this._cells[t].updateColorTheme()}}(Ex),kx=new class{constructor(){this._icons=[],this.createElements()}createElements(){const t=document.createElement("div");t.id="endingPanelParent",t.className="fullwidth",document.body.appendChild(t);let e=document.createElement("div");e.className="separator",t.appendChild(e);let i=document.createElement("div");i.id="endingPanelText",i.innerHTML="\n        Thank you for spending the time to look through my portfolio!<br>\n        Feel free to contact me at the following address: <div style='display: inline-block; color: var(--secondary-color);'>ionutopriaofficial@gmail.com</div><br>\n        ",t.appendChild(i);let n=document.createElement("div");n.id="linksParent",t.appendChild(n),this.createCellLink(n,"./images/icons/linkedin.jpg","https://www.linkedin.com/in/ionut-opria-6164b5150/"),this.createCellLink(n,"./images/icons/github.jpg","https://github.com/OpriaIonut"),this.createCellLink(n,"./images/icons/itch.jpg","https://kirirato.itch.io"),this.createCellLink(n,"./images/icons/artstation.jpg","https://www.artstation.com/kirirato16"),this.createCellLink(n,"./images/icons/twitter.jpg","https://twitter.com/Kirirato"),this.createCellLink(n,"./images/icons/CV3.jpg","CV");let s=document.createElement("div");s.id="copyright",s.innerHTML="Copyright © 2024 by Ionu&#x021b; Opria<br>All content and trademarks property of their respective owners",t.appendChild(s)}createCellLink(t,e,i){let n=document.createElement("img");n.className="homePageReferalLink",n.src=e,"CV"==i?n.addEventListener("mousedown",(()=>{this.downloadFile("CV Ionut Opria.pdf","CV Ionut Opria.pdf")})):n.addEventListener("mousedown",(()=>{window.open(i,"_blank")})),n.style.cursor="pointer",t.appendChild(n),this._icons.push(n)}downloadFile(t,e){const i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}updateColorTheme(){for(let t=0;t<this._icons.length;++t)"grayscaleTheme"==document.documentElement.className?this._icons[t].classList.add("grayscale"):this._icons[t].classList.remove("grayscale")}},Ox=new yx,Nx=document.createElement("div");Nx.id="warningMsg",Nx.style.display="none";let Ux=document.createElement("div");Ux.id="warningMsgText",Ux.innerHTML="Please open the website in a landscape/desktop format.",Nx.appendChild(Ux),document.body.appendChild(Nx);let Bx=0;requestAnimationFrame((function t(e){requestAnimationFrame(t),wx.value=window.innerWidth/window.innerHeight<1;let i=.01*(e-Bx);Bx=e,Mx.currentTime=e,Mx.deltaTime=i,Ax.update(),Ox.update(i),Rx.update(),Dx.update(),Lx.update()})),window.addEventListener("click",(()=>{Sx.value=!0}))})()})();